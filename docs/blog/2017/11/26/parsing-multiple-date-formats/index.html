
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Parsing multiple date formats with clj-time - Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Parsing multiple date formats with clj-time" />
    <meta itemprop="description" content="Need to parse strings with multiple date formats into dates? Here is how you can do it." />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Parsing multiple date formats with clj-time" />
    <meta name="twitter:description" content="Need to parse strings with multiple date formats into dates? Here is how you can do it." />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="The Blog of Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/blog/2017/11/26/parsing-multiple-date-formats/" />
    <meta property="og:title" content="Parsing multiple date formats with clj-time" />
    <meta property="og:description" content="Need to parse strings with multiple date formats into dates? Here is how you can do it." />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
      <meta property="og:type" content="article" />
    
    
      <meta property="article:published_time" content="2017-11-26T09:52:00-06:00" />
    

    <meta name="description" content="Need to parse strings with multiple date formats into dates? Here is how you can do it.">

    <meta name="keywords" content="clojure, java, joda, jodatime, joda-time, date, clj-time">

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/blog/2017/11/26/parsing-multiple-date-formats/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
    
<script>
 var origin = window.location.origin;
 if (!origin) {
   origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
 }
 if (origin.indexOf('localhost') === -1) {
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-19834208-2', 'auto');
   ga('send', 'pageview');
 }
</script>


  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div>
  <article class="hentry" role="article">
    
  <header>
    
      <h1 class="entry-title">Parsing multiple date formats with clj-time</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-11-26T09:52:00-06:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>9:52 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I recently needed to optimize the speed of some Clojure code. After investigating, I identified that a huge number of exceptions were being thrown and handling these was slowing down the process.</p>

<p>The code throwing the exceptions was parsing strings into Joda-Time DateTime objects using the <a href="https://github.com/clj-time/clj-time">clj-time</a> library.</p>

<p>The code was calling <a href="https://github.com/clj-time/clj-time/blob/cce58248937bc05452ebfc8b65134961227a554e/src/clj_time/coerce.clj#L33-L38">clj-time.coerce/from-string</a> which calls <a href="https://github.com/clj-time/clj-time/blob/cce58248937bc05452ebfc8b65134961227a554e/src/clj_time/format.clj#L156-L165">clj-time.format/parse</a>. <code>format/parse</code> iterates through up to approximately 50 formatters in an attempt to parse whatever string you pass it. If one of these formatters doesn’t parse the string, it throws an exception which <code>format/parse</code> catches and ignores before attempting the next formatter.</p>

<p>This was pretty wasteful. This was especially wasteful in the code I was working in since it only needed to handle two different date formats.</p>

<p>Luckily, Joda-Time has a way to build a formatter that handles multiple formats and clj-time provides access to it. Below is code that creates a formatter that handles two different formats.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">multiple-dates.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clj-time.core</span> <span class="ss">:as</span> <span class="nv">time</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clj-time.format</span> <span class="ss">:as</span> <span class="nv">time-format</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">multi-format</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">time-format/formatter</span> <span class="nv">time/utc</span>
</span><span class='line'>                         <span class="s">&quot;YYYY-MM-dd&quot;</span>
</span><span class='line'>                         <span class="s">&quot;YYYY-MM-dd&#39;T&#39;HH:mm:ss.SSSZ&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nb">parse </span><span class="p">[</span><span class="nv">s</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">time-format/parse</span> <span class="nv">multi-format</span> <span class="nv">s</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>And below are some examples of using it in the repl.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">multiple-dates.core&gt;</span> <span class="p">(</span><span class="nb">parse </span><span class="s">&quot;2017-09-04&quot;</span><span class="p">)</span>
</span><span class='line'><span class="o">#</span><span class="nv">object</span><span class="p">[</span><span class="nv">org.joda.time.DateTime</span> <span class="mi">0</span><span class="nv">x5d5e4cd7</span> <span class="s">&quot;2017-09-04T00:00:00.000Z&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">multiple-dates.core&gt;</span> <span class="p">(</span><span class="nb">parse </span><span class="s">&quot;2017-09-04T12:11:02.123Z&quot;</span><span class="p">)</span>
</span><span class='line'><span class="o">#</span><span class="nv">object</span><span class="p">[</span><span class="nv">org.joda.time.DateTime</span> <span class="mi">0</span><span class="nv">x174f3a5c</span> <span class="s">&quot;2017-09-04T12:11:02.123Z&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">multiple-dates.core&gt;</span> <span class="p">(</span><span class="nb">parse </span><span class="s">&quot;2017-09-04-12:11:02.123Z&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nv">IllegalArgumentException</span> <span class="nv">Invalid</span> <span class="nv">format</span><span class="err">:</span> <span class="s">&quot;2017-09-04-12:11:02.123Z&quot;</span> <span class="nv">is</span> <span class="nv">malformed</span> <span class="nv">at</span> <span class="s">&quot;-12:11:02.123Z&quot;</span>  <span class="nv">org.joda.time.format.DateTimeFormatter.parseDateTime</span> <span class="p">(</span><span class="nf">DateTimeFormatter.java</span><span class="ss">:945</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Looking back at that code, it seems pretty straightforward. I’ll admit that it took me and my pair a while to figure out how to do this using <code>clj-time</code>. I ended up looking at Joda-Time&rsquo;s documentation and implemented this using Java interop before I cracked how to use <code>clj-time.format/formatter</code> to do the same thing.</p>
</div>


    <em>Looking forward to the next article? Never miss a post by subscribing using <a target="_blank" href="https://jakemccrary.substack.com/">e-mail</a> or <a href="https://feeds.feedburner.com/JakeMccrarysMusings">RSS</a>.
</em>

    <footer>
      <p class="meta">
        
  

<span class="byline author vcard">Posted by <span class="fn">Jake McCrary</span></span>

        




<time class='entry-date' datetime='2017-11-26T09:52:00-06:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>9:52 am</span></time>
        

<span class="categories">
  
    <a class='category' href='/blog/categories/clojure/'>clojure</a>, <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


      </p>
      
      <div class="sharing">
  
</div>

      
      <p class="meta">
        
        <a class="basic-alignment left" href="/blog/2017/10/31/a-guide-to-distributed-work/" title="Previous Post: A guide to distributed work">&laquo; A guide to distributed work</a>
        
        
        <a class="basic-alignment right" href="/blog/2018/02/18/using-clojure-macros-for-nicer-error-handling/" title="Next Post: Using Clojure macros for nicer error handling">Using Clojure macros for nicer error handling &raquo;</a>
        
      </p>
    </footer>
  </article>
  
  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite">

  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <div id="disqus_target" >
    <script>
     var insertDisqus = function() {
       var elem = document.createElement('script');
       elem.innerHTML =  "var disqus_shortname = 'jakemccrary'; var disqus_identifier = 'https://jakemccrary.com/blog/2017/11/26/parsing-multiple-date-formats/'; var disqus_url = 'https://jakemccrary.com/blog/2017/11/26/parsing-multiple-date-formats/'; (function () {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);}());"
       var target = document.getElementById('disqus_target');
       target.parentNode.replaceChild(elem, target);
     }
    </script>
    <button class="comment-button" onclick="insertDisqus()"><span>ENABLE COMMENTS AND RECOMMENDED ARTICLES</span></button>
  </div>

</div>
  </section>
  
</div>

<aside class="sidebar">
  
  <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/03/16/a-retrospective-format/">A retrospective format for remote or co-located teams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/03/10/more-working-from-home-tips/">More working from home tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/02/25/auto-syncing-a-git-repository/">Auto-syncing a git repository</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/01/11/reading-in-2019/">Reading in 2019</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/12/building-an-atreus-keyboard/">Building an Atreus keyboard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/23/building-a-onewheel-stand/">Building a Onewheel stand</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/15/switching-my-ergodox-to-qmk-firmware/">Switching my Ergodox to QMK firmware</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/30/how-i-use-social-media/">How I use social media</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/03/20/breaking-change-and-more-in-lein-test-refresh-0-dot-24-dot-0/">Breaking change and more in lein-test-refresh 0.24.1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/13/testing-asynchronous-javascript-with-jasmine/">Testing asynchronous JavaScript with Jasmine</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
  


</body>
</html>
