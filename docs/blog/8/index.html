
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Jake McCrary" />
    <meta itemprop="description" content=" Leiningen checkout dependencies are a useful
feature. Checkout dependencies allow you to work on a library and consuming
project at the same time. By &hellip;" />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Jake McCrary" />
    <meta name="twitter:description" content=" Leiningen checkout dependencies are a useful
feature. Checkout dependencies allow you to work on a library and consuming
project at the same time. By &hellip;" />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="Writing by Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/blog/8/" />
    <meta property="og:title" content="Jake McCrary" />
    <meta property="og:description" content=" Leiningen checkout dependencies are a useful
feature. Checkout dependencies allow you to work on a library and consuming
project at the same time. By &hellip;" />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
    

    <meta name="description" content=" Leiningen checkout dependencies are a useful
feature. Checkout dependencies allow you to work on a library and consuming
project at the same time. By &hellip;">

    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/blog/8/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
    
<script>
 var origin = window.location.origin;
 if (!origin) {
   origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
 }
 if (origin.indexOf('localhost') === -1) {
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-19834208-2', 'auto');
   ga('send', 'pageview');
 }
</script>


  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  <li><a href="https://jakemccrary.substack.com/welcome" target="_blank" rel="subscribe-email" title="subscribe via email">Newsletter</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/24/advanced-leiningen-checkouts-configuring-what-ends-up-on-your-classpath/">Advanced Leiningen checkouts: configuring what ends up on your classpath</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-03-24T21:29:00-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:29 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://leiningen.org/">Leiningen</a> checkout dependencies are a useful
feature. Checkout dependencies allow you to work on a library and consuming
project at the same time. By setting up checkout dependencies you can
skip running <code>lein install</code> in the library project; it appears on the
classpath of the consuming project. An example of what this looks like
can be found in the
<a href="https://github.com/technomancy/leiningen/blob/master/doc/TUTORIAL.md#checkout-dependencies">Leiningen documentation</a>
or in a
<a href="http://jakemccrary.com/blog/2012/03/28/working-on-multiple-clojure-projects-at-once/">previous post</a>
of mine.</p>

<p>By default, Leiningen adds the <code>:source-paths</code>, <code>:test-paths</code>,
<code>:resource-paths</code>, and <code>:compile-path</code> directories of the checkout
projects to your consuming project&rsquo;s classpath. It also recurses and
adds the checkouts of your checkouts (and keeps recursing).</p>

<p>You can override what gets added to your classpath by
<code>:checkout-deps-shares</code> to your project.clj. This key&rsquo;s value should
be a vector of functions that when applied to your checkouts' project
map return the paths that should be included on the classpath. The
default values can be found
<a href="https://github.com/technomancy/leiningen/blob/ff84da697249184874b528950048981621ac0b61/leiningen-core/src/leiningen/core/project.clj#L488-L492">here</a>
and an example of overriding the default behavior can be found in the
<a href="https://github.com/technomancy/leiningen/blob/ff84da697249184874b528950048981621ac0b61/sample.project.clj#L320-L321">sample.project.clj</a>.</p>

<p>I ran into a situation this week where having my checkouts'
<code>:test-paths</code> on the classpath caused issues my consuming project. My
first pass at fixing this problem was to add <code>:checkout-deps-shares
[:source-paths :resource-paths :compile-path]</code> to my project.clj. <strong>This
didn&rsquo;t work</strong>. My project.clj looked like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defproject </span><span class="nv">example</span> <span class="s">&quot;1.2.3-SNAPSHOT&quot;</span>
</span><span class='line'>  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">library</span> <span class="s">&quot;1.2.2&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.6.0&quot;</span><span class="p">]]</span>
</span><span class='line'>  <span class="ss">:checkout-deps-shares</span> <span class="p">[</span><span class="ss">:source-paths</span> <span class="ss">:resource-paths</span> <span class="ss">:compile-path</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>Why didn&rsquo;t it work? It didn&rsquo;t work because of how Leiningen merges
duplicate keys in the project map. When Leiningen merges the various
configuration maps (from merging profiles, merging defaults, etc) and
it encounters values that are collections it combines them (more
details found in
<a href="https://github.com/technomancy/leiningen/blob/master/doc/PROFILES.md#merging">documentation</a>).
Using <code>lein pprint :checkout-deps-shares</code> shows what we end up with.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">$</span> lein pprint :checkout-deps-shares
</span><span class='line'><span class="go">(:source-paths</span>
</span><span class='line'><span class="go"> :resource-paths</span>
</span><span class='line'><span class="go"> :compile-path</span>
</span><span class='line'><span class="go"> :source-paths</span>
</span><span class='line'><span class="go"> :test-paths</span>
</span><span class='line'><span class="go"> :resource-paths</span>
</span><span class='line'><span class="go"> :compile-path</span>
</span><span class='line'><span class="go"> #&lt;Var@43e3a075:</span>
</span><span class='line'><span class="go">   #&lt;classpath$checkout_deps_paths leiningen.core.classpath$checkout_deps_paths@6761b44b&gt;&gt;)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve ended up with the default values and the values we specified in
the project.clj. This isn&rsquo;t hard to fix. To tell Leiningen to replace
the value instead of merging you add the <code>^:replace</code> metadata to the
value. Below is the same project.clj but with <code>^:replace</code> added.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defproject </span><span class="nv">example</span> <span class="s">&quot;1.2.3-SNAPSHOT&quot;</span>
</span><span class='line'>  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">library</span> <span class="s">&quot;1.2.2&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.6.0&quot;</span><span class="p">]]</span>
</span><span class='line'>  <span class="ss">:checkout-deps-shares</span> <span class="o">^</span><span class="ss">:replace</span> <span class="p">[</span><span class="ss">:source-paths</span> <span class="ss">:resource-paths</span> <span class="ss">:compile-path</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>This solves the problem of <code>:test-paths</code> showing up on the classpath
but it introduces another problem. Checkouts' checkout dependencies no
longer show up on the classpath. This is because
<code>leiningen.core.classpath/checkout-deps-paths</code> is no longer applied to
the checkouts.</p>

<p>Without <code>leiningen.core.classpath/checkout-deps-paths</code> Leiningen stops
recursing and, as a result, no longer picks up checkouts' checkout
dependencies. My first attempt at fixing this was to modify my
project.clj so the <code>:checkout-deps-shares</code> section looked like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:checkout-deps-shares</span> <span class="o">^</span><span class="ss">:replace</span> <span class="p">[</span><span class="ss">:source-paths</span> <span class="ss">:resource-paths</span> <span class="ss">:compile-path</span>
</span><span class='line'>                                 <span class="nv">leiningen.core.classpath/checkout-deps-paths</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above fails. It runs but doesn&rsquo;t actually add the correct
directories to the classpath. The next attempt is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:checkout-deps-shares</span> <span class="o">^</span><span class="ss">:replace</span> <span class="p">[</span><span class="ss">:source-paths</span> <span class="ss">:resource-paths</span> <span class="ss">:compile-path</span>
</span><span class='line'>                                 <span class="o">#</span><span class="ss">&#39;leiningen.core.classpath/checkout-deps-paths</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This attempt failed quicker. Now an exception is thrown when trying to
run Leiningen tasks.</p>

<p>The next one works. It takes advantage of dynamic eval through
<a href="https://github.com/technomancy/leiningen/blob/master/doc/PROFILES.md#dynamic-eval">read-eval</a>
syntax. With the below snippet the checkouts' checkouts are added to
the classpath.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:checkout-deps-shares</span> <span class="o">^</span><span class="ss">:replace</span> <span class="p">[</span><span class="ss">:source-paths</span> <span class="ss">:resource-paths</span> <span class="ss">:compile-path</span>
</span><span class='line'>                                 <span class="o">#</span><span class="nv">=</span><span class="p">(</span><span class="nb">eval </span><span class="nv">leiningen.core.classpath/checkout-deps-paths</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hopefully this is useful to someone else. It took a bit of digging to
figure it out and many incorrect attempts to get correct. The full
example project.clj is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defproject </span><span class="nv">example</span> <span class="s">&quot;1.2.3-SNAPSHOT&quot;</span>
</span><span class='line'>  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">library</span> <span class="s">&quot;1.2.2&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.6.0&quot;</span><span class="p">]]</span>
</span><span class='line'>  <span class="ss">:checkout-deps-shares</span> <span class="o">^</span><span class="ss">:replace</span> <span class="p">[</span><span class="ss">:source-paths</span> <span class="ss">:resource-paths</span> <span class="ss">:compile-path</span>
</span><span class='line'>                                   <span class="o">#</span><span class="nv">=</span><span class="p">(</span><span class="nb">eval </span><span class="nv">leiningen.core.classpath/checkout-deps-paths</span><span class="p">)])</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/24/remote-pairing/">Remote Pairing</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-24T15:19:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:19 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>See all of my remote/working-from-home <a href="/blog/categories/remote/">articles here</a>.</p></blockquote>

<p>Over a year ago I joined <a href="http://outpace.com">Outpace</a>. All of
Outpace&rsquo;s developers are remote but we still practice pair
programming. As a result I&rsquo;ve done a lot of remote pairing. I was
skeptical before joining that it would work well and I&rsquo;m happy to
report that I was wrong. Remote pairing works.</p>

<h2>Why remote pairing?</h2>

<p>The usual pair programming
<a href="http://c2.com/cgi/wiki?PairProgrammingBenefits">benefits</a> apply to
remote pairing; more people know the code, quality is higher, and
it provides an opportunity for mentorship. Another benefit, more
beneficial in a remote setting, is that it increases <strong>social
interaction</strong>.</p>

<p>The most common response I receive when I tell someone I work from my
apartment is &ldquo;I&rsquo;d miss the interaction with co-workers.&rdquo; When you work
remote you do miss out on the usual in office interaction. Pair
programming helps replace some of this. It helps you build and
maintain relationships with your remote colleagues.</p>

<h2>Communication</h2>

<p>Communication is an important part of pair programming. When you&rsquo;re
pairing in person you use both physical and vocal communication. When
remote pairing you primarily use vocal communication. You can pick up
on some physical cues with video chat but it is hard. You will never
notice your pair reaching for their keyboard.</p>

<p>I&rsquo;ve used Google Hangouts, <a href="http://zoom.us">Zoom</a>, and Skype for
communication. Currently I&rsquo;m primarily using Zoom. It offers high
quality video and audio and usually doesn&rsquo;t consume too many
resources.</p>

<p>I recommend not using your computers built-in microphone. You should
use headphones with a mic or a directional microphone. You&rsquo;ll sound
better and you&rsquo;ll stop your pair from hearing themselves through your
computer.</p>

<p>I use
<a href="http://www.amazon.com/gp/product/B005VAORH6/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B005VAORH6&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=3AX26BCB4ZHZWLC5">these headphones</a>.
They are cheap, light, and open-eared but are wired. I&rsquo;ve been told I
sound the best when I&rsquo;m using them. I also own these
<a href="http://www.amazon.com/gp/product/B003VANOFY/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B003VANOFY&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=LDHRWNCUOO45B7G4">wireless headphones</a>.
They are closed-ear, heavier, and wireless. The wireless is great but
the closed-ear design causes me to talk differently and by the end of
the day my throat is hoarse. Both of these headphones are widely used
by my colleagues and I don&rsquo;t think you can go wrong with either one.</p>

<p>Some people don&rsquo;t like wearing headphones all day. If you are one of
those I&rsquo;d recommend picking up a directional microphone. Many of my
colleagues use a
<a href="http://www.amazon.com/gp/product/B002OO333Q/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B002OO333Q&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=XVNYHVNXTAC3J2RD">Snowball</a>.</p>

<h2>Connecting the machines</h2>

<p>So now you can communicate with your pair. It is time to deal with the
main problem in remote pairing. How do you actually work on the same
code with someone across the world?</p>

<p>At Outpace we&rsquo;ve somewhat cheated and have standardized our
development hardware. Everyone has a computer running OS X and, if
they want it, at least one 27 inch monitor (mostly Apple 27 inch
displays or a
<a href="http://www.amazon.com/gp/product/B009H0XQQY/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B009H0XQQY&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=JJLKLYNESYPKCRKZ">Dell</a>)
with a resolution of 2560x1440. Since everyone has nearly identical
hardware and software we are able to pair using OS X&rsquo;s built-in screen
sharing. This allows full sharing of the host&rsquo;s desktop. This full
desktop sharing is the best way to emulate working physically next to
your pair. This enable the use of any editor and lets you both look at
the same browser windows (useful for testing UIs or reading reference
material). With decent internet connections both programmers can write
code with minimal lag. This is my preferred way of pairing.</p>

<p>Another option that works well is <a href="http://tmate.io/">tmate</a>. tmate is
a fork of tmux that makes remote pairing easy. It makes it dead simple
to have remote developer connect to your machine and share your
terminal. This means you are stuck using tools that work in a terminal
and, if you are working on a user interface, you need to share that
some other way. There generally is less lag when the remote developer
is typing.</p>

<p>A third option is to have the host programmer share their screen using
screen sharing built-in to Google Hangouts or <a href="http://zoom.us">Zoom</a>.
This is a quick way to share a screen and is my preferred way of
sharing GUIs with more than one other person. With both Zoom and
Google Hangouts the remote developer can control the host&rsquo;s machine
but it isn&rsquo;t a great experience. If you are pairing this way the
remote developer rarely touches the keyboard.</p>

<h2>Soloing</h2>

<p>It might seem weird to have a section on soloing in an article about
remote pairing. Soloing happens and even in an environment that almost
entirely pairs it is important. Not everyone can or wants to pair 100%
of the time. Soloing can be recharging. It is important to be
self-aware and recognize if you need solo time. Below are a few tips
for getting that solo time.</p>

<p>One way to introduce solo time is to take your lunch at a different
time than your pair. This provides both of you and your pair with an
opportunity to do a bit of soloing.</p>

<p>Other short soloing opportunities happen because of meetings and
interviews. It isn&rsquo;t uncommon for half of a pair to leave for a bit to
join a meeting, give an interview, or jump over to help out another
developer for a bit.</p>

<p>Soloing also happens as a result of uneven team numbers. If your team
is odd numbered than there are plenty of opportunities for being a solo
developer. Try to volunteer to be the solo developer but be aware of
becoming too isolated.</p>

<h2>Conclusion</h2>

<p>Remote pairing works. Working at <a href="http://outpace.com">Outpace</a> has
shown me how well it can work. Reasonably fast Internet paired with
modern tools can make it seem like you&rsquo;re almost in the same room as
your pair.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/11/overview-of-my-leiningen-profiles-dot-clj/">Overview of my Leiningen profiles.clj</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-11T22:12:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:12 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p><strong>2017-08-27: I&rsquo;ve published an updated version <a href="/blog/2017/08/27/my-current-leiningen-profiles-dot-clj/">here</a>.</strong></p>

<p><a href="https://github.com/technomancy/leiningen">Leiningen</a>, a Clojure build
tool, has the concept of
<a href="https://github.com/technomancy/leiningen/blob/master/doc/PROFILES.md">profiles</a>.
One thing profiles are useful for is allowing you to have development
tools available to a project without having them as dependencies when
you release your project. An example of when you might want to do this
is when you are using a testing library like
<a href="https://github.com/jaycfields/expectations">expectations</a>.</p>

<p>Some development tools, such as
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a>, are
useful to have across most of your Clojure projects. Rather nicely,
Leiningen supports adding global profiles to <code>~/.lein/profiles.clj</code>.
These profiles are available in all your projects.</p>

<p>Below is most of my <code>profiles.clj</code>. I&rsquo;ve removed some sensitive
settings and what is left are the development tools that I find
useful.</p>

<figure class='code'><figcaption><span>Entire :user profile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:user</span> <span class="p">{</span><span class="ss">:plugin-repositories</span> <span class="p">[[</span><span class="s">&quot;private-plugins&quot;</span> <span class="p">{</span><span class="ss">:url</span> <span class="s">&quot;private repo url&quot;</span><span class="p">}]]</span>
</span><span class='line'>        <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">pjstadig/humane-test-output</span> <span class="s">&quot;0.6.0&quot;</span><span class="p">]]</span>
</span><span class='line'>        <span class="ss">:injections</span> <span class="p">[(</span><span class="nf">require</span> <span class="ss">&#39;pjstadig.humane-test-output</span><span class="p">)</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">pjstadig.humane-test-output/activate!</span><span class="p">)]</span>
</span><span class='line'>        <span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">cider/cider-nrepl</span> <span class="s">&quot;0.8.2&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">refactor-nrepl</span> <span class="s">&quot;0.2.2&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">com.jakemccrary/lein-test-refresh</span> <span class="s">&quot;0.5.5&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">lein-autoexpect</span> <span class="s">&quot;1.4.2&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">lein-ancient</span> <span class="s">&quot;0.5.5&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">jonase/eastwood</span> <span class="s">&quot;0.2.1&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">lein-kibit</span> <span class="s">&quot;0.0.8&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">lein-pprint</span> <span class="s">&quot;1.1.2&quot;</span><span class="p">]]</span>
</span><span class='line'>        <span class="ss">:test-refresh</span> <span class="p">{</span><span class="ss">:notify-command</span> <span class="p">[</span><span class="s">&quot;terminal-notifier&quot;</span> <span class="s">&quot;-title&quot;</span> <span class="s">&quot;Tests&quot;</span> <span class="s">&quot;-message&quot;</span><span class="p">]}}}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>:plugin-repositories [["private-plugins" {:url "private repo url"}]]</code>
sets a private plugin repository. This allows me to use
<a href="http://outpace.com/">Outpace&rsquo;s</a> private Leiningen templates for
setting up new projects for work.</p>

<p>The next few lines are all related. They setup
<a href="https://github.com/pjstadig/humane-test-output">humane-test-output</a>.
<code>humane-test-output</code> makes <code>clojure.test</code> output more readable. It
makes using <code>clojure.test</code> much more enjoyable. I highly recommend it.
Sample output can be found in my
<a href="/blog/2014/06/22/comparing-clojure-testing-libraries-output/">Comparing Clojure Testing Libraries</a>
post.</p>

<figure class='code'><figcaption><span>humane-test-output setup in the :user profile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">pjstadig/humane-test-output</span> <span class="s">&quot;0.6.0&quot;</span><span class="p">]]</span>
</span><span class='line'><span class="ss">:injections</span> <span class="p">[(</span><span class="nf">require</span> <span class="ss">&#39;pjstadig.humane-test-output</span><span class="p">)</span>
</span><span class='line'>             <span class="p">(</span><span class="nf">pjstadig.humane-test-output/activate!</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we get to my <code>:plugins</code> section. This is the bulk of
my <code>profiles.clj</code>.</p>

<figure class='code'><figcaption><span>:plugins section of my :user profile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">cider/cider-nrepl</span> <span class="s">&quot;0.8.2&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">refactor-nrepl</span> <span class="s">&quot;0.2.2&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">com.jakemccrary/lein-test-refresh</span> <span class="s">&quot;0.5.5&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">lein-autoexpect</span> <span class="s">&quot;1.4.2&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">lein-ancient</span> <span class="s">&quot;0.5.5&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">jonase/eastwood</span> <span class="s">&quot;0.2.1&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">lein-kibit</span> <span class="s">&quot;0.0.8&quot;</span><span class="p">]</span>
</span><span class='line'>          <span class="p">[</span><span class="nv">lein-pprint</span> <span class="s">&quot;1.1.2&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first entry is for <code>cider/cider-nrepl</code>. I write Clojure using
Emacs and <a href="https://github.com/clojure-emacs/cider">CIDER</a> and much of
CIDER&rsquo;s functionality exists in nrepl middleware found in
<code>cider/cider-nrepl</code>. This dependency is required for me to be
effective while writing Clojure.</p>

<p><code>refactor-nrepl</code> is next.
<a href="https://github.com/clojure-emacs/clj-refactor.el">clj-refactor.el</a>
requires it for some refactorings. I actually don&rsquo;t use any of those
refactorings (I only use move to let, extract to let, and
introduce let refactorings) but I still keep it around.</p>

<p><code>com.jakemccrary/lein-test-refresh</code> is next. This lets me use
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a>
globally. <code>lein-test-refresh</code> runs your <code>clojure.test</code> tests whenever
a file changes in your project. This is another key development tool
in my process.</p>

<p>Up next is <code>lein-autoexpect</code>. It was the first Leiningen plugin I
wrote and it enables continuous testing with
<a href="https://github.com/jaycfields/expectations">expectations</a>.</p>

<p>Both <code>lein-autoexpect</code> and <code>lein-test-refresh</code> are projects I created
and maintain. Writing <code>lein-autoexpect</code> was my first
exposure to continuous testing and it changed how I develop code. I
find it frustrating to develop without such a tool.</p>

<p>Next up is <a href="https://github.com/xsc/lein-ancient">lein-ancient</a>. It
checks your project.clj for outdated dependencies and plugins. It
isn&rsquo;t something that gets used every day but it is super useful when
you need it.</p>

<p>The next two entries are for
<a href="https://github.com/jonase/eastwood">jonase/eastwood</a> and
<a href="https://github.com/jonase/kibit">lein-kibit</a>. They are both tools
that look at your Clojure code and report common mistakes. I don&rsquo;t use
either consistently but I do find them useful. I&rsquo;ve found bugs with eastwood.</p>

<p>The final plugin is <code>lein-pprint</code>.
<a href="https://github.com/technomancy/leiningen/tree/master/lein-pprint">lein-pprint</a>
prints out your project map. It is useful for trying to grasp what is
going on when messing around with various Leiningen options.</p>

<p>The final part, seen below, of my <code>profiles.clj</code> is configuration for
<code>lein-test-refresh.</code> It configures <code>lein-test-refresh</code> to use
<a href="https://github.com/alloy/terminal-notifier">terminal-notifier</a> to
notify me when my tests pass or fail. Using a continuous tester that
allows flexible notification is useful. Not having to glance at a
terminal to see if your tests are passing or failing is great.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:test-refresh</span> <span class="p">{</span><span class="ss">:notify-command</span> <span class="p">[</span><span class="s">&quot;terminal-notifier&quot;</span> <span class="s">&quot;-title&quot;</span> <span class="s">&quot;Tests&quot;</span> <span class="s">&quot;-message&quot;</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That is my <code>~/.lein/profiles.clj</code>. I don&rsquo;t think it contains anything
mind blowing but it definitely contains a useful collection of Clojure
development tools. I encourage you to check out them out and to think
about what tools you should be putting into your global <code>:user</code>
profile.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/08/reading-in-2014/">Reading in 2014</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-08T22:59:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:59 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>At the beginning of last year I took some time and
<a href="http://jakemccrary.com/blog/2014/01/01/using-incanter-to-review-my-2013-reading/">reviewed</a>
my 2013 reading using Clojure and Incanter to generate some stats. It
was a useful exercise to reflect back on my reading and play around
with Incanter again.</p>

<p>Over the last couple of weeks I&rsquo;ve taken a similar look at my
2014 reading. The rest of this post highlights some of the top books
from the previous year and then posts some numbers at the end.</p>

<p>I review every book I read using
<a href="https://www.goodreads.com/">Goodreads</a>. If you want to see more of
what I&rsquo;ve been reading you can find me
<a href="https://www.goodreads.com/user/show/3431614-jake-mccrary">here</a>. I
track and review every book I read and have found this practice to be
extremely rewarding.</p>

<h3>2014 Goals</h3>

<p>I entered 2014 without a volume goal. Unlike 2013, I didn&rsquo;t have a
page or book count goal. I entered 2014 with the desire to reread two
specific books and the nebulous goal of reading more non-fiction.</p>

<h3>2014 Results</h3>

<p>I ended up setting a new volume record. I read 69 books for a total of
almost 23,000 pages. I also read every week of
<a href="http://www.amazon.com/gp/product/B00FDWVIHO/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00FDWVIHO&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=S6TWD3DEAED3EDBF">Day One</a>,
a weekly literary journal containing one short story and one poem from
new authors. This doesn&rsquo;t count towards my page or book count but is
reading I enjoy. It exposes me to many different styles.</p>

<p>More than a third of my reading was non-fiction. I don&rsquo;t
have numbers for 2013 but that feels like an increase. I consider my
goal of reading more non-fiction achieved.</p>

<p>I also reread the two books I had planned on rereading. I wanted to
reread
<a href="http://www.amazon.com/gp/product/B000S1M9LY/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B000S1M9LY&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=XEJIFRILDRUSJXWG">Infinite Jest</a>
and
<a href="http://www.amazon.com/Hard-Boiled-Wonderland-World-Haruki-Murakami-ebook/dp/B004AP9W1O/ref=sr_1_1?ie=UTF8&amp;qid=1420159468&amp;sr=8-1&amp;keywords=a+hard+boiled+wonderland">Hard-Boiled Wonderland and the End of the World</a>
and succeeded in rereading both of them.</p>

<h3>Recommendations</h3>

<p>I awarded seven books a five out of five star rating. I&rsquo;ve listed them
below in (in no particular order). Each book I&rsquo;d recommend without
hesitation. Instead of reworking or copying my previous reviews I&rsquo;ve
provided links to Goodreads. The titles link to Amazon.</p>

<ul>
<li><a href="http://www.amazon.com/gp/product/B00QS2HXUO/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00QS2HXUO&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=RWTY2PCQBTCXMLOK">Working Effectively with Unit Tests</a> by Jay Fields (<a href="https://www.goodreads.com/review/show/984963558">my review</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B004J35LHQ/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B004J35LHQ&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=FP26VU2OR4JMMDOZ">The Secrets of Consulting</a> by Gerald Weinberg (<a href="https://www.goodreads.com/review/show/519452572">my review</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B00N1ZN6C0/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00N1ZN6C0&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=LW3CLVNSZMRLBDVW">Extreme Programming Explained</a> by Kent Beck (<a href="https://www.goodreads.com/review/show/1119479193">my review</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B000FC1JAI/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B000FC1JAI&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=5TFM37LOXWLSBMUD">Meditations</a> by Marcus Aurelious and translated by Gregory Hays (<a href="https://www.goodreads.com/review/show/998010207">my review</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B000QUELZ4/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B000QUELZ4&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=56W5DEBPW3LU6XZX">A Man Without a Country</a> by Kurt Vonnegut (<a href="https://www.goodreads.com/review/show/93929432">my review</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B000S1M9LY/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B000S1M9LY&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=XEJIFRILDRUSJXWG">Infinite Jest</a> by David Foster Wallace (<a href="https://www.goodreads.com/review/show/509610965">my first review</a>, <a href="https://www.goodreads.com/review/show/880349659">second review</a>)</li>
<li><a href="http://www.amazon.com/gp/product/B00IHMF9KE/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00IHMF9KE&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=WPOULKSHDQDXKMLZ">The Bone Clocks</a> by David Mitchell (<a href="https://www.goodreads.com/review/show/1030027657">my review</a>)</li>
</ul>


<p>I&rsquo;m recommending a specific translation of <em>Meditations</em>. I attempted
to read different one first and it was so painful to read I ended up
giving up. The linked translation is modern and contains a useful
forward giving you background information on the time.</p>

<p>I only read one series this year but it was a good one.
<a href="http://www.amazon.com/gp/bookseries/B00HUQBPWE/kindle/?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;linkCode=ur2&amp;tag=jakemccrary08-20&amp;linkId=ABX4JPELH5GKERZP">The Magicians</a>,
by Lev Grossman, was recommended by a friend who described it as
&ldquo;Harry Potter but with characters battling depression.&rdquo; I&rsquo;m not sure
that fully captures the feel of the series but it is a start. The
series introduces you to a world like our own but with magic. You
follow cynical, self-absorbed students as they attend school,
graduate, and grow up living in both the magical and non-magical
world. The first book in the series is the weakest so if you read that
and find it enjoyable you should definitely pick up the next two
books.</p>

<h3>2015 Goals</h3>

<p>2015 isn&rsquo;t going to have an easily measured goal. I don&rsquo;t feel the
need to set number of books or pages goals any more. I&rsquo;m hoping to
increase the quality of my reading. This is a pretty unclear goal. To
me this doesn&rsquo;t mean increasing the average rating of books I read but
instead I want to get more out of what I read. I want to think a bit
deeper about the subjects I&rsquo;m reading.</p>

<h3>2014 Measurements</h3>

<p>Below are some random measurements that are probably only interesting
to me.</p>

<p>This year I recorded the format of the books I read. This was the year
of the ebook; over 90% of the books I read were electronic. I&rsquo;d guess
that this is a higher percentage of ebooks than previous years. I wish
I had recorded the formats read in previous years.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Binding   | Number of books |
</span><span class='line'>|-----------+-----------------|
</span><span class='line'>| Hardcover |               1 |
</span><span class='line'>| Paperback |               4 |
</span><span class='line'>| Kindle    |              64 |</span></code></pre></td></tr></table></div></figure>


<p>My average rating has been going down over the last four years.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Year | Average Rating |
</span><span class='line'>|------+----------------|
</span><span class='line'>| 2011 | 3.84           |
</span><span class='line'>| 2012 | 3.66           |
</span><span class='line'>| 2013 | 3.67           |
</span><span class='line'>| 2014 | 3.48           |</span></code></pre></td></tr></table></div></figure>


<p>In 2014, three authors composed nearly 25% of my reading (by page count). The
top six authors by page count are below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Author               | My Average Rating | Number of Books | Number of Pages | Percent of Total Page Count |
</span><span class='line'>|----------------------+-------------------+-----------------+-----------------+-----------------------------|
</span><span class='line'>| David Mitchell       |                 4 |               5 |            2334 |                      10.19% |
</span><span class='line'>| David Foster Wallace |       4.333333333 |               3 |            1753 |                       7.65% |
</span><span class='line'>| Lev Grossman         |       3.666666667 |               3 |            1244 |                       5.43% |
</span><span class='line'>| Marisha Pessl        |               3.5 |               2 |            1153 |                       5.03% |
</span><span class='line'>| Haruki Murakami      |               3.5 |               2 |             768 |                       3.35% |
</span><span class='line'>| Cormac McCarthy      |               3.5 |               2 |             650 |                       2.84% |</span></code></pre></td></tr></table></div></figure>


<p>My top six authors by average rating (with ties broken by number of
books) are below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Author               | My Average Rating | Number of Books | Number of Pages | Percent of Total Page Count |
</span><span class='line'>|----------------------+-------------------+-----------------+-----------------+-----------------------------|
</span><span class='line'>| Gerald M. Weinberg   |                 5 |               1 |             228 |                       1.00% |
</span><span class='line'>| Kent Beck            |                 5 |               1 |             224 |                       0.98% |
</span><span class='line'>| Jay Fields           |                 5 |               1 |             204 |                       0.89% |
</span><span class='line'>| Kurt Vonnegut        |               4.5 |               2 |             377 |                       1.65% |
</span><span class='line'>| David Foster Wallace |       4.333333333 |               3 |            1753 |                       7.65% |
</span><span class='line'>| David Mitchell       |                 4 |               5 |            2334 |                      10.19% |</span></code></pre></td></tr></table></div></figure>


<p>I did top six for both of these because otherwise David Mitchell would
not have been in the second one. I&rsquo;ve devoured his writing in the last
year and a half for a reason. I&rsquo;m consistently rating his books
highly.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/21/restricting-access-to-certain-routes/">Restricting access to certain routes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-21T16:48:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>4:48 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I&rsquo;ve been working on adding authentication and authorization
to a Clojure web service. The project uses
<a href="https://github.com/weavejester/compojure">compojure</a> for routing and
<a href="https://github.com/cemerick/friend">friend</a> for authentication and
authorization. My pair and I wanted to restrict access to specific
routes while leaving some routes completely public. It took a few
tries until we figured out how to do this in a way that made us happy.</p>

<p>The rest of this post shows the approximate path we took to our
current solution. It focuses on using friend to restrict access to
specific routes. It does not go into details about adding
authentication to your web service.</p>

<p>Below is an example of the routes before adding authorization checks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.server</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">compojure.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">GET</span> <span class="nv">defroutes</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">compojure</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">compojure.route</span> <span class="ss">:as</span> <span class="nv">route</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">app</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/status&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">status</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/cars&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-cars</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/attributes&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-attributes</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/drivers&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-drivers</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">route/not-found</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We wanted to make <code>/cars</code>, <code>/attributes</code>, and <code>/drivers</code> require that
the request satisfies the <code>:example.server/user</code> role. Requesting
<code>/status</code> should not require authorization. The first attempt left us
with the following code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.server</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">compojure.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">GET</span> <span class="nv">defroutes</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">compojure</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">compojure.route</span> <span class="ss">:as</span> <span class="nv">route</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">cemerick.friend</span> <span class="ss">:as</span> <span class="nv">friend</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">app</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/status&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">status</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/cars&quot;</span> <span class="nv">_</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">friend/authorize</span> <span class="o">#</span><span class="p">{</span><span class="ss">::user</span><span class="p">}</span>
</span><span class='line'>                         <span class="p">(</span><span class="nf">fetch-cars</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/attributes&quot;</span> <span class="nv">_</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">friend/authorize</span> <span class="o">#</span><span class="p">{</span><span class="ss">::user</span><span class="p">}</span>
</span><span class='line'>                         <span class="p">(</span><span class="nf">fetch-attributes</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/drivers&quot;</span> <span class="nv">_</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">friend/authorize</span> <span class="o">#</span><span class="p">{</span><span class="ss">::user</span><span class="p">}</span>
</span><span class='line'>                         <span class="p">(</span><span class="nf">fetch-drivers</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">route/not-found</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above works but it suffers from repetition. You could write a
macro to minimize the repetition but we thought there must be a better
way.</p>

<p>After reading more of <a href="https://github.com/cemerick/friend">friend</a>&rsquo;s
documentation we discovered <code>friend/wrap-authorize</code>. This is
middleware that only allows requests through if the request
satisfies the required roles. Our first pass at using
<code>friend/wrap-authorize</code> looked like the following example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.server</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">compojure.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">GET</span> <span class="nv">defroutes</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">compojure</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">compojure.route</span> <span class="ss">:as</span> <span class="nv">route</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">cemerick.friend</span> <span class="ss">:as</span> <span class="nv">friend</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">protected-routes</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/cars&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-cars</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/attributes&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-attributes</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/drivers&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-drivers</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">app</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/status&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">status</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">friend/wrap-authorize</span> <span class="nv">protected-routes</span> <span class="o">#</span><span class="p">{</span><span class="ss">::user</span><span class="p">})</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">route/not-found</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is much nicer. The repetition is removed by extracting routes
that require authorization into a separate <code>defroutes</code> and wrapping it
with <code>friend/wrap-authorize</code>.</p>

<p>This introduces a subtle bug. A response with status code 404 is no
longer returned if a non-existent resource is requested and the
request is unauthorized. This is because the authorization check
happens <em>before</em> matching a route. friend&rsquo;s documentation warns
against this and suggests using <code>compojure/context</code> to scope usage of
<code>friend/wrap-authorize</code>. This doesn&rsquo;t solve the problem but it at
least narrows its scope. We can do better.</p>

<p>Compojure
<a href="https://github.com/weavejester/compojure/blob/master/HISTORY.md">1.2.0</a>
introduced the function <code>wrap-routes</code>. <code>wrap-routes</code> applies
middleware <em>after</em> a route is matched. By using this we can have all
of the benefits of using <code>friend/wrap-authorize</code> without breaking
returning 404 responses.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.server</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">compojure.core</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">GET</span> <span class="nv">defroutes</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">compojure</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">compojure.route</span> <span class="ss">:as</span> <span class="nv">route</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">cemerick.friend</span> <span class="ss">:as</span> <span class="nv">friend</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">protected-routes</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/cars&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-cars</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/attributes&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-attributes</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/drivers&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">fetch-drivers</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">defroutes</span> <span class="nv">app</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/status&quot;</span> <span class="nv">_</span> <span class="p">(</span><span class="nf">status</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">compojure/wrap-routes</span> <span class="nv">protected-routes</span>
</span><span class='line'>                         <span class="nv">friend/wrap-authorize</span>
</span><span class='line'>                         <span class="o">#</span><span class="p">{</span><span class="ss">::user</span><span class="p">})</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">route/not-found</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>There we have it. A solution without duplication that still responds
properly to requests for non-existent resources.
<code>compojure/wrap-routes</code> is a useful function to know about.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/09/an-effective-code-review-process/">An Effective Code Review Process</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-09T20:44:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:44 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>See all of my remote/working-from-home <a href="/blog/categories/remote/">articles here</a>.</p></blockquote>

<p><a href="https://twitter.com/searls/status/540603801955471360"><img class="center" src="/images/justin-searls-code-reviews-harmful.png" title="The way most organizations implement code reviews in teams is usually more harmful than helpful. I generally recommend going without them. - Justin Searls" ></a></p>

<p>The above was tweeted <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> recently and it resulted in some decent
discussion about code reviews. In the past six months at
<a href="http://www.outpace.com">Outpace</a>, I&rsquo;ve been part of a handful of code
review sessions that have been extremely productive. After the reviews
many developers have expressed shock at the effectiveness of the process.
A tweet-sized overview of the process we&rsquo;ve followed can be found in
<a href="https://twitter.com/gigasquid">Carin Meier</a>&rsquo;s
<a href="https://twitter.com/gigasquid/status/540606002547425281">responses</a> to
the above tweet. Since you can&rsquo;t fit details into tweets the rest of
this post expands on our code review process.</p>

<p>Some background before we dive into the details.
<a href="http://www.outpace.com">Outpace</a> is a software company that
practices, despite every programmer working remotely, nearly 100% pair
programming. In addition, the team Carin and I are on do most of our
work through GitHub pull requests. Before merging with master, the
pull requests are reviewed by other teammates. Between pairing and
pull requests many eyes see every line of code as changes are made.</p>

<p>Even with all this, we&rsquo;ve found value in having more traditional code
reviews. We&rsquo;ve found that different feedback and action items emerge
from reviewing code that we already have than from reviews of code
changes (e.g., pull requests).</p>

<p>In addition to working for the team described above, the process below
has been successfully used to review an internal library where the
reviewers where mostly interested users with a couple contributors. It
has also been successful on teams that were not adherent to doing work
through reviewed pull requests.</p>

<h3>The Code Review Process</h3>

<h4>Step 1: Select the code to review</h4>

<p>Typically we do this between a week and two weeks before the code
review. Here we identify the code we want to review and create a
two-hour meeting on a Friday at the end of day.</p>

<p>Having the meeting late on Friday helps create a relaxed environment.
The review becomes a time to unwind, enjoy a beverage of choice, and
talk about code. I haven&rsquo;t met a developer that doesn&rsquo;t enjoy
discussing how to make code better and this lets everyone finish the
week doing just that. The code review becomes an uplifting way to
finish a week.</p>

<h4>Step 2: Open the code review</h4>

<p>A few days (typically late Tuesday or early Wednesday) before the
Friday code review meeting we start the review. We do this by opening
a <a href="https://github.com">GitHub</a> pull request. The following steps will
create a pull request where you can comment every line of code being
reviewed.</p>

<ol>
<li>Create a local branch.</li>
<li>Delete the code being reviewed and commit locally.</li>
<li>Push the branch to GitHub.</li>
<li>Open a pull request.</li>
</ol>


<p>These steps are necessary because GitHub pull requests only let you
view code that has changed. This process marks every line as deleted,
which causes every line to appear the <em>Files changed</em> tab.</p>

<p>Opening the pull request a few days before the review meeting provides
a location for pre-meeting comments to be added. This lets reviewers
spend a couple days thinking about and commenting on the code.
Comments on the pull request indicate a conversation should happen
during the code review meeting.</p>

<h4>Step 3: The code review meeting</h4>

<p>Its finally Friday and time to review the code as a group. Everyone
joins a video conference and someone volunteers to lead the code
review. At least one other person volunteers to be a note taker.</p>

<p>The leader directs the code review and keeps it moving forward. To do
this the leader shares their screen with the video conference and
scrolls through the <em>Files changed</em> view of the pull request. When a
comment appears on screen the leader stops scrolling and discussion
starts.</p>

<p>The comments are read (often silently) and discussion happens. The
leader tries to recognize when a conclusion has been reached or when
further discussion, outside of the code review, needs to happen. When
a conclusion is reached someone (often the leader) states a quick
summary and a note taker records the next steps. The next steps are
added as additional comments in the comment thread being discussed. As
the next steps are recorded the leader moves on to the next comment.</p>

<p>This continues until either time runs out or the group runs out of
things to discuss.</p>

<p>After the code review a volunteer turns the next steps comments into
Trello cards and we take care of the code review items as part of our
usual work.</p>

<h3>Results</h3>

<p>We&rsquo;ve seen impressive improvements to code quality in the projects
that have undergone this style of code review. Both small and large
changes have happened as a result. Code has become simpler, clearer,
and better understood. Additionally, the feeling of collective code
ownership has increased.</p>

<p>Teammates have been surprised at how well this process has worked.
More than a couple have said that historically they have not found
code reviews useful but that these were.</p>

<p>This style of code review has worked in a few different settings and I
encourage you to give it a shot.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Reading through the discussion on Twitter after this tweet can give some hints as to what it takes to have an effective code review.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/07/ergodox-turn-on-led-when-not-on-the-main-layer/">ErgoDox: Turn on an LED When Not on the Main Layer</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-07T17:35:00-05:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:35 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>The
<a href="http://jakemccrary.com/blog/2014/07/27/building-the-ergodox-keyboard/">ErgoDox</a>
is a great keyboard. One its appeals is that you can build your own
firmware. This makes it possible to rearrange the keys however you
want and tweak other functionality. The firmware is fairly advanced
and allows you to have multiple layers to your keyboard.</p>

<p>Multiple layers allow the ErgoDox to have fewer physical keys than
traditional keyboards. How often do you use an F key? If you are like
me the answer is almost never. Why bother having a dedicated key?</p>

<p>Another benefit of multiple layers is that your keyboard is multiple
keyboards in one. Do you use the Dvorak layout and your roommate use
Qwerty? Program both a Dvorak layer and a Qwerty layer into your
keyboard and switch between them with the push of a button.</p>

<p>The only downside I&rsquo;ve noticed of multiple layers is that I&rsquo;ll switch
between them by accident. This is frustrating as all of a sudden your
keyboard works differently and there is no indication that you are on a
different layer.</p>

<p>The ErgoDox has a
<a href="https://github.com/benblazak/ergodox-firmware/blob/513b82d585fdc7175db736163340af3ed6c6f38b/src/main.c#L124-L133">few LEDs</a>
in it that I have never used. I don&rsquo;t even have the needed keys as
part of my keyboard layout (Caps lock? Who uses caps lock? I
don&rsquo;t need to shout that often). I decided to repurpose the num lock
LED as an indicator that I&rsquo;m off the main layer.</p>

<p>This was a straight forward change. In the firmware there is a
<a href="https://github.com/benblazak/ergodox-firmware/blob/513b82d585fdc7175db736163340af3ed6c6f38b/src/main.c#L171">variable</a>
that holds what keyboard layer is active. All I had to do to get the
num lock LED on when I changed layers was to move the <code>layers_head</code>
variable higher in <code>main.c</code> and then change the conditional to turn on
the num lock LED when <code>layers_head != 0</code>.
<a href="https://github.com/jakemcc/ergodox-firmware/commit/383f16a3f091b4e2dd031d098007c4289cc1a261">This</a>
is the commit that does this change. It could have been done as a
three line change.</p>

<p>I highly recommend making this change. Now I just need to find a
transparent DSA keycaps so I can see the LED easier.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/01/book-review-haskell-data-analysis-cookbook/">Book Review: Haskell Data Analysis Cookbook</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-01T13:49:00-05:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>1:49 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Packt Publishing recently asked me to write a review of the book
<a href="http://bit.ly/X0YQaL">Haskell Data Analysis Cookbook</a> by Nishant
Shukla. The book is broken into small sections that show you how to do
a particular task related to data analysis. These tasks vary from
reading a csv file or parsing json to listening to a stream of tweets.</p>

<p>I&rsquo;m not a Haskell programmer. My Haskell experience is limited to
reading some books
(<a href="http://learnyouahaskell.com/">Learn You a Haskell for Great Good</a>
and most of <a href="http://realworldhaskell.org/">Real World Haskell</a>) and
solving some toy problems. All of reading and programming happened
years ago though so I&rsquo;m out of practice.</p>

<p>This book is not for a programmer that is unfamiliar with Haskell. If
you&rsquo;ve never studied it before you&rsquo;ll find yourself turning towards
documentation. If you enter this book with a solid understanding of
functional programming you can get by with a smaller understanding of
Haskell but you will not get much from the book.</p>

<p>I&rsquo;ve only read a few cookbook style books and this one followed the
usual format. It will be more useful as a quick reference than as
something you would read through. It doesn&rsquo;t dive deep into any topic
but does point you toward libraries for various tasks and shows a
short example of using them.</p>

<p>A common critic I have of most code examples applies to this book.
Most examples do not do qualified imports of namespaces or selective
imports of functions from namespaces. This is especially useful when
your examples might be read by people who are not be familiar with the
languages standard libraries. Reading code and immediately knowing
where a function comes from is incredibly useful to understanding.</p>

<p>The code for this book is available on
<a href="https://github.com/BinRoot/Haskell-Data-Analysis-Cookbook">GitHub</a>.
It is useful to look at the full example for a section. The examples
in the book are broken into parts with English explanations and I
found that made it hard to fully understand how the code fit together.
Looking at the examples in the GitHub repo helped.</p>

<h4>Recommendation</h4>

<p>I&rsquo;d recommend this book for Haskell programmers who find the table of
contents interesting. If you read the table of contents and think it
would be useful to have a shallow introduction to the topics listed
then you&rsquo;ll find this book useful. It doesn&rsquo;t give a detailed dive
into anything but at least gives you a starting point.</p>

<p>If you either learning Haskell or using Haskell then this book doesn&rsquo;t
have much to offer you.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/27/building-the-ergodox-keyboard/">Building the ErgoDox Keyboard</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-27T21:05:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>9:05 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier this year I built an
<a href="https://deskthority.net/wiki/ErgoDox">ErgoDox</a>. The ErgoDox is a split
hand mechanical keyboard whose design has been released under the GNU
GPLv3. There are a few standard <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> ways of getting the parts. It
basically comes down to sourcing all the parts yourself or buying a
bundle from <a href="https://www.massdrop.com/buy/ergodox">Massdrop</a>. I opted
to wait until Massdrop was selling them and bought a kit from them.</p>

<p><img src="/images/my-keyboard.jpg" title="My ErgoDox" alt="My ErgoDox" /></p>

<h3>Why?</h3>

<ol>
<li>I&rsquo;ve used an ergonomic keyboard for years and was intrigued by the split hand design.</li>
<li>I wanted to try out Cherry MX key switches.</li>
<li>Using your thumb for more than just space bar made a lot of sense to me.</li>
<li>The firmware lets you have multiple layers. I thought this could be really useful.</li>
<li>The project sounded fun. I used to make physical devices and this
seemed like a good way to do that again.</li>
</ol>


<h3>Buying</h3>

<p>As mentioned earlier I bought my parts from Massdrop. In the buy I
participated in I had the option of a full hand case or the
traditional case and I opted for the full hand. As part of the buy I
also bought additional aluminum top layers, a blank set of DSA <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>
keycaps, and Cherry MX blue key switches.</p>

<p>If I were doing it again I would not buy the extra aluminum top
layer. I built one of my hands using the aluminum and the other with
the basic acrylic top. I enjoy both the look and feel of the acrylic
hand better.</p>

<p>I would also not buy the set of DSA keycaps from Massdrop. It was
convenient and a bit cheaper to buy from them but had I known I could
get different
<a href="http://keyshop.pimpmykeyboard.com/products/full-keysets/dsa-blank-sets-1">colors</a>
from <a href="http://www.keycapsdirect.com/">Signature Plastics</a> I would have done that.</p>

<p>I also bought eight &ldquo;deep-dish&rdquo; DSA keys direct from Signature
Plastics. These keys feel different which lets me know when my fingers
are above the home row. I&rsquo;d recommend doing this. You can order from
<a href="http://www.keycapsdirect.com/key-capsinventory.php">this</a> page.</p>

<p>For key switches I bought Cherry MX Blues through Massdrop. Blues are
extremely clicky. You can easily hear me typing in every room of my
apartment. It is very satisfying.</p>

<p>After using the keyboard for about a week I also ended up buying some
<a href="http://www.amazon.com/gp/product/B00897D3OQ/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00897D3OQ&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=HTBBKS475FGFIG2M">pads</a>
for my wrists. I occasionally rest my wrists on the keyboard and the
keyboard&rsquo;s edge would dig into me.</p>

<h3>Building</h3>

<p>I followed Massdrop&rsquo;s step-by-step
<a href="https://www.massdrop.com/ext/ergodox/assembly.php">guide</a> and
<a href="https://www.youtube.com/watch?v=x1irVrAl3Ts">this</a> YouTube video.
Another great resource is the community at
<a href="http://geekhack.org/index.php?topic=22780.0">GeekHack</a>. I&rsquo;d recommend
reading and watching as much as possible before starting your build.</p>

<p>I built this using a cheap soldering iron I&rsquo;ve had for years, very
thin solder, solder wick, and a multimeter. I don&rsquo;t know if this would
have been easier with better tools or not but those got the job done.</p>

<p>While soldering the surface mount diodes I was in the zone and
soldered a few locations that didn&rsquo;t actually need to be soldered.
When you are soldering the diodes you should only be soldering them to
the locations that have the key silk screen.</p>

<p>My system for minimizing errors while soldering the diodes is the
following five steps.</p>

<ol>
<li>Lay down some solder on one of the pads.</li>
<li>Put the correct end of the diode on top of that solder, reheat and
push down.</li>
<li>Test the connection with a multimeter.</li>
<li>Solder the other half of the diode.</li>
<li>Test the connection.</li>
</ol>


<p>I batched up the steps. I&rsquo;d do a whole row of the first step, then
move to the second for the entire row, then do the third, etc. Being
rigorous about testing every connection is important. Catching
mistakes early makes it easier to fix the mistakes.</p>

<p>If you solder a diode on the wrong way there is a huge difference (at
least for me using solder wick) between the difficulty of fixing the
error when only one pad has been soldered versus two pads. I soldered
more than one diode backwards and a mistake noticed after soldering
only one pad was easy to fix. After soldering both pads it took
serious effort.</p>

<p>Eventually you&rsquo;ll need to cut open a USB cable. I ended up removing
the plastic housing using a Dremel. When soldering the wires to the
USB holes I was too concerned with it looking pretty and did not leave
plenty of wire. This made it harder to solder and as a result I ended
up doing a poor job that resulted in a short. After desoldering and
destroying another cable, but leaving more wire, I managed to do a
better job. I originally noticed the short because I kept getting
warnings from my computer about my USB Keyboard drawing too much
power.</p>

<p>I&rsquo;ve
<a href="https://www.evernote.com/shard/s68/sh/4f51c3b2-b50b-47d3-8219-ea155cf5fef5/df239167726bcebf06cc2b5101ac8e42/">annotated a copy</a>
of Massdrop&rsquo;s instructions using Evernote. It contains the above tips
inline.</p>

<h3>Firmware</h3>

<p>After you physically build your keyboard you need to build the
firmware. There are a few different firmwares that can work and you
can discover those on GeekHack. I&rsquo;m using a fork of what Massdrop&rsquo;s
<a href="https://www.massdrop.com/ext/ergodox">graphical configuration</a> tool
uses. It is based off
<a href="https://github.com/benblazak/ergodox-firmware">benblazak/ergodox-firmware</a>.</p>

<p>One of the exciting things about the ErgoDox is tweaking the firmware.
I took the base firmware and modified it to have media key support and
<a href="https://github.com/jakemcc/ergodox-firmware/commit/383f16a3f091b4e2dd031d098007c4289cc1a261">light up the LEDs</a>
when I&rsquo;m on any layer besides the base. Some people have added the
ability to record keyboard macros and other neat features. I encourage
you to take a look at the source even if you use the graphical
configuration tool. I haven&rsquo;t explored beyond
<a href="https://github.com/benblazak/ergodox-firmware">benblazak/ergodox-firmware</a>
so I can&rsquo;t compare it to other firmwares.</p>

<h3>Conclusion</h3>

<p>I really enjoy it. Building it was both fun and frustrating <sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>.</p>

<p>After using the keyboard for a few months I&rsquo;ve found that I really
only use three (on each hand) of the thumb cluster keys. I also don&rsquo;t
use the keyboard layers too often. I have three layers programmed and
I always stay on the main one unless I want to hit a media key.</p>

<p>Would I recommend building your own ErgoDox? If you already can or are
willing to learn to solder and this sounds at all interesting to you I
would recommend it. The project can be frustrating but the result is
great.</p>

<h3>The Future</h3>

<p>There is still a lot left to explore in the custom keyboard space.
Even so I have no plans on leaving the ErgoDox anytime soon. In terms
of improving my ErgoDox, I plan on poking around the different
firmwares at some point. I&rsquo;d also like to explore
<a href="http://geekhack.org/index.php?topic=22780.msg1405792#msg1405792">tenting</a>
<a href="https://github.com/adereth/ergodox-tent">options</a>.</p>

<h3>Resources</h3>

<ul>
<li><a href="http://geekhack.org/index.php?topic=22780.0">GeekHack ErgoDox thread</a></li>
<li><a href="http://geekhack.org/index.php?topic=40501.0">GeekHack FAQ</a>
Useful for general information about keyboard topics.</li>
<li><a href="http://geekhack.org/index.php?topic=40501.0#post_DD">GeekHack Cherry actuation forces</a></li>
<li><a href="https://www.massdrop.com/buy/ergodox">Massdrop Buy</a></li>
<li><a href="https://www.massdrop.com/ext/ergodox">Massdrop Configuration Tool</a></li>
<li><a href="https://github.com/benblazak/ergodox-firmware">benblazak/ergodox-firmware</a></li>
<li><a href="http://geekhack.org/index.php?topic=48106.0">TMK firmware for ErgoDox</a>
One of the alternative firmwares.</li>
</ul>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>I feel a bit odd using the word standard to describe acquiring parts to build a keyboard.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p><a href="http://keycapsdirect.com/key-caps.php">This</a> page has diagrams that shows the different keycap families.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>Those surface mount diodes are so tiny.<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/04/using-emacs-to-explore-an-http-api/">Using Emacs to Explore an HTTP API</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-04T13:05:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:05 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I rediscovered an Emacs package that allows you to interact
with HTTP endpoints from the comfort of an Emacs buffer.
<a href="https://github.com/pashky/restclient.el">restclient.el</a> provides
<code>restclient-mode</code>. This mode allows you to write and execute HTTP
requests in an Emacs buffer. This package can be found in
<a href="http://melpa.milkbox.net/#/restclient">MELPA</a>.</p>

<p>Below is an example buffer that touches the GitHub API.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">:github</span> <span class="o">=</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">api</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># get users orgs</span>
</span><span class='line'>
</span><span class='line'><span class="no">GET</span> <span class="ss">:github</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">jakemcc</span><span class="o">/</span><span class="n">orgs</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># rendor markdown</span>
</span><span class='line'>
</span><span class='line'><span class="no">POST</span> <span class="ss">:github</span><span class="o">/</span><span class="n">markdown</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;text&quot;</span> <span class="p">:</span> <span class="s2">&quot;## Title&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># rendor markdown raw</span>
</span><span class='line'>
</span><span class='line'><span class="no">POST</span> <span class="ss">:github</span><span class="o">/</span><span class="n">markdown</span><span class="o">/</span><span class="n">raw</span>
</span><span class='line'><span class="no">Content</span><span class="o">-</span><span class="ss">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span>
</span><span class='line'>
</span><span class='line'><span class="no">Title</span>
</span><span class='line'><span class="o">-----</span>
</span></code></pre></td></tr></table></div></figure>


<p>The example above has a few interesting snippets. <code>:github</code> is an
example of a variable. Lines 8-14 show an example of posting json to
an endpoint. You put the data you want to send below the query. The
last POST shows how to set headers for a request.</p>

<p>The location of your cursor decides what query to execute. Comments
start with <code>#</code> and break your document into sections. The query in the
same section as your cursor is the one that is executed. If the cursor
is anywhere on lines 3-6 and I hit <code>C-c C-c</code> then Emacs queries GitHub
for my organizations. Below is what pops up in a buffer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;avatar_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/avatars.githubusercontent.com\/u\/1826953?&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;public_members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/public_members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;events_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/events&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;repos_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/repos&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1826953</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;login&quot;</span><span class="o">:</span> <span class="s2">&quot;speakerconf&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;avatar_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/avatars.githubusercontent.com\/u\/4711436?&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;public_members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/public_members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;events_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/events&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;repos_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/repos&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">4711436</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;login&quot;</span><span class="o">:</span> <span class="s2">&quot;outpace&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'><span class="c1">// HTTP/1.1 200 OK</span>
</span><span class='line'><span class="c1">// Server: GitHub.com</span>
</span><span class='line'><span class="c1">// Date: Fri, 04 Jul 2014 17:34:26 GMT</span>
</span><span class='line'><span class="c1">// Content-Type: application/json; charset=utf-8</span>
</span><span class='line'><span class="c1">// other headers removed for space consideration on blog</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>C-c C-c</code> triggers <code>restclient-http-send-current</code> which runs a query
and pretty prints the result. I could have used <code>C-c C-r</code> to trigger
<code>restclient-http-send-current-raw</code> which executes a query and shows
the raw result.</p>

<p>It isn&rsquo;t a perfect mode. One issue I&rsquo;ve come across is that queries
targeting <code>localhost</code> fail. The solution is to query <code>127.0.0.1</code>.</p>

<p><code>restclient-mode</code> makes Emacs a useful tool for exploring and
testing HTTP APIs. Since it operates on a simple text
format it allows you to easily share executable documentation with
others. I highly recommend <strong>restclient.el</strong>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog//9">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog//7">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2021/01/24/reading-in-2020/">Reading in 2020</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/12/30/speeding-up-magit-with-the-native-comp-branch-of-emacs/">Speeding up Magit with the native-comp branch of Emacs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/14/speeding-up-magit/">Speeding up magit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/11/creating-a-custom-kindle-dictionary/">Creating a custom Kindle dictionary</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/10/03/go-create-silly-small-programs/">Go create silly, small programs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/08/31/utilities-i-like-selecta/">Utilities I like: selecta</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/07/03/introducing-photo-fit/">Introducing Photo Fit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/06/28/using-bazel-to-help-fix-flaky-tests/">Using Bazel to help fix flaky tests</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/05/04/how-to-be-alerted-when-a-long-running-process-finishes/">How to be automatically notified when long running processes finish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/26/hanging-a-hangboard-using-a-doorway-pull-up-bar/">How to hang a hangboard using a doorway pull-up bar</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Subscribe</h1>
  <p>Looking forward to reading more of my writing?</p>
  <p>Sign up for my <a target="_blank" href="https://jakemccrary.substack.com/welcome">newsletter</a> to get periodic emails with links to my latest writing and other thoughts.</p>
  <p>Can't wait for the infrequent newsletter? Subscribe to the <a href="http://feeds.feedburner.com/JakeMccrarysMusings">RSS</a> feed.</p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
  


</body>
</html>
