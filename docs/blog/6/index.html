
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Jake McCrary" />
    <meta itemprop="description" content=" A few months ago I was implementing some changes to
Lumanu&rsquo;s user interface. Lumanu is a tool I&rsquo;ve
been working on that helps its users &hellip;" />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Jake McCrary" />
    <meta name="twitter:description" content=" A few months ago I was implementing some changes to
Lumanu&rsquo;s user interface. Lumanu is a tool I&rsquo;ve
been working on that helps its users &hellip;" />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="The Blog of Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/blog/6/" />
    <meta property="og:title" content="Jake McCrary" />
    <meta property="og:description" content=" A few months ago I was implementing some changes to
Lumanu&rsquo;s user interface. Lumanu is a tool I&rsquo;ve
been working on that helps its users &hellip;" />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
    

    <meta name="description" content=" A few months ago I was implementing some changes to
Lumanu&rsquo;s user interface. Lumanu is a tool I&rsquo;ve
been working on that helps its users &hellip;">

    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/blog/6/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
    
<script>
 var origin = window.location.origin;
 if (!origin) {
   origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
 }
 if (origin.indexOf('localhost') === -1) {
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-19834208-2', 'auto');
   ga('send', 'pageview');
 }
</script>


  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/14/use-google-to-get-a-sites-favicon/">Use Google to get a site's favicon</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-14T09:10:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:10 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>A few months ago I was implementing some changes to
<a href="https://lumanu.com">Lumanu&rsquo;s</a> user interface. Lumanu is a tool I&rsquo;ve
been working on that helps its users create, discover, and curate
engaging content.</p>

<p>This interface change was to our discovery view. This is the view that
surfaces interesting content to our users. The change involved
showing the favicon of content&rsquo;s origin in our interface.</p>

<p>I often browse the Internet with the network tab of the Chrome
Developer Tools open. I do this because I find it interesting to see
what services other web applications are using. I had the network tab
open while browsing a site that displayed many favicons and noticed a
lot fetches from google.com. This surprised me, so I took a deeper
look at the requests and saw they were hitting a URL that appeared to
provide favicons. It turns out you can query Google for favicons.</p>

<h3>Example</h3>

<p>Let&rsquo;s pretend we want to get the favicon for <code>jakemccrary.com</code>. You
simply construct a URL that looks like
<a href="https://www.google.com/s2/favicons?domain=jakemccrary.com"><code>https://www.google.com/s2/favicons?domain=jakemccrary.com</code></a>
and all of a sudden you have the favicon. Just replace
<code>jakemccrary.com</code> with the domain you care about and you&rsquo;ll be
rewarded with that domain&rsquo;s favicon.</p>

<p><img src="https://www.google.com/s2/favicons?domain=jakemccrary.com" title="Favicon from Google" alt="My favicon from Google" /></p>

<p>This definitely isn&rsquo;t a new feature. If you search online you&rsquo;ll see
people talking about it years ago. I had never heard of it before and
discovering it saved us an unknown amount of time. It allowed us to
iterate on our interface without having to figure out the nuances of
favicons. We were able to quickly try out the interface change and
then throw it away without costing us too much time.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/30/speeding-up-my-blog/">Speeding up my blog</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-30T23:42:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>11:42 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I was recently reading
<a href="https://jefframnani.com/about/">Jeff Ramnani&rsquo;s</a> <em>about</em> page and I
was somewhat inspired by it. It loads quickly and links to
<a href="http://mattgemmell.com/designing-blogs-for-readers/">Designing blogs for readers</a>,
an interesting essay by Matt Gemmmell. Reading that essay inspired me
to think about my own site and what experience I want to deliver to
readers.</p>

<p>I can&rsquo;t imagine what every reader wants but I know what I want to
experience when I read an article online. Reading high quality content
is my highest priority. Beyond that I enjoy when a page loads fast and
the visual design doesn&rsquo;t get in the way. I think a great example of
these two requirements is <a href="http://zenhabits.net/falling/">zen habits</a>
(along with Jeff Ramnani&rsquo;s and Matt Gemmell&rsquo;s).</p>

<p>My own site sort of achieves those goals. I like to think I&rsquo;m writing
well-written content that helps others. I know it has helped me. With
regards to visual design I think there is room for improvement. I don&rsquo;t
think my site&rsquo;s design is actively distracting from the content
though, so I&rsquo;ve decided to focus on improving the page load time
first.</p>

<h2>The optimization process</h2>

<p>As with any optimization problem it is important figure what you&rsquo;re
going to measure, how you&rsquo;re going to measure it and your starting
point. I decided to focus on my page load time, as measured by
<a href="http://www.webpagetest.org">Web Page Test</a>. I used Google&rsquo;s
<a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a>
to score and provide helpful tips for improving page
speed. Unfortunately I didn&rsquo;t capture my starting point with PageSpeed
Insights but I think I was scoring around a 66/100 for mobile and
79/100 for desktop.</p>

<p><img src="/images/before-optimizations.png" alt="Starting point from Web Page Test" /></p>

<p>As measured by Web Page Test, the first load of my main page took five
seconds and it wasn&rsquo;t fully loaded for another second. This is
ridiculous. My page is almost entirely static content and most of my
assets are served from CloudFlare. It should be blazing fast.</p>

<p>Next I looked at what was actually being loaded. Google&rsquo;s PageSpeed
Insights identified that I had three render-blocking <code>script</code>
tags. The offending scripts were Modernizr, jQuery, and
octopress.js. PageSpeed Insights
<a href="https://developers.google.com/speed/docs/insights/BlockingJS#overview">recommends</a>
inlining JavaScript required to render the page or make loading
asynchronous. I decided to go a step further and remove the need for
the JavaScript.</p>

<h3>Removing octopress.js</h3>

<p>It turns out <code>octopress.js</code> was the reason Modernizr and jQuery were
required. Most of what
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js">octopress.js</a>
did were things that I don&rsquo;t need; some sort of
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L111">flash video fallback</a>,
adding line numbers to
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L112">GitHub Gists</a>,
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L99">rendering</a>
delicious links, and toggling the
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L114">sidebar visibility</a>. I
was able to delete all that code.</p>

<p>Next up was the
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L1-L13">mobile navigation</a>
<code>octopress.js</code> provided. This feature enabled navigation through a
<code>&lt;select&gt;</code> element when the reader&rsquo;s view port was tiny. Restyling my
navigation bar to fit better on small screens allowed me to remove
this feature. <code>ocotpress.js</code> also did some
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L37">feature detection</a>
for Modernizr. I stopped using image masks and was able to remove that
code as well.</p>

<p>The remaining code in <code>octopress.js</code> was a workaround for an
<a href="https://github.com/jakemcc/jakemccrary.com/blob/c27a131aef437181dcab9552c3241f8adafb3884/source/javascripts/octopress.js#L121-L136">iOS scaling bug</a>. This
JavaScript was inlined into my html. At this point <code>octopress.js</code> was
empty and with it empty the requirements for jQuery and Modernizer
disappeared. This let me remove three render-blocking <code>script</code> tags.</p>

<h3>Remaining JavaScript</h3>

<p>At this point the remaining JavaScript used for my blog was enabling
comments with Disqus and showing recent tweets in my sidebar. I still
enjoy having comments on my blog so I&rsquo;m keeping Disqus around. I doubt
that readers care what my most recent tweets are so I removed
Twitter&rsquo;s JavaScript. Removing my tweets also cleans up my sidebar and
helps keep the focus on my writing.</p>

<h3>Nearly no JavaScript, now what?</h3>

<p>At this point Google&rsquo;s PageSpeed Insight was suggesting that I up my
cache times, inline my css, and move my web fonts lower on my
page. Bumping up my cache times was trivial; I simply tweaked a
CloudFlare setting.</p>

<p>I opted to not inline my css. This would require me to modify my
site&rsquo;s generation and I just didn&rsquo;t feel like diving down that rabbit
hole. I also didn&rsquo;t move the web fonts lower on the page. I find fonts
re-rendering jarring and as a result kept them loading<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> in my <code>&lt;head&gt;</code>.</p>

<h2>The results</h2>

<p>I used Web Page Test to measure again and now the page load time is
down to 2.5 seconds. Page load times are cut in half from the starting
point. My PageSpeed Insights scores are also higher; up to 79/100 for mobile
and 92/100 for desktop.</p>

<p><img src="/images/after-optimizations.png" alt="Web Page Test after optimization" /></p>

<p>Honestly, that number still seems high<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> to me and I&rsquo;m sure I could
get it lower. But for now it is good enough<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>. As a result of doing
this I&rsquo;ve learned more about my blogging setup and managed to speed up
my page load. Now it is time to focus on researching for future
posts (and at some point restyling).</p>

<h2>Update on 2016-05-03</h2>

<p>I completely removed web font loading from my site. Getting rid of the
fonts reduced my load time, as measured by Web Page Test, by a
second. Google&rsquo;s PageSpeed Insights now scores this site at 90/100 for
mobile and 96/100 for desktop.</p>

<p><img src="/images/after-optimizations2.png" alt="Web Page Test after font removal" /></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>When I first wrote this I didn&rsquo;t change anything about my web fonts. After thinking about it for a few days I ended up removing them completely. Details are in the update at the end of the post.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>I&rsquo;m asking Web Page Test to load my page using IE10. I get much faster load times using Chrome or Firefox locally which is what most of my readers use. This is good enough for now.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>I mean, the starting point was probably good enough but if I admitted that then I wouldn&rsquo;t have had the excuse to dig into my site&rsquo;s load time.<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/10/the-usefulness-of-clojures-cond-arrow/">The usefulness of Clojure's cond-></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-10T18:45:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>6:45 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Clojure&rsquo;s
<a href="https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/cond-%3E"><code>cond-&gt;</code></a>
(and <code>cond-&gt;&gt;</code>) is a versatile macro. It isn&rsquo;t a new macro, it
has been around since version 1.5, but I finally discovered and
started using it sometime last year. It isn&rsquo;t a workhorse macro,
you won&rsquo;t be using it everyday, but it comes in handy.</p>

<h3>What is <code>cond-&gt;</code>?</h3>

<p>Let&rsquo;s start by looking at the docstring.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage: (cond-&gt; expr & clauses)
</span><span class='line'>
</span><span class='line'>Takes an expression and a set of test/form pairs. Threads expr (via -&gt;)
</span><span class='line'>through each form for which the corresponding test
</span><span class='line'>expression is true. Note that, unlike cond branching, cond-&gt; threading does
</span><span class='line'>not short circuit after the first true test expression.</span></code></pre></td></tr></table></div></figure>


<p>So what does the docstring mean? Let&rsquo;s break it down with an example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cond-&gt;</span> <span class="mi">10</span>
</span><span class='line'>  <span class="nv">false</span> <span class="nv">inc</span><span class="p">)</span>
</span><span class='line'><span class="nv">=&gt;</span> <span class="mi">10</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the above example <code>10</code> is the <code>expr</code> mentioned in the docstring and
everything after it are the <code>clauses</code>. Each clause is a pair made up
of a test and a form. In this example there is a single clause with
the value <code>false</code> as the test the function <code>inc</code> as the form. Since
the test evaluates to a false value the expression is not threaded
into the form. As a result the original expression, <code>10</code>, is returned.</p>

<p>Let&rsquo;s look at an example with a truthy test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cond-&gt;</span> <span class="mi">10</span>
</span><span class='line'>  <span class="nv">true</span> <span class="p">(</span><span class="nb">- </span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="nv">=&gt;</span> <span class="mi">8</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once again, <code>10</code> is the starting expression. The single clause has a
test that evaluates to true so the expression is threaded into the
first position of the form <code>(- 2)</code>. The result is <code>8</code> and this is
returned.</p>

<p>Next is an example of a <code>cond-&gt;</code> with multiple clauses. Explanations
are inline with the code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cond-&gt;</span> <span class="mi">10</span> <span class="c1">; start with 10</span>
</span><span class='line'>  <span class="c1">;; test evaluates to true, so apply inc to 10. Current value is now 11.</span>
</span><span class='line'>  <span class="nv">true</span> <span class="nv">inc</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">;; (zero? 1) evaluates to false, do not perform action. Current value stays 11.</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">zero? </span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">;; (pos? 4) evaluates to true, thread 11 into first position of form.</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">pos? </span><span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="mi">5</span><span class="p">))</span>
</span><span class='line'><span class="nv">=&gt;</span> <span class="mi">6</span> <span class="c1">; The result of (- 11 5) is 6.</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you understand the above example then you have a good grasp of
<code>cond-&gt;</code>. But when is this functionality useful?</p>

<h3>When do I use cond->?</h3>

<p>Looking through the codebases I work on, I almost primarily see
<code>cond-&gt;</code> being used with the initial expression being a hash-map. It
is being used in situations where we want to selectively
<code>assoc</code>, <code>update</code>, or <code>dissoc</code> something from a map.</p>

<p>If <code>cond-&gt;</code> did not exist you would accomplish those selective
modifications with code similar to below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">some-pred?</span> <span class="nv">q</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">assoc </span><span class="nv">m</span> <span class="ss">:a-key</span> <span class="ss">:a-value</span><span class="p">)</span>
</span><span class='line'>  <span class="nv">m</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can rewrite the above with <code>cond-&gt;</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">cond-&gt;</span> <span class="nv">m</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">some-pred?</span> <span class="nv">q</span><span class="p">)</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">:a-key</span> <span class="ss">:a-value</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re not used to seeing <code>cond-&gt;</code> the above transformation might
seem like a step backwards. I know it felt that way to me when I first
saw <code>cond-&gt;</code>. Give yourself time to get familiar with it and you&rsquo;ll be
glad you&rsquo;re using it.</p>

<p>A meatier example of using <code>cond-&gt;</code> is demonstrated below. Here we&rsquo;re
manipulating data structures designed for use with
<a href="https://github.com/jkk/honeysql">honeysql</a> to generate SQL
statements. We start with a <code>base-query</code> and selectively modify it
based on incoming parameters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">query</span> <span class="p">[</span><span class="nv">req-params</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">and-clause</span> <span class="p">(</span><span class="nf">fnil</span> <span class="nb">conj </span><span class="p">[</span><span class="ss">:and</span><span class="p">])</span>
</span><span class='line'>        <span class="nv">base-query</span> <span class="p">{</span><span class="ss">:select</span> <span class="p">[</span><span class="ss">:name</span> <span class="ss">:job</span><span class="p">]</span>
</span><span class='line'>                    <span class="ss">:from</span> <span class="p">[</span><span class="ss">:person</span><span class="p">]}]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">cond-&gt;</span> <span class="nv">base-query</span>
</span><span class='line'>      <span class="p">(</span><span class="ss">:job</span> <span class="nv">req-params</span><span class="p">)</span> <span class="p">(</span><span class="nf">update</span> <span class="ss">:where</span> <span class="nv">and-clause</span> <span class="p">[</span><span class="ss">:=</span> <span class="ss">:job</span> <span class="p">(</span><span class="ss">:job</span> <span class="nv">req-params</span><span class="p">)])</span>
</span><span class='line'>      <span class="p">(</span><span class="ss">:name</span> <span class="nv">req-params</span><span class="p">)</span> <span class="p">(</span><span class="nf">update</span> <span class="ss">:where</span> <span class="nv">and-clause</span> <span class="p">[</span><span class="ss">:=</span> <span class="ss">:name</span> <span class="p">(</span><span class="ss">:name</span> <span class="nv">req-params</span><span class="p">)])</span>
</span><span class='line'>      <span class="p">(</span><span class="ss">:min-age</span> <span class="nv">req-params</span><span class="p">)</span> <span class="p">(</span><span class="nf">update</span> <span class="ss">:where</span> <span class="nv">and-clause</span> <span class="p">[</span><span class="ss">:&gt;</span> <span class="ss">:age</span> <span class="p">(</span><span class="ss">:min-age</span> <span class="nv">req-params</span><span class="p">)]))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hopefully this gives you a taste of <code>cond-&gt;</code>. I&rsquo;ve found it to be
quite useful. It has a place in every Clojure developer&rsquo;s toolbox.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/08/book-review-serverless-single-page-apps/">Book review: Serverless Single Page Apps</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-08T10:15:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>10:15 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve read Ben Rady&rsquo;s
<a href="https://pragprog.com/book/brapps/serverless-single-page-apps">Serverless Single Page Apps</a>
twice now. As an early technical reviewer, I was able to watch and
take part in the book&rsquo;s evolution. The early draft was good but the
most recent near-final draft was better.</p>

<p><em>Serverless Single Page Apps</em> walks you through building a low-cost,
highly-available, serverless single page web application. It does this
on top of various Amazon web services (DynamoDB, Cognito, Lambda, API
Gateway, S3). If you follow along you&rsquo;ll end up with a simple web
application with authentication.</p>

<p>The book is very enjoyable. The examples are clear and the book is
well written. The book uses JavaScript to implement the serverless
application. For the user interface it uses plain JavaScript with a
bit of jQuery and for the AWS Lambda functions you dip into some
Node.js. <em>Serverless</em> doesn&rsquo;t distract you from learning about
serverless applications by forcing you to learn new JavaScript
frameworks or libraries.</p>

<p>One of my favorite parts of the book is Ben&rsquo;s use of test driven
development. The examples provided give the reader a decent taste of
the benefits of test-first development. Having the tests helped me
when I made some silly mistakes in later parts of the book.</p>

<p>Overall I&rsquo;d recommend this book to developers who are interested in
learning what a serverless application might look like. If you follow
along you&rsquo;ll know how to build one by the end and will have a good
starting point for diving deeper into the topic.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/03/13/reading-in-2015/">Reading in 2015</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-03-13T16:18:00-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>4:18 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>At the beginning of the year I generally take the time to reflect on
my reading in the previous year. I&rsquo;m nearly three months but I&rsquo;m
finally taking a look at 2015. Here are my summaries of my
<a href="http://jakemccrary.com/blog/2015/01/08/reading-in-2014/">2014</a> and
<a href="http://jakemccrary.com/blog/2014/01/01/using-incanter-to-review-my-2013-reading/">2013</a>
reading.</p>

<p>I&rsquo;ve continued to keep track of my reading by using
<a href="http://goodreads.com">Goodreads</a>. My
<a href="https://www.goodreads.com/user/show/3431614-jake-mccrary">profile</a>
contains the full list and reviews of books I&rsquo;ve read
since 2010. <a href="https://www.goodreads.com/review/list/3431614-jake-mccrary?read_at=2015">Here</a>
is my 2015 list.</p>

<h3>2015 Goals</h3>

<p>2015 did not have an easily measured goal. I set the vague goal of
increasing the quality of my reading by attempting to think deeper about
what I&rsquo;ve read.</p>

<h3>2015 Results</h3>

<p>I have no idea if I achieved my goal. Some books have stuck with me
and I&rsquo;ve thought quite a bit about the stories. Others I&rsquo;ve forgotten
already.</p>

<p>Looking at raw numbers I read 51 books in 2015 for a total of about
21,790 pages. When compared to 2014 these numbers are lower by 19
books and about 1300 pages.</p>

<p>In terms of star ratings, 2015 was a better year. I had three more
five star books and one more four star book. The 19 book difference
between 2014 and 2015 is entirely found in two and three star books.</p>

<h3>Recommendations</h3>

<p>I awarded ten books a five star rating. This is more five stars than
any other year. Each of the five star books I&rsquo;d recommend without
hesitation. Below is my list of five star books. The titles are
affiliate links to Amazon and the <em>my review</em> text links to
Goodreads.</p>

<ul>
<li><a href="http://amzn.to/24YyEvJ">David Foster Wallace - The Pale King</a> (<a href="https://www.goodreads.com/review/show/882190236">my review</a>)</li>
<li><a href="http://amzn.to/1QPjLV6">Donna Tartt - The Goldfinch</a> (<a href="https://www.goodreads.com/review/show/1168264855">my review</a>)</li>
<li><a href="http://amzn.to/1M0BjhZ">Donna Tartt - The Secret History</a> (<a href="https://www.goodreads.com/review/show/1225842414">my review</a>)</li>
<li><a href="http://amzn.to/1pFcZZg">James Clavell - Shogun</a> (<a href="https://www.goodreads.com/review/show/1284160882">my review</a>)</li>
<li><a href="http://amzn.to/1P6YKAX">John Williams - Stoner</a> (<a href="https://www.goodreads.com/review/show/1152858937">my review</a>)</li>
<li><a href="http://amzn.to/1QPjSA2">Michael L. Anderson - The Rock Climber&rsquo;s Training Manual</a> (<a href="https://www.goodreads.com/review/show/1420673577">my review</a>)</li>
<li><a href="http://amzn.to/1P6YMbY">Neal Stephenson - Cryptonomicon</a> (<a href="https://www.goodreads.com/review/show/799153387">my review</a>)</li>
<li><a href="http://amzn.to/24Yy8xF">Neal Stephenson - Reamde</a> (<a href="https://www.goodreads.com/review/show/927872107">my review</a>)</li>
<li><a href="http://amzn.to/1pFd3bo">Neal Stephenson - Snow Crash</a> (<a href="https://www.goodreads.com/review/show/799153414">my review</a>)</li>
<li><a href="http://amzn.to/1YO1HOf">Sam Newman - Building Microservices</a> (<a href="https://www.goodreads.com/review/show/1202873191">my review</a>)</li>
</ul>


<p>One of the great things about writing this post is that it forces me
to pause and reflect on the previous years books. Its great seeing
this list of great books and remembering the stories. Of these ten
books the ones I remember most fondly are <em>Stoner</em>, <em>Snow Crash</em>, and
<em>The Pale King</em>.</p>

<p>There were also a ton of great four star books this year. One that
stands out is Joseph Heller&rsquo;s
<a href="http://amzn.to/1pFcQFc">Something Happened</a>
(<a href="https://www.goodreads.com/review/show/189671091">my review</a>). Kurt
Vonnegut wrote a brilliant
<a href="http://www.nytimes.com/books/98/02/15/home/heller-something.html">review</a>
of this book which I encourage you to read.</p>

<p>Dave MacLeod&rsquo;s
<a href="http://amzn.to/1pFcVIV">Make or Break: Don&rsquo;t Let Climbing Injuries Dictate Your Success</a>
(<a href="https://www.goodreads.com/review/show/1236422760">my review</a>)
deserves a mention. I highly recommend this book to any climber. We
push our bodies hard and this book will help you prevent and recover
from injuries. I&rsquo;ve used it as a reference so many times over the past
year. It probably deserves five stars.</p>

<h3>Other Stats</h3>

<p>Unsurprisingly, I&rsquo;m continuing to mostly read ebooks.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|           | 2014 | 2015 |
</span><span class='line'>|-----------+------+------|
</span><span class='line'>| ebook     |   64 |   47 |
</span><span class='line'>| hardcover |    1 |    1 |
</span><span class='line'>| paperback |    4 |    3 |</span></code></pre></td></tr></table></div></figure>


<p>My average rating went up.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Year | Average Rating |
</span><span class='line'>|------+----------------|
</span><span class='line'>| 2011 |           3.84 |
</span><span class='line'>| 2012 |           3.66 |
</span><span class='line'>| 2013 |           3.67 |
</span><span class='line'>| 2014 |           3.48 |
</span><span class='line'>| 2015 |           3.86 |</span></code></pre></td></tr></table></div></figure>


<p>Last year I had many repeat authors. This year I had fewer. Neal
Stephenson and Donna Tart really stood out this year. I read multiple
books from both of them and rated every book five stars.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Author               | My Average Rating | Number of Pages | Number of books |
</span><span class='line'>|----------------------+-------------------+-----------------+-----------------|
</span><span class='line'>| Neal Stephenson      |                 5 |            2693 |               3 |
</span><span class='line'>| Donna Tartt          |                 5 |            1427 |               2 |
</span><span class='line'>| Paolo Bacigalupi     |       3.666666667 |            1113 |               3 |
</span><span class='line'>| Bret Easton Ellis    |               3.5 |             590 |               2 |</span></code></pre></td></tr></table></div></figure>


<h3>2016 Goals</h3>

<p>In 2016 I&rsquo;m planning on reading one or two biographies. That isn&rsquo;t a
genre I typically read. It should be a pretty easy goal to hit. If you
have any recommendations please leave them in a comment.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/19/clojurescript-treat-warnings-as-errors/">ClojureScript: Treat warnings as errors</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-19T17:09:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:09 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Recently my team deployed a new version of our ClojureScript UI and it
had a minor bug. It was trivial to fix the problem, a ClojureScript
build warning pointed us to the cause. As a result we started thinking
it would be nice to have build warnings count as errors and fail our
ClojureScript build.</p>

<p>We use <a href="http://leiningen.org/">Leiningen</a> (version 2.5.3) and
<a href="https://github.com/emezeske/lein-cljsbuild">lein-cljsbuild</a> (version
1.1.1). After some searching we found that lein-cljsbuild supports
<a href="https://github.com/emezeske/lein-cljsbuild#custom-warning-handlers">specifying custom warning handlers</a>
as the value to the <code>:warning-handlers</code> key. The lein-cljsbuild README even
provides an example, which we took and added a <code>(System/exit 1)</code> to
the end of it. This resulted in a build configuration that looked similar to below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:id</span> <span class="s">&quot;prod&quot;</span>
</span><span class='line'> <span class="ss">:warning-handlers</span> <span class="p">[(</span><span class="k">fn </span><span class="p">[</span><span class="nv">warning-type</span> <span class="nv">env</span> <span class="nv">extra</span><span class="p">]</span>
</span><span class='line'>                      <span class="p">(</span><span class="nb">when-let </span><span class="p">[</span><span class="nv">s</span> <span class="p">(</span><span class="nf">cljs.analyzer/error-message</span> <span class="nv">warning-type</span> <span class="nv">extra</span><span class="p">)]</span>
</span><span class='line'>                        <span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*out*</span> <span class="nv">*err*</span><span class="p">]</span>
</span><span class='line'>                          <span class="p">(</span><span class="nb">println </span><span class="s">&quot;WARNING:&quot;</span> <span class="p">(</span><span class="nf">cljs.analyzer/message</span> <span class="nv">env</span> <span class="nv">s</span><span class="p">)))</span>
</span><span class='line'>                        <span class="p">(</span><span class="nf">System/exit</span> <span class="mi">1</span><span class="p">)))]</span>
</span><span class='line'> <span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;src/cljc&quot;</span> <span class="s">&quot;src/cljs&quot;</span><span class="p">]</span>
</span><span class='line'> <span class="ss">:compiler</span> <span class="p">{</span><span class="ss">:output-to</span> <span class="s">&quot;resources/public/js/compiled/ui.js&quot;</span>
</span><span class='line'>            <span class="ss">:externs</span> <span class="p">[</span><span class="s">&quot;resources/intercom-externs.js&quot;</span>
</span><span class='line'>                      <span class="s">&quot;resources/mixpanel-externs.js&quot;</span><span class="p">]</span>
</span><span class='line'>            <span class="ss">:optimizations</span> <span class="ss">:advanced</span><span class="p">}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This worked! Well, it sort of worked. Our build failed whenever there
was a warning but now we were seeing spurious warnings. We saw &ldquo;Use of
undeclared Var&rdquo; warnings when functions created in a <code>letfn</code> where
calling each other. Definitely not a situation that warrants a warning
and definitely not a build failure.</p>

<p>We weren&rsquo;t seeing this warning before so we opened ClojureScript&rsquo;s
source and found the
<a href="https://github.com/clojure/clojurescript/blob/452edf43927566cc0ea0a3846706c0294cef235d/src/main/clojure/cljs/analyzer.cljc#L360-L366">default warning handler</a>.
The default handler checks that <code>warning-type</code> has a truthy value in
the map <code>*cljs-warnings*</code>. Inspired by the default handler we added
the same check to the start of our warning handler.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:warning-handlers</span> <span class="p">[(</span><span class="k">fn </span><span class="p">[</span><span class="nv">warning-type</span> <span class="nv">env</span> <span class="nv">extra</span><span class="p">]</span>
</span><span class='line'>                     <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nf">warning-type</span> <span class="nv">cljs.analyzer/*cljs-warnings*</span><span class="p">)</span>
</span><span class='line'>                       <span class="p">(</span><span class="nb">when-let </span><span class="p">[</span><span class="nv">s</span> <span class="p">(</span><span class="nf">cljs.analyzer/error-message</span> <span class="nv">warning-type</span> <span class="nv">extra</span><span class="p">)]</span>
</span><span class='line'>                         <span class="p">(</span><span class="nb">binding </span><span class="p">[</span><span class="nv">*out*</span> <span class="nv">*err*</span><span class="p">]</span>
</span><span class='line'>                           <span class="p">(</span><span class="nb">println </span><span class="s">&quot;WARNING:&quot;</span> <span class="p">(</span><span class="nf">cljs.analyzer/message</span> <span class="nv">env</span> <span class="nv">s</span><span class="p">)))</span>
</span><span class='line'>                         <span class="p">(</span><span class="nf">System/exit</span> <span class="mi">1</span><span class="p">))))]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Success! Now we no longer get incorrect warnings when compiling our
<code>letfn</code> form and our build still fails if a warning occurs. Now we can
build and deploy with a little more confidence.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/12/18/even-quicker-feedback-from-your-clojure-tests/">Even quicker feedback from your Clojure tests</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-12-18T15:29:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:29 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I was recently inspired by a post on a mailing list to make the TDD
cycle with <code>clojure.test</code> and
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> even
faster. <code>lein-test-refresh</code> is a Leiningen tool that monitors your
Clojure project&rsquo;s source, reloads changes, and then runs your tests.
Tools like it provide some of the fastest feedback cycles possible.</p>

<p>To make the feedback cycle even faster I added the option to only run
tests in changed namespaces. This means you&rsquo;re running
the minimum number of tests after a change. Version 0.12.0 of
<code>lein-test-refresh</code> was released earlier this week with this feature.</p>

<p>To use it add <code>[com.jakemccrary/lein-test-refresh 0.12.0]</code> as a plugin
to your profiles.clj or project.clj. An example
<a href="https://github.com/jakemcc/lein-test-refresh/blob/master/sample.project.clj#L3">project.clj</a>
can be found in the project&rsquo;s GitHub repo.</p>

<p>Once you&rsquo;re on the latest version you can toggle this feature from the
command line by providing a <code>:changes-only</code> flag, <code>lein test-refresh
:changes-only</code>, or by adding <code>:changes-only true</code> to your
<code>:test-refresh</code> configuration section in your project.clj or
profiles.clj. When the feature is on you can still run all your tests
by hitting <code>enter</code> in the terminal running <code>lein test-refresh</code>.</p>

<p>Below is an example of the time difference between running all my tests
and the tests in a single namespace.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ran 49 tests containing 219 assertions.
</span><span class='line'>0 failures, 0 errors.
</span><span class='line'>
</span><span class='line'>Passed all tests
</span><span class='line'>Finished at 14:42:41.655 (run time: 2.006s)
</span><span class='line'>*********************************************
</span><span class='line'>*************** Running tests ***************
</span><span class='line'>:reloading (lumanu.utils-test)
</span><span class='line'>
</span><span class='line'>Ran 1 tests containing 3 assertions.
</span><span class='line'>0 failures, 0 errors.
</span><span class='line'>
</span><span class='line'>Passed all tests
</span><span class='line'>Finished at 14:43:12.648 (run time: 0.085s)</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve been using this feature for about a week now and am enjoying it.
My whole test suite isn&rsquo;t particularly slow but even still I&rsquo;ve been
enjoying the faster feedback.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/11/15/sql-aggregate-a-set-of-values-together/">SQL: Aggregate a set of values together</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-15T19:45:00-06:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:45 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Lately I&rsquo;ve been working on projects that use
<a href="http://www.postgresql.org/">Postgres</a> as our relational database.
This has allowed us to simplify some of our Clojure code by leaning on
some built-in features of Postgres. One SQL function supported by
Postgres which has greatly simplified our code is the <code>array_agg</code>
<a href="http://www.postgresql.org/docs/9.4/static/functions-aggregate.html">aggregate</a>
function.</p>

<h2>What is <code>array_agg</code>?</h2>

<p>The <code>array_agg</code> function takes an argument and returns an array of the
argument type. That sentence will make more sense after an example.
The snippet below shows a simplified schema for a blog&rsquo;s database.
There is a table called <code>blog_posts</code> that contains details about
posts, a table called <code>categories</code> that has labels that can be applied
to blog posts, and a join table called <code>post_categories</code> that links
the two previous tables together.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">blog</span><span class="o">=#</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">title</span> <span class="k">from</span> <span class="n">blog_posts</span><span class="p">;</span>
</span><span class='line'> <span class="n">id</span> <span class="o">|</span>    <span class="n">title</span>
</span><span class='line'><span class="c1">----+--------------</span>
</span><span class='line'>  <span class="mi">1</span> <span class="o">|</span> <span class="k">SQL</span> <span class="n">Post</span>
</span><span class='line'>  <span class="mi">2</span> <span class="o">|</span> <span class="n">Clojure</span> <span class="n">Post</span>
</span><span class='line'>
</span><span class='line'><span class="n">blog</span><span class="o">=#</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">categories</span><span class="p">;</span>
</span><span class='line'> <span class="n">id</span> <span class="o">|</span>   <span class="n">name</span>
</span><span class='line'><span class="c1">----+----------</span>
</span><span class='line'>  <span class="mi">1</span> <span class="o">|</span> <span class="k">sql</span>
</span><span class='line'>  <span class="mi">2</span> <span class="o">|</span> <span class="n">emacs</span>
</span><span class='line'>  <span class="mi">3</span> <span class="o">|</span> <span class="n">clojure</span>
</span><span class='line'>  <span class="mi">4</span> <span class="o">|</span> <span class="n">postgres</span>
</span><span class='line'>
</span><span class='line'><span class="n">blog</span><span class="o">=#</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">post_categories</span><span class="p">;</span>
</span><span class='line'> <span class="n">blog_post_id</span> <span class="o">|</span> <span class="n">category_id</span>
</span><span class='line'><span class="c1">--------------+-------------</span>
</span><span class='line'>            <span class="mi">1</span> <span class="o">|</span>           <span class="mi">1</span>
</span><span class='line'>            <span class="mi">2</span> <span class="o">|</span>           <span class="mi">2</span>
</span><span class='line'>            <span class="mi">1</span> <span class="o">|</span>           <span class="mi">4</span>
</span><span class='line'>            <span class="mi">2</span> <span class="o">|</span>           <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before I learned about <code>array_agg</code>, if I wanted to know how each blog
post had been categorized I might have written the following query.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">select</span> <span class="n">title</span><span class="p">,</span> <span class="n">name</span> <span class="k">as</span> <span class="n">category</span>
</span><span class='line'>  <span class="k">from</span> <span class="n">blog_posts</span> <span class="n">bp</span>
</span><span class='line'>  <span class="k">join</span> <span class="n">post_categories</span> <span class="n">pc</span> <span class="k">on</span> <span class="n">pc</span><span class="p">.</span><span class="n">blog_post_id</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="n">id</span>
</span><span class='line'>  <span class="k">join</span> <span class="n">categories</span> <span class="k">c</span> <span class="k">on</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">pc</span><span class="p">.</span><span class="n">category_id</span>
</span><span class='line'>  <span class="k">order</span> <span class="k">by</span> <span class="n">title</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">title</span>     <span class="o">|</span> <span class="n">category</span>
</span><span class='line'><span class="c1">--------------+----------</span>
</span><span class='line'> <span class="n">Clojure</span> <span class="n">Post</span> <span class="o">|</span> <span class="n">emacs</span>
</span><span class='line'> <span class="n">Clojure</span> <span class="n">Post</span> <span class="o">|</span> <span class="n">clojure</span>
</span><span class='line'> <span class="k">SQL</span> <span class="n">Post</span>     <span class="o">|</span> <span class="k">sql</span>
</span><span class='line'> <span class="k">SQL</span> <span class="n">Post</span>     <span class="o">|</span> <span class="n">postgres</span>
</span></code></pre></td></tr></table></div></figure>


<p>The result is readable but as the number of posts and categories grow
it becomes harder to read. The query also doesn&rsquo;t answer the question,
&ldquo;How are my posts categorized?&rdquo;, well. The ideal answer is a single
row per post that shows the post&rsquo;s categories. You can use <code>array_agg</code>
to get that ideal answer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">select</span> <span class="n">title</span><span class="p">,</span> <span class="n">array_agg</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">categories</span>
</span><span class='line'>  <span class="k">from</span> <span class="n">blog_posts</span> <span class="n">bp</span>
</span><span class='line'>  <span class="k">join</span> <span class="n">post_categories</span> <span class="n">pc</span> <span class="k">on</span> <span class="n">pc</span><span class="p">.</span><span class="n">blog_post_id</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="n">id</span>
</span><span class='line'>  <span class="k">join</span> <span class="n">categories</span> <span class="k">c</span> <span class="k">on</span> <span class="k">c</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">pc</span><span class="p">.</span><span class="n">category_id</span>
</span><span class='line'>  <span class="k">group</span> <span class="k">by</span> <span class="n">title</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">title</span>     <span class="o">|</span>   <span class="n">categories</span>
</span><span class='line'><span class="c1">--------------+-----------------</span>
</span><span class='line'> <span class="k">SQL</span> <span class="n">Post</span>     <span class="o">|</span> <span class="err">{</span><span class="k">sql</span><span class="p">,</span><span class="n">postgres</span><span class="err">}</span>
</span><span class='line'> <span class="n">Clojure</span> <span class="n">Post</span> <span class="o">|</span> <span class="err">{</span><span class="n">emacs</span><span class="p">,</span><span class="n">clojure</span><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I find the <code>array_agg</code> version much nicer to read. The result answers
the question in a very direct fashion and the query expresses the
question well. Everything about the query expresses the question, you
no longer have an extra <code>order by</code> clause to make the result more
readable by human eyes.</p>

<h2>How did it make my Clojure code simpler?</h2>

<p>The above is great and it makes everything more readable for a human.
Most of the time I&rsquo;m not querying a SQL database so that a human can
directly read the results; instead I&rsquo;m using Clojure to manipulate
results of a query. Fortunately, <code>array_agg</code> simplifies my Clojure
code as well.</p>

<p>I&rsquo;m working with a schema that has many relationships similar to the
above relationship. Continuing with the example from above the snippet
below shows the data shape we&rsquo;d get back from <code>clojure.java.jdbc</code>
prior to using <code>array_agg</code>. The data shape we actually want follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; data shape you get from the non-array_agg query.</span>
</span><span class='line'><span class="p">[{</span><span class="ss">:title</span> <span class="s">&quot;Clojure Post&quot;</span> <span class="ss">:category</span> <span class="s">&quot;emacs&quot;</span><span class="p">}</span>
</span><span class='line'> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;SQL Post&quot;</span> <span class="ss">:category</span> <span class="s">&quot;sql&quot;</span><span class="p">}</span>
</span><span class='line'> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;Clojure Post&quot;</span> <span class="ss">:category</span> <span class="s">&quot;clojure&quot;</span><span class="p">}</span>
</span><span class='line'> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;SQL Post&quot;</span> <span class="ss">:category</span> <span class="s">&quot;postgres&quot;</span><span class="p">}]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; data shape you want</span>
</span><span class='line'><span class="p">[{</span><span class="ss">:title</span> <span class="s">&quot;Clojure Post&quot;</span> <span class="ss">:categories</span> <span class="p">[</span><span class="s">&quot;emacs&quot;</span> <span class="s">&quot;clojure&quot;</span><span class="p">]}</span>
</span><span class='line'> <span class="p">{</span><span class="ss">:title</span> <span class="s">&quot;SQL Post&quot;</span> <span class="ss">:categories</span> <span class="p">[</span><span class="s">&quot;sql&quot;</span> <span class="s">&quot;postgres&quot;</span><span class="p">]}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we&rsquo;re not getting data in our desired shape we need to write
code that combines rows. One way of doing that is to use <code>reduce</code> and <code>map</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">squash-by-title</span> <span class="p">[</span><span class="nv">rows</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">rows</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">reduce </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">r</span> <span class="nv">row</span><span class="p">]</span> <span class="p">(</span><span class="nf">update</span> <span class="nv">r</span> <span class="p">(</span><span class="ss">:title</span> <span class="nv">row</span><span class="p">)</span> <span class="nb">conj </span><span class="p">(</span><span class="ss">:category</span> <span class="nv">row</span><span class="p">)))</span> <span class="p">{})</span>
</span><span class='line'>       <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">title</span> <span class="nv">categories</span><span class="p">]]</span> <span class="p">{</span><span class="ss">:title</span> <span class="nv">title</span> <span class="ss">:categories</span> <span class="nv">categories</span><span class="p">}))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve been writing Clojure for a long time and when I see code like
above it still takes me a bit of time to figure out what is happening.
Not only that, but eventually your project has different squash
operations depending on what data you&rsquo;re pulling back from the
database. They are probably mostly similar and eventually you abstract
the differences and feel great. Then you come back months later and
have to figure out how it all works. Luckily, if you&rsquo;re using a
database that supports <code>array_agg</code>, there is a better way.</p>

<p>The first step is to change your queries to use <code>array_agg</code>. The
second step is to extend the <code>clojure.java.jdbc/IResultSetReadColumn</code>
protocol to the type returned by your jdbc driver. For my project that
looks like the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; clojure.java.jdbc has been required as jdbc</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">extend-protocol</span> <span class="nv">jdbc/IResultSetReadColumn</span>
</span><span class='line'>  <span class="nv">org.postgresql.jdbc4.Jdbc4Array</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">result-set-read-column</span> <span class="p">[</span><span class="nv">pgobj</span> <span class="nv">metadata</span> <span class="nv">i</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">vec</span> <span class="p">(</span><span class="nf">.getArray</span> <span class="nv">pgobj</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>By changing my queries to use <code>array_agg</code> and adding those four lines
of code I&rsquo;m able to delete all of my squashing functions and get data
from my database in the shape I want. I also end up with easier to
understand code and more expressive queries. Awesome.</p>

<p><em>Thanks to <a href="http://timothypratley.blogspot.com/">Timothy Pratley</a> for
providing feedback on earlier versions of this post.</em></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/03/github-code-reviews/">GitHub Code Reviews</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-03T11:22:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>11:22 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Last December I wrote about the
<a href="/blog/2014/12/09/an-effective-code-review-process/">effective code review process</a>
I started at Outpace. The process works well; participants say it is
the most effective review process they&rsquo;ve experienced. The rest of
this post is a summary of the process with a bit of an enhancement
around setting up the code for review. I&rsquo;d recommend you read the
original
<a href="/blog/2014/12/09/an-effective-code-review-process/">post</a>
for a bit more color on the process.</p>

<h3>Steps for GitHub code review</h3>

<ol>
<li>Select the code to review.</li>
<li>About a week before the review, create a branch and delete the code
you&rsquo;re reviewing.</li>
<li>Push this branch to GitHub and open a pull request. This pull
request provides a location where comments can be made on every
line of code.</li>
<li>Schedule the code review meeting. Make sure participants have two
to three days to asynchronously review the code in the pull
request.</li>
<li>Have the code review. Get everyone together (video chat or in person)
and go through the comments on the pull request and discuss. Add
action items as a comment. The leader of the code review keeps
discussion moving.</li>
</ol>


<p>It&rsquo;s a lightweight process. If you&rsquo;re already using GitHub it doesn&rsquo;t
bring in any other tools and, unlike some dedicated code review
software I&rsquo;ve used, the GitHub pull request interface has good
performance.</p>

<p>One complaint about this process is that the code you&rsquo;re reviewing
appears as deleted in the pull request. It is a superficial complaint
but seeing the entire code base as deleted can feel a bit weird.</p>

<p>For the most recent code review, I figured out how to have all the
code appear as added. The snippet below contains the steps and example
commands.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">#</span> <span class="nb">cd </span>to the repository you are reviewing.
</span><span class='line'><span class="go">cd blog</span>
</span><span class='line'>
</span><span class='line'><span class="gp">#</span> Make a new branch.
</span><span class='line'><span class="go">git checkout -b empty-repo</span>
</span><span class='line'>
</span><span class='line'><span class="gp">#</span> Copy all files in repo to a temporary directory.
</span><span class='line'><span class="go">rm -rf /tmp/repo &amp;&amp; mkdir /tmp/repo &amp;&amp; cp -R * /tmp/repo</span>
</span><span class='line'>
</span><span class='line'><span class="gp">#</span> Remove all files from repository, commit, and push to GitHub.
</span><span class='line'><span class="go">rm -rf *</span>
</span><span class='line'><span class="go">git commit -am &#39;remove all files&#39;</span>
</span><span class='line'><span class="go">git push origin empty-repo</span>
</span><span class='line'>
</span><span class='line'><span class="gp">#</span> Create a new branch with the empty-repo as the parent.
</span><span class='line'><span class="go">git checkout -b code-review</span>
</span><span class='line'>
</span><span class='line'><span class="gp">#</span> Copy back in the files and add the files you want to review.
</span><span class='line'><span class="gp">#</span> Commit and push to GitHub.
</span><span class='line'><span class="go">cp -R /tmp/repo/* .</span>
</span><span class='line'><span class="go">git add files-to-review</span>
</span><span class='line'><span class="go">git commit -m &#39;adding files for review&#39;</span>
</span><span class='line'><span class="go">git push origin code-review</span>
</span><span class='line'>
</span><span class='line'><span class="gp">#</span> Now, go to project on GitHub and switch to the code-review branch.
</span><span class='line'><span class="gp">#</span> Open a pull request comparing the empty-repo and the code-review
</span><span class='line'><span class="gp">#</span> branch.
</span></code></pre></td></tr></table></div></figure>


<p>Voila, you now have a pull request with every line under review marked
as added instead of deleted! It takes a little more than two times the
number steps required to open a pull request with the code deleted but
you might find it worth it. Seeing code as added instead of removed is
a minor thing but minor things can make a process more enjoyable. It
is nice to know it is possible.</p>

<p>If you aren&rsquo;t doing code reviews or have found them useless in the
past, I recommend you try out this process. This post is the
abbreviated version but it gives you enough to get started. If you
haven&rsquo;t done one in this style before, I&rsquo;d highly recommend reading
the longer <a href="/blog/2014/12/09/an-effective-code-review-process/">post</a>
as it gives some details that I&rsquo;ve left out here.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/30/my-favorite-clj-refactor-features/">My favorite clj-refactor features</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-30T08:40:00-05:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>8:40 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>If you write Clojure using Emacs you should check out
<a href="https://github.com/clojure-emacs/clj-refactor.el">clj-refactor</a>. It
is working better than ever and makes developing Clojure more
enjoyable.</p>

<p>I don&rsquo;t use all the features in clj-refactor. There are a lot of
features I haven&rsquo;t had the need to use and many I just can&rsquo;t remember.
Below are the features I use consistently.</p>

<h3>Favorite Features</h3>

<p>My favorite feature of clj-refactor is the
<a href="/blog/2015/06/18/emacs-automatically-require-common-namespaces/">magic requires</a>.
This feature lets you type a prefix (such as <code>(str/)</code>) and have the
namespace automatically added to your <code>ns</code> form (in this example
<code>[clojure.string :as str]</code>). It is awesome. You can also add
<a href="/blog/2015/06/18/emacs-automatically-require-common-namespaces/">your own</a>
prefix mappings.</p>

<p>My other most frequently used refactorings are
<a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-introduce-let">introduce let</a>,
<a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-expand-let">expand let</a>,
and
<a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-move-to-let">move to let</a>.
These three are very complementary and are a quick way if introducing
named locals.</p>

<p><a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-add-missing-libspec">Add missing libspec</a>
is a recent discovery of mine. Have you ever paired with a developer
who uses Intellij with Cursive and been a bit jealous of the
auto-requiring? I have. This refactoring lets you do that. Type
whatever symbol you want and clj-refactor tries to resolve it and then
require the containing namespace with correct prefix. Recently I broke
a massive namespace into a few smaller ones and this refactoring saved
me a ton of time.</p>

<p>I used to use
<a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-move-form">move form</a>
when trying to reorganize namespaces but now I pretty much just cut
and paste and use
<a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-add-missing-libspec">add missing libspec</a>
to fix the requires. I want to use <strong>move form</strong> but I haven&rsquo;t had a
ton of success with it. <strong>Add missing libspec</strong> plus cut and paste is
a few more steps but my success rate has been much higher.</p>

<p><a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-sort-ns">Sort ns</a>
does exactly what it says, it sorts your <code>ns</code> form. Once you get used
to keeping your <code>ns</code> forms sorted you won&rsquo;t go back.</p>

<p><a href="https://github.com/clojure-emacs/clj-refactor.el/wiki/cljr-extract-function">Extract function</a>
is another refactoring I recently stumbled upon. I&rsquo;ve used it a few
times since then and when it works it is pretty awesome. I&rsquo;ve had
unexpected behavior a couple of times but it was unclear if that was
my fault or it not handling macros well. If you&rsquo;re extracting a
function you might as well give it a shot.</p>

<p>The final feature is the
<a href="https://github.com/clojure-emacs/clj-refactor.el/wiki#automatic-insertion-of-namespace-declaration">automatic insertion of namespace declarations</a>
when you create a new Clojure file. I nearly forgot to highlight this
feature because it requires no action on my side and it is amazing. If
I never have to type a namespace symbol again I&rsquo;ll be happy.</p>

<h3>Customization</h3>

<p>Below is my entire clj-refactor setup from my Emacs init.el. It
doesn&rsquo;t take much to get it to a state I like.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;clj-refactor</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; Add custom magic requires.</span>
</span><span class='line'><span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">mapping</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;maps&quot;</span> <span class="o">.</span> <span class="s">&quot;outpace.util.maps&quot;</span><span class="p">)</span>
</span><span class='line'>                   <span class="p">(</span><span class="s">&quot;seqs&quot;</span> <span class="o">.</span> <span class="s">&quot;outpace.util.seqs&quot;</span><span class="p">)</span>
</span><span class='line'>                   <span class="p">(</span><span class="s">&quot;times&quot;</span> <span class="o">.</span> <span class="s">&quot;outpace.util.times&quot;</span><span class="p">)</span>
</span><span class='line'>                   <span class="p">(</span><span class="s">&quot;repl&quot;</span> <span class="o">.</span> <span class="s">&quot;outpace.util.repl&quot;</span><span class="p">)</span>
</span><span class='line'>                   <span class="p">(</span><span class="s">&quot;time&quot;</span> <span class="o">.</span> <span class="s">&quot;clj-time.core&quot;</span><span class="p">)</span>
</span><span class='line'>                   <span class="p">(</span><span class="s">&quot;string&quot;</span> <span class="o">.</span> <span class="s">&quot;clojure.string&quot;</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;cljr-magic-require-namespaces</span> <span class="nv">mapping</span> <span class="no">t</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">setq</span> <span class="nv">cljr-favor-prefix-notation</span> <span class="no">nil</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;clojure-mode-hook</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
</span><span class='line'>                               <span class="p">(</span><span class="nv">clj-refactor-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>                               <span class="p">(</span><span class="nv">yas/minor-mode</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>                               <span class="p">(</span><span class="nv">cljr-add-keybindings-with-prefix</span> <span class="s">&quot;C-c C-x&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you use Emacs and write Clojure you should check out clj-refactor.
There are enough features that consistently work and help keep you in
the flow that it is worth using.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog//7">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog//5">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/05/02/how-to-be-alerted-when-a-long-running-process-finishes/">How to be notified when long running processes finish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/26/hanging-a-hangboard-using-a-doorway-pull-up-bar/">How to hang a hangboard using a doorway pull-up bar</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/21/using-bash-preexec-for-monitoring-the-runtime-of-your-last-command/">Using Bash-Preexec for monitoring the runtime of your last command</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/03/16/a-retrospective-format/">A retrospective format for remote or co-located teams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/03/10/more-working-from-home-tips/">More working from home tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/02/25/auto-syncing-a-git-repository/">Auto-syncing a git repository</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/01/11/books-that-changed-my-life/">Books that changed my life</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/01/11/reading-in-2019/">Reading in 2019</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/12/building-an-atreus-keyboard/">Building an Atreus keyboard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/08/fast-feedback-is-important/">Fast feedback is important</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Subscribe</h1>
  <p>Looking forward to the next article? 
    Subscribe to the <a href="https://feeds.feedburner.com/JakeMccrarysMusings">RSS</a> feed to receive full articles as they are posted or sign-up for periodic <a target="_blank" href="https://jakemccrary.substack.com/welcome">emails</a> containing links back to this site.
  </p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
  


</body>
</html>
