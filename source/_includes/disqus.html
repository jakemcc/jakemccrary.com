{% comment %} Load script if disquss comments are enabled and `page.comments` is either empty (index) or set to true {% endcomment %}
{% if site.disqus_short_name and page.comments == true %}
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <div id="disqus_target" >
    <script>
     function insertDisqus() {
       var elem = document.createElement('script');
       elem.innerHTML =  "var disqus_shortname = '{{ site.disqus_short_name }}'; {% if page.comments == true %} {% comment %} `page.comments` can be only be set to true on pages/posts, so we embed the comments here. {% endcomment %} var disqus_identifier = '{{ site.url }}{{ page.url }}'.replace('https', 'http'); var disqus_url = '{{ site.url }}{{ page.url }}'; var disqus_script = 'embed.js'; {% endif %} (function () {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);}());"
       var target = document.getElementById('disqus_target');
       target.parentNode.replaceChild(elem, target);
     }
    </script>
    <button onclick="insertDisqus()">Enable comments and recommended articles</button>
  </div>
{% endif %}
