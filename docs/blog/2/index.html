
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Jake McCrary" />
    <meta itemprop="description" content=" Lately, I&rsquo;ve been using tmux a lot. This resulted in me figuring out how to get lein-test-refresh to send notifications using tmux. The setup &hellip;" />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Jake McCrary" />
    <meta name="twitter:description" content=" Lately, I&rsquo;ve been using tmux a lot. This resulted in me figuring out how to get lein-test-refresh to send notifications using tmux. The setup &hellip;" />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="The Blog of Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/blog/2/" />
    <meta property="og:title" content="Jake McCrary" />
    <meta property="og:description" content=" Lately, I&rsquo;ve been using tmux a lot. This resulted in me figuring out how to get lein-test-refresh to send notifications using tmux. The setup &hellip;" />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
    

    <meta name="description" content=" Lately, I&rsquo;ve been using tmux a lot. This resulted in me figuring out how to get lein-test-refresh to send notifications using tmux. The setup &hellip;">

    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/blog/2/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
    
<script>
 var origin = window.location.origin;
 if (!origin) {
   origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
 }
 if (origin.indexOf('localhost') === -1) {
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-19834208-2', 'auto');
   ga('send', 'pageview');
 }
</script>


  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/01/27/how-to-display-a-message-to-all-tmux-clients/">How to display a message to all tmux clients</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-01-27T17:03:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>5:03 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><!-- Estimated time: 30 minutes -->


<!-- First Draft: 26 minutes -->


<!-- First edits: 14 minutes -->


<p>Lately, I&rsquo;ve been using <a href="https://github.com/tmux/tmux">tmux</a> a lot. This resulted in me figuring out how to get <a href="https://github.com/jakemcc/lein-test-refresh#notifications">lein-test-refresh</a> to send <a href="/blog/2019/01/06/notifications-with-tmux-and-lein-test-refresh/">notifications using tmux</a>.</p>

<p>The setup linked above works great for when I&rsquo;m doing work all by myself. It showed a problem when using ssh and tmux to pair with another developer. Instead of both developers receiving a notification, only one did. One is better than none but not ideal.</p>

<p>Below is a GIF showing the problem. Each window simulates a different developer.</p>

<p><img src="/images/tmux-pair-fail.gif" alt="tmux only showing one developer a notification" /></p>

<p>This wasn&rsquo;t too hard to fix. A little digging through the tmux manpage shows that <code>tmux display-message</code> takes an optional flag telling it which client receives the message. If we can get a list of all the clients then iterating over them and sending a message to each is straightforward.</p>

<p><code>tmux list-clients</code> give us this list. Below is the output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux list-clients
</span><span class='line'>/dev/ttys002: 0 [78x41 xterm-256color] (utf8)
</span><span class='line'>/dev/ttys006: 0 [78x42 xterm-256color] (utf8)</span></code></pre></td></tr></table></div></figure>


<p>What we care about are the parts that look like <code>/dev/ttys002</code>. At first I used <code>cut</code> to grab these values but then I dug a bit deeper into the <code>tmux</code> manpage.</p>

<p>It turns out that you can specify a format to <code>tmux list-clients</code>. Running <code>tmux list-clients -F "#{client_name}"</code> gives us the output we care about.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tmux list-clients -F "#{client_name}"
</span><span class='line'>/dev/ttys002
</span><span class='line'>/dev/ttys006</span></code></pre></td></tr></table></div></figure>


<p>We can combine that with <code>xargs</code> to send a message to multiple clients.</p>

<p><img src="/images/tmux-xargs-example.gif" alt="tmux xargs example" /></p>

<p>That command is a bit much to put into <code>lein-test-refresh</code>&rsquo;s configuration so I shoved it in a script called <code>notify</code> and configured <code>lein-test-refresh</code> to use it. Script and GIF of that below. Now both you and your pair can get notifications.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">USAGE</span><span class="o">=</span><span class="s2">&quot;Usage: notify &lt;message&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">example: notify &#39;Tests passed!&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;$USAGE&quot;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nv">message</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>
</span><span class='line'>
</span><span class='line'>tmux list-clients -F <span class="s2">&quot;#{client_name}&quot;</span> <span class="se">\</span>
</span><span class='line'>    <span class="p">|</span> xargs -n1 -I<span class="o">{}</span> tmux display-message -c <span class="o">{}</span> <span class="s2">&quot;$message&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/tmux-notify-script.gif" alt="Example using notify script" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/01/21/reading-in-2018/">Reading in 2018</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-01-21T14:29:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2019</span></span> <span class='time'>2:29 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>At the beginning of every year I like to take the time to reflect on my previous year&rsquo;s reading. It gives me a time to correct my data and think about where I want my reading to go in the upcoming year.</p>

<p>Here are links to my previous end-of-year reflections: <a href="/blog/2014/01/01/using-incanter-to-review-my-2013-reading/">2013</a>, <a href="/blog/2015/01/08/reading-in-2014/">2014</a>, <a href="/blog/2016/03/13/reading-in-2015/">2015</a>, <a href="/blog/2017/01/04/reading-in-2016/">2016</a>, and <a href="/blog/2018/03/03/reading-in-2017/">2017</a>.</p>

<p>I&rsquo;ve continued to keep track of my reading using <a href="http://goodreads.com">Goodreads</a>. My <a href="https://www.goodreads.com/user/show/3431614-jake-mccrary">profile</a> continues to have the full list of the books I&rsquo;ve read since 2010. <a href="https://www.goodreads.com/review/list/3431614-jake-mccrary?read_at=2018">Here</a> is my entire 2018 record.</p>

<p>I slacked off a bit when writing reviews for all of my read books in Goodreads. I often didn&rsquo;t write a review until some time had passed after completing the book and, as a result, I think I did a worse job reviewing books. Some books don&rsquo;t even have a written review. I&rsquo;m not a fan of this and will push myself some in 2019 to do a better job.</p>

<h2>2018 Goal</h2>

<blockquote><p>There are a few more books on writing that I&rsquo;ve wanted to read for a while. I&rsquo;m planning on reading at least one of them this year. I&rsquo;m also want to read more Octavia Butler. - Me (in the previous reading post)</p></blockquote>

<p>That was my goal for 2018. It breaks down into two goals:</p>

<ol>
<li>Read at least one book on writing.</li>
<li>Read more Octavia Butler.</li>
</ol>


<p>I succeeded on the Octavia Butler goal and completely failed with the other.</p>

<h2>2018 Numbers</h2>

<p>I read 43 books for a total of 16,213 pages. This is a bit less than last year but still a fair amount.</p>

<h2>Highlights</h2>

<p>Below is a list of my five star books from 2018. The book titles link to Amazon and are affiliate links. The other links are to my Goodreads review. Unfortunately, this year I didn&rsquo;t do a great job of always writing a review so some of them are missing or very short.</p>

<p>I generally highlight a lot of passages while reading and then rarely go back to look at them. I&rsquo;ve included links to my highlights. Are they worthwhile without the context of the book? I have no idea. I&rsquo;ve reread them and got something out of them but many are also so far removed from my memory that they are almost useless.</p>

<ul>
<li><a href="https://amzn.to/2TYyeo2">Being Mortal: Medicine and What Matters in the End by Atul Gawande</a> (<a href="https://www.goodreads.com/review/show/1380346555">my review</a>, <a href="https://www.goodreads.com/notes/23290548-being-mortal/3431614-jake-mccrary">my highlights</a>)</li>
<li><a href="https://amzn.to/2TaFJZb">Sapiens: A Brief History of Humankind by Yuval Noah Harari</a> (<a href="https://www.goodreads.com/review/show/1679140092">my review</a>, <a href="https://www.goodreads.com/notes/20873740-sapiens/3431614-jake-mccrary">my highlights</a>)</li>
<li><a href="https://amzn.to/2FP8jvk">Essentialism: The Disciplined Pursuit of Less by Greg McKeown</a> (<a href="https://www.goodreads.com/review/show/1178908716">my review</a>, <a href="https://www.goodreads.com/notes/19776547-essentialism/3431614-jake-mccrary">my highlights</a>)</li>
<li><a href="https://amzn.to/2Docah1">Crucial Conversations Tools for Talking When Stakes Are High by Kerry Patterson,  Joseph Grenny, Ron McMillan, Al Switzler</a> (<a href="https://www.goodreads.com/notes/13041257-crucial-conversations-tools-for-talking-when-stakes-are-high/3431614-jake-mccrary">my highlights</a>)</li>
<li><a href="https://amzn.to/2sAWpNB">Rediscovering JavaScript: Master ES6, ES7, and ES8 by Venkat Subramaniam</a> (<a href="https://www.goodreads.com/review/show/2450809712">my review</a>)</li>
<li><a href="https://amzn.to/2U2QDjy">CivilWarLand in Bad Decline by George Saunders</a> (<a href="https://www.goodreads.com/review/show/104227855">my review</a>)</li>
<li><a href="https://amzn.to/2Do2fIt">The Obelisk Gate (The Broken Earth #2) by N.K. Jemisin</a></li>
<li><a href="https://amzn.to/2FLwbje">The Stone Sky (The Broken Earth, #3) by N.K. Jemisin</a> (<a href="https://www.goodreads.com/review/show/2467372092">my review</a>)</li>
<li><a href="https://amzn.to/2FNdgo8">The Hate U Give by Angie Thomas</a> (<a href="https://www.goodreads.com/review/show/2221117127">my review</a>)</li>
<li><a href="https://amzn.to/2T4PUy9">Six of Crows (Six of Crows, #1) by Leigh Bardugo</a> (<a href="https://www.goodreads.com/review/show/2309941150">my review</a>)</li>
<li><a href="https://amzn.to/2RZOzeG">Crooked Kingdom (Six of Crows #2) by Leigh Bardugo</a></li>
</ul>


<h4>Being Mortal: Medicine and What Matters in the End by Atul Gawande</h4>

<p>This book deals with the end of our lives. It was great. There is a lot of good insight here. Like a lot of the non-fiction books I read, I really should go back and take notes on what I highlighted.</p>

<p>We&rsquo;re all going to deal with death and sickness. This book can help.</p>

<h4>Sapiens: A Brief History of Humankind by Yuval Noah Harari</h4>

<p>My entire Goodreads review is two sentences.</p>

<blockquote><p>This is an incredible book. You should read this. - Me</p></blockquote>

<p>I still agree with this. My friend, Steve Deobald, <a href="https://www.goodreads.com/review/show/2347504001?book_show_action=false">described</a> this book as &ldquo;the most lucid book he&rsquo;s ever read.&rdquo; There is a reason this book has a 4.45 rating on Goodreads. Go read the blurb about it there and then buy and read this book<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<h4>Essentialism: The Disciplined Pursuit of Less by Greg McKeown</h4>

<blockquote><p>If you don’t prioritize your life, someone else will. - Greg McKeown</p></blockquote>

<p>A really great book encouraging you to focus on what matters and, as a result, make a bigger impact and be happier. It is better to make a mile of progress on one thing instead of making inches of progress in a bunch.</p>

<p>Tim Ferris recently <a href="https://tim.blog/2019/01/09/greg-mckeown-essentialism/">published a podcast</a> with Greg McKeown which I&rsquo;d also recommend. I&rsquo;ve enjoyed listening to the podcast after a bit of time away from the book. This has helped reinforce ideas from the book. If you&rsquo;re hesitant to read the book, take the time to listen and pay attention to this long podcast.</p>

<p>I highlighted over 100 sections of this book. I plan on revisiting these notes and this book periodically.</p>

<h4>Crucial Conversations Tools for Talking When Stakes Are High by Kerry Patterson, Joseph Grenny, Ron McMillan, Al Switzler</h4>

<p>A crucial conversation is one where the stakes are high, opinions vary, and emotions run strong. This book provides guidance for handling those conversations better.</p>

<p>I enjoyed this book and thought I picked up some useful tips from it. I think this is another where doing follow up work would help solidify some of the concepts.</p>

<h4>Rediscovering JavaScript: Master ES6, ES7, and ES8 by Venkat Subramaniam</h4>

<p>Do you write JavaScript?</p>

<p>Did you write JavaScript in the past but then move on to languages like ClojureScript and miss all the changes that happened to JavaScript?</p>

<p>Both of those sentences apply to me. This book has been great at catching up on modern JavaScript. I find myself referencing it while writing JavaScript and it has been very helpful. It is to the point and I find myself referencing it periodically.</p>

<h4>CivilWarLand in Bad Decline by George Saunders</h4>

<p>I really like this book. It is a wonderful collection of short stories. This was my second time reading it and I still enjoyed it.</p>

<h4>The Obelisk Gate (The Broken Earth #2) and The Stone Sky (The Broken Earth, #3) by N.K. Jemisin</h4>

<p>N.K. Jemisin has won a Hugo three years in a row. Those three years line up with each release of a book in The Broken Earth series. They are really good.</p>

<p>This series is great. The world is interesting and the story compelling. I highly recommend it.</p>

<h4>The Hate U Give by Angie Thomas</h4>

<p>Reading lets you experience life from a different perspective. This book is good. It was quickly made into a movie which is also pretty good.</p>

<p>I read this as part of my book club and it was universally enjoyed.</p>

<h4>Six of Crows (Six of Crows, #1) and Crooked Kingdom (Six of Crows #2) by Leigh Bardugo</h4>

<p>I just really enjoyed this series. I enjoyed the fantasy world it was set in and have read most of Leigh Bardugo&rsquo;s other books that are set in this same world.</p>

<p>The series is a young adult series. It isn&rsquo;t complex. The reading isn&rsquo;t difficult. It isn&rsquo;t going to change your life and you&rsquo;re not going to be blown away by the writing. It almost feels weird to include this series in the same list as CivilWarLand and The Broken Earth series. Even still, I found myself sucked into the story and didn&rsquo;t mind spending the short amount of time it took to read the books.</p>

<h3>Non-Five Star highlights</h3>

<h4>Life 3.0: Being Human in the Age of Artificial Intelligence by Max Tegmark</h4>

<p><a href="https://amzn.to/2AU6B8E">amazon</a>, <a href="https://www.goodreads.com/notes/35881748-life-3-0/3431614-jake-mccrary">my highlights</a></p>

<p>I thought this was a really interesting book.</p>

<h4>When: The Scientific Secrets of Perfect Timing by Daniel H. Pink</h4>

<p><a href="https://amzn.to/2RV2v9W">amazon</a>, <a href="https://www.goodreads.com/review/show/2278408888">my review</a>, <a href="https://www.goodreads.com/notes/35786699-when/3431614-jake-mccrary">my highlights</a></p>

<p>I really enjoyed this. Pink references other works to build a narrative about how timing matters. When should you take a nap? Is it better to go do the doctors in the morning or afternoon? How do are cognitive abilities generally change throughout the day? How should you try to end your vacations?</p>

<p>I did take some notes on the book while reading it and I have referenced them. It was a good book. I should have taken more notes.</p>

<h4>Bloodchild and Other Stories by Octavia E. Butler</h4>

<p><a href="https://amzn.to/2MreMxO">amazon</a>, <a href="https://www.goodreads.com/review/show/2293497979">my review</a>, <a href="https://www.goodreads.com/notes/40274755-bloodchild-and-other-stories/3431614-jake-mccrary">my highlights</a></p>

<p>This is a great collection of short stories and non-fiction articles written by Octavia Butler. I really love her writing. I&rsquo;ve read a few of her works and still enjoy <a href="https://www.goodreads.com/book/show/60926.Lilith_s_Brood">Lilith&rsquo;s Brood</a> the most.</p>

<p>Below is a quote from her about science fiction that really resonated with me. It really hits home on one of the reasons I love reading science fiction.</p>

<blockquote><p>But still I’m asked, what good is science fiction to Black people? What good is any form of literature to Black people? What good is science fiction’s thinking about the present, the future, and the past? What good is its tendency to warn or to consider alternative ways of thinking and doing? What good is its examination of the possible effects of science and technology, or social organization and political direction? At its best, science fiction stimulates imagination and creativity. It gets reader and writer off the beaten track, off the narrow, narrow footpath of what “everyone” is saying, doing, thinking—whoever “everyone” happens to be this year. And what good is all this to Black people? - Octavia Butler</p></blockquote>

<h4>Eeeee Eee Eeee by Tao Lin</h4>

<p><a href="https://amzn.to/2AUSrnJ">amazon</a>, <a href="https://www.goodreads.com/review/show/1788752328">my review</a></p>

<p>This book is real bizarre. For some reason I liked it.</p>

<h4>Factfulness: Ten Reasons We&rsquo;re Wrong About the World&ndash;and Why Things Are Better Than You Think by Hans Rosling</h4>

<p><a href="https://amzn.to/2FQBmP8">amazon</a>, <a href="https://www.goodreads.com/review/show/2402596250">my review</a>, <a href="https://www.goodreads.com/notes/36185940-factfulness/3431614-jake-mccrary">my highlights</a></p>

<p>This book is great. It is very approachable and dispels some wrong common knowledge.</p>

<h2>Stats</h2>

<p>I struggled generating stats this year. I kept having data issues with Goodreads. There is data that is in Goodreads that is failing to export both through their export feature and API. I&rsquo;m somewhat wondering what I would need to do to track reading in a different way.</p>

<p>Below is the reading stats per month. The numbers are based on when the book is completed. December is partially so low because the other books all carried over to January.</p>

<p><img src="/images/2018-books-and-pages.svg" title="Book and pages count by month" alt="Book and pages count by month" /></p>

<p>Electronic books continue to make up the majority of the books I&rsquo;m reading.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|           | 2018 | 2017 | 2016 | 2015 |
</span><span class='line'>|-----------+------+------+------+------|
</span><span class='line'>| ebook     |   37 |   37 |   56 |   47 |
</span><span class='line'>| hardcover |    1 |    7 |    0 |    1 |
</span><span class='line'>| paperback |    5 |    5 |    3 |    3 |</span></code></pre></td></tr></table></div></figure>


<p>There are two physical books not included in my read books that I started and still need to finish. They are a both books focused on fitness (climbing injuries and proper movement) and aren&rsquo;t books I&rsquo;m actively reading.</p>

<p>Nearly a third of my reading was non-fiction. For the second year in a row, only two of those were software related.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|             | Number of books |
</span><span class='line'>|-------------+-----------------|
</span><span class='line'>| fiction     |              29 |
</span><span class='line'>| non-fiction |              14 |</span></code></pre></td></tr></table></div></figure>


<h2>2019 Goals</h2>

<p>I have a stack of software and process books and I&rsquo;d like to read through at least some of them (others are more reference books). I&rsquo;m also going to bring over the 2018 goal of reading at least one book on writing.</p>

<p>In a more general sense, I&rsquo;m hoping to put some practices together that help me gain more from the books I&rsquo;m reading. I&rsquo;m still thinking through what that means.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>In the beginning of 2019 I also read Harari&rsquo;s &ldquo;21 lessons for the 21st Century.&rdquo; Spoiler alert: this book will end up in my 2019 reading summary post.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/01/06/notifications-with-tmux-and-lein-test-refresh/">Notifications with tmux and lein-test-refresh</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-01-06T16:55:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>4:55 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve been using Emacs in a remote <a href="https://github.com/tmux/tmux">tmux</a> session lately and I&rsquo;ve been missing <a href="https://github.com/jakemcc/lein-test-refresh#notifications">lein-test-refresh</a> notifications when my Clojure tests pass or fail. Luckily, it only took me a little bit of searching to figure out a solution for when I&rsquo;m working inside of tmux.</p>

<p>Below is a GIF of the notifications I get as my tests run and pass or fail.</p>

<p><img src="/images/tmux-test-refresh.gif" title="tmux and test-refresh notifications" alt="tmux and test-refresh notifications" /></p>

<p>With the above notifications, I can keep my focus on my code and only switch to the tmux window with <code>lein test-refresh</code> running when a test fails.</p>

<p>This was pretty easy to setup. You can trigger a message in tmux by running <code>tmux display-message &lt;MESSAGE_HERE&gt;</code>. To configure <a href="https://github.com/jakemcc/lein-test-refresh#notifications">lein-test-refresh</a> to send notifications to tmux simply include the following in your <code>:test-refresh</code> section of your <code>project.clj</code> or <code>profiles.clj</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="ss">:test-refresh</span> <span class="p">{</span><span class="ss">:notify-command</span> <span class="p">[</span><span class="s">&quot;tmux&quot;</span> <span class="s">&quot;display-message&quot;</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I hope you enjoy this. Its has made using a remote terminal with tmux and <a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> more enjoyable.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/12/27/a-more-helpful-makefile/">A more helpful makefile</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-12-27T21:21:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>9:21 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>In an <a href="/blog/2016/11/30/unify-your-project-interfaces/">older article</a> of mine I extolled the virtues of having unified interfaces for interacting with your projects. I recently started working at Coinbase and the group I&rsquo;m working with is mostly using makefiles as that common interface. We still have some more work to do to unify the makefile targets of the various projects but I&rsquo;ve picked up one tip that makes switching between projects easier.</p>

<p>That tip is to have the default target of your makefile be one that prints out a helpful message. This looks like the following.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.PHONY: help
</span><span class='line'>help:
</span><span class='line'>  @grep -E '^[0-9a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
</span><span class='line'>   sort | \
</span><span class='line'>   awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'</span></code></pre></td></tr></table></div></figure>


<p>There is a lot going on there but it basically looks through your makefile targets and finds the ones that have a comment starting with <code>##</code> after the target dependencies. Those targets are printed to the console along with the comment.</p>

<p>As an example, the makefile for my website looks similar to the below file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.PHONY: help
</span><span class='line'>help:
</span><span class='line'>  @grep -E '^[0-9a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
</span><span class='line'>   sort | \
</span><span class='line'>   awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'
</span><span class='line'>
</span><span class='line'>.PHONY: watch
</span><span class='line'>watch: ## Watch for changes and serve preview of site with drafts
</span><span class='line'>  bundle exec rake clean
</span><span class='line'>  bundle exec rake preview
</span><span class='line'>
</span><span class='line'>.PHONY: develop
</span><span class='line'>develop: ## Serve a preview of the site without drafts and refresh changes
</span><span class='line'>  bundle exec rake clean
</span><span class='line'>  bundle exec rake develop
</span><span class='line'>
</span><span class='line'>.PHONY: new_adventure
</span><span class='line'>new_adventure: ## Start a new adventure post
</span><span class='line'>  bundle exec rake new_adventure
</span><span class='line'>
</span><span class='line'>.PHONY: new_post
</span><span class='line'>new_post: ## Start a new post
</span><span class='line'>  bundle exec rake new_post 
</span><span class='line'>
</span><span class='line'>.PHONY: deploy
</span><span class='line'>deploy: ## deploy
</span><span class='line'>  ./deploy.sh</span></code></pre></td></tr></table></div></figure>


<p>When this file, when I run <code>make</code> in this websites source, I get the following output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0 [last: 0s] 21:11:50 ~/src/jakemcc/blog (master)
</span><span class='line'>$ make
</span><span class='line'>deploy                         deploy
</span><span class='line'>develop                        Serve a preview of the site without drafts and refresh changes
</span><span class='line'>new_adventure                  Start a new adventure post
</span><span class='line'>new_post                       Start a new post
</span><span class='line'>watch                          Watch for changes and serve preview of site with drafts</span></code></pre></td></tr></table></div></figure>


<p>This is super useful when you&rsquo;re starting doing work in a new project. With this feature you can get a quick list of useful targets and a description. It allows you to quickly see what can be done in a project.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/07/16/built-in-test-narrowing-with-lein-test-refresh/">Built-in test narrowing with lein-test-refresh</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-07-16T14:47:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>2:47 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>If you follow my work you probably know that I value fast feedback cycles. Most of the open-source I maintain was developed to enable faster feedback cycles. This is why <a href="https://github.com/jakemcc/lein-test-refresh/">lein-test-refresh</a> and <a href="https://github.com/clojure-expectations/lein-autoexpect">lein-autoexpect</a> were originally created.</p>

<p>Leiningen supports <a href="https://github.com/technomancy/leiningen/blob/master/doc/TUTORIAL.md#tests">test selectors</a> and lein-test-refresh <a href="https://github.com/jakemcc/lein-test-refresh/blob/master/CHANGES.md#040">does as well</a>. This lets you start-up a testing session and only run tests or namespaces with certain metadata on them. This is a super useful feature as it lets you narrow your testing scope to one (or a handful) of tests while working on solving a specific problem.</p>

<p>lein-test-refresh now has built-in functionality that allows you to focus your test scope without restarting the Leiningen test process. If lein-test-refresh sees a <code>deftest</code> or <code>ns</code> form marked with <code>:test-refresh/focus true</code> in its metadata, then it will only run tests marked with <code>:test-refresh/focus</code>.</p>

<p>Below is an example of what this looks like.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="o">^</span><span class="ss">:test-refresh/focus</span> <span class="nv">test-addition</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="mi">1</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This functionality has only been available for a short period of time and I&rsquo;ve already found it useful. I think you will too. Enjoy.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/06/15/tracking-changes-to-a-reagent-atom/">Tracking changes to a Reagent atom</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-06-15T09:05:00-05:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>9:05 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I was recently having some difficulty debugging a problem in a
ClojureScript single page application. The SPA was implemented using
<a href="https://reagent-project.github.io/">reagent</a><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>This interface stores most of its state in a global
<code>reagent.core/atom</code> called <code>db</code>. To debug the problem, I thought it
would be useful to track how the global state changed as I interacted
with the interface. How do we do that?</p>

<p>For the rest of this article, pretend that <code>(require '[reagent.core
:as reagent])</code> has been executed.</p>

<p>First, let&rsquo;s define <code>db-history</code> in the same namespace as the global
<code>reagent/atom</code>, <code>db</code>. This is where we&rsquo;ll collect the changes to <code>db</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">ui.data</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">reagent.core</span> <span class="ss">:as</span> <span class="nv">reagent</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">db</span> <span class="p">(</span><span class="nf">reagent/atom</span> <span class="p">{</span><span class="ss">:app/current-page</span> <span class="ss">:offer-list</span><span class="p">}))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">db-history</span> <span class="p">(</span><span class="nf">atom</span> <span class="p">[]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, let&rsquo;s write a function called <code>aggregate-state</code>. This function
grabs the current value in <code>db</code> and <code>conj</code>s it onto <code>db-history</code>. It
also limits the history to the most recent 101 states.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">aggregate-state</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">d</span> <span class="o">@</span><span class="nv">db</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">swap!</span> <span class="nv">db-history</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">hist</span><span class="p">]</span>
</span><span class='line'>                        <span class="p">(</span><span class="nb">-&gt; </span><span class="p">(</span><span class="nb">take </span><span class="mi">100</span> <span class="nv">hist</span><span class="p">)</span>
</span><span class='line'>                            <span class="nv">vec</span>
</span><span class='line'>                            <span class="p">(</span><span class="nb">conj </span><span class="nv">d</span><span class="p">))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we need to invoke <code>aggregate-state</code> whenever <code>db</code> changes. We can
do this using <code>reagent/track</code>. <code>reagent/track</code> takes a function and
optional arguments and invokes that function whenever a <code>reagent/atom</code>
that function depends on changes.</p>

<p><code>reagent/track!</code> is similar except it immediately invokes the function
instead of waiting for the first change. We can use it to cause
<code>aggregate-state</code> to get called whenever <code>db</code> changes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">db-history-logger</span> <span class="p">(</span><span class="nf">reagent/track!</span> <span class="nv">aggregate-state</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now history of the global state is being tracked. But we need a way to
access it. Below is what I ended up writing. When you call
<code>ui.data.history()</code> in Chrome&rsquo;s JavaScript console, it returns an
object you can click on to explore. If you pass in strings as
arguments to <code>history</code> then it only selects some of the data from the
global <code>db</code> and history.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="o">^</span><span class="ss">:export</span> <span class="nv">history</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">d</span> <span class="o">@</span><span class="nv">db</span>
</span><span class='line'>        <span class="nv">k</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">seq </span><span class="nv">args</span><span class="p">)</span>
</span><span class='line'>            <span class="p">(</span><span class="nb">map keyword </span><span class="nv">args</span><span class="p">)</span>
</span><span class='line'>            <span class="p">(</span><span class="nb">keys </span><span class="nv">d</span><span class="p">))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">clj-&gt;js</span> <span class="p">{</span><span class="ss">:history</span> <span class="p">(</span><span class="nf">mapv</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nb">select-keys </span><span class="nv">x</span> <span class="nv">k</span><span class="p">))</span> <span class="o">@</span><span class="nv">db-history</span><span class="p">)</span>
</span><span class='line'>              <span class="ss">:current</span> <span class="p">(</span><span class="nb">select-keys </span><span class="nv">d</span> <span class="nv">k</span><span class="p">)})))</span>
</span></code></pre></td></tr></table></div></figure>


<p>It only took about fifteen lines of code to gain a view of our
application&rsquo;s state changes over time. This view helped me solve my
problem. Hopefully it will help you too.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>This particular project is nearly four years old and has had many hands on it over the years. Working in it reminds me of how useful re-frame is on larger applications like this one.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/06/14/clojure-prevent-multiple-simultaneous-invocations/">Preventing duplicate long-running invocations in Clojure</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-06-14T09:47:00-05:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>9:47 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>A couple months ago I was looking into a problem and noticed that
there was a situation where an expensive operation could be running
simultaneously multiple times. This was wasteful.</p>

<p>This operation happened on a timer and could also be triggered by a power
user through the UI. A power user could accidentally (or purposefully)
mash on a UI button and cause the instance they&rsquo;re interacting with
to grind to a halt<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>It was pretty easy to prevent. All I needed to introduce was an
<code>atom</code> and lean on <code>compare-and-set!</code>. <code>compare-and-set!</code> is a pretty
neat function (and concept found in many languages). Here is the docstring:</p>

<blockquote><p>Atomically sets the value of atom to newval if and only if the
current value of the atom is identical to oldval. Returns true if
set happened, else false</p></blockquote>

<p>Basically, <code>compare-and-set!</code> changes the value of an atom only if it
starts from a specified value and returns a boolean letting you know
if it did.</p>

<p>To prevent an operation from running multiple times, introduce an atom
and wrap calling the operation in a conditional using
<code>compare-and-set!</code>.  After doing the work, be sure to <code>reset!</code> your
atom back to the starting value.</p>

<p>Below is the code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defonce </span><span class="nv">running?</span> <span class="p">(</span><span class="nf">atom</span> <span class="nv">false</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn- </span><span class="nv">expensive-operation!</span><span class="o">&#39;</span> <span class="p">[]</span>
</span><span class='line'>  <span class="c1">;; do work</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">expensive-operation!</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nf">compare-and-set!</span> <span class="nv">running?</span> <span class="nv">false</span> <span class="nv">true</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">try</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">expensive-operation!</span><span class="o">&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">finally</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">reset!</span> <span class="nv">running?</span> <span class="nv">false</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>OK, not really grind to a halt, but consume unnecessary resources.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/03/03/reading-in-2017/">Reading in 2017</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-03-03T11:17:00-06:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2018</span></span> <span class='time'>11:17 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I typically like to reflect on my previous years reading closer to the beginning of the next year. We are just entering March, so I&rsquo;ve missed doing that.</p>

<p>Here are links to my previous end-of-year reflections: <a href="/blog/2014/01/01/using-incanter-to-review-my-2013-reading/">2013</a>, <a href="/blog/2015/01/08/reading-in-2014/">2014</a>, <a href="/blog/2016/03/13/reading-in-2015/">2015</a>, <a href="/blog/2017/01/04/reading-in-2016/">2016</a>.</p>

<p>I&rsquo;ve continued to keep track of my reading using <a href="http://goodreads.com">Goodreads</a>. My <a href="https://www.goodreads.com/user/show/3431614-jake-mccrary">profile</a> continues to have the full list of the books I&rsquo;ve read since 2010. <a href="https://www.goodreads.com/review/list/3431614-jake-mccrary?read_at=2017">Here</a> is my entire 2017 record.</p>

<h2>2017 Goal</h2>

<p>My goal entering 2017 was to revisit some past favorites. I started this goal without setting a number, so I&rsquo;ll just have to trust how I feel about it.</p>

<p>In 2017, I reread Frank Herbert&rsquo;s Dune and John William&rsquo;s Stoner. I also read new-to-me books by the authors David Foster Wallace, Haruki Murakami, George Saunders, and Neal Stephenson. I&rsquo;ve also reread a George Saunders book in the first part of 2018.</p>

<p>I mostly achieved 2017&rsquo;s goal. If I had reread another book, I&rsquo;d consider it 100% completed, but I&rsquo;m going to count reading some favorite authors towards the goal.</p>

<h2>2017 Numbers</h2>

<p>I read a total of 49 books for a total of 17,853 pages. I also read every issue of Amazon&rsquo;s <em>Day One</em> weekly periodical<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>The number of five-star books I read this last year was low compared to previous years.</p>

<h2>Recommendations</h2>

<p>I only gave out seven five-star ratings. Two of the seven were books I reread.  Title links are affiliate links to Amazon and the review links are to my review on Goodreads.</p>

<ul>
<li><a href="http://amzn.to/2CVygnP">Stories of Your Life and Others - Ted Chiang</a> (<a href="https://www.goodreads.com/review/show/1868465450">my review</a>)</li>
<li><a href="http://amzn.to/2CX3RFE">A Supposedly Fun Thing I&rsquo;ll Never Do Again: Essays and Arguments - David Foster Wallace</a> (<a href="https://www.goodreads.com/review/show/1071157288">my review</a>)</li>
<li><a href="http://amzn.to/2F9ghjv">Dune - Frank Herbert</a> (<a href="https://www.goodreads.com/review/show/2200354838">my review</a>)</li>
<li><a href="http://amzn.to/2oE3X0w">Lilith&rsquo;s Brood - Octavia Butler</a> (<a href="https://www.goodreads.com/review/show/2136588256">my review</a>)</li>
<li><a href="http://amzn.to/2GWZCfB">Stoner - John Williams</a> (<a href="https://www.goodreads.com/review/show/1896951901">my review</a>)</li>
<li><a href="http://amzn.to/2FgNgln">The Sense of Style: The Thinking Person&rsquo;s Guide to Writing in the 21st Century - Steven Pinker</a> (<a href="https://www.goodreads.com/review/show/1216210735">my review</a>)</li>
<li><a href="http://amzn.to/2H3cHEm">Shoe Dog - Phil Knight</a> (<a href="https://www.goodreads.com/review/show/1866261263">my review</a>)</li>
</ul>


<p>Below are more details on some of the above five-star books and some shoutouts for some non-five star books. Looking back over my books, I&rsquo;d recommend any four-star or higher book without hesitation but am not going to put them all here.</p>

<h4><em>Lilith&rsquo;s Brood</em> by Octavia Butler</h4>

<p><em>Lilith&rsquo;s Brood</em> was one of the last books I read in 2017. It is a three book series published as a single book. It is amazing. This series achieves precisely what I want in a great science fiction book. I highly recommend this book. Reading this book reminded me why I love reading.</p>

<p>A quote from a non-fiction essay by Octavia Butler describes why good science fiction is fantastic.</p>

<blockquote><p>But still I’m asked, what good is science fiction to Black people? What good is any form of literature to Black people? What good is science fiction’s thinking about the present, the future, and the past? What good is its tendency to warn or to consider alternative ways of thinking and doing? What good is its examination of the possible effects of science and technology, or social organization and political direction? At its best, science fiction stimulates imagination and creativity. It gets reader and writer off the beaten track, off the narrow, narrow footpath of what “everyone” is saying, doing, thinking—whoever “everyone” happens to be this year. And what good is all this to Black people? - <strong>Octavia Butler</strong></p></blockquote>

<h4><em>The Sense of Style</em> by Steven Pinker</h4>

<p>Yes, I read a book on writing and think this is one of the top books I read last year. I initially read a Kindle edition from my local library and then immediately bought the hardcover so I can reference it while writing.</p>

<p>The writing is great. The book is humorous. I&rsquo;d highly recommend to anyone that writes. I should reread this.</p>

<h4><em>Dune</em> by Frank Herbert</h4>

<p><em>Dune</em> is a classic for a reason. It was still great my second time through it. If you haven&rsquo;t read Dune, you are missing out.</p>

<p>If you read it on a Kindle, I have a <a href="http://gum.co/dune-dictionary">custom Kindle dictionary</a> that makes reading it more pleasurable.</p>

<h4><em>Stoner</em> by John Williams</h4>

<p>It is still unclear to me why I like this book so much, but I do. The writing is crisp. The story is depressing.</p>

<h4><em>Stories of Your Life and Others</em> by Ted Chiang</h4>

<p>Over the years I&rsquo;ve started to enjoy reading short story collections. Every story in this collection was great. I devoured this book and then everything else I could find by Ted Chiang.</p>

<h4><em>Capital in the Twenty-First Century</em> by Thomas Piketty</h4>

<p>This is a massive book. It probably deserved five-stars. It presents a ton of information to the reader. It is boring. It also made me think about the role of taxes in society and changed my thoughts about them.</p>

<p>If you&rsquo;ve been putting this off, you can probably skip to the last section and still get a lot from this book.</p>

<p><a href="https://www.goodreads.com/review/show/926621222?book_show_action=true">Here</a> is a review that does a spot on job of describing the book. Here is an <a href="http://amzn.to/2oKfDPx">Amazon</a> link and <a href="https://www.goodreads.com/review/show/2041297829">my own review</a>.</p>

<h4>Bobiverse Series by Dennis Taylor</h4>

<p><a href="https://www.goodreads.com/series/192752-bobiverse">This</a> is a fun light-hearted science fiction series. It still manages to explore some deep topics. Read the description and if it sounds interesting to you, pick it up.</p>

<h2>Stats</h2>

<p>Similar to last year, April and September were times when I wasn&rsquo;t reading a ton.</p>

<p><img src="/images/reading-by-month-2017.jpg" title="Chart of reading per month" alt="Chart of reading per month" /></p>

<p>This year physical books made a comeback. I checked out more physical books from the library this year than in the past.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|           | 2017 | 2016 | 2015 |
</span><span class='line'>|-----------+------+------+------|
</span><span class='line'>| ebook     |   37 |   56 |   47 |
</span><span class='line'>| hardcover |    7 |    0 |    1 |
</span><span class='line'>| paperback |    5 |    3 |    3 |</span></code></pre></td></tr></table></div></figure>


<p>My average rating went down a bit.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Year | Avg Rating |
</span><span class='line'>|------+------------|
</span><span class='line'>| 2011 |       3.84 |
</span><span class='line'>| 2012 |       3.66 |
</span><span class='line'>| 2013 |       3.55 |
</span><span class='line'>| 2014 |       3.49 |
</span><span class='line'>| 2015 |       3.86 |
</span><span class='line'>| 2016 |       3.85 |
</span><span class='line'>| 2017 |       3.77 |</span></code></pre></td></tr></table></div></figure>


<p>I read a lot of non-fiction books this year. Only two of them were directly related to software.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>|             | Number of books |
</span><span class='line'>|-------------+-----------------|
</span><span class='line'>| fiction     |              30 |
</span><span class='line'>| non-fiction |              19 |
</span></code></pre></td></tr></table></div></figure>


<h2>2018 Goals</h2>

<p>There are a few more books on writing that I&rsquo;ve wanted to read for a while. I&rsquo;m planning on reading at least one of them this year. I&rsquo;m also want to read more Octavia Butler.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Unfortunately, this periodical has ended after years of publishing once a week. I&rsquo;m bummed. I really enjoyed receiving a short story and poem once a week.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/02/20/creating-serverless-applications-with-clojurescript-and-firebase/">Creating serverless applications with ClojureScript and Firebase</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-02-20T11:30:00-06:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>11:30 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier this year, I traveled to India and gave a presentation at
<a href="http://inclojure.org">IN/Clojure</a>. I talked about building serverless
ClojureScript applications that use <a href="https://firebase.com">Firebase</a>
to persist and sync data between clients.</p>

<p>I was pretty pleased with how the talk went. The people who talked to
me after seemed to enjoy the presentation and were inspired to try out
some of the techniques and tools I mentioned.</p>

<p>Here is the talk. I hope you enjoy it. It was fun to give.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/rMqo3lgxe7o" frameborder="0" allow="encrypted-media" allowfullscreen></iframe>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/02/18/using-clojure-macros-for-nicer-error-handling/">Using Clojure macros for nicer error handling</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-02-18T11:24:00-06:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>11:24 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>In July 2017, I found myself editing some Clojure code that looked approximately like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">validate-required-fields</span> <span class="p">[</span><span class="nv">params</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">when-not </span><span class="p">(</span><span class="nb">contains? </span><span class="nv">params</span> <span class="ss">:source</span><span class="p">)</span>
</span><span class='line'>    <span class="s">&quot;Missing source field&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">validate-invariants</span> <span class="p">[</span><span class="nv">params</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">&gt;= </span><span class="p">(</span><span class="ss">:lower</span> <span class="nv">params</span><span class="p">)</span> <span class="p">(</span><span class="ss">:higher</span> <span class="nv">params</span><span class="p">))</span>
</span><span class='line'>    <span class="s">&quot;lower field must be smaller than higher&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; route handler taken out of other routes</span>
</span><span class='line'><span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/event-redirect/:event_type&quot;</span> <span class="nv">request</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">params</span> <span class="p">(</span><span class="ss">:params</span> <span class="nv">request</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">field-error</span> <span class="p">(</span><span class="nf">validate-required-fields</span> <span class="nv">params</span><span class="p">)]</span>
</span><span class='line'>      <span class="p">{</span><span class="ss">:status</span> <span class="mi">400</span> <span class="ss">:body</span> <span class="nv">field-error</span><span class="p">}</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">invariant-error</span> <span class="p">(</span><span class="nf">validate-invariants</span> <span class="nv">params</span><span class="p">)]</span>
</span><span class='line'>        <span class="p">{</span><span class="ss">:status</span> <span class="mi">400</span> <span class="ss">:body</span> <span class="nv">invariant-error</span><span class="p">}</span>
</span><span class='line'>        <span class="p">(</span><span class="nf">publish-and-redirect</span> <span class="nv">params</span><span class="p">)))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>This route handler validates its inputs, and if they fail validation,
then it returns an error response. I found this pretty ugly. This
small chunk of code has numerous <code>if</code> branches and quite a bit of
nesting. All of this makes it hard to read and hurts understanding.</p>

<p>While adding a new feature to it, I remembered some code I wrote with
<a href="https://github.com/snoe">Case</a> back in late 2015. Back then we were
working on Lumanu and wrote a Clojure macro that we called
<code>halt-on-error-&gt;&gt;</code>. This macro worked similarly to <code>-&gt;&gt;</code>, except it
allowed any step in the processing pipeline to halt execution and
trigger an error handler. We were working on a web crawler at the
time, and this macro significantly improved the readability of our
data processing pipeline. There was a lot of error handling code
throughout the web crawler, and this macro helped keep it readable.</p>

<p>I realized that using a similar macro would make this code easier to
follow. I recreated <code>halt-on-error-&gt;&gt;</code> to allow any form to cause it
to return early. The above code could then be written like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">validate-required-fields</span> <span class="p">[</span><span class="nv">params</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">contains? </span><span class="nv">params</span> <span class="ss">:source</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">params</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">exec/halt</span> <span class="p">{</span><span class="ss">:status</span> <span class="mi">400</span> <span class="ss">:body</span> <span class="s">&quot;Missing source field&quot;</span><span class="p">})))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">validate-invariants</span> <span class="p">[</span><span class="nv">params</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="ss">:lower</span> <span class="nv">params</span><span class="p">)</span> <span class="p">(</span><span class="ss">:higher</span> <span class="nv">params</span><span class="p">))</span>
</span><span class='line'>    <span class="nv">params</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">exec/halt</span> <span class="p">{</span><span class="ss">:status</span> <span class="mi">400</span> <span class="ss">:body</span> <span class="s">&quot;lower field must be smaller than higher&quot;</span><span class="p">})))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">GET</span> <span class="s">&quot;/event-redirect/:event_type&quot;</span> <span class="nv">request</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="nv">request</span>
</span><span class='line'>                         <span class="ss">:params</span>
</span><span class='line'>                         <span class="nv">validate-required-fields</span>
</span><span class='line'>                         <span class="nv">validate-invariants</span>
</span><span class='line'>                         <span class="nv">publish-and-redirect</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you understand <code>halt-on-error-&gt;&gt;</code>, this chunk of
code is much easier to read.</p>

<p>Let&rsquo;s implement <code>halt-on-error-&gt;&gt;</code>.</p>

<h2>Implementing <code>halt-on-error-&gt;&gt;</code></h2>

<p>Here are some tests for that specify how <code>halt-on-error-&gt;&gt;</code> should work.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">halt.execution-test</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span>  <span class="p">[</span><span class="nv">halt.execution</span> <span class="ss">:as</span> <span class="nv">exec</span><span class="p">]</span>
</span><span class='line'>             <span class="p">[</span><span class="nv">clojure.test</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">produce-error</span> <span class="p">(</span><span class="nb">constantly </span><span class="p">(</span><span class="nf">exec/halt</span> <span class="p">{</span><span class="ss">:x</span> <span class="s">&quot;foobar&quot;</span><span class="p">})))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">success-fn</span>
</span><span class='line'>  <span class="s">&quot;Weird function that appends suffix to s&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">suffix</span> <span class="nv">s</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">str </span><span class="nv">s</span> <span class="nv">suffix</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">single-step</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="s">&quot;first&quot;</span> <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">two-steps-with-no-error</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="s">&quot;firstsecond&quot;</span> <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>                                              <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;second&quot;</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">error-as-first-step</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="p">{</span><span class="ss">:x</span> <span class="s">&quot;foobar&quot;</span><span class="p">}</span> <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">produce-error</span><span class="p">))))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="p">{</span><span class="ss">:x</span> <span class="s">&quot;foobar&quot;</span><span class="p">}</span> <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">produce-error</span><span class="p">)</span>
</span><span class='line'>                                              <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">error-after-first-step</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="p">{</span><span class="ss">:x</span> <span class="s">&quot;foobar&quot;</span><span class="p">}</span> <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>                                              <span class="p">(</span><span class="nf">produce-error</span><span class="p">)</span>
</span><span class='line'>                                              <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;second&quot;</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">works-with-anonymous-functions</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="mi">1</span> <span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>                                  <span class="p">((</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nf">exec/halt</span> <span class="mi">1</span><span class="p">)))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below is an implementation of <code>halt-on-error-&gt;&gt;</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">halt.execution</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defrecord </span><span class="nv">Stopper</span> <span class="p">[</span><span class="nv">x</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">halt</span> <span class="p">[</span><span class="nv">data</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">Stopper.</span> <span class="nv">data</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">halt-on-error-&gt;&gt;</span> <span class="p">[</span><span class="nv">form</span> <span class="o">&amp;</span> <span class="nv">forms</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">g</span> <span class="p">(</span><span class="nf">gensym</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">pstep</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">step</span><span class="p">]</span> <span class="o">`</span><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">instance? </span><span class="nv">Stopper</span> <span class="o">~</span><span class="nv">g</span><span class="p">)</span> <span class="o">~</span><span class="nv">g</span> <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="o">~</span><span class="nv">g</span> <span class="o">~</span><span class="nv">step</span><span class="p">)))]</span>
</span><span class='line'>    <span class="o">`</span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="o">~</span><span class="nv">g</span> <span class="o">~</span><span class="nv">form</span>
</span><span class='line'>           <span class="o">~@</span><span class="p">(</span><span class="nb">interleave </span><span class="p">(</span><span class="nb">repeat </span><span class="nv">g</span><span class="p">)</span> <span class="p">(</span><span class="nb">map </span><span class="nv">pstep</span> <span class="nv">forms</span><span class="p">))]</span>
</span><span class='line'>       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">instance? </span><span class="nv">Stopper</span> <span class="o">~</span><span class="nv">g</span><span class="p">)</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">.x</span> <span class="o">~</span><span class="nv">g</span><span class="p">)</span>
</span><span class='line'>         <span class="o">~</span><span class="nv">g</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>So what is this macro doing? First, it uses <code>gensym</code> to get a symbol
with a unique name and stores this in <code>g</code>. It then defines a helper
function called <code>pstep</code> for use in the code generation part of the
macro.</p>

<p>This macro generates a <code>let</code> block that repeatedly executes a form and
assigns the return value back to <code>g</code>. <code>g</code> is then checked to confirm
execution should continue before it is threaded into the next form. If
<code>g</code> is ever an instance of a <code>Stopper</code>, execution halts and the value
wrapped in the <code>Stopper</code> is returned.</p>

<p>Looking at an expanded version of a macro can be easier to understand
than a written explanation. Below is a macroexpanded version of one of
the tests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="c1">;; What is being expanded</span>
</span><span class='line'><span class="p">(</span><span class="nb">macroexpand-1 </span><span class="o">&#39;</span><span class="p">(</span><span class="nf">exec/halt-on-error-&gt;&gt;</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>                                       <span class="p">(</span><span class="nf">produce-error</span><span class="p">)</span>
</span><span class='line'>                                       <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;second&quot;</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">;; The expansion</span>
</span><span class='line'><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">G__15365</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;first&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">G__15365</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">instance? </span><span class="nv">halt.execution.Stopper</span> <span class="nv">G__15365</span><span class="p">)</span>
</span><span class='line'>                 <span class="nv">G__15365</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">G__15365</span> <span class="p">(</span><span class="nf">produce-error</span><span class="p">)))</span>
</span><span class='line'>      <span class="nv">G__15365</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">instance? </span><span class="nv">halt.execution.Stopper</span> <span class="nv">G__15365</span><span class="p">)</span>
</span><span class='line'>                 <span class="nv">G__15365</span>
</span><span class='line'>                 <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">G__15365</span> <span class="p">(</span><span class="nf">success-fn</span> <span class="s">&quot;second&quot;</span><span class="p">)))]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">instance? </span><span class="nv">halt.execution.Stopper</span> <span class="nv">G__15365</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">.x</span> <span class="nv">G__15365</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">G__15365</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Looking at that expansion, you can see how we are using a <code>let</code> block
to repeatedly assign to the same symbol and we check that return value
before executing the next stop.</p>

<p>This isn&rsquo;t a new pattern. There are
<a href="https://github.com/kumarshantanu/promenade">libraries</a> that implement
similar ideas. At IN/Clojure 2018, Varun Sharma gave a
<a href="https://www.slideshare.net/VarunSharma143/elegant-errorhandling-for-a-more-civilized-age">talk</a>
about how this cleaned up their code. You can even get bogged down and
throw around words like monad when talking about it.</p>

<p>I&rsquo;d encourage you to look at your code and see if you have areas where
error handling code is detracting from the readability. This might be
an area where this, or something similar to it, would help.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog//3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/03/10/more-working-from-home-tips/">More working from home tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/02/25/auto-syncing-a-git-repository/">Auto-syncing a git repository</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/01/11/reading-in-2019/">Reading in 2019</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/12/building-an-atreus-keyboard/">Building an Atreus keyboard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/23/building-a-onewheel-stand/">Building a Onewheel stand</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/15/switching-my-ergodox-to-qmk-firmware/">Switching my Ergodox to QMK firmware</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/30/how-i-use-social-media/">How I use social media</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/03/20/breaking-change-and-more-in-lein-test-refresh-0-dot-24-dot-0/">Breaking change and more in lein-test-refresh 0.24.1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/13/testing-asynchronous-javascript-with-jasmine/">Testing asynchronous JavaScript with Jasmine</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/28/how-to-use-leiningen-test-selectors-to-filter-by-test-name/">How to use Leiningen test selectors to filter by test name</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
  


</body>
</html>
