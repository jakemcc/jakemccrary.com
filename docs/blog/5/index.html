
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Jake McCrary" />
    <meta itemprop="description" content=" See all of my remote/working-from-home articles here. Whether it is working as the one remote employee at a traditional company or being one of many &hellip;" />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Jake McCrary" />
    <meta name="twitter:description" content=" See all of my remote/working-from-home articles here. Whether it is working as the one remote employee at a traditional company or being one of many &hellip;" />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="Writing by Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/blog/5/" />
    <meta property="og:title" content="Jake McCrary" />
    <meta property="og:description" content=" See all of my remote/working-from-home articles here. Whether it is working as the one remote employee at a traditional company or being one of many &hellip;" />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
    

    <meta name="description" content=" See all of my remote/working-from-home articles here. Whether it is working as the one remote employee at a traditional company or being one of many &hellip;">

    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/blog/5/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  <li><a href="https://jakemccrary.substack.com/welcome" target="_blank" rel="subscribe-email" title="subscribe via email">Newsletter</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/31/a-guide-to-distributed-work/">A guide to distributed work</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-31T18:30:00-05:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2017</span></span> <span class='time'>6:30 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>See all of my remote/working-from-home <a href="/blog/categories/remote/">articles here</a>.</p></blockquote>

<p>Whether it is working as the one remote employee at a traditional company or being one of many at a distributed company, remote work is becoming an option for many of us.</p>

<p>The number of employees that work remotely is growing<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. Technology improvements, pervasive Internet, and mindset changes are some of the drivers for this change.</p>

<p>The remainder of this article highlights some observations from my last few years of working for distributed companies. I&rsquo;ve also interviewed and corresponded with many other remote and formerly remote workers. Their contributions, along with books and articles on remote work, have influenced my thinking about what it means to have a successful distributed company. I&rsquo;ve been working remotely since October 2013 in roles that have ranged from being a team lead to software developer to CTO. Each company I&rsquo;ve worked for was fully distributed. There were no offices.</p>

<p>The types of distributed companies I&rsquo;ve worked with have not been asynchronous. They have had core working hours centered around one of the middle time zones in the continental United States. You could work from anywhere, but you needed to be willing to work while others were working. I consider this synchronous remote work.</p>

<p>Much of the following also applies to individuals working remotely for a not-entirely-distributed company or team. Being the only remote individual in a non-remote team comes with its own set of challenges that I&rsquo;m not going to attempt to present. If you are part of a team where some members work remotely, my recommendation is that you should treat that team as a remote team. If you don&rsquo;t, the remote worker will have a harder time keeping up with the rest of the team.</p>

<h2>Benefits</h2>

<p>If you ask someone that has never worked remotely before for the benefits of working remotely, they would probably be able to guess at some of the most obvious benefits. The top two responses I&rsquo;ve received to this question are having no commute and more flexibility in your schedule. These two advantages are huge. There are other, less obvious advantages as well.</p>

<h3>No commute</h3>

<p>This is the benefit that most workers, remote and non-remote, identify when asked about benefits of remote work. This benefit stands out because it is huge and obvious. In the United States, the average one-way commute is <a href="https://project.wnyc.org/commute-times-us/embed.html#5.00/42.000/-89.500">25 minutes long</a>. The average worker spends nearly one hour going to and from their work.</p>

<p>If you are going to work five days a week, then you&rsquo;re spending over four hours commuting.  That is half of a full workday riding a bicycle, car, train, or bus. In the best case scenario, you are using that time to read, listen to a podcast, or trying to think deeply about a problem. In reality, you&rsquo;re trying to do one of those activities, but you are continuously distracted by the world around you. You have to worry about avoiding accidents, driving safely, or another distracting concern.</p>

<p>Commuting has been shown to have negative effects on the commuters<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>. Being able to work remotely lets you avoid those problems.</p>

<h3>Flexibility in schedule</h3>

<p>This is another benefit that most people can immediately identify. Remote works gives you more power over your schedule. Even if you&rsquo;re part of a synchronous distributed team, you gain flexibility. All of a sudden your breaks become time you can use to enrich your non-work life.</p>

<p>Picking up or dropping off your children at daycare or school becomes easier. Taking your dog for a midday walk becomes possible. Since you aren&rsquo;t commuting, you have more time to make breakfast for you and your family. You can run errands or go to your favorite neighborhood lunch spot during the day. These errands and restaurant trips are quicker since you&rsquo;re effectively doing them at off hours as most of your neighbors are working at their office.</p>

<h3>More time with family</h3>

<p>If you&rsquo;re working at home, then it becomes easy to see your family more. You can say hi to your kids when they get home from school. You have more time in the evening to spend with your baby before bedtime.</p>

<h3>Customize your workspace</h3>

<p>You get to choose where you work. For many, this will be in a home office. This is your space. You get to make it your own.</p>

<p>Do you like to work in a cave? Paint the walls a dark color, block out the windows and enjoy your cave-like experience. Do you prefer sunlight and plants? Work near a window and add houseplants to your space. Do you want an awesome sit-stand desk and chair? Buy <a href="/blog/2015/03/31/my-home-work-space/">them</a>.</p>

<p>One of my former colleagues likes to walk on a treadmill while standing or, if sitting, he enjoyed having <a href="http://amzn.to/2gRypQD">pedals</a> under his desk. These are customizations he would have a hard time getting at most offices.</p>

<h3>Eat the food you want to eat</h3>

<p>Many of us have preferred diet (or a diet we&rsquo;re forced to follow). When you work from home, it is easier to eat food you know you should eat.</p>

<p>When you work from an office, you have a few food options. You can bring your food, go out to eat, or (if your employer offers it) eat food provided by your company. If you follow a restrictive diet, all of these options are more hassle than making your lunch at home every day.</p>

<p>Feel like eating food someone else has prepared? You can still do that while working from home.</p>

<h3>Fewer interruptions</h3>

<p>As a remote worker, you can choose your working location. This lets you select a spot with fewer distractions. You can pick an ideal location that helps you achieve a state of <a href="https://en.wikipedia.org/wiki/Flow_(psychology)">flow</a>.</p>

<p>Minimizing interruptions is one of the keys to accomplishing challenging tasks. After an interruption, it takes up to a half an hour to get back to your original task<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>.</p>

<h3>Off-hours support</h3>

<p>This is a benefit I have not seen mentioned many other places. Off-hours support becomes much easier if you are working remotely. The actions you would take for an urgent alert at 1 AM are the same actions you would take at 1 PM.</p>

<p>When you get that 1 AM page you don&rsquo;t have to struggle to remember how you check production while at home; this is an activity you do on a regular basis. You know what you need to do. You don&rsquo;t have to remember how to VPN into your company&rsquo;s network; you do that every day.</p>

<p>No one likes getting woken up by a support call. At least this way you get to use your normal tools for solving problems.</p>

<h3>Recruiting</h3>

<p>Since you aren&rsquo;t limited to your locale, you can recruit from a much broader region. This means you can find the top talent for your company. This is huge.</p>

<p>Back in late 2013, it was quite challenging to find experienced Clojure programmers. Because <a href="https://outpace.com">Outpace</a> is a distributed company, we were able to hire experts from across the entire United States. We would not have been able to recruit nearly as well if we were limited to a single location.</p>

<h3>Employee retention</h3>

<p>If your company supports remote work, then you remove an entire reason for an employee leaving. Sometimes, a person needs to move.  Working for a company that supports remote work allows them to move and not leave the company.</p>

<h3>Reduced office costs</h3>

<p>Having a distributed workforce can reduce office costs drastically. In a fully distributed company, it could reduce the cost to zero. Realistically, I&rsquo;d expect the company I work for to provide computer hardware so there are still some costs<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>. Unless the company pays for Internet and phone, the recurring costs are minimal.</p>

<h2>Downsides</h2>

<p>While there are many benefits, there are also downsides to working remotely. When I talk to non-remote workers about working remotely, I typically hear &ldquo;I don&rsquo;t know how you do it, I&rsquo;d be so distracted.&rdquo; This statement touches on one of the downsides of remote work, but it isn&rsquo;t largest one. Below are some downsides that I and others have observed.</p>

<h3>Loneliness and isolation</h3>

<p>Nearly everyone I&rsquo;ve talked to, including myself, puts this as the top downside.</p>

<p>Most of us are social creatures. You do not get the same type of social interaction with your coworkers when you are working remotely. Instead of bumping into a wide range of people in the office, you interact with a smaller group through video chats, phone calls, chat rooms, and email. Depending on what you are doing, you might not even get that interaction.</p>

<p>This is very unfamiliar to most of us. We&rsquo;re used to being in physical proximity to other humans. We&rsquo;re used to having small talk and grabbing coffee or lunch with other people.</p>

<p>You can combat these feelings by setting up communication with other employees at your company. Have some dedicated chat rooms for non-work discussions. Have a daily, short video meeting that is a status check within the team so that everyone gets to see another person&rsquo;s face at least once a day. If you work in a city that has other remote workers from your company then meet up occasionally for dinner, lunch, or happy hour.</p>

<p>If you are having troubles with loneliness and isolation, try to find an area where you can work surrounded by other people. Two options are co-working spaces and coffee shops. Alternatively, try to have social activities you regularly do with non-coworkers in your area. Having strong connections with non-coworkers can help combat loneliness.</p>

<p>If I stay inside for more than a couple days, I get grumpy. I didn&rsquo;t realize this when I worked in an office. Noticing this has benefited my rock climbing, as I&rsquo;ve made that my main non-work social activity. Even if I merely go bouldering by myself, being around other humans helps. If you&rsquo;re working remotely and feeling grumpy, try to find an activity you can regularly do and see if doing that helps.</p>

<h3>Distractions</h3>

<p>This is the downside that non-remote workers most often identify. People assume that television and other distractions in your home are irresistible and will cause you not to get work done. When you are working 100% remotely, you don&rsquo;t have the same distractions you have when you are only occasionally working remotely. You can&rsquo;t do laundry every day. You only have so much TV you can watch.</p>

<p>Personally, I don&rsquo;t have a problem with distractions when working at home. I know others that do. They mostly have when they first started working from home. When they first started working at home, they found themselves doing too much around the house. As a result, they worked late hours or felt like they weren&rsquo;t getting enough work done. Once you recognize the problem, it is possible to train yourself not to get distracted.</p>

<p>Roommates, kids, and family are another (sometimes welcome) distraction. You can combat interruptions from others by setting boundaries. Many of my coworkers have a rule that when their office door is closed, they are unavailable. I&rsquo;ll claim that coworkers interrupting you in an office are more distracting as the much rarer interruption from someone within your home.</p>

<p>Employees that work remotely are typically choosing to work remotely. Once they get used to working remotely, distractions stop being a problem. They know they need to produce quality work and will take steps to make sure they do.</p>

<h3>Working too much</h3>

<p>When you first start working from home, you suddenly find yourself living in the same space that you work. This lack of change in location and commute makes it easy to keep working. You get invested in a problem and all of a sudden it is past the time when you should have stopped working.</p>

<p>Even if you manage to stop working on time, it is easy to slip back into work mode. The computer setup I like to use in the evening is in the same location as my work setup. This makes it easy for me to take one more peek at our monitoring dashboards or check my work email.</p>

<p>You do not want to overwork and you do not want your teammates to overwork. In the short-term, overwork can be beneficial. Long-term it leads to burnout and poor outcomes.</p>

<h3>Fewer interactions</h3>

<p>This is a negative and positive. When you are working remotely, you have fewer random interactions with coworkers. You most likely interact with your team plus the same handful of people outside of your team regularly but you rarely interact with others.</p>

<p>In an office, there is a chance you&rsquo;ll run into people outside your usual circle of communication. You might eat lunch with a broader variety of people. You may bump into others while getting a coffee or a snack.</p>

<p>You can help increase interactions on a distributed team by having some chat rooms that encourage random discussions. Another option is to have a regular and optional meeting scheduled where people can give an informal presentation on something that interests them.</p>

<h2>Tools</h2>

<p>You will need to select tools that work for distributed teams. Most computer or web-based tools can work in a distributed setting. Any physical tools (such as pen and paper) will not work.</p>

<p>A prime example of this is the <a href="http://www.caroli.org/the-card-wall/">classic card wall</a> for tracking work. A physical wall with actual cards will not work as soon as there is a single remote worker on a team. Instead of a physical wall, you&rsquo;ll need to using something like <a href="https://trello.com">Trello</a>.</p>

<p>It is less important to get stuck on a particular tool recommendation and more essential to pay attention to the categories of tools. Categories of tools tend to be more stable than a specific recommendation.</p>

<h3>Text chat</h3>

<p>You&rsquo;ll want a chat application. <a href="https://slack.com">Slack</a> and <a href="https://www.stride.com/">Stride</a> are just two of the many available services.</p>

<h3>Video conference</h3>

<p>Video conferencing is a technology that you should embrace. It is much better than talking to either an individual or a group on the phone. Being able to read body language makes communication far better. Personally, I&rsquo;ve used Google Hangouts and <a href="https://zoom.us">Zoom</a> for hundreds of hours each and prefer Zoom. <a href="https://appear.in">appear.in</a> is another option that doesn&rsquo;t require installing anything. There are many options in this space and more keep appearing. It is even built into Slack.</p>

<h3>Phone conferences</h3>

<p>I&rsquo;d try to get rid of phone conferences in preference to video conferences. Video chat has many benefits over conference calls. I actually can&rsquo;t recommend any phone conferencing tools, but I will mention that Zoom supports people dialing into a video conference.</p>

<h3>Screen sharing</h3>

<p>You&rsquo;ll want to have a way to show another person or group what is on your screen. It is even better if someone else can take control of your machine or use their cursor to point towards something on your screen.</p>

<p>Most of my experience with this is using the feature built-in to Zoom. Pretty much every video conference tool I&rsquo;ve used (appear.in, Google Hangouts, etc.) has screen sharing built-in.</p>

<h3>Real-time collaboration on a document</h3>

<p>Being able to collectively edit a document with a group is pretty amazing. <a href="http://etherpad.org/">Etherpad</a> and <a href="https://www.google.com/intl/en/docs/about/">Google Docs</a> are two options. Most of my experience is with Google Docs.</p>

<p>When a document supports real-time collaboration, you can do amazing things. You can use it to capture ideas from a remote group. An extreme version of this can be viewed by opening <a href="http://idlewords.com/talks/fan_is_a_tool_using_animal.htm">this page</a> and searching for &ldquo;Google doc.&rdquo;</p>

<p>You can use a shared document to facilitate a remote meeting (this goes incredibly well once you get the practice of it). Having a document that everyone in a meeting can edit is so much better than a whiteboard that only one or two people can simultaneously use.</p>

<h3>Whiteboards</h3>

<p>Whiteboards are an example of a tool that is always brought up, even by remote workers, as something that distributed teams miss. There are alternatives.</p>

<p>Whiteboards are a very convenient tool when meeting in-person, but there are other ways of collaborating when working remotely. Shared documents and screen sharing go a long way towards enabling collaboration. Tools that work well for remote collaboration often have another benefit over whiteboards; they are easier to persist and reference later.</p>

<p>One whiteboard alternative is Zoom&rsquo;s built-in whiteboard. It works fairly well. Another is to use <a href="https://drawings.google.com">Google Drawings</a>. <a href="https://precursorapp.com/">Precursor</a> is a design focused collaborative tool that can also work.</p>

<p>Even after four years, I occasionally find myself missing a whiteboard or shared piece of paper. Drawing with a mouse isn&rsquo;t ideal. I know some developers that use an iPad or a Wacom tablet to help them quickly sketch diagrams for their team.</p>

<h2>Communication</h2>

<p>Communication is inherently different on a distributed team. You cannot just walk across an office to interrupt someone and ask them a question. Communication happens mostly through text. You need to be skilled at written communication.</p>

<p>You lose context with written communication when compared to vocal or in-person communication. You no longer have body language or tone of voice to help you interpret what someone means. Lack of tone is huge. This is one reason that text communication is interpreted as more emotionally negative or neutral than intended<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup>. If you&rsquo;re reading text communication, try to read it with a positive tone.</p>

<p>It can also be useful to have rules around the expectations of different forms of communication. How quickly do you need to respond to an email? How quick should a response be to a chat room message?  When should you pick up the phone and call someone?</p>

<h3>Chat rooms</h3>

<p>Chat room applications (IRC, Slack, Stride, Flowdock, etc.) are pretty great. They provide a medium of communication that has a lower barrier to entry than email. Chat tools have a place in the distributed teams tool chest.</p>

<p>The chat room becomes even more central to work once you start including useful bots in the room. These bots can perform many functions. You can look in the <a href="https://slack.com/apps">Slack App Directory</a> to see some of the bots that people are producing.</p>

<p>If you start adding bots and other automated messages to your chat application, you might want to think about setting up a separate channel. Some messages are not worthy of being interjected into your team&rsquo;s main chat. They can be distracting and hurt the flow of conversation. These messages tend to be ones that are informative, but not critical. For my teams, these messages include things like git commits and Trello card updates. It is great to see these in a single spot but annoying when they interrupt a conversation.</p>

<p>Chat rooms can also be a big time sink. They are a source of concentration interrupting notifications. The feeling of missing out on conversations can drive people to join a large number of channels. This piles on the potential for distraction.</p>

<p>Chat rooms also provide a feeling of immediacy that isn&rsquo;t actually there. You don&rsquo;t know if key people have seen your message or have had time to respond.</p>

<p>Despite having search functionality, I&rsquo;ve found it hard to find previous conversations in chat applications. If something important appears in chat, I&rsquo;d recommend extracting it from the chat application and recording it somewhere else.</p>

<p>I&rsquo;d also recommend turning off notifications for all but most definite &ldquo;someone is trying to reach me&rdquo; triggers. Encourage members of your chat to use entire channel notifications sparingly and only for messages that need everyone&rsquo;s attention. There are not many messages that immediately require everyone&rsquo;s attention.</p>

<p>It can be a challenge to follow chat conversations, especially if they span a larger unit of time. Don&rsquo;t be afraid to move a conversation to email or another medium that is better suited for longer and more complex discussions.</p>

<p>Many chat applications offer the ability to have private rooms or to send direct messages to a user. Don&rsquo;t be afraid of using these private channels, but if your communication can be public, it should be public. It can be challenging to ask a question and admit you don&rsquo;t know something but seeing that dialogue might help others. Similarly, having discussions about a feature, bug, or task can help spread knowledge.</p>

<h3>Email</h3>

<p>Despite all of the efforts to replace email; email is still useful. It is the most common form of communication between companies, it is pervasive, and it usually comes with good search capabilities.</p>

<p>A good email thread can keep a topic contained in a form that is possible to follow. Unlike a chat room, there (usually) aren&rsquo;t off-topic interjections from uninvolved parties.</p>

<h3>Phone</h3>

<p>You shouldn&rsquo;t be afraid of calling someone. Just recognize that this is an interruption. Your company should have a directory of telephone numbers that is accessible to everyone.</p>

<p>One downside of any voice conversation is that it is not automatically persisted. It can be worth following up a phone call with an email summarizing the discussion and the next steps.</p>

<h3>Picking the right communication medium</h3>

<p>When you are working on a distributed team, you can no longer walk over to someone&rsquo;s desk and interrupt them. This is great. Not every question deserves an immediate answer.</p>

<p>Agree with your team when to use different forms of communication. Set expectations with regards to response times and urgency for different mediums. Maybe direct chat messages are expected to be responded to in under 10 minutes. Perhaps emails are OK having a delay of a few hours. This is something your group will need to decide.</p>

<h2>Practices</h2>

<p>These are some practices I&rsquo;ve seen work well with distributed teams. Many of them are slight variations on what you might have experienced on a co-located team.</p>

<h3>Stand-ups</h3>

<p>Most of the teams I&rsquo;ve been part of, whether distributed or co-located, have had a daily stand-up meeting. The intention of this meeting was to provide a short, scheduled time for communicating any roadblocks to progress, interesting information, status updates, and desire for help.</p>

<p>For a distributed stand-up, the team joins a video conference and we gather around a shared Google Doc that has prompts similar to the snippet below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Day: 2017-07-11
</span><span class='line'>
</span><span class='line'>What's interesting?
</span><span class='line'>
</span><span class='line'>Want help?
</span><span class='line'>
</span><span class='line'>Meetings:</span></code></pre></td></tr></table></div></figure>


<p>These prompts provide a starting point for team members to add additional text. Our stand-ups were at the beginning of the day, so frequently team members would add text to the document at the end of the prior day. Filling in the document at the end of the day instead of right before the stand-up was useful as memories and thoughts were often fresher without having to remember them the following morning.</p>

<p>After being filled in, the document would look like below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Day: 2017-07-11
</span><span class='line'>
</span><span class='line'>What's interesting?
</span><span class='line'>  - New deploy lowered response time by 20% [Jake]
</span><span class='line'>  - Discovered bug in date-time library around checking if date is within interval [Sue]
</span><span class='line'>  - Greg joined the team!
</span><span class='line'>  - Adding blocker functionality going to take longer than expected [Donald]
</span><span class='line'>
</span><span class='line'>Want help?
</span><span class='line'>  - Having difficulties running batch process locally. [Tom]
</span><span class='line'>  - I'm having a hard time understanding propensity calculation [Mike]
</span><span class='line'>
</span><span class='line'>Meetings:
</span><span class='line'>  - API overview with client @ 2 PM Central [Jake/Jeremy]</span></code></pre></td></tr></table></div></figure>


<p>We would gather around the Google Doc and everyone would take a couple of minutes to read silently. If anyone felt like something was worth talking about they would <strong>bold</strong> the text and then we&rsquo;d work from top to bottom and have a quick discussion. For our <code>Want help?</code> section we&rsquo;d solicit volunteers and move on. The <code>Meetings</code> section was primarily there to provide visibility as to when certain members might not be available. After we worked through the <code>Want help?</code> section we&rsquo;d pop over to Trello and review the work in progress and make sure everyone had an idea of what they would be doing that day.</p>

<p>The nice thing about doing a stand-up around a shared Google Doc is that you can put in richer media than just text. Screenshots of monitoring graphs were a regular addition to the <code>What's interesting?</code> section.</p>

<p>Every day a new section was added to the top of the Google Doc and the previous day was pushed lower on the page. Having this written history of stand-ups was useful as it allowed us to notice patterns through a persisted medium instead of relying on our memory. It also let someone who was on vacation come back and have an idea of what had happened while they were gone. Below is what the document would look like on the next day (comments removed to keep the example shorter).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Day: 2017-07-12
</span><span class='line'>
</span><span class='line'>What's interesting?
</span><span class='line'>  - [...]
</span><span class='line'>
</span><span class='line'>Want help?
</span><span class='line'>  - [...]
</span><span class='line'>
</span><span class='line'>Meetings:
</span><span class='line'>  - [...]
</span><span class='line'>
</span><span class='line'>-------
</span><span class='line'>Day: 2017-07-11
</span><span class='line'>
</span><span class='line'>What's interesting?
</span><span class='line'>  - [...]
</span><span class='line'>
</span><span class='line'>Want help?
</span><span class='line'>  - [...]
</span><span class='line'>
</span><span class='line'>Meetings:
</span><span class='line'>  - [...]</span></code></pre></td></tr></table></div></figure>


<p>Above is an example from one of the teams I led. Another team used the following prompts.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1. Accomplished Yesterday
</span><span class='line'>
</span><span class='line'>2. Requires Attention/Roadblocks
</span><span class='line'>
</span><span class='line'>3. Scope Creep Alerts
</span><span class='line'>
</span><span class='line'>4. Would like to Do Today</span></code></pre></td></tr></table></div></figure>


<p>The important thing is to find something that works for your team. Different teams are going to prefer different formats.</p>

<p>Another interesting benefit of using a Google Doc to drive your stand-up is that it can be visible to other teams. You can even combine teams into a single document. Below is an example with two teams in a single document.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>**Everyone**
</span><span class='line'>  - [...]
</span><span class='line'>
</span><span class='line'>**Team Events**
</span><span class='line'>  1. Accomplished Yesterday
</span><span class='line'>     - [...]
</span><span class='line'>  2. Requires Attention/Roadblocks
</span><span class='line'>     - [...]
</span><span class='line'>  3. Scope Creep Alerts
</span><span class='line'>     - [...]
</span><span class='line'>  4. Would like to do today
</span><span class='line'>     - [...]
</span><span class='line'>
</span><span class='line'>**Team Engine**
</span><span class='line'>What's interesting?
</span><span class='line'>  - [...]
</span><span class='line'>Want help?
</span><span class='line'>  - [...]
</span><span class='line'>Meetings:
</span><span class='line'>  - [...]</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>I&rsquo;ve seen this work successfully with five related teams in a single document. News and information that affects everyone is added in the <code>Everyone</code> section. Team specific information is put in the team sections. Each team still has their individual stand-up where they only look at their section. But since their section is part of the larger document, they get a taste of what is going on in the other related teams. This helps replace the random hallway chatter you get in a shared office and gives everyone a slightly broader picture.</p>

<p>This worked shockingly well. I&rsquo;ve had colleagues reach out, some years after leaving, to ask for the template we used for this multi-team stand-up.</p>

<h3>Stand-downs</h3>

<p>Stand-downs are a meeting that provides time to informally chat with a group. I&rsquo;ve seen them used as an optional end-of-day water cooler activity for a group to talk about whatever. These chats often happen, but are unscheduled, in an office.</p>

<p>These meetings should be an optional, short meeting scheduled near the end of the day. This gives team members a good excuse (socializing with their coworkers) to stop working (which helps with the problem of overwork). No one should feel pressure to be at these meetings.</p>

<p>The conversation may or may not be work-related. Maybe you discuss a language feature someone learned. You might talk about a book you started reading. It doesn&rsquo;t matter what is discussed; these meetings can help a team get closer and promote more social interaction.</p>

<p>I&rsquo;ve also worked with teams that play games, such as <a href="https://jackboxgames.com/project/jbpp3/">Jackbox Party Packs</a>, through video conferences.</p>

<h3>Remote Pair Programming</h3>

<p><a href="http://c2.com/xp/PairProgramming.html">Pair programming</a> is a technique that people often employ when working in-person. It works even better when remote and helps solve some of the difficulties of working remotely.</p>

<p>Remote pair programming helps fight the feeling of loneliness and isolation that remote workers feel. Remote pairing forces intense interaction between two people. It also helps keep the two people focused on work. It is easy for a single person to get distracted by browsing Hacker News but much harder for both people to get sucked into it.</p>

<p>The ideal in-person pair programming setup is when you take a single computer and hook up two large monitors, two keyboards, and two mice and then mirror the monitors. This lets both programmers use their personal keyboard and stare straight ahead at their monitor.</p>

<p>Remote pair programming is an even better setup. One developer, the host, somehow shares their environment with the other developer. This can be done through screen sharing using Zoom, Slack, VNC, tmate, or some other way. The important part is that both developers can see the code and, if necessary, someway of viewing a UI component. They should both be able to edit the code.</p>

<p>Like the ideal local pair programming environment, each developer uses their personal keyboard, mouse, and monitor. Unlike the local pair programming environment, they each also have their own computer. This lets one developer look up documentation on their computer while the host developer continues to write code. It also allows the non-host developer to shield the host from distractions like answering questions in the chat room or responding to emails.</p>

<p>When remote programming it is easier for the non-host developer to stop paying attention. It is easier to be rude and not pay attention to your pair when you are not sitting next to them. If you notice your pair has zoned out, nicely call them out on it or ask them a question to get them to re-engage.</p>

<h3>One-on-ones</h3>

<p>One-on-ones are a useful practice in both a co-located and distributed team. For those who aren&rsquo;t familiar with one-on-ones, they are meetings between you and your manager (flip that if you are the manager). They should be scheduled regularly and be a time where you discuss higher-level topics than the daily work. They are extremely useful for helping you develop professionally and helping a team run smoothly. If you currently have one-on-ones and you aren&rsquo;t finding them useful, I&rsquo;d recommend reading some articles with tips for making them useful. Here are a <a href="https://www.themuse.com/advice/how-to-have-oneonones-that-actually-matter">couple</a> <a href="https://hbr.org/2016/08/how-to-make-your-one-on-ones-with-employees-more-productive">articles</a> that give some pretty good advice. As both a team lead and a team member I&rsquo;ve found one-on-ones extremely useful. I thought they were even more useful when on a distributed team.</p>

<p>With a distributed team you lose out on a lot of the body language you can pick up on when in person. It is harder to tell when someone is frustrated or when a pair is not working well together. Burnout is harder to notice. One-on-ones provide a time for that information to come out.</p>

<h3>Meet in person</h3>

<p>You should have your distributed team or company meet in person. This shouldn&rsquo;t happen too regularly; I think this ideally happens two to four times a year. Even if you see someone every day on video, there is still some magic that happens when you meet in person<sup id="fnref:6"><a href="#fn:6" rel="footnote">6</a></sup>.</p>

<p>You can use this time to do the typical day-to-day work, but I think it is more productive to try other activities. The most successful in-person meetups I&rsquo;ve been part of consisted mostly of group discussions. This can take the form of a mini-conference or <a href="http://openspaceworld.org/wp2/what-is/">Open Space</a>. Another option is to brainstorm some potentially wild ideas and try implementing them to see how far you can get.</p>

<p>Use this time to have some meals and drinks with your coworkers. Play some board games and talk about things other than work. Sing some karaoke. Get to know your coworkers as more than someone inside your computer. Doing so can help with communication and understanding personalities.</p>

<h2>End</h2>

<p>It is an exciting time to be a remote worker. New tools are emerging that try to make remote work easier. New techniques are being discovered. Old techniques are being adapted.</p>

<p>I hope you&rsquo;ve found this article useful. If you are a remote worker, maybe you&rsquo;ve picked up some ideas to bring into your remote work. If you work in an office, perhaps you&rsquo;ve found some useful arguments for moving towards remote work.</p>

<p>There is much more I could write about remote work and distributed teams. Some of these sections deserve their own posts and extended examples. You can view the <a href="/blog/categories/remote/">remote category</a> of my site to view other articles I&rsquo;ve already written.</p>

<p>If you&rsquo;ve enjoyed this article, consider sharing (<a href="https://twitter.com/intent/tweet?text=A%20guide%20to%20distributed%20work%20https%3A%2F%2Fjakemccrary.com%2Fblog%2F2017%2F10%2F31%2Fa-guide-to-distributed-work%2F&amp;via=jakemcc">tweeting</a>) it to your followers.</p>

<h2>Acknowledgments</h2>

<p>This article came to life from the notes and research I did prior to speaking at the <a href="http://lanyrd.com/2016/aitworkshop/">2016 AIT Workshop</a>. Some of those notes came from correspondence with <a href="https://timothypratley.blogspot.com/">Timothy Pratley</a>, <a href="http://www.rustybentley.com/">Rusty Bentley</a>, <a href="http://gigasquidsoftware.com/">Carin Meier</a>, <a href="https://twitter.com/devn">Devin Walters</a>, <a href="https://twitter.com/kidpollo">Paco Viramontes</a>, <a href="http://www.xpteam.com/">Jeff Bay</a>, and <a href="http://www.grayduckllc.com/">Michael Halvorson</a>. Discussions at the conference, with the above individuals, and working remotely at <a href="https://outpace.com">Outpace</a> and <a href="https://lumanu.com">Lumanu</a> really helped solidify my thoughts.</p>

<h2>Other references</h2>

<ul>
<li><a href="http://amzn.to/2geZYlw">Remote - Jason Fried and David Heinemeier Hansson</a></li>
<li><a href="https://zapier.com/learn/the-ultimate-guide-to-remote-working/">The Ultimate Guide to Remote Work - Zapier</a></li>
<li><a href="http://paul.stadig.name/2013/07/remote-distributed.html">Remote != Distributed - Paul Stadig</a></li>
<li><a href="http://bob.mcwhirter.org/blog/2010/09/13/remote-worker-distributed-team/">Remote worker vs distributed team - Bob Mcwhirter</a></li>
<li><a href="http://martinfowler.com/articles/remote-or-co-located.html">Remote or co-located - Martin Fowler</a></li>
</ul>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<a href="http://globalworkplaceanalytics.com/telecommuting-statistics">http://globalworkplaceanalytics.com/telecommuting-statistics</a><a href="#fnref:1" rev="footnote">&#8617;</a></li>
<li id="fn:2">
Various articles: <a href="https://www.psychologytoday.com/blog/urban-survival/201501/commuting-the-stress-doesnt-pay">one</a>, <a href="http://time.com/9912/10-things-your-commute-does-to-your-body/">two</a>, <a href="http://www.businessinsider.com/long-commutes-have-an-impact-on-health-and-productivity-2017-5">three</a>, <a href="https://www.theguardian.com/news/datablog/2014/feb/12/how-does-commuting-affect-wellbeing">four</a>, <a href="http://www.npr.org/2011/10/19/141514467/small-changes-can-help-you-thrive-happily">five</a>, <a href="https://www.forbes.com/sites/amymorin/2014/12/07/want-to-be-happier-change-your-commute-or-change-your-attitude/#5d71cadc7417">six</a>, <a href="http://webarchive.nationalarchives.gov.uk/20160107224314/http://www.ons.gov.uk/ons/dcp171766_351954.pdf">seven</a><a href="#fnref:2" rev="footnote">&#8617;</a></li>
<li id="fn:3">
<a href="http://www.npr.org/2015/09/22/442582422/the-cost-of-interruptions-they-waste-more-time-than-you-think">http://www.npr.org/2015/09/22/442582422/the-cost-of-interruptions-they-waste-more-time-than-you-think</a><a href="#fnref:3" rev="footnote">&#8617;</a></li>
<li id="fn:4">
Though, you may want to pay for the Internet or provide a budget to help remote employees set up their home office.<a href="#fnref:4" rev="footnote">&#8617;</a></li>
<li id="fn:5">
<a href="http://amr.aom.org/content/33/2/309.short">Carrying too Heavy a Load? The Communication and Miscommunication of Emotion by Email</a> and <a href="https://www.fastcodesign.com/3036748/evidence/why-its-so-hard-to-detect-emotion-in-emails-and-texts">Why It&rsquo;s So Hard To Detect Emotion In Emails And Texts</a><a href="#fnref:5" rev="footnote">&#8617;</a></li>
<li id="fn:6">
Like being surprised at how tall or short your coworkers are. It gets me every time.<a href="#fnref:6" rev="footnote">&#8617;</a></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/29/measure-aggregate-performance/">Measuring aggregate performance in Clojure</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-29T08:48:01-05:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>8:48 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Last time I needed to speed up some code, I wrote a Clojure macro that recorded the aggregate time spent executing the code wrapped by the macro. Aggregate timings were useful since the same functions were called multiple times in the code path we were trying to optimize. Seeing total times made it easier to identify where we should spend our time.</p>

<p>Below is the namespace I temporarily introduced into our codebase.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">metrics</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">msec-str</span>
</span><span class='line'>  <span class="s">&quot;Returns a human readable version of milliseconds based upon scale&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">msecs</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">s</span> <span class="mi">1000</span>
</span><span class='line'>        <span class="nv">m</span> <span class="p">(</span><span class="nb">* </span><span class="mi">60</span> <span class="nv">s</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">h</span> <span class="p">(</span><span class="nb">* </span><span class="mi">60</span> <span class="nv">m</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">condp</span> <span class="nb">&gt;= </span><span class="nv">msecs</span>
</span><span class='line'>      <span class="mi">1</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%.5f msecs&quot;</span> <span class="p">(</span><span class="nb">float </span><span class="nv">msecs</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">s</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%.1f msecs&quot;</span> <span class="p">(</span><span class="nb">float </span><span class="nv">msecs</span><span class="p">))</span>
</span><span class='line'>      <span class="nv">m</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%.1f seconds&quot;</span> <span class="p">(</span><span class="nb">float </span><span class="p">(</span><span class="nb">/ </span><span class="nv">msecs</span> <span class="nv">s</span><span class="p">)))</span>
</span><span class='line'>      <span class="nv">h</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%02dm:%02ds&quot;</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nb">/ </span><span class="nv">msecs</span> <span class="nv">m</span><span class="p">))</span>
</span><span class='line'>                <span class="p">(</span><span class="nf">mod</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nb">/ </span><span class="nv">msecs</span> <span class="nv">s</span><span class="p">))</span> <span class="mi">60</span><span class="p">))</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%dh:%02dm&quot;</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nb">/ </span><span class="nv">msecs</span> <span class="nv">h</span><span class="p">))</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">mod</span> <span class="p">(</span><span class="nb">int </span><span class="p">(</span><span class="nb">/ </span><span class="nv">msecs</span> <span class="nv">m</span><span class="p">))</span> <span class="mi">60</span><span class="p">)))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="k">def </span><span class="nv">aggregates</span> <span class="p">(</span><span class="nf">atom</span> <span class="p">{}))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defmacro </span><span class="nv">record-aggregate</span>
</span><span class='line'>  <span class="s">&quot;Records the total time spent executing body across invocations.&quot;</span>
</span><span class='line'>  <span class="p">[</span><span class="nv">label</span> <span class="o">&amp;</span> <span class="nv">body</span><span class="p">]</span>
</span><span class='line'>  <span class="o">`</span><span class="p">(</span><span class="nf">do</span>
</span><span class='line'>     <span class="p">(</span><span class="nb">when-not </span><span class="p">(</span><span class="nb">contains? </span><span class="o">@</span><span class="nv">aggregates</span> <span class="o">~</span><span class="nv">label</span><span class="p">)</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">swap!</span> <span class="nv">aggregates</span> <span class="nb">assoc </span><span class="o">~</span><span class="nv">label</span> <span class="p">{</span><span class="ss">:order</span> <span class="p">(</span><span class="nb">inc </span><span class="p">(</span><span class="nb">count </span><span class="o">@</span><span class="nv">aggregates</span><span class="p">))}))</span>
</span><span class='line'>     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">start-time#</span> <span class="p">(</span><span class="nf">System/nanoTime</span><span class="p">)</span>
</span><span class='line'>           <span class="nv">result#</span> <span class="p">(</span><span class="k">do </span><span class="o">~@</span><span class="nv">body</span><span class="p">)</span>
</span><span class='line'>           <span class="nv">result#</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">seq? </span><span class="nv">result#</span><span class="p">)</span>
</span><span class='line'>                            <span class="p">(</span><span class="nb">instance? </span><span class="nv">clojure.lang.IPending</span> <span class="nv">result#</span><span class="p">)</span>
</span><span class='line'>                            <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">realized?</span> <span class="nv">result#</span><span class="p">)))</span>
</span><span class='line'>                     <span class="p">(</span><span class="nb">doall </span><span class="nv">result#</span><span class="p">)</span>
</span><span class='line'>                     <span class="nv">result#</span><span class="p">)</span>
</span><span class='line'>           <span class="nv">end-time#</span> <span class="p">(</span><span class="nf">System/nanoTime</span><span class="p">)]</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">swap!</span> <span class="nv">aggregates</span>
</span><span class='line'>              <span class="nv">update-in</span>
</span><span class='line'>              <span class="p">[</span><span class="o">~</span><span class="nv">label</span> <span class="ss">:msecs</span><span class="p">]</span>
</span><span class='line'>              <span class="p">(</span><span class="nf">fnil</span> <span class="nb">+ </span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>              <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">double </span><span class="p">(</span><span class="nb">- </span><span class="nv">end-time#</span> <span class="nv">start-time#</span><span class="p">))</span> <span class="mf">1000000.0</span><span class="p">))</span>
</span><span class='line'>       <span class="nv">result#</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">log-times</span>
</span><span class='line'>  <span class="s">&quot;Logs time recorded by record-aggregate and resets the aggregate times.&quot;</span>
</span><span class='line'>  <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">doseq </span><span class="p">[[</span><span class="nv">label</span> <span class="nv">data</span><span class="p">]</span> <span class="p">(</span><span class="nb">sort-by </span><span class="p">(</span><span class="nb">comp </span><span class="ss">:order</span> <span class="nv">second</span><span class="p">)</span> <span class="o">@</span><span class="nv">aggregates</span><span class="p">)</span>
</span><span class='line'>          <span class="ss">:let</span> <span class="p">[</span><span class="nv">msecs</span> <span class="p">(</span><span class="ss">:msecs</span> <span class="nv">data</span><span class="p">)]]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Executing&quot;</span> <span class="nv">label</span> <span class="s">&quot;took:&quot;</span> <span class="p">(</span><span class="nf">msec-str</span> <span class="nv">msecs</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">reset!</span> <span class="nv">aggregates</span> <span class="p">{}))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>record-aggregate</code> takes a label and code and times how long that code takes to run. If the executed code returns an unrealized lazy sequence, it also evaluates the sequence<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>Below is an example of using the above code. When we used it, we looked at the code path we needed to optimize and wrapped chunks of it in <code>record-aggregate</code>. At the end of the calculations, we inserted a call to <code>log-times</code> so timing data would show up in our logs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">work</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">metrics</span> <span class="ss">:as</span> <span class="nv">m</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">calculation</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">m/record-aggregate</span> <span class="ss">::calculation</span>
</span><span class='line'>                      <span class="p">(</span><span class="nf">Thread/sleep</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">300</span> <span class="p">(</span><span class="nb">rand-int </span><span class="mi">60</span><span class="p">)))</span>
</span><span class='line'>                      <span class="nv">x</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">work</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">m/record-aggregate</span> <span class="ss">::work</span>
</span><span class='line'>                      <span class="p">(</span><span class="nf">repeatedly</span> <span class="mi">10</span> <span class="p">(</span><span class="k">fn </span><span class="p">[]</span>
</span><span class='line'>                                       <span class="p">(</span><span class="nf">Thread/sleep</span> <span class="mi">5</span><span class="p">)</span>
</span><span class='line'>                                       <span class="nv">x</span><span class="p">))))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">process-rows</span> <span class="p">[</span><span class="nv">rows</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">rows</span> <span class="p">(</span><span class="nf">m/record-aggregate</span> <span class="ss">::process-rows</span>
</span><span class='line'>                                 <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="nv">rows</span>
</span><span class='line'>                                      <span class="p">(</span><span class="nf">mapv</span> <span class="nv">calculation</span><span class="p">)</span>
</span><span class='line'>                                      <span class="p">(</span><span class="nb">mapcat </span><span class="nv">work</span><span class="p">)))]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">m/log-times</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">rows</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, when <code>(process-rows [:a :a])</code> is called output similar to below is printed.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="nv">Executing</span> <span class="ss">:work/process-rows</span> <span class="nv">took</span><span class="err">:</span> <span class="mf">780.9</span> <span class="nv">msecs</span>
</span><span class='line'><span class="nv">Executing</span> <span class="ss">:work/calculation</span> <span class="nv">took</span><span class="err">:</span> <span class="mf">664.6</span> <span class="nv">msecs</span>
</span><span class='line'><span class="nv">Executing</span> <span class="ss">:work/work</span> <span class="nv">took</span><span class="err">:</span> <span class="mf">115.8</span> <span class="nv">msecs</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using this technique, we were able to identify slow parts of our process and were able to optimize those chunks of our code. There are potential flaws with measuring time like this, but they were not a problem in our situation<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
See <a href="/blog/2016/12/31/measure-what-you-intended-to-measure/">Measure what you intend to measure</a><a href="#fnref:1" rev="footnote">&#8617;</a></li>
<li id="fn:2">
See <a href="https://shipilev.net/blog/2014/nanotrusting-nanotime/">Nanotrusting the Nanotime</a><a href="#fnref:2" rev="footnote">&#8617;</a></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/08/27/my-current-leiningen-profiles-dot-clj/">My current Leiningen profiles.clj</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-08-27T19:06:00-05:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>7:06 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Nearly three years ago I wrote an overview of my <a href="/blog/2015/01/11/overview-of-my-leiningen-profiles-dot-clj/">Leiningen profiles.clj</a>. That post is one of my most visited articles, so I thought I&rsquo;d give an update on what I currently keep in <code>~/.lein/profiles.clj</code>.</p>

<figure class='code'><figcaption><span>profiles.clj</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">{</span><span class="ss">:user</span> <span class="p">{</span><span class="ss">:plugin-repositories</span> <span class="p">[[</span><span class="s">&quot;private-plugins&quot;</span> <span class="p">{</span><span class="ss">:url</span> <span class="s">&quot;private url&quot;</span><span class="p">}]]</span>
</span><span class='line'>        <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">pjstadig/humane-test-output</span> <span class="s">&quot;0.8.2&quot;</span><span class="p">]]</span>
</span><span class='line'>        <span class="ss">:injections</span> <span class="p">[(</span><span class="nf">require</span> <span class="ss">&#39;pjstadig.humane-test-output</span><span class="p">)</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">pjstadig.humane-test-output/activate!</span><span class="p">)]</span>
</span><span class='line'>        <span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">io.sattvik/lein-ancient</span> <span class="s">&quot;0.6.11&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">lein-pprint</span> <span class="s">&quot;1.1.2&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">com.jakemccrary/lein-test-refresh</span> <span class="s">&quot;0.21.1&quot;</span><span class="p">]</span>
</span><span class='line'>                  <span class="p">[</span><span class="nv">lein-autoexpect</span> <span class="s">&quot;1.9.0&quot;</span><span class="p">]]</span>
</span><span class='line'>        <span class="ss">:signing</span> <span class="p">{</span><span class="ss">:gpg-key</span> <span class="s">&quot;B38C2F8C&quot;</span><span class="p">}</span>
</span><span class='line'>        <span class="ss">:test-refresh</span> <span class="p">{</span><span class="ss">:notify-command</span> <span class="p">[</span><span class="s">&quot;terminal-notifier&quot;</span> <span class="s">&quot;-title&quot;</span> <span class="s">&quot;Tests&quot;</span> <span class="s">&quot;-message&quot;</span><span class="p">]</span>
</span><span class='line'>                       <span class="ss">:quiet</span> <span class="nv">true</span>
</span><span class='line'>                       <span class="ss">:changes-only</span> <span class="nv">true</span><span class="p">}}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The biggest difference between my <code>profiles.clj</code> from early 2015 and now is that I&rsquo;ve removed all of the CIDER related plugins. I still use CIDER, but CIDER no longer requires you to list its dependencies explicitly.</p>

<p>Ive also removed Eastwood and Kibit from my toolchain. I love static analysis, but these tools fail too frequently with my projects. As a result, I rarely used them and Ive removed them. Instead, Ive started using <a href="https://github.com/candid82/joker">joker</a> for some basic static analysis and am really enjoying it. It is fast, and it has made refactoring in Emacs noticeably better.</p>

<p><a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a>, <a href="https://github.com/clojure-expectations/lein-autoexpect">lein-autoexpect</a>, and <a href="https://github.com/pjstadig/humane-test-output">humane-test-output</a> have stuck around and have been updated to the latest versions. These tools make testing Clojure much nicer.</p>

<p>I&rsquo;m also taking advantage of some new features that <a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> provides. These settings enable the most reliable, fastest feedback possible while writing tests. My <a href="/blog/2016/06/20/my-recommended-clojure-testing-setup/">recommended testing setup</a> article goes into more details.</p>

<p><code>lein-ancient</code> and <code>lein-pprint</code> have stuck around. I rarely use <code>lein-pprint</code> but it comes in handy when debugging project.clj problems. <code>lein-ancient</code> is great for helping you keep your project&rsquo;s dependencies up to date. I use a forked version that contains some changes I need to work with my company&rsquo;s private repository.</p>

<p>And there you have it. My updated profiles.clj<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
Some of you might wonder why I don&rsquo;t just link to this file in version control somewhere? Well, it is kept encrypted in a git repository because it also contains some secrets that should not be public that I&rsquo;ve removed for this post.<a href="#fnref:1" rev="footnote">&#8617;</a></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/07/28/using-my-phones-voice-control-for-a-month/">Using my phone's voice control for a month</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-07-28T09:06:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>9:06 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>From May 6th to June 2nd the screen of my phone had a crack. I have an Android phone, and the crack was through the software buttons at the bottom of the screen. As a result, I could not touch the back, home, or overview (app switching) buttons. For nearly a month I never saw my home screen, couldn&rsquo;t go back, or switch apps through touching my phone. I was very reliant on arriving notifications giving me an opportunity to open apps.</p>

<p>It took me some time, but I realized I could use voice commands to replace some of the missing functionality. Using voice commands, I could open apps and no longer be at the whim of notifications.</p>

<p>Here is an example of my phone usage during this month. My thoughts are in [brackets]. <em>Italics</em> indicate actions. Talking is wrapped in  .</p>

<ol>
<li>[Alright, I want to open Instagram] &ldquo;Ok Google, open Instagram.&rdquo;</li>
<li>[Sweet, it worked] <em>scrolls through feed</em></li>
<li><em>WhatsApp notification happens</em> [Great, a notification, I can click it to open WhatsApp]</li>
<li><em>I read messages in WhatsApp.</em></li>
<li>[Time to go back to Instagram] &ldquo;Ok Google, open Instagram&rdquo;</li>
<li>[sigh, voice command failed, lets try again] &ldquo;Ok Google, open Instagram&rdquo;</li>
<li><em>Instagram opens</em> [Great, time to scroll through more pictures]</li>
</ol>


<p>As you can see, it is a bit more painful than clicking buttons to switch between different apps. Voice commands fail sometimes and, at least for me, generally take more effort than tapping the screen. Thats ok though; I was determined to embrace voice commands and experience what a future of only voice commands might feel like.</p>

<p>Below are some observations from using my voice to control my phone for a month.</p>

<h3>It is awkward in public</h3>

<p>My phone usage in public went way down. There was something about having to talk to your phone to open an app that made me not want to pull out my phone.</p>

<p>It is much more obvious you are using your phone when you use your voice to control it. It makes casual glances at your phone while hanging out with a group impossible. You cant sneak a quick look at Instagram when you need to say Ok Google, open Instagram without completely letting everyone around you know you are no longer paying attention.</p>

<p>This also stopped me from using my phone in Ubers/Lyfts/cabs. I often talk to the driver or other passengers anyway, but this cemented that. I realize it is completely normal to ignore the other people in a car but I felt like a (small) asshole audibly calling out that I&rsquo;m ignoring other people in the car.</p>

<h3>You become more conscious of what apps you use</h3>

<p>When you have to say Okay Google, open Instagram every time you want to open Instagram, you become way more aware of how often you use Instagram. Using your voice instead of tapping a button on your screen is a much bigger hurdle between having the urge to open something and actually opening it. It gives you more time to observe what you are doing.</p>

<h3>You become more conscious of using your phone</h3>

<p>Using your phone becomes a lot harder. This increased difficulty helped highlight when I was using my phone. My phones functionality dropped drastically and, as a result, I stopped reaching for it as much.</p>

<p>This reminded me of when I used a dumb (feature) phone for a couple of months a few years ago. Using a non-smartphone after using a smartphone for years was weird. It helped me reign in my usage<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<h3>Voice control can be pretty convenient</h3>

<p>Even after repairing my screen, I still find myself using some voice commands. While making my morning coffee, I often ask my phone for the weather forecast. This is more convenient than opening an app and it lets me continue to use both hands while making coffee.</p>

<p>Setting alarms, starting countdown timers, adding reminders, and checking the weather are all things I do through voice commands now.</p>

<h3>I wish it worked all the time</h3>

<p>I suppose this is an argument for getting a <a href="https://store.google.com/us/product/google_home?hl=en-US">Google Home</a> or <a href="http://amzn.to/2vctz9A">Amazon Echo</a>. I have to wake up my phone to use voice commands with it. This limits the usefulness of voice commands since I need be within reach of my phone.</p>

<h3>I wish it could do more</h3>

<p>At some point, I got used to asking my phone to do things. Then I started giving it more complicated commands, and it would fail. I found myself giving it multi-stage commands such as Ok Google, turn on Bluetooth and play my playlist Chill on Spotify. That doesn&rsquo;t work but it would be amazing if it did.</p>

<h2>Recommendations</h2>

<p>I recommend that you force yourself to use voice commands for some period of time. Pretend your home button is broken and you have to use voice control to move around your phone. Youll become more aware of your phone usage and you&rsquo;ll learn some useful voice commands that will make your technology usage nicer.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
My non-smartphone experiment four years ago is what resulted in me no longer using Facebook or Twitter on my phone. It also is the reason I silenced most notifications, including email, on my phone.<a href="#fnref:1" rev="footnote">&#8617;</a></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/06/30/speeding-up-site-by-optionally-loading-disqus-comments/">Speeding up this site by optionally loading Disqus comments</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-06-30T19:37:00-05:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>7:37 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier this month I took another look at what was required for reading an article on this site. What <a href="/blog/2016/04/30/speeding-up-my-blog/">else</a> could I do to make this site load faster?</p>

<p>To do this, I loaded up <a href="http://webpagetest.org/">WebPageTest</a> and pointed it towards one of my <a href="/blog/2017/05/30/adding-a-json-feed-to-octopress-slash-jekyll/">posts</a>. To my shock, it took 113 requests for a total of 721 KB to load a single post. This took WebPageTest 6.491 seconds. The document complete event triggered after 15 requests (103 KB, 1.6 seconds).</p>

<p>113 requests to load a static article was ridiculous. Most of those requests happened as a result of loading the Disqus javascript. I find comments valuable and want to continue including them on my site. Because of this, I couldn&rsquo;t remove Disqus. Instead, I made loading Disqus optional.</p>

<p>After making the required changes, it only takes 11 requests for 61 KB of data to fully load the test post. The document complete event only required 8 requests for 51 KB of data. Optionally loading the Disqus javascript resulted in a massive reduction of data transferred.</p>

<p>How did I do it? The template that generates my articles now only inserts the Disqus javascript when a reader clicks a button. My <a href="https://github.com/jakemcc/jakemccrary.com/blob/74f4232ce7263ba3de48497d0c0d10a8fa1a73f9/source/_includes/disqus.html">final template</a> is at the bottom of this post.</p>

<p>The template adds an <code>insertDisqus</code> function that inserts a <code>&lt;script&gt;</code> element when a reader clicks a button. This element contains the original JavaScript that loads Disqus. When the <code>&lt;script&gt;</code> element is inserted into the page, the Disqus javascript is loaded and the comments appear.</p>

<p>My exact template might not work for you, but I&rsquo;d encourage you to think about optionally loading Disqus and other non-required JavaScript. Your readers will thank you.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>{% if site.disqus_short_name and page.comments == true %}
</span><span class='line'>  <span class="nt">&lt;noscript&gt;</span>Please enable JavaScript to view the <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://disqus.com/?ref_noscript&quot;</span><span class="nt">&gt;</span>comments powered by Disqus.<span class="nt">&lt;/a&gt;&lt;/noscript&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;disqus_target&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;script&gt;</span>
</span><span class='line'>     <span class="kd">var</span> <span class="nx">insertDisqus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>       <span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
</span><span class='line'>       <span class="nx">elem</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span>  <span class="s2">&quot;var disqus_shortname = &#39;{{ site.disqus_short_name }}&#39;; var disqus_identifier = &#39;{{ site.url }}{{ page.url }}&#39;; var disqus_url = &#39;{{ site.url }}{{ page.url }}&#39;; (function () {var dsq = document.createElement(&#39;script&#39;); dsq.type = &#39;text/javascript&#39;; dsq.async = true; dsq.src = &#39;//&#39; + disqus_shortname + &#39;.disqus.com/embed.js&#39;; (document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(dsq);}());&quot;</span>
</span><span class='line'>       <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;disqus_target&#39;</span><span class="p">);</span>
</span><span class='line'>       <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">target</span><span class="p">);</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;comment-button&quot;</span> <span class="na">onclick=</span><span class="s">&quot;insertDisqus()&quot;</span><span class="nt">&gt;&lt;span&gt;</span>ENABLE COMMENTS AND RECOMMENDED ARTICLES<span class="nt">&lt;/span&gt;&lt;/button&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>{% endif %}
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/30/adding-a-json-feed-to-octopress-slash-jekyll/">Adding a JSON Feed to an Octopress/Jekyll generated site</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-05-30T22:31:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:31 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I went to a coffee shop this last weekend with the intention of writing up a <a href="/blog/2017/05/29/using-comm-to-verify-matching-content/">quick article</a> on <code>comm</code>. I sat down, sipping my coffee, and wasnt motivated. I didnt feel like knocking out a short post, and I didnt feel like editing a draft Ive been sitting on for a while. I wanted to do some work though, so I decided to add a <a href="https://jsonfeed.org/">JSON Feed</a> to this site.</p>

<p>JSON Feed is an alternative to <a href="https://tools.ietf.org/html/rfc4287">Atom</a> and <a href="http://cyber.harvard.edu/rss/rss.html">RSS</a> that uses JSON instead of XML. I figured I could add support for it in less than the time it would take to enjoy my coffee and maybe some readers would find it useful. Id be shocked if anyone actually finds this useful, but it was a fun little exercise anyway.</p>

<p>An old version of Octopress (2.something), which uses an old version of Jekyll (2.5.3), generates this site. Despite this, I dont think the template would need to change much if I moved to a new version. The template below is saved as <a href="https://github.com/jakemcc/jakemccrary.com/blob/master/source/feed.json">source/feed.json</a> in my git repository.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">---</span>
</span><span class='line'><span class="nx">layout</span><span class="o">:</span> <span class="kc">null</span>
</span><span class='line'><span class="o">---</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;https://jsonfeed.org/version/1&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">site</span><span class="p">.</span><span class="nx">title</span> <span class="o">|</span> <span class="nx">jsonify</span> <span class="p">}},</span>
</span><span class='line'>  <span class="s2">&quot;home_page_url&quot;</span><span class="o">:</span> <span class="s2">&quot;{{ site.url }}&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;feed_url&quot;</span><span class="o">:</span> <span class="s2">&quot;{{site.url}}/feed.json&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;favicon&quot;</span><span class="o">:</span> <span class="s2">&quot;{{ site.url }}/favicon.png&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;url&quot;</span> <span class="o">:</span> <span class="s2">&quot;https://twitter.com/jakemcc&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;{{ site.author | strip_html }}&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;user_comment&quot;</span><span class="o">:</span> <span class="s2">&quot;This feed allows you to read the posts from this site in any feed reader that supports the JSON Feed format. To add this feed to your reader, copy the following URL - {{ site.url }}/feed.json - and add it your reader.&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;items&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">post</span> <span class="k">in</span> <span class="nx">site</span><span class="p">.</span><span class="nx">posts</span> <span class="nx">limit</span><span class="o">:</span> <span class="mi">20</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;{{ site.url }}{{ post.id }}&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;{{ site.url }}{{ post.url }}&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;date_published&quot;</span><span class="o">:</span> <span class="s2">&quot;{{ post.date | date_to_xmlschema }}&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">site</span><span class="p">.</span><span class="nx">titlecase</span> <span class="o">%</span><span class="p">}{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">title</span> <span class="o">|</span> <span class="nx">titlecase</span> <span class="o">|</span> <span class="nx">jsonify</span> <span class="p">}}{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">title</span> <span class="o">|</span> <span class="nx">jsonify</span> <span class="p">}}{</span><span class="o">%</span> <span class="nx">endif</span> <span class="o">%</span><span class="p">},</span>
</span><span class='line'>      <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">post</span><span class="p">.</span><span class="nx">description</span> <span class="o">%</span><span class="p">}</span><span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">description</span> <span class="o">|</span> <span class="nx">jsonify</span> <span class="p">}},{</span><span class="o">%</span> <span class="nx">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>      <span class="s2">&quot;content_html&quot;</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">post</span><span class="p">.</span><span class="nx">content</span> <span class="o">|</span> <span class="nx">expand_urls</span><span class="o">:</span> <span class="nx">site</span><span class="p">.</span><span class="nx">url</span> <span class="o">|</span> <span class="nx">jsonify</span> <span class="p">}},</span>
</span><span class='line'>      <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;{{ site.author | strip_html }}&quot;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">forloop</span><span class="p">.</span><span class="nx">last</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">%</span><span class="p">},{</span><span class="o">%</span> <span class="nx">endif</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>    <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I approached this problem by reading the <a href="https://jsonfeed.org/version/1">JSON Feed Version 1 spec</a> and cribbing values from the template for my Atom feed. The trickiest part was filling in the <code>"content_html"</code> value. It took me a while to find figure out that <code>jsonify</code> needed to be at the end of <code>{{ post.content | expand_urls: site.url | jsonify }}</code>. That translates the post&rsquo;s HTML content into its JSON representation. Youll notice that any template expression with <code>jsonify</code> at the end also isnt wrapped in quotes. This is because <code>jsonify</code> is doing that for me.</p>

<p>The <code>{% if forloop.last == false %},{% endif %}</code> is also important. Without this, the generated JSON has an extra <code>,</code> after the final element in items. This isnt valid JSON.</p>

<p>I caught that by using the command line tool <a href="http://trentm.com/json/">json</a>. If you ever edit JSON by hand or generate it from a template then you should add this tool to your toolbox. It will prevent you from creating invalid JSON.</p>

<p>How did I use it? Id make a change in the <code>feed.json</code> template and generate an output file. Then Id <code>cat</code> that file to <code>json --validate</code>. When there was an error, Id see a message like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">0 [last: 5s] 12:43:47 ~/src/jakemcc/blog (master *)</span>
</span><span class='line'><span class="gp">$</span> cat public/feed.json <span class="p">|</span> json --validate
</span><span class='line'><span class="go">json: error: input is not JSON: Expected &#39;,&#39; instead of &#39;{&#39; at line 25, column 5:</span>
</span><span class='line'><span class="go">            {</span>
</span><span class='line'><span class="go">        ....^</span>
</span><span class='line'><span class="go">1 [last: 0s] 12:43:49 ~/src/jakemcc/blog (master *)</span>
</span><span class='line'><span class="gp">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>And there would be zero output on success.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">0 [last: 5s] 12:45:25 ~/src/jakemcc/blog (master)</span>
</span><span class='line'><span class="gp">$</span> cat public/feed.json <span class="p">|</span> json --validate
</span><span class='line'><span class="go">0 [last: 0s] 12:45:30 ~/src/jakemcc/blog (master)</span>
</span><span class='line'><span class="gp">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>It was pretty straightforward to add a JSON Feed. Was it a good use of my time? <code>\_()_/</code>. In the process of adding the feed I learned more about Liquid templating and figured out how to embed liquid tags into a blog post. Even adding redundant features can be a useful exercise.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/29/using-comm-to-verify-matching-content/">Using comm to verify file content matches</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-05-29T10:45:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:45 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I recently found myself in a situation where I needed to confirm that a process took in a tab separated file, did some processing, and then output a new file containing the original columns with some additional ones. The feature I was adding allowed the process to die and restart while processing the input file and pick up where it left off.</p>

<p>I needed to confirm the output had data for every line in the input. I reached to the command line tool <code>comm</code>.</p>

<p>Below is a made up input file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UNIQUE_ID    USER
</span><span class='line'>1 38101838
</span><span class='line'>2 19183819
</span><span class='line'>3 19123811
</span><span class='line'>4 10348018
</span><span class='line'>5 19881911
</span><span class='line'>6 29182918</span></code></pre></td></tr></table></div></figure>


<p>And here is some made up output.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UNIQUE_ID    USER    MESSAGE
</span><span class='line'>1 38101838    A01
</span><span class='line'>2 19183819    A05
</span><span class='line'>3 19123811    A02
</span><span class='line'>4 10348018    A01
</span><span class='line'>5 19881911    A02
</span><span class='line'>6 29182918    A05</span></code></pre></td></tr></table></div></figure>


<p>With files this size, it would be easy enough to check visually. In my testing, I was dealing with files that had thousands of lines. This is too many to check by hand. It is a perfect amount for <code>comm</code>.</p>

<p><a href="https://en.wikipedia.org/wiki/Comm">comm</a> reads two files as input and then outputs three columns. The first column contains lines found only in the first file, the second column contains lines only found in the second, and the last column contains lines in both. If it is easier for you to think about it as set operations, the first two columns are similar to performing two set differences and the third is similar to set intersection. Below is an example adapted from Wikipedia showing its behavior.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat foo.txt
</span><span class='line'>apple
</span><span class='line'>banana
</span><span class='line'>eggplant
</span><span class='line'>$ cat bar.txt
</span><span class='line'>apple
</span><span class='line'>banana
</span><span class='line'>banana
</span><span class='line'>zucchini
</span><span class='line'>$ comm foo.txt bar.txt
</span><span class='line'>                  apple
</span><span class='line'>                  banana
</span><span class='line'>          banana
</span><span class='line'>eggplant
</span><span class='line'>          zucchini</span></code></pre></td></tr></table></div></figure>


<p>So how is this useful? Well, you can also tell <code>comm</code> to suppress outputting specific columns.  If we send the common columns from the input and output file to <code>comm</code> and suppress <code>comm</code>&rsquo;s third column then anything printed to the screen is a problem. Anything printed to the screen was found in one of the files and not the other. We&rsquo;ll select the common columns using cut and, since comm expects input to be sorted, then sort using <code>sort</code>. Let&rsquo;s see what happens.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ comm -3 &lt;(cut -f 1,2 input.txt | sort) &lt;(cut -f 1,2 output.txt | sort)
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Success! Nothing was printed to the console, so there is nothing unique in either file.</p>

<p><code>comm</code> is a useful tool to have in your command line toolbox.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/05/15/send-a-push-notification-when-your-external-ip-address-changes/">Send a push notification when your external IP address changes</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-05-15T22:15:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:15 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I need to know when my external IP address changes. Whenever it changes, I need to update an IP whitelist and need to re-login to a few sites. I sometimes don&rsquo;t notice for a couple of days and, during that time, some automatic processes fail.</p>

<p>After the last time this happened, I whipped up a script that sends me a push notification when my IP address changes.</p>

<p>The script uses <a href="https://pushover.net/">Pushover</a> to send the push notification. Pushover is great. I have used it for years to get notifications from my headless computers. If you use the below script, replace <code>${PUSHOVER_TOKEN}</code> and <code>${PUSHOVER_USER}</code> with your own details.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="nb">set</span> -e
</span><span class='line'>
</span><span class='line'><span class="nv">previous_file</span><span class="o">=</span><span class="s2">&quot;${HOME}/.previous-external-ip&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> ! -e <span class="s2">&quot;${previous_file}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    dig +short myip.opendns.com @resolver1.opendns.com &gt; <span class="s2">&quot;${previous_file}&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nv">current_ip</span><span class="o">=</span><span class="k">$(</span>dig +short myip.opendns.com @resolver1.opendns.com<span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">previous_ip</span><span class="o">=</span><span class="k">$(</span>cat <span class="s2">&quot;${previous_file}&quot;</span><span class="k">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;${current_ip}&quot;</span> !<span class="o">=</span> <span class="s2">&quot;${previous_ip}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;external ip changed&quot;</span>
</span><span class='line'>    curl -s --form-string <span class="s2">&quot;token=${PUSHOVER_TOKEN}&quot;</span> <span class="se">\</span>
</span><span class='line'>         --form-string <span class="s2">&quot;user=${PUSHOVER_USER}&quot;</span> <span class="se">\</span>
</span><span class='line'>         --form-string <span class="s2">&quot;title=External IP address changed&quot;</span> <span class="se">\</span>
</span><span class='line'>         --form-string <span class="s2">&quot;message=&#39;${previous_ip}&#39; =&gt; &#39;${current_ip}&#39;&quot;</span> <span class="se">\</span>
</span><span class='line'>         https://api.pushover.net/1/messages.json
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;${current_ip}&quot;</span> &gt; <span class="s2">&quot;${previous_file}&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/04/17/what-are-the-most-used-clojure-libraries/">What are the most used Clojure libraries?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-04-17T10:07:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:07 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>In
a
<a href="/blog/2017/03/31/what-clojure-testing-library-is-most-used/">previous post</a>,
we used Google&rsquo;s BigQuery and the
public
<a href="https://cloud.google.com/bigquery/public-data/github">GitHub dataset</a>
to discover the most used Clojure testing library. The answer wasn&rsquo;t
surprising. The built-in <code>clojure.test</code> was by far the most used.</p>

<p>Let&rsquo;s use the dataset to answer a less obvious question, what are the
most used libraries in Clojure projects? We&rsquo;ll measure this by
counting references to libraries in <code>project.clj</code> and <code>build.boot</code>
files.</p>

<p>Before we can answer that question, we&rsquo;ll need to transform the
data. First, we create the Clojure subset of the GitHub dataset. I did
this by executing the following queries and saving the results to
tables<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="c1">-- Save the results of this query to the clojure.files table</span>
</span><span class='line'><span class="k">SELECT</span>
</span><span class='line'>  <span class="o">*</span>
</span><span class='line'><span class="k">FROM</span>
</span><span class='line'>  <span class="p">[</span><span class="n">bigquery</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="k">data</span><span class="p">:</span><span class="n">github_repos</span><span class="p">.</span><span class="n">files</span><span class="p">]</span>
</span><span class='line'><span class="k">WHERE</span>
</span><span class='line'>  <span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;.clj&#39;</span>
</span><span class='line'>  <span class="k">OR</span> <span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;.cljc&#39;</span>
</span><span class='line'>  <span class="k">OR</span> <span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;.cljs&#39;</span>
</span><span class='line'>  <span class="k">OR</span> <span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;boot.build&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">-- Save the results to clojure.contents</span>
</span><span class='line'><span class="k">SELECT</span> <span class="o">*</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">[</span><span class="n">bigquery</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="k">data</span><span class="p">:</span><span class="n">github_repos</span><span class="p">.</span><span class="n">contents</span><span class="p">]</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">clojure</span><span class="p">.</span><span class="n">files</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we extract the dependencies from <code>build.boot</code> and <code>project.clj</code>
files. Fortunately for us, both of these files specify dependencies in
the same format, so we&rsquo;re able to use the same regular expression on both types.</p>

<p>The query below identifies <code>project.clj</code> and <code>build.boot</code> files,
splits each file into lines, and extracts referenced library names and
versions using a regular expression. Additional filtering is done get
rid of some spurious results.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span>
</span><span class='line'>  <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">r</span><span class="s1">&#39;\[+(\S+)\s+&quot;\S+&quot;]&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="n">library</span><span class="p">,</span>
</span><span class='line'>  <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">r</span><span class="s1">&#39;\[+\S+\s+&quot;(\S+)&quot;]&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="k">version</span><span class="p">,</span>
</span><span class='line'>  <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="k">count</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">(</span>
</span><span class='line'>  <span class="k">SELECT</span>
</span><span class='line'>    <span class="n">SPLIT</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="n">line</span>
</span><span class='line'>  <span class="k">FROM</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clojure</span><span class="p">.</span><span class="n">contents</span><span class="p">]</span>
</span><span class='line'>  <span class="k">WHERE</span>
</span><span class='line'>    <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span>
</span><span class='line'>    <span class="k">SELECT</span>
</span><span class='line'>      <span class="n">id</span>
</span><span class='line'>    <span class="k">FROM</span>
</span><span class='line'>      <span class="p">[</span><span class="n">clojure</span><span class="p">.</span><span class="n">files</span><span class="p">]</span>
</span><span class='line'>    <span class="k">WHERE</span>
</span><span class='line'>      <span class="n">path</span> <span class="k">LIKE</span> <span class="s1">&#39;%project.clj&#39;</span>
</span><span class='line'>      <span class="k">OR</span> <span class="n">path</span> <span class="k">LIKE</span> <span class="s1">&#39;%build.boot&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">HAVING</span> <span class="n">line</span> <span class="k">contains</span> <span class="s1">&#39;[&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span>
</span><span class='line'>  <span class="n">library</span><span class="p">,</span> <span class="k">version</span>
</span><span class='line'><span class="k">HAVING</span> <span class="n">library</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span> <span class="k">and</span> <span class="k">not</span> <span class="n">library</span> <span class="k">contains</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span>
</span><span class='line'>  <span class="k">count</span> <span class="k">DESC</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first five rows from the result are below. Let&rsquo;s save the entire
result to a <code>clojure.libraries</code> table.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">|</span> <span class="n">library</span>             <span class="o">|</span> <span class="k">version</span> <span class="o">|</span> <span class="k">count</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span><span class="c1">---------------------+---------+-------|</span>
</span><span class='line'><span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span> <span class="o">|</span> <span class="mi">1</span><span class="p">.</span><span class="mi">6</span><span class="p">.</span><span class="mi">0</span>   <span class="o">|</span> <span class="mi">7015</span>  <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span> <span class="o">|</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">1</span>   <span class="o">|</span> <span class="mi">4251</span>  <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span> <span class="o">|</span> <span class="mi">1</span><span class="p">.</span><span class="mi">7</span><span class="p">.</span><span class="mi">0</span>   <span class="o">|</span> <span class="mi">4093</span>  <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span> <span class="o">|</span> <span class="mi">1</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span>   <span class="o">|</span> <span class="mi">3016</span>  <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">hiccup</span>              <span class="o">|</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span>   <span class="o">|</span> <span class="mi">1280</span>  <span class="o">|</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can start answering all sorts of interesting questions.</p>

<p>What is the most referenced library put out under the <code>org.clojure</code> group?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="n">library</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">count</span>
</span><span class='line'><span class="k">FROM</span> <span class="n">clojure</span><span class="p">.</span><span class="n">libraries</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">library</span> <span class="k">CONTAINS</span> <span class="s1">&#39;org.clojure&#39;</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span> <span class="n">library</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span> <span class="k">desc</span>
</span><span class='line'>
</span><span class='line'><span class="o">|</span> <span class="k">Row</span> <span class="o">|</span> <span class="n">library</span>                        <span class="o">|</span> <span class="k">count</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span><span class="c1">-----+--------------------------------+-------|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span>            <span class="o">|</span> <span class="mi">20834</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojurescript</span>      <span class="o">|</span>  <span class="mi">3080</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="n">async</span>         <span class="o">|</span>  <span class="mi">2612</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">logging</span>      <span class="o">|</span>  <span class="mi">1579</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span>          <span class="o">|</span>  <span class="mi">1546</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">nrepl</span>        <span class="o">|</span>  <span class="mi">1244</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">jdbc</span>          <span class="o">|</span>  <span class="mi">1064</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">cli</span>          <span class="o">|</span>  <span class="mi">1053</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">9</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">namespace</span>    <span class="o">|</span>   <span class="mi">982</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">10</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="k">check</span>         <span class="o">|</span>   <span class="mi">603</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">11</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="k">match</span>         <span class="o">|</span>   <span class="mi">578</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">12</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">math</span><span class="p">.</span><span class="nb">numeric</span><span class="o">-</span><span class="n">tower</span> <span class="o">|</span>   <span class="mi">503</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">13</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">csv</span>           <span class="o">|</span>   <span class="mi">381</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">14</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">math</span><span class="p">.</span><span class="n">combinatorics</span> <span class="o">|</span>   <span class="mi">372</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">15</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">reader</span>       <span class="o">|</span>   <span class="mi">368</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">16</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span><span class="o">-</span><span class="n">contrib</span>    <span class="o">|</span>   <span class="mi">335</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">17</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">xml</span>           <span class="o">|</span>   <span class="mi">289</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">18</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">trace</span>        <span class="o">|</span>   <span class="mi">236</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">classpath</span>     <span class="o">|</span>   <span class="mi">199</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">20</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="k">cache</span>         <span class="o">|</span>   <span class="mi">179</span> <span class="o">|</span>
</span></code></pre></td></tr></table></div></figure>


<p>Clojure and ClojureScript are at the top, which isn&rsquo;t surprising. I&rsquo;m
surprised to see <code>tools.nrepl</code> in the next five results (rows 3-7). It
is the only library out of the top that I haven&rsquo;t used.</p>

<p>What testing library is used the most? We already answered this in
my
<a href="/blog/2017/03/31/what-clojure-testing-library-is-most-used/">last article</a> but
let&rsquo;s see if we get the same answer when we&rsquo;re counting how many times
a library is pulled into a project.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="n">library</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">count</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">[</span><span class="n">clojure</span><span class="p">.</span><span class="n">libraries</span><span class="p">]</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">library</span> <span class="k">in</span> <span class="p">(</span><span class="s1">&#39;midje&#39;</span><span class="p">,</span> <span class="s1">&#39;expectations&#39;</span><span class="p">,</span> <span class="s1">&#39;speclj&#39;</span><span class="p">,</span> <span class="s1">&#39;smidjen&#39;</span><span class="p">,</span> <span class="s1">&#39;fudje&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span> <span class="n">library</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span> <span class="k">desc</span>
</span><span class='line'>
</span><span class='line'><span class="o">|</span> <span class="k">Row</span> <span class="o">|</span> <span class="n">library</span>                <span class="o">|</span> <span class="k">count</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span><span class="c1">-----+------------------------+-------|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span> <span class="n">midje</span>                  <span class="o">|</span>  <span class="mi">1122</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span> <span class="n">speclj</span>                 <span class="o">|</span>   <span class="mi">336</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span> <span class="n">expectations</span>           <span class="o">|</span>   <span class="mi">235</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span> <span class="n">smidjen</span>                <span class="o">|</span>     <span class="mi">1</span> <span class="o">|</span>
</span></code></pre></td></tr></table></div></figure>


<p>Those results are close to the previous results. Of the non-clojure.test libraries, midje still ends up on top.</p>

<p>What groups (as identified by the Maven groupId) have their libraries referenced the most? Top 12 are below but the <a href="https://docs.google.com/a/jakemccrary.com/spreadsheets/d/1QGRRGSo5t5Pnpwizdv_H8negs8NBxtRour6KxWN6hVY/edit?usp=sharing">full result</a> is available.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">library</span><span class="p">,</span> <span class="n">r</span><span class="s1">&#39;(\S+)/\S+&#39;</span><span class="p">)</span> <span class="k">AS</span> <span class="k">group</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">AS</span> <span class="k">count</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">[</span><span class="n">clojure</span><span class="p">.</span><span class="n">libraries</span><span class="p">]</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span> <span class="k">group</span>
</span><span class='line'><span class="k">HAVING</span> <span class="k">group</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">null</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span> <span class="k">DESC</span>
</span><span class='line'>
</span><span class='line'><span class="o">|</span> <span class="k">Row</span> <span class="o">|</span> <span class="k">group</span>                 <span class="o">|</span> <span class="k">count</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span><span class="c1">-----+-----------------------+-------|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span>           <span class="o">|</span> <span class="mi">39611</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span> <span class="n">ring</span>                  <span class="o">|</span>  <span class="mi">5817</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span> <span class="n">com</span><span class="p">.</span><span class="n">cemerick</span>          <span class="o">|</span>  <span class="mi">2053</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span> <span class="n">com</span><span class="p">.</span><span class="n">taoensso</span>          <span class="o">|</span>  <span class="mi">1605</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span> <span class="n">prismatic</span>             <span class="o">|</span>  <span class="mi">1398</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">slf4j</span>             <span class="o">|</span>  <span class="mi">1209</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span> <span class="n">cljsjs</span>                <span class="o">|</span>   <span class="mi">868</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span> <span class="n">javax</span><span class="p">.</span><span class="n">servlet</span>         <span class="o">|</span>   <span class="mi">786</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">9</span> <span class="o">|</span> <span class="n">com</span><span class="p">.</span><span class="n">stuartsierra</span>      <span class="o">|</span>   <span class="mi">642</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">10</span> <span class="o">|</span> <span class="n">com</span><span class="p">.</span><span class="n">badlogicgames</span><span class="p">.</span><span class="n">gdx</span> <span class="o">|</span>   <span class="mi">586</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">11</span> <span class="o">|</span> <span class="n">cider</span>                 <span class="o">|</span>   <span class="mi">560</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">12</span> <span class="o">|</span> <span class="n">pjstadig</span>              <span class="o">|</span>   <span class="mi">536</span> <span class="o">|</span>
</span></code></pre></td></tr></table></div></figure>


<p>And finally, the question that inspired this article, what is the most used library?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="n">library</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="k">count</span><span class="p">)</span> <span class="k">count</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">[</span><span class="n">clojure</span><span class="p">.</span><span class="n">libraries</span><span class="p">]</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">library</span> <span class="o">!=</span> <span class="s1">&#39;org.clojure/clojure&#39;</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span> <span class="n">library</span>
</span><span class='line'><span class="k">ORDER</span> <span class="k">BY</span> <span class="k">count</span> <span class="k">desc</span>
</span><span class='line'>
</span><span class='line'><span class="o">|</span> <span class="k">Row</span> <span class="o">|</span> <span class="n">library</span>                     <span class="o">|</span> <span class="k">count</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span><span class="c1">-----+-----------------------------+-------|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">1</span> <span class="o">|</span> <span class="n">compojure</span>                   <span class="o">|</span>  <span class="mi">3609</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">2</span> <span class="o">|</span> <span class="n">lein</span><span class="o">-</span><span class="n">cljsbuild</span>              <span class="o">|</span>  <span class="mi">3413</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">3</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojurescript</span>   <span class="o">|</span>  <span class="mi">3080</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">4</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">core</span><span class="p">.</span><span class="n">async</span>      <span class="o">|</span>  <span class="mi">2612</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">5</span> <span class="o">|</span> <span class="n">lein</span><span class="o">-</span><span class="n">ring</span>                   <span class="o">|</span>  <span class="mi">1809</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">6</span> <span class="o">|</span> <span class="n">cheshire</span>                    <span class="o">|</span>  <span class="mi">1802</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">7</span> <span class="o">|</span> <span class="n">environ</span>                     <span class="o">|</span>  <span class="mi">1763</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">8</span> <span class="o">|</span> <span class="n">ring</span>                        <span class="o">|</span>  <span class="mi">1678</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>   <span class="mi">9</span> <span class="o">|</span> <span class="n">clj</span><span class="o">-</span><span class="n">http</span>                    <span class="o">|</span>  <span class="mi">1648</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">10</span> <span class="o">|</span> <span class="n">clj</span><span class="o">-</span><span class="n">time</span>                    <span class="o">|</span>  <span class="mi">1613</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">11</span> <span class="o">|</span> <span class="n">hiccup</span>                      <span class="o">|</span>  <span class="mi">1591</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">12</span> <span class="o">|</span> <span class="n">lein</span><span class="o">-</span><span class="n">figwheel</span>               <span class="o">|</span>  <span class="mi">1582</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">13</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">logging</span>   <span class="o">|</span>  <span class="mi">1579</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">14</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span>       <span class="o">|</span>  <span class="mi">1546</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">15</span> <span class="o">|</span> <span class="n">http</span><span class="o">-</span><span class="n">kit</span>                    <span class="o">|</span>  <span class="mi">1423</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">16</span> <span class="o">|</span> <span class="n">lein</span><span class="o">-</span><span class="n">environ</span>                <span class="o">|</span>  <span class="mi">1325</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">17</span> <span class="o">|</span> <span class="n">ring</span><span class="o">/</span><span class="n">ring</span><span class="o">-</span><span class="k">defaults</span>          <span class="o">|</span>  <span class="mi">1302</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">18</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">nrepl</span>     <span class="o">|</span>  <span class="mi">1244</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">19</span> <span class="o">|</span> <span class="n">midje</span>                       <span class="o">|</span>  <span class="mi">1122</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">20</span> <span class="o">|</span> <span class="n">com</span><span class="p">.</span><span class="n">cemerick</span><span class="o">/</span><span class="n">piggieback</span>     <span class="o">|</span>  <span class="mi">1096</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">21</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">jdbc</span>       <span class="o">|</span>  <span class="mi">1064</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">22</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">cli</span>       <span class="o">|</span>  <span class="mi">1053</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">23</span> <span class="o">|</span> <span class="n">enlive</span>                      <span class="o">|</span>  <span class="mi">1001</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">24</span> <span class="o">|</span> <span class="n">ring</span><span class="o">/</span><span class="n">ring</span><span class="o">-</span><span class="n">core</span>              <span class="o">|</span>   <span class="mi">995</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">25</span> <span class="o">|</span> <span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">namespace</span> <span class="o">|</span>   <span class="mi">982</span> <span class="o">|</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/weavejester/compojure">Compojure</a> takes the top
slot. <a href="https://docs.google.com/a/jakemccrary.com/spreadsheets/d/1-zmcOVPKLGrdRT_VkTrRUuRFyuxxmXi9eeH6Xzlt7yg/edit?usp=sharing">Full results are available</a>.</p>

<p>Before doing this research I tried to predict what libraries I&rsquo;d see
in the top 10. I thought that clj-time and clj-http would be up
there. I&rsquo;m happy to see my guess was correct.</p>

<p>It was pretty pleasant using BigQuery to do this analysis. Queries
took at most seconds to execute. This quick feedback let me play
around in the web interface without feeling like I was waiting for
computers to do work. This made the research into Clojure library
usage painless and fun.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
I did this in early March 2017.<a href="#fnref:1" rev="footnote">&#8617;</a></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/03/31/what-clojure-testing-library-is-most-used/">Which Clojure testing library is most used?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-03-31T21:54:00-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2017</span></span> <span class='time'>9:54 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve always assumed that the built-in <code>clojure.test</code> is the most
widely used testing library in the Clojure community. Earlier this
month I decided to test this assumption using the
Google&rsquo;s BigQuery <a href="https://cloud.google.com/bigquery/public-data/github">GitHub dataset</a>.</p>

<p>The BigQuery GitHub dataset contains over three terabytes of source
code from more than 2.8 million open source GitHub
repositories. BigQuery lets us quickly query this data using SQL.</p>

<p>Below is a table with the results (done in early March 2017) of my
investigation. Surprising no one, <code>clojure.test</code> comes out as the
winner and it is a winner by a lot.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Library      | # Repos Using |
</span><span class='line'>|--------------+---------------|
</span><span class='line'>| clojure.test |         14304 |
</span><span class='line'>| midje        |          1348 |
</span><span class='line'>| expectations |           429 |
</span><span class='line'>| speclj       |           207 |
</span><span class='line'>| smidjen      |             1 |
</span><span class='line'>| fudje        |             1 |</span></code></pre></td></tr></table></div></figure>


<p>23,243 repositories were identified as containing Clojure (or
ClojureScript) code. This means there were about 6,953 repositories
that didn&rsquo;t use any testing library<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. This puts the &ldquo;no tests or an
obscure other way of testing&rdquo; in a pretty solid second place.</p>

<p>You should take these numbers as ballpark figures and not exact
answers. I know from using GitHub&rsquo;s search interface that there are
three public projects
using <a href="https://github.com/jimpil/fudje">fudje</a><sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.</p>

<p>So, why don&rsquo;t all three of those projects show up? The dataset only
includes projects where Google could identify the project as open
source and the GitHub licenses API is used to do that<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>. Two of
those three projects were probably unable to be identified as
something with an appropriate license.</p>

<p>Another small problem is that since <code>expectations</code> is an actual word,
it shows up outside of <code>ns</code> declarations. I ended up using a fairly
simple query to generate this data and it only knows that
<code>expectations</code> shows up somewhere in a file. I experimented with some
more restrictive queries but they didn&rsquo;t drastically change the result
and I wasn&rsquo;t sure they weren&rsquo;t wrong in other ways. If you subtract a
number between 100 and 150 you&rsquo;ll probably have a more accurate
expectations usage count.</p>

<p>Keep reading if you want to hear more about the steps to come up with
the above numbers.</p>

<p>If you have other Clojure questions you think could be answered by
querying this dataset, let me know in the comments or
on <a href="https://twitter.com/jakemcc">twitter</a>. I have some more ideas, so
I wouldn&rsquo;t be surprised if at least one more article gets written.</p>

<h2>The Details</h2>

<p>The process was pretty straightforward. Most of my time was spent
exploring the tables, figuring out what the columns represented,
figuring out what queries worked well, and manually confirming some of
the results. BigQuery is very fast. Very little of my time was spent
waiting for results.</p>

<h3>1. Setup the data</h3>

<p>You get 1 TB of free BigQuery usage a month. You can blow through this
in a single query. Google provides sample tables that contain less
data but I wanted to operate on the full set of Clojure(Script) files,
so my first step was to execute some queries to create tables
that only contained Clojure data.</p>

<p>First, I queried the <code>github_repos.files</code> table for all the
Clojure(Script) files and saved that to a <code>clojure.files</code> table.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span>
</span><span class='line'>  <span class="o">*</span>
</span><span class='line'><span class="k">FROM</span>
</span><span class='line'>  <span class="p">[</span><span class="n">bigquery</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="k">data</span><span class="p">:</span><span class="n">github_repos</span><span class="p">.</span><span class="n">files</span><span class="p">]</span>
</span><span class='line'><span class="k">WHERE</span>
</span><span class='line'>  <span class="p">(</span><span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;.clj&#39;</span>
</span><span class='line'>    <span class="k">OR</span> <span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;.cljc&#39;</span>
</span><span class='line'>    <span class="k">OR</span> <span class="k">RIGHT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;.cljs&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above query took only 9.2 seconds to run and processed 328 GB of data.</p>

<p>Using the <code>clojure.files</code> table, we can select the source for all the
Clojure code from the <code>github_repos.contents</code>. I saved this to a
<code>clojure.contents</code> table.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="o">*</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">[</span><span class="n">bigquery</span><span class="o">-</span><span class="k">public</span><span class="o">-</span><span class="k">data</span><span class="p">:</span><span class="n">github_repos</span><span class="p">.</span><span class="n">contents</span><span class="p">]</span>
</span><span class='line'><span class="k">WHERE</span> <span class="n">id</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">clojure</span><span class="p">.</span><span class="n">files</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This query processed 1.84 TB of data in 21.5 seconds. So fast. In just
under 30 seconds, I&rsquo;ve blown through the free limit.</p>

<h3>2. Identify what testing library (or libraries) a repo uses</h3>

<p>We can guess that a file uses a testing library if it contains certain
string. The strings we&rsquo;ll search for are the namespaces we&rsquo;d expect to
see required or used in a <code>ns</code> declaration. The below query does this
for each file and then rolls up the results by repository. It took 3
seconds to run and processed 611 MB of data.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span>
</span><span class='line'>  <span class="n">files</span><span class="p">.</span><span class="n">repo_name</span><span class="p">,</span>
</span><span class='line'>  <span class="k">MAX</span><span class="p">(</span><span class="n">uses_clojure_test</span><span class="p">)</span> <span class="n">uses_clojure_test</span><span class="p">,</span>
</span><span class='line'>  <span class="k">MAX</span><span class="p">(</span><span class="n">uses_expectations</span><span class="p">)</span> <span class="n">uses_expectations</span><span class="p">,</span>
</span><span class='line'>  <span class="k">MAX</span><span class="p">(</span><span class="n">uses_midje</span><span class="p">)</span> <span class="n">uses_midje</span><span class="p">,</span>
</span><span class='line'>  <span class="k">MAX</span><span class="p">(</span><span class="n">uses_speclj</span><span class="p">)</span> <span class="n">uses_speclj</span><span class="p">,</span>
</span><span class='line'>  <span class="k">MAX</span><span class="p">(</span><span class="n">uses_fudje</span><span class="p">)</span> <span class="n">uses_fudje</span><span class="p">,</span>
</span><span class='line'>  <span class="k">MAX</span><span class="p">(</span><span class="n">uses_smidjen</span><span class="p">)</span> <span class="n">uses_smidjen</span><span class="p">,</span>
</span><span class='line'><span class="k">FROM</span> <span class="p">(</span>
</span><span class='line'>  <span class="k">SELECT</span>
</span><span class='line'>    <span class="n">id</span><span class="p">,</span>
</span><span class='line'>    <span class="n">contents</span><span class="p">.</span><span class="n">content</span> <span class="k">LIKE</span> <span class="s1">&#39;%clojure.test%&#39;</span> <span class="n">uses_clojure_test</span><span class="p">,</span>
</span><span class='line'>    <span class="n">contents</span><span class="p">.</span><span class="n">content</span> <span class="k">LIKE</span> <span class="s1">&#39;%expectations%&#39;</span> <span class="n">uses_expectations</span><span class="p">,</span>
</span><span class='line'>    <span class="n">contents</span><span class="p">.</span><span class="n">content</span> <span class="k">LIKE</span> <span class="s1">&#39;%midje%&#39;</span> <span class="n">uses_midje</span><span class="p">,</span>
</span><span class='line'>    <span class="n">contents</span><span class="p">.</span><span class="n">content</span> <span class="k">LIKE</span> <span class="s1">&#39;%speclj%&#39;</span> <span class="n">uses_speclj</span><span class="p">,</span>
</span><span class='line'>    <span class="n">contents</span><span class="p">.</span><span class="n">content</span> <span class="k">LIKE</span> <span class="s1">&#39;%fudje%&#39;</span> <span class="n">uses_fudje</span><span class="p">,</span>
</span><span class='line'>    <span class="n">contents</span><span class="p">.</span><span class="n">content</span> <span class="k">LIKE</span> <span class="s1">&#39;%smidjen%&#39;</span> <span class="n">uses_smidjen</span><span class="p">,</span>
</span><span class='line'>  <span class="k">FROM</span>
</span><span class='line'>    <span class="n">clojure</span><span class="p">.</span><span class="n">contents</span> <span class="k">AS</span> <span class="n">contents</span><span class="p">)</span> <span class="n">x</span>
</span><span class='line'><span class="k">JOIN</span>
</span><span class='line'>  <span class="n">clojure</span><span class="p">.</span><span class="n">files</span> <span class="n">files</span> <span class="k">ON</span> <span class="n">files</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">id</span>
</span><span class='line'><span class="k">GROUP</span> <span class="k">BY</span>
</span><span class='line'>  <span class="n">files</span><span class="p">.</span><span class="n">repo_name</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below is a screenshot of the first few rows in the result.</p>

<p><img src="/images/bigquery-testing-library-result.png" title="BigQuery results for test library usage by repo" alt="BigQuery results for test library usage by repo" /></p>

<h3>3. Export the data</h3>

<p>At this point, we could continue doing the analysis using SQL and the
BigQuery UI but I opted to explore the data using Clojure and the
repl. There were too many rows to directly download the query results
as a csv file, so I ended up having to save the results as a table and
then export it to Google&rsquo;s cloud storage and download from there.</p>

<p>The first few rows of the file look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">files_repo_name</span><span class="p">,</span><span class="n">uses_clojure_test</span><span class="p">,</span><span class="n">uses_expectations</span><span class="p">,</span><span class="n">uses_midje</span><span class="p">,</span><span class="n">uses_speclj</span><span class="p">,</span><span class="n">uses_fudje</span><span class="p">,</span><span class="n">uses_smidjen</span>
</span><span class='line'><span class="n">wangchunyang</span><span class="o">/</span><span class="n">clojure</span><span class="o">-</span><span class="n">liberator</span><span class="o">-</span><span class="n">examples</span><span class="p">,</span><span class="k">true</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span>
</span><span class='line'><span class="n">yantonov</span><span class="o">/</span><span class="n">rex</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="k">false</span>
</span></code></pre></td></tr></table></div></figure>


<h3>4. Calculate some numbers</h3>

<p>The code takes the csv file and does some transformations. You could
do this in Excel or using any language of your choice. I&rsquo;m not going
to include code here, as it isn&rsquo;t that interesting.</p>

<h2>BigQuery thoughts</h2>

<p>This was my first time using Google&rsquo;s BigQuery. This wasn&rsquo;t the most
difficult analysis to do but I was impressed at the speed and ease of
use. The web UI, which I used entirely for this, is neither really
great or extremely terrible. It mostly just worked and I rarely had to
look up documentation.</p>

<p>I don&rsquo;t really feel comfortable making a judgment call on if the cost
is expensive or not but this article cost a bit less than seven
dollars to write. This doesn&rsquo;t seem too outrageous to me.</p>

<p>Based on my limited usage of BigQuery, it is something I&rsquo;d look into further if I needed its capabilities.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
Probably higher, as projects can and use more than one testing library.<a href="#fnref:1" rev="footnote">&#8617;</a></li>
<li id="fn:2">
And those projects are <a href="https://github.com/jumarko/clojure-random">jumarko/clojure-random</a>, <a href="https://github.com/dpassen1/great-sort">dpassen1/great-sort</a>, and <a href="https://github.com/jimpil/fudje">jimpil/fudje</a>.<a href="#fnref:2" rev="footnote">&#8617;</a></li>
<li id="fn:3">
<a href="https://news.ycombinator.com/item?id=12004644">Source is a Google Developer Advocate&rsquo;s response on old HN post</a><a href="#fnref:3" rev="footnote">&#8617;</a></li>
</ol>
</div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog//6">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog//4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2024/06/16/scheduling-cron-tasks-in-mixed-time-zones/">Scheduling cron tasks in mixed time zones</a>
      </li>
    
      <li class="post">
        <a href="/blog/2024/02/18/reading-in-2023/">Reading in 2023</a>
      </li>
    
      <li class="post">
        <a href="/blog/2023/01/14/reading-in-2022/">Reading in 2022</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/11/13/bookmarklets-on-mobile-are-useful/">Bookmarklets on mobile are useful</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/01/02/reading-in-2021/">Reading in 2021</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/09/11/tests-can-act-as-living-documentation/">Tests are living documentation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/08/07/improve-your-tests-by-picking-better-constants/">Improve your tests by picking better constants</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/01/24/reading-in-2020/">Reading in 2020</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/12/30/speeding-up-magit-with-the-native-comp-branch-of-emacs/">Speeding up Magit with the native-comp branch of Emacs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/14/speeding-up-magit/">Speeding up magit</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Subscribe</h1>
  <p>Looking forward to reading more of my writing?</p>
  <p>Sign up for my <a target="_blank" href="https://jakemccrary.substack.com/welcome">newsletter</a> to get periodic emails with links to my latest writing and other thoughts.</p>
  <p>Can't wait for the infrequent newsletter? Subscribe to the <a href="http://feeds.feedburner.com/JakeMccrarysMusings">RSS</a> feed.</p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
</body>
</html>
