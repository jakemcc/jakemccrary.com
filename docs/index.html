
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Jake McCrary" />
    <meta itemprop="description" content="Home of Jake McCrary's writing on software, teams, and technology." />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Jake McCrary" />
    <meta name="twitter:description" content="Home of Jake McCrary's writing on software, teams, and technology." />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="Writing by Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/" />
    <meta property="og:title" content="Jake McCrary" />
    <meta property="og:description" content="Home of Jake McCrary's writing on software, teams, and technology." />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
    

    <meta name="description" content="Home of Jake McCrary's writing on software, teams, and technology.">

    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
    
<script>
 var origin = window.location.origin;
 if (!origin) {
   origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
 }
 if (origin.indexOf('localhost') === -1) {
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-19834208-2', 'auto');
   ga('send', 'pageview');
 }
</script>


  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  <li><a href="https://jakemccrary.substack.com/welcome" target="_blank" rel="subscribe-email" title="subscribe via email">Newsletter</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/12/30/speeding-up-magit-with-the-native-comp-branch-of-emacs/">Speeding up Magit with the native-comp branch of Emacs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-12-30T20:08:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>8:08 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>In my last article, <a href="/blog/2020/11/14/speeding-up-magit/">Speeding up Magit</a>, I showed how removing elements from Magit&rsquo;s status buffer drastically reduces the time it takes to refresh this buffer when working in a large repository (from 4 seconds to around 0.348 seconds).
In a <a href="https://www.reddit.com/r/emacs/comments/k3xfa1/speeding_up_magit/ge5o0e0/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3">comment on r/emacs</a>, someone wondered if the <code>native-comp</code> feature of Emacs might improve the Magit status refresh time.</p>

<p>This reddit thread was the first time I had heard of the <code>native-comp</code> feature.
This feature lives on the <code>feature/native-comp</code> branch of the Emacs repository and it compiles Elisp code into native code.
Many users have reported noticeable speed improvements using it.
The <a href="http://akrl.sdf.org/gccemacs.html">official development log</a> and <a href="https://www.emacswiki.org/emacs/GccEmacs">Emacs Wiki</a> have more information about it.</p>

<p>I&rsquo;ll provide more information about getting <code>native-comp</code> working on macOS after I answer the Magit speed question.</p>

<h2>How did it change refresh times of the Magit status buffer?</h2>

<p>The quick answer is that running Emacs with <code>native-comp</code> improved the refresh times of the Magit status buffer.
Below is a table of the various times.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>| Experiment                              | magit-status refresh time |
</span><span class='line'>|-----------------------------------------+---------------------------|
</span><span class='line'>| full magit-status with native-comp      | 3.152 seconds             |
</span><span class='line'>| full magit-status without native-comp   | 4.003 seconds             |
</span><span class='line'>| magit-status with many sections removed | 0.348 seconds             |</span></code></pre></td></tr></table></div></figure>


<p>Using <code>native-comp</code>, we&rsquo;ve cut off about 0.85 seconds.
That is a pretty solid improvement.
Even still, that isn&rsquo;t fast enough for how often I use Magit so I&rsquo;ll be sticking with my <a href="/blog/2020/11/14/speeding-up-magit/">Magit setup</a> with many sections removed.</p>

<p>As a caveat, the timing with <code>native-comp</code> also includes upgrading Emacs from <code>26.3</code> to <code>28.0.50</code> (so I could have <code>native-comp</code>) and Magit from <code>20201111.1436</code> to <code>20201212.929</code>.
As a result, the comparison to <code>full magit-status without native-comp</code> isn&rsquo;t entirely fair as multiple variables have changed.
The comparison to time with sections removed is fair as I&rsquo;m still using that setup (but with native-comp) and the timing is pretty much the same.</p>

<h2>Getting <code>native-comp</code> on macOS</h2>

<p>To enable <code>native-comp</code> you need to build Emacs from source.
I&rsquo;ve done this before on Linux systems but this was the first time I&rsquo;ve done this on macOS.</p>

<p>When browsing reddit, I found the <a href="https://github.com/jimeh/build-emacs-for-macos">build-emacs-for-macos</a> project which has some helpful instructions for doing this.
I followed the instructions from the readme and picked the latest known good commit from <a href="https://github.com/jimeh/build-emacs-for-macos/issues/6">this issue</a> (at the time I did this <code>be907b0ba82c2a65e0468d50653cae8a7cf5f16b</code>).
I then updated my <a href="https://github.com/jakemcc/emacs.d/commit/72cf37a497b72b8990956395e2eaa87285ea7c81">init.el</a> based on instructions from in the <code>build-emacs-for-macos</code> project.</p>

<p>I haven&rsquo;t had any issues since switching to this very new Emacs.
I don&rsquo;t have numbers to back this up but it does feel faster.</p>

<h2>Recommendation</h2>

<p>I&rsquo;d recommend giving the <code>native-comp</code> feature of Emacs a shot.
It wasn&rsquo;t terribly challenging to get setup and it is nice to get a glimpse of what the future of Emacs might be.
That future is a bit snappier.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/11/14/speeding-up-magit/">Speeding up magit</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-11-14T16:37:00-06:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>4:37 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/magit/magit">Magit</a> is a great Emacs tool and by far my favorite way of interacting with git repositories.
I use Magit nearly every day.</p>

<p>Unfortunately, refreshing the <code>magit-status</code> buffer is sluggish when you are working in a large repository.</p>

<p>A few months ago, I became sick of waiting and investigated how to speed up refreshing the status buffer.
After doing some research, I learned about the <code>magit-refresh-verbose</code> variable.</p>

<p>Setting <code>magit-refresh-verbose</code> to true causes Magit to print some very useful output to your <code>*Messages*</code> buffer.
This output shows how many seconds each step of <code>magit-status</code> takes.</p>

<p>Here is the output for the large repo that caused me to look into this.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Refreshing buffer ‘magit: example-repo’...
</span><span class='line'>  magit-insert-error-header                          1e-06
</span><span class='line'>  magit-insert-diff-filter-header                    2.3e-05
</span><span class='line'>  magit-insert-head-branch-header                    0.026227
</span><span class='line'>  magit-insert-upstream-branch-header                0.014285
</span><span class='line'>  magit-insert-push-branch-header                    0.005662
</span><span class='line'>  magit-insert-tags-header                           1.7119309999999999
</span><span class='line'>  magit-insert-status-headers                        1.767466
</span><span class='line'>  magit-insert-merge-log                             0.005947
</span><span class='line'>  magit-insert-rebase-sequence                       0.000115
</span><span class='line'>  magit-insert-am-sequence                           5.1e-05
</span><span class='line'>  magit-insert-sequencer-sequence                    0.000105
</span><span class='line'>  magit-insert-bisect-output                         5.3e-05
</span><span class='line'>  magit-insert-bisect-rest                           1.1e-05
</span><span class='line'>  magit-insert-bisect-log                            1e-05
</span><span class='line'>  magit-insert-untracked-files                       0.259485
</span><span class='line'>  magit-insert-unstaged-changes                      0.031528
</span><span class='line'>  magit-insert-staged-changes                        0.017763
</span><span class='line'>  magit-insert-stashes                               0.028514
</span><span class='line'>  magit-insert-unpushed-to-pushremote                0.911193
</span><span class='line'>  magit-insert-unpushed-to-upstream-or-recent        0.497709
</span><span class='line'>  magit-insert-unpulled-from-pushremote              7.2e-05
</span><span class='line'>  magit-insert-unpulled-from-upstream                0.446168
</span><span class='line'>Refreshing buffer ‘magit: example-repo’...done (4.003s)</span></code></pre></td></tr></table></div></figure>


<p>The total time is found in the last line and we can see it took four seconds.
Four seconds is an incredibly long time to wait before interacting with Magit.</p>

<p>You can change how much work Magit does by removing functions from the <code>magit-status-sections-hook</code> with <code>remove-hook</code>.
I looked at the timings and and tried removing anything I decided was slow and something I didn&rsquo;t think I&rsquo;d miss.
For me, that list includes <code>magit-insert-tags-header</code>, <code>magit-insert-status-headers</code>, <code>magit-insert-unpushed-to-pushremote</code>, <code>magit-insert-unpushed-to-upstream-or-recent</code>, and <code>magit-insert-unpulled-from-upstream</code>. I also removed <code>magit-insert-unpulled-from-pushremote</code>.</p>

<p>You remove a function from a hook by adding elisp similar to <code>(remove-hook 'magit-status-sections-hook 'magit-insert-tags-header)</code> to your Emacs configuration.</p>

<p>I use <a href="https://github.com/jwiegley/use-package">use-package</a> to configure mine and below is what my <code>magit</code> section looks like.</p>

<p>Lines 20-25 remove the hooks.
I also hard-code <code>magit-git-executable</code> to be the full path of the <code>git</code> executable on line 5 because folks said this made a difference on macOS.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span class="p">(</span><span class="nb">use-package</span> <span class="nv">magit</span>
</span><span class='line'>  <span class="ss">:ensure</span> <span class="no">t</span>
</span><span class='line'>  <span class="ss">:bind</span> <span class="p">(</span><span class="s">&quot;C-c g&quot;</span> <span class="o">.</span> <span class="nv">magit-status</span><span class="p">)</span>
</span><span class='line'>  <span class="ss">:custom</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">magit-git-executable</span> <span class="s">&quot;/usr/local/bin/git&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="ss">:init</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">with-editor</span> <span class="ss">:ensure</span> <span class="no">t</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">;; Have magit-status go full screen and quit to previous</span>
</span><span class='line'>  <span class="c1">;; configuration.  Taken from</span>
</span><span class='line'>  <span class="c1">;; http://whattheemacsd.com/setup-magit.el-01.html#comment-748135498</span>
</span><span class='line'>  <span class="c1">;; and http://irreal.org/blog/?p=2253</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">defadvice</span> <span class="nv">magit-status</span> <span class="p">(</span><span class="nv">around</span> <span class="nv">magit-fullscreen</span> <span class="nv">activate</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">window-configuration-to-register</span> <span class="ss">:magit-fullscreen</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">ad-do-it</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">delete-other-windows</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">defadvice</span> <span class="nv">magit-quit-window</span> <span class="p">(</span><span class="nv">after</span> <span class="nv">magit-restore-screen</span> <span class="nv">activate</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">jump-to-register</span> <span class="ss">:magit-fullscreen</span><span class="p">))</span>
</span><span class='line'>  <span class="ss">:config</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;magit-status-sections-hook</span> <span class="ss">&#39;magit-insert-tags-header</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;magit-status-sections-hook</span> <span class="ss">&#39;magit-insert-status-headers</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;magit-status-sections-hook</span> <span class="ss">&#39;magit-insert-unpushed-to-pushremote</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;magit-status-sections-hook</span> <span class="ss">&#39;magit-insert-unpulled-from-pushremote</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;magit-status-sections-hook</span> <span class="ss">&#39;magit-insert-unpulled-from-upstream</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;magit-status-sections-hook</span> <span class="ss">&#39;magit-insert-unpushed-to-upstream-or-recent</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>After this change, my <code>magit-status</code> buffer refreshes in under half a second.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='elisp'><span class='line'><span class="nv">Refreshing</span> <span class="nv">buffer</span> <span class="err">‘</span><span class="nv">magit:</span> <span class="nv">example-repo</span><span class="err">’</span><span class="o">...</span>
</span><span class='line'>  <span class="nv">magit-insert-merge-log</span>                             <span class="mf">0.005771</span>
</span><span class='line'>  <span class="nv">magit-insert-rebase-sequence</span>                       <span class="mf">0.000118</span>
</span><span class='line'>  <span class="nv">magit-insert-am-sequence</span>                           <span class="mf">5.3e-05</span>
</span><span class='line'>  <span class="nv">magit-insert-sequencer-sequence</span>                    <span class="mf">0.0001</span>
</span><span class='line'>  <span class="nv">magit-insert-bisect-output</span>                         <span class="mf">5.5e-05</span>
</span><span class='line'>  <span class="nv">magit-insert-bisect-rest</span>                           <span class="mf">1.1e-05</span>
</span><span class='line'>  <span class="nv">magit-insert-bisect-log</span>                            <span class="mf">1.1e-05</span>
</span><span class='line'>  <span class="nv">magit-insert-untracked-files</span>                       <span class="mf">0.247723</span>
</span><span class='line'>  <span class="nv">magit-insert-unstaged-changes</span>                      <span class="mf">0.024989</span>
</span><span class='line'>  <span class="nv">magit-insert-staged-changes</span>                        <span class="mf">0.018397</span>
</span><span class='line'>  <span class="nv">magit-insert-stashes</span>                               <span class="mf">0.026055</span>
</span><span class='line'><span class="nv">Refreshing</span> <span class="nv">buffer</span> <span class="err">‘</span><span class="nv">magit:</span> <span class="nv">example-repo</span><span class="err">’</span><span class="o">...</span><span class="nv">done</span> <span class="p">(</span><span class="nv">0.348s</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>What did I lose from the <code>magit-status</code> buffer as a result of these changes?
Here is screenshot of the original buffer.</p>

<p><img src="/images/magit-speed/magit-before.png" alt="Buffer before changes" /></p>

<p>And here is the buffer after.</p>

<p><img src="/images/magit-speed/magit-after.png" alt="Buffer after changes" /></p>

<p>The difference is drastic<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.
And so is the speed difference.</p>

<p>The increased speed is worth losing the additional information.
I interact with <code>git</code> very often and much prefer using Magit to do so.
Before these changes, I found myself regressing to using <code>git</code> at the command line and I don&rsquo;t find that to be nearly as enjoyable.
Since I&rsquo;ve made these changes, I&rsquo;m back to doing 99% of my <code>git</code> interactions through Magit.</p>

<p>Don&rsquo;t settle for slow interactions with your computer.
Aggressively shorten your feedback cycles and you&rsquo;ll change how you interact with the machine.</p>

<h4>Versions used when writing this article</h4>

<p>This post was written with Magit version <code>20201111.1436</code> and Emacs <code>26.3</code> on macOS <code>10.15.7</code>.
I&rsquo;ve been using these changes for a few months but do not remember or have a record of what Magit version I was using at the time I originally made these changes.</p>

<p><strong>edit on 2020/12/15</strong>:</p>

<p>I recently upgraded Emacs to tryout the native-comp work and can report this still works with with Emacs <code>28.0.50</code>, Magit <code>20201212.929</code>, and Git <code>2.29.2</code> running in macOS <code>11.0.1</code>.</p>

<p>As a warning, this reduces the information Magit shows you. The status buffer will be blank if you have no changes.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>The before image is even missing some sections that would have gone missing in the after shot since I didn&rsquo;t want to put the effort.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/11/11/creating-a-custom-kindle-dictionary/">Creating a custom Kindle dictionary</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-11-11T19:23:00-06:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>7:23 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Back in April 2013, I created and published a <a href="https://gumroad.com/l/dune-dictionary">custom Kindle dictionary</a> for the book <a href="http://www.amazon.com/gp/product/B00B7NPRY8/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B00B7NPRY8&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=LC2NFEXWA7JXW57B">Dune</a>.
As far as I can tell, <a href="https://gumroad.com/l/dune-dictionary">my Dune dictionary</a> was the very first custom Kindle dictionary for a fiction book.</p>

<p>I created it because I was reading Dune for the first time and there were many unfamiliar words.
These words could not be looked up by my Kindle because they were not found in any of on-device dictionaries.
These words were in Dune&rsquo;s glossary but flipping back-and-forth to that on a Kindle was a huge pain.</p>

<p>I initially worked around this by printing a word list from Wikipedia and carrying it with me.
This was better but it was still annoying.</p>

<p>I was so annoyed that I took a break from reading to figure out how to create a custom Kindle dictionary.
At the time, there wasn&rsquo;t a ton of great information online about how to do this.</p>

<p>Eventually, I found Amazon&rsquo;s <a href="https://s3.amazonaws.com/kindlegen/AmazonKindlePublishingGuidelines.pdf">Kindle Publishing Guidelines</a> and, referencing it, managed to figure out something that worked.
The link in the previous sentence is to the <strong>current</strong> documentation which is much nicer than the <a href="https://web.archive.org/web/20130408183149/http://s3.amazonaws.com/kindlegen/AmazonKindlePublishingGuidelines.pdf">mid-2013 documentation</a>.
The earlier documentation left me with questions and required quite a bit of experimentation.</p>

<p>Using the mid-2013 documentation, I developed some Clojure code to generate my <a href="https://gumroad.com/l/dune-dictionary">dictionary</a>.
Doing this in 2013 was annoying.
The documentation was not good.</p>

<p>I recently read <a href="https://www.gregegan.net/DIASPORA/DIASPORA.html">Greg Egan&rsquo;s Diaspora</a> and found myself wishing I had a custom dictionary.
I took a break from reading and packaged up Diaspora&rsquo;s glossary into a dictionary.
I could have stuck with my 2013 generator but I decided to update it and write this article about creating a Kindle dictionary in late 2020.</p>

<p>The new documentation is a bit better but it still isn&rsquo;t great.
Here is what you need to do.</p>

<h2>Making a dictionary</h2>

<p>Below are the steps to building a dictionary.</p>

<ol>
<li>Construct your list of words and definitions.</li>
<li>Convert the list into the format specified by Amazon.</li>
<li>Create a cover page.</li>
<li>Create a copyright page.</li>
<li>Create a usage page (definitely optional).</li>
<li>Make an <code>.opf</code> file.</li>
<li>Combine the files together.</li>
<li>Put it onto your device.</li>
</ol>


<h3>1. Construct your list of words and definitions</h3>

<p>There really are no set instructions for this.
Source your words and definitions and store them in some format that you&rsquo;ll be able to manipulate in a programming language.</p>

<p>I&rsquo;ve sourced words a few different ways.
I&rsquo;ve taken them straight from a book&rsquo;s glossary, a Wikipedia entry, and extracted them from a programming book&rsquo;s <a href="/blog/2013/07/09/releasing-the-functional-javascript-companion/">source code</a>.</p>

<h3>2. Convert the list into the format specified by Amazon</h3>

<p>Below is the basic scaffolding of the html file Amazon requires along with some inline styles that I think look decent on devices.
This has some extra stuff in it and also doesn&rsquo;t contain everything Amazon specifies.
But it works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html</span> <span class="na">xmlns:math=</span><span class="s">&quot;http://exslt.org/math&quot;</span> <span class="na">xmlns:svg=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span>
</span><span class='line'>      <span class="na">xmlns:tl=</span><span class="s">&quot;https://kindlegen.s3.amazonaws.com/AmazonKindlePublishingGuidelines.pdf&quot;</span>
</span><span class='line'>      <span class="na">xmlns:saxon=</span><span class="s">&quot;http://saxon.sf.net/&quot;</span> <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
</span><span class='line'>      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>      <span class="na">xmlns:cx=</span><span class="s">&quot;https://kindlegen.s3.amazonaws.com/AmazonKindlePublishingGuidelines.pdf&quot;</span>
</span><span class='line'>      <span class="na">xmlns:dc=</span><span class="s">&quot;http://purl.org/dc/elements/1.1/&quot;</span>
</span><span class='line'>      <span class="na">xmlns:mbp=</span><span class="s">&quot;https://kindlegen.s3.amazonaws.com/AmazonKindlePublishingGuidelines.pdf&quot;</span>
</span><span class='line'>      <span class="na">xmlns:mmc=</span><span class="s">&quot;https://kindlegen.s3.amazonaws.com/AmazonKindlePublishingGuidelines.pdf&quot;</span>
</span><span class='line'>      <span class="na">xmlns:idx=</span><span class="s">&quot;https://kindlegen.s3.amazonaws.com/AmazonKindlePublishingGuidelines.pdf&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;style&gt;</span>
</span><span class='line'>      <span class="nt">h5</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">font-size</span><span class="o">:</span> <span class="m">1em</span><span class="p">;</span>
</span><span class='line'>          <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nt">dt</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nt">dd</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>          <span class="k">padding</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0.5em</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>          <span class="k">display</span><span class="o">:</span> <span class="k">block</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="nt">&lt;/style&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;mbp:framset&gt;</span>
</span><span class='line'>      [PUT THE WORDS HERE]
</span><span class='line'>    <span class="nt">&lt;/mbp:framset&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>[PUT THE WORDS HERE]</code> part gets filled in with the markup for all of your words.
The basic structure for an entry looks like the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;idx:entry</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="na">scriptable=</span><span class="s">&quot;yes&quot;</span> <span class="na">spell=</span><span class="s">&quot;yes&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h5&gt;&lt;dt&gt;&lt;idx:orth&gt;</span>WORD HERE<span class="nt">&lt;/idx:orth&gt;&lt;/dt&gt;&lt;/h5&gt;</span>
</span><span class='line'>  <span class="nt">&lt;dd&gt;</span>DEFINITION<span class="nt">&lt;/dd&gt;</span>
</span><span class='line'><span class="nt">&lt;/idx:entry&gt;</span>
</span><span class='line'><span class="nt">&lt;hr/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Every word has an <code>&lt;idx:entry&gt;</code> block followed by a <code>&lt;hr&gt;</code>.
These two elements together comprise a single entry.</p>

<p>The <code>name</code> attribute on the <code>&lt;idx:entry&gt;</code> element sets the lookup index associated with the entry.
Unless you are building a dictionary with multiple indexes, you can pretty much ignore it.
Whatever value is provided needs to match the value found in the <code>.opf</code> file we&rsquo;ll make later.</p>

<p>The <code>scriptable</code> attribute makes the entry available from the index and can only have the value <code>"yes"</code>.
The <code>spell</code> can also only be <code>"yes"</code> and enables wildcard search and spell correction.</p>

<p>The markup you use inside the <code>idx:entry</code> element is mostly up to you.
The only markup you need is the <code>&lt;idx:orth&gt;</code> node.
Its content is the word being looked up.
The rest of the markup can be whatever you want.</p>

<p>I wrap the term in a <code>dt</code> and the definition in <code>dd</code> because it just feels like the right thing to do and provides tags to put some CSS styles on.
I wrap the <code>dt</code> element in an <code>h5</code> because I couldn&rsquo;t figure out what CSS styles would actually work on my Kindle voyage to put the term on its own line.</p>

<p>It isn&rsquo;t that I don&rsquo;t know what the styles should be but my Kindle did not respect them.
Figuring out stuff like this is part of the experimentation required to produce a dictionary that you&rsquo;re happy with.</p>

<p>There is additional supported markup that provides more functionality.
This includes providing alternative words that all resolve to the same entry, specifying if an exact match is required, and varying the search word from the displayed word.
Most dictionaries don&rsquo;t need these features so I&rsquo;m not going to elaborate on them.</p>

<h3>3. Construct a cover page.</h3>

<p>This is just a requirement of a Kindle.
Create a html file called <code>cover.html</code> and substitute in the appropriate values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">&quot;text/html&quot;</span> <span class="na">http-equiv=</span><span class="s">&quot;content-type&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>Dune Dictionary<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h3&gt;</span>Created by Jake McCrary<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Amazon wants you to provide an image as well but you don&rsquo;t actually have to do this.
You probably need to do this if you actually publish the dictionary through Amazon<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<h3>4. Create a copyright page</h3>

<p>This is also a requirement of the Kindle publishing guide.
There isn&rsquo;t any special markup for doing this.</p>

<p>Just make another html file and fill in some appropriate details.</p>

<h3>5. Create a usage page</h3>

<p>This isn&rsquo;t a requirement but I include another page that explains how to use the dictionary.
Again, this is just a html document with some content in it.</p>

<h3>6. Make an <code>.opf</code> file.</h3>

<p>This is one of the poorly documented but extremely important parts of making a Kindle dictionary.
This is a XML file that ties together all the previous files into an actual dictionary.</p>

<p>Make an opf file and name it whatever you want; in this example we&rsquo;ll go with <code>dict.opf</code>.</p>

<p>Below is the one I&rsquo;ve used for the Diaspora dictionary.
If you&rsquo;ve created an image for a cover then lines 7 and 15 are the important and line 15 should be uncommented.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;package</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.idpf.org/2007/opf&quot;</span> <span class="na">unique-identifier=</span><span class="s">&quot;BookId&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;metadata&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dc:title&gt;</span>A dictionary for Diaspora by Greg Egan<span class="nt">&lt;/dc:title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dc:creator</span> <span class="na">opf:role=</span><span class="s">&quot;aut&quot;</span><span class="nt">&gt;</span>Jake McCrary<span class="nt">&lt;/dc:creator&gt;</span>
</span><span class='line'>    <span class="nt">&lt;dc:language&gt;</span>en-us<span class="nt">&lt;/dc:language&gt;</span>
</span><span class='line'>    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;cover&quot;</span> <span class="na">content=</span><span class="s">&quot;my-cover-image&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;x-metadata&gt;</span>
</span><span class='line'>      <span class="nt">&lt;DictionaryInLanguage&gt;</span>en-us<span class="nt">&lt;/DictionaryInLanguage&gt;</span>
</span><span class='line'>      <span class="nt">&lt;DictionaryOutLanguage&gt;</span>en-us<span class="nt">&lt;/DictionaryOutLanguage&gt;</span>
</span><span class='line'>      <span class="nt">&lt;DefaultLookupIndex&gt;</span>default<span class="nt">&lt;/DefaultLookupIndex&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/x-metadata&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/metadata&gt;</span>
</span><span class='line'>  <span class="nt">&lt;manifest&gt;</span>
</span><span class='line'>    <span class="c">&lt;!-- &lt;item href=&quot;cover-image.jpg&quot; id=&quot;my-cover-image&quot; media-type=&quot;image/jpg&quot; /&gt; --&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;cover&quot;</span>
</span><span class='line'>          <span class="na">href=</span><span class="s">&quot;cover.html&quot;</span>
</span><span class='line'>          <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;usage&quot;</span>
</span><span class='line'>          <span class="na">href=</span><span class="s">&quot;usage.html&quot;</span>
</span><span class='line'>          <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;copyright&quot;</span>
</span><span class='line'>          <span class="na">href=</span><span class="s">&quot;copyright.html&quot;</span>
</span><span class='line'>          <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;item</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span>
</span><span class='line'>          <span class="na">href=</span><span class="s">&quot;content.html&quot;</span>
</span><span class='line'>          <span class="na">media-type=</span><span class="s">&quot;application/xhtml+xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/manifest&gt;</span>
</span><span class='line'>  <span class="nt">&lt;spine&gt;</span>
</span><span class='line'>    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;cover&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;usage&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;copyright&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;itemref</span> <span class="na">idref=</span><span class="s">&quot;content&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/spine&gt;</span>
</span><span class='line'>  <span class="nt">&lt;guide&gt;</span>
</span><span class='line'>    <span class="nt">&lt;reference</span> <span class="na">type=</span><span class="s">&quot;index&quot;</span> <span class="na">title=</span><span class="s">&quot;IndexName&quot;</span> <span class="na">href=</span><span class="s">&quot;content.html&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/guide&gt;</span>
</span><span class='line'><span class="nt">&lt;/package&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>An import element in this file is the <code>&lt;DefaultLookupIndex&gt;</code> element.
The <code>&lt;DefaultLookupIndex&gt;</code> content needs to contain the same value from the <code>name</code> attribute on your <code>&lt;idx:entry&gt;</code> elements.
The <code>&lt;DictionaryInLanguage&gt;</code> and <code>&lt;DictionaryOutLanguage&gt;</code> tell the Kindle the valid languages for your dictionary.</p>

<p>The other elements in the <code>&lt;metadata&gt;</code> should be pretty self-explanatory.</p>

<p>The <code>&lt;manifest&gt;</code> gives identifiers for the various files you&rsquo;ve made in the previous steps</p>

<p>The commented out <code>&lt;img&gt;</code> shows how you&rsquo;d add the cover image if you opt to have one.
For sideloading dictionaries onto Kindles, it is not required.</p>

<p>The <code>&lt;spine&gt;</code> section references the <code>&lt;item&gt;</code>s from the <code>&lt;manifest&gt;</code> and specifies the order they appear in your book.</p>

<p>I honestly don&rsquo;t remember why the <code>&lt;guide&gt;</code> section is in there or what it is doing in this example.
I&rsquo;m guessing that is what causes there to be an index with the word list in the dictionary but I haven&rsquo;t tried removing it and the documentation doesn&rsquo;t talk about it.
I only have it there since I had it in earlier dictionaries I made.</p>

<h3>7. Combine the files together</h3>

<p>The publishing guidelines (as of October 2020) tell you to combine the previously created files together using the command line tool <code>kindlegen</code>.
The problem with those instructions is that Amazon doesn&rsquo;t offer <code>kindlegen</code> as a download anymore.
If you want to use it, you can still find it through the Internet Archive.</p>

<p>Instead of following the publishing guidelines, we&rsquo;ll use Kindle Previewer to finish making the dictionary.
It is pretty straight forward.</p>

<ol>
<li>Download the <a href="https://www.amazon.com/gp/feature.html?ie=UTF8&amp;docId=1000765261">Kindle Previewer</a> application.</li>
<li>Open it up and click <code>File &gt; Open</code>.</li>
<li>Find your <code>dict.opf</code> file and open that.</li>
<li><code>File &gt; Export</code> and export it as a <code>.mobi</code> file.</li>
</ol>


<p>The conversion log will complain about a couple things such as missing cover.
As long as these are just <code>Warnings</code> it doesn&rsquo;t matter.</p>

<p>I&rsquo;ve found the preview in this app doesn&rsquo;t match what it looks like on your device so take it with a grain of salt.</p>

<h3>7. Put it onto your device</h3>

<p>Finally, put the dictionary onto your Kindle.
You can do this by either using a USB cable or by emailing it to your Kindle&rsquo;s email address.</p>

<p>Once it is on your Kindle, open it up and double check that the formatting is correct.
Next, open the book you&rsquo;ve made it for and try looking up a word.
If the lookup fails or uses another dictionary, click the dictionary name in the pop-up to change your default dictionary to yours.
Now when you try to look up a word, your dictionary is searched first.</p>

<p>The great thing is that if a word <em>isn&rsquo;t</em> in your dictionary then the Kindle searches the other dictionaries<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.
This feature is great as it lets your dictionary be very focused.
Hopefully Amazon doesn&rsquo;t remove this feature.</p>

<h2>End</h2>

<p>It was interesting creating another dictionary so long after I made my first couple.
Some of the new features, like the ability to require an exact word match, would have been useful for my <a href="/blog/2013/07/09/releasing-the-functional-javascript-companion/">second dictionary</a>.
The actual markup recommendations have changed over the years but luckily my <a href="https://gumroad.com/l/dune-dictionary">Dune dictionary</a> still works.
I&rsquo;m not constantly checking that it works, so if Amazon had changed something and it broke, I probably wouldn&rsquo;t notice until someone reported it.</p>

<p>The Kindle documentation is much better now compared to 2013 but it still isn&rsquo;t great.</p>

<p>It is also a bummer that <code>kindlegen</code> is gone.
It was nice to be able to convert the input files from the command line.
I also think this means you can no longer make a dictionary from a Linux machine as I don&rsquo;t remember seeing Kindle Previewer support.</p>

<p>If you&rsquo;re ever in a situation where you think a custom dictionary would be useful, feel free to reach out.</p>

<p>Go forth and make dictionaries.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>This is actually a challenge to do due to restrictions on what Amazon allows published.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>No idea if it searches all of them in some order but I&rsquo;m very glad it works this way.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/10/03/go-create-silly-small-programs/">Go create silly, small programs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-10-03T13:24:00-05:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2020</span></span> <span class='time'>1:24 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Over the summer, I developed a couple of small, sort of silly programs.
One, <a href="https://jakemccrary.com/experiments/photo-fit/">Photo Fit</a>, is a little tool that runs in a web browser and resizes photos to fit as your phone&rsquo;s background.
The other, <a href="https://default-equipment.herokuapp.com/">Default Equipment</a>, runs on Heroku and automates changing the &ldquo;bike&rdquo; of my Strava-tracked e-bike rides to be my <a href="https://onewheel.com/">onewheel</a>.</p>

<p>These weren&rsquo;t created to solve large problems in the world.
There is no plan to make any money with them.
As of October 2020, Default Equipment doesn&rsquo;t even work for other people (though it could, send me a message if you&rsquo;d like to use it and I&rsquo;ll get around to it).</p>

<p>Each was created to fix a minor annoyance in my life and, because these tools can live on the Internet, they can fix the same minor annoyance in other lives.</p>

<p>With an increasing amount of software in the world, being able to write software is nearly sorcery<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.
As a developer, you can identify a problem in the world and then change the world to remove that problem.
And, depending on the problem, you can remove it for everyone else.</p>

<p>Software developers aren&rsquo;t alone in being able to identify problems and remove them through creation.
Carpenters can build shelves for their books.
Cooks can prepare food to remove hunger.
You can come up with nearly an infinite number of other examples.</p>

<p>The difference is that a solo developer can solve problems for an unknown number of other folks.
This is enabled by the Internet enabled ease of distribution.
This is very powerful.</p>

<p>Developers can expose their solution to others through a web application.
Desktop or mobile applications can be distributed through various app stores or made available as a download.
Source code can be made available for others to run.
Being able to distribute easily and cheaply is a game changer.</p>

<p>A developer&rsquo;s change to the world might be a minor improvement.
Photo Fit might never be used by anyone besides me.
But it is still out there, making the world slightly better.
It is available for someone to stumble upon when they are also annoyed by the same problem.</p>

<p>It felt good to write these tiny, useful programs.
If you scope them small enough, there is a definitive ending point<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.
This lets you feel that finishing-a-project satisfaction quickly.
The small size also allows you experiment with new techniques and tools without committing to a large and ongoing commitment.</p>

<p>I wrote both Photo Fit and Default Equipment in TypeScript.
Before the beginning of summer, I didn&rsquo;t know TypeScript and had little exposure to Node.js.
Now I have some experience with both and gained that while making small improvements to my life and potentially the lives of others.</p>

<p>If you haven&rsquo;t developed software to solve a small problem recently, I&rsquo;d recommend doing it.
Don&rsquo;t hesitate to remove a problem that feels silly.
Removing those problems can still make your life slightly better and gives you an opportunity to learn.
It feels good to remove an annoyance from your life.
If you can, make that software available to others so their lives are improved as well.
Take advantage of the power of easy distribution to improve the world and not just your tiny slice of it.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>This is taken to an extreme in the fantasy series <a href="https://www.goodreads.com/series/131379-magic-2-0">Magic 2.0</a>.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>Excluding any ongoing maintenance. But if you&rsquo;re making something small enough you can approach near zero ongoing maintenance. One of my longest running solve-my-own-problems application, Book Robot, has been operating for nearly 7 years with minimal effort.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/08/31/utilities-i-like-selecta/">Utilities I like: selecta</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-08-31T22:24:00-05:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2020</span></span> <span class='time'>10:24 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/garybernhardt/selecta">Selecta</a> is a command-line utility that gives you the power to fuzzy select items from a list of text.
What does that mean?
It means you pipe <code>selecta</code> a list of text on stdin, it helps you make a choice from items in that list, and then <code>selecta</code> prints that choice to stdout.</p>

<p>Here is an example of me using it to help me narrow in on what file I&rsquo;d like to pass to <code>wc</code>.</p>

<p><video autoplay loop muted playsinline>
  <source src="/images/selecta-search.webm" type="video/webm">
  <source src="/images/selecta-search.mp4" type="video/mp4">
</video></p>

<p>In this example, I search for markdown files using <code>ripgrep</code> (<code>rg</code>), type part of a filename, hit enter to select the match, and then see the <code>wc</code> stats of that file.
This isn&rsquo;t the greatest example of using <code>selecta</code> but it adequately shows what it does.</p>

<p>Some number of years ago, I wrote a script called <code>connect-db</code>.
This script used <code>selecta</code>, along with <code>grep</code>, <code>sed</code>, and <code>cut</code>, to provide a very pleasant command-line experience for connecting to known databases.
My coworkers and I used this script frequently.</p>

<p>By combining <code>selecta</code> with other stdin/stdout friendly command-line tools you can build really enjoyable, time-saving tools.
<a href="https://github.com/garybernhardt/selecta">Selecta</a> is a useful utility to add to your toolkit.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/07/03/introducing-photo-fit/">Introducing Photo Fit</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-07-03T18:37:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2020</span></span> <span class='time'>6:37 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier this year, I wanted to use a landscape photo as my background on my phone.
It wasn&rsquo;t the photo below but we can use it as an example.</p>

<p><img class="center" src="/images/photo-fit/keyboard-new-keycaps.jpg" title="Landscape image of my keyboard" alt="Landscape image of my keyboard"></p>

<p>When I made it my background, my phone<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> zoomed in to make it fit the portrait orientation of the phone.</p>

<p><img class="center" src="/images/photo-fit/phone-background-before.jpg" title="Screenshot of phone with zoomed in keyboard photo" alt="Screenshot of phone with zoomed in keyboard photo"></p>

<p>This is not great.
I don&rsquo;t want a zoomed in version that fits my vertical phone.
I want to see the whole photo with black bars at the top and bottom</p>

<p>I tried to find a way to add these bars using my phone.
I couldn&rsquo;t find an easy way.</p>

<p>At this point, a reasonable solution would have been transferring the photo to a computer, editing it, and transferring it back to my phone.
I didn&rsquo;t do that.
Instead, I wrote a little TypeScript<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> web app that adds the bars for you.
You open the website on your phone, select an image, and then download a properly sized image.</p>

<p><img class="center" src="/images/photo-fit/phone-background-after.jpg" title="Screenshot of phone with properly fitting image" alt="Screenshot of phone with properly fitting image"></p>

<p>The tool uses the canvas API and does all of the work in the browser itself.
It was a fun, bite-sized project and it gave me an excuse to write some TypeScript and do some web programming.
This was the first time I&rsquo;ve written TypeScript since learning it and I haven&rsquo;t done any web programming in a while.</p>

<p>Making <a href="/experiments/photo-fit/">Photo Fit</a> was not a fast approach to changing my phone&rsquo;s background.
But, now the tool exists and anyone, including future me, can quickly resize their photo from the comfort of their own phone.</p>

<p><a href="/experiments/photo-fit/">Photo Fit</a> is live and available for others to use.
I&rsquo;ve only tested it on my own phone and desktop browsers.
It might not work!
If you do try it and something weird happens, plese let me know.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>A Samsung S8 running Android 9 <a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>I recently learned some TypeScript through <a href="https://www.executeprogram.com">Execute Program</a>. Execute program is a really neat application of spaced repetition for learning programming concepts.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/06/28/using-bazel-to-help-fix-flaky-tests/">Using Bazel to help fix flaky tests</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-06-28T18:28:00-05:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>6:28 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Flaky tests are terrible.
These are tests that pass or fail without anything changing in the code.
They often pass the majority of the time and fail rarely.
This makes them hard to detect and cause developers to often just run the tests again.</p>

<p>Flaky tests erode your team&rsquo;s confidence in your system.
They cause folks to get in the habit of not trusting the output of tests.
This discourages people from writing tests as they stop seeing them as something that improves quality and instead view them as a drag on productivity.</p>

<p>Flaky tests are often hard to fix.
If they were easy to fix, they wouldn&rsquo;t have been flaky in the first place.
One difficulty in fixing them is that the failures are often hard to reproduce.</p>

<p>Often, the first step in fixing a flaky test is to write a script to run the tests multiple times in a row.
If you are using <a href="https://bazel.build/">Bazel</a> as your build tool you don&rsquo;t need to write this.</p>

<p>Here is an example <code>bazel</code><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> command for helping you recreate flaky test failures.</p>

<p><code>bazel test --test_strategy=exclusive --test_output=errors --runs_per_test=50 -t- //...</code></p>

<p>The above command is running all the test targets in a workspace and each flag is important.</p>

<ul>
<li><code>--runs_per_test=50</code> is telling Bazel to run each test 50 times.</li>
<li><code>--test_output=errors</code> is telling Bazel to only print errors to your console.</li>
<li><code>-t-</code> is a shortcut for <code>--nocache_test_results</code> (or <code>--cache_test_results=no</code>).
This flag tells Bazel to <strong>not</strong> cache the test results.</li>
<li><code>--test_strategy=exclusive</code> will cause tests to be run serially.
Without this, Bazel could run your test targets concurrently and if your tests aren&rsquo;t designed for this you may run into other failures.</li>
</ul>


<p>Flaky tests are terrible and you should try not to have them.
Try your best to have reliable tests.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>I&rsquo;ve written this while using Bazel 3.2.0. If you are reading this far in the future the flags may have changed.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/05/04/how-to-be-alerted-when-a-long-running-process-finishes/">How to be automatically notified when long running processes finish</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-05-04T20:35:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>8:35 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Let me set the stage.
I kick off the compilation of a large Scala codebase.
This will take minutes to finish, so I switch to Slack and catch up on what coworkers have posted.
Someone posted an interesting link and I follow it to an article.
Fifteen minutes later, I notice the compilation finished twelve minutes ago.
I silently grumble at myself, disappointed that I didn&rsquo;t start the next step twelve minutes ago.</p>

<p>Has some variation of the above happened to you?</p>

<p>It doesn&rsquo;t happen to me anymore because now my computer tells me when any long running process finishes.
This might sound annoying but it is great.
I no longer feel guilty<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> for dropping into Slack and can immediately get back to the task at hand as soon the process finishes.</p>

<p>I&rsquo;ve done this by enhancing on my setup for showing the <a href="/blog/2020/04/21/using-bash-preexec-for-monitoring-the-runtime-of-your-last-command/">runtime of the previous command in my prompt</a>.
You don&rsquo;t have to read that article for the rest of this one to make sense, but you should because it shows you how to add a very useful feature to your prompt.</p>

<p>Below is the code that causes my computer to tell me when it finishes running commands that takes longer than 30 seconds.
It is found in my <code>~/.bashrc</code>.
An explanation follows the code snippet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Using https://github.com/rcaloras/bash-preexec</span>
</span><span class='line'>preexec<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">_last_command</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;UNSET&quot;</span> <span class="o">==</span> <span class="s2">&quot;${_timer}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nv">_timer</span><span class="o">=</span><span class="nv">$SECONDS</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nv">_timer</span><span class="o">=</span><span class="k">${</span><span class="nv">_timer</span><span class="k">:-</span><span class="nv">$SECONDS</span><span class="k">}</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>_maybe_speak<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nb">local </span><span class="nv">elapsed_seconds</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">((</span> elapsed_seconds &gt; <span class="m">30</span> <span class="o">))</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>        <span class="nb">local </span>c
</span><span class='line'>        <span class="nv">c</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;${_last_command}&quot;</span> <span class="p">|</span> cut -d<span class="s1">&#39; &#39;</span> -f1<span class="k">)</span>
</span><span class='line'>        <span class="o">(</span> say <span class="s2">&quot;finished ${c}&quot;</span> <span class="p">&amp;</span> <span class="o">)</span>
</span><span class='line'>    <span class="k">fi</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>precmd<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;UNSET&quot;</span> <span class="o">==</span> <span class="s2">&quot;${_timer}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>     <span class="nv">timer_show</span><span class="o">=</span><span class="s2">&quot;0s&quot;</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nv">elapsed_seconds</span><span class="o">=</span><span class="k">$((</span>SECONDS <span class="o">-</span> _timer<span class="k">))</span>
</span><span class='line'>    _maybe_speak <span class="k">${</span><span class="nv">elapsed_seconds</span><span class="k">}</span>
</span><span class='line'>    <span class="nv">timer_show</span><span class="o">=</span><span class="s2">&quot;$(format-duration seconds $elapsed_seconds)&quot;</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'>  <span class="nv">_timer</span><span class="o">=</span><span class="s2">&quot;UNSET&quot;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># put at the bottom of my .bashrc</span>
</span><span class='line'><span class="o">[[</span> -f <span class="s2">&quot;$HOME/.bash-preexec.sh&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">source</span> <span class="s2">&quot;$HOME/.bash-preexec.sh&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/rcaloras/bash-preexec">Bash-Preexec</a> triggers the <code>preexec</code>, immediately before a command is execute, and <code>precmd</code> functions, immediately before the shell prompt reappears.
Those two functions are enough to figure out how much time has elapsed while a command ran.
You setup Bash-Preexec by downloading <a href="https://github.com/rcaloras/bash-preexec/blob/master/bash-preexec.sh">bash-preexec.sh</a> and sourcing it in your <code>~/.bashrc</code>.</p>

<p><code>preexec</code> is passed the command being ran and it captures it in <code>_last_command</code>.
It also captures the current number of seconds the shell has been running as <code>_timer</code>.</p>

<p><code>precmd</code> uses the value in <code>_timer</code> to calculate the elapsed time in seconds and then calls the function <code>_maybe_speak</code> with this as an argument.
It also does the work required for showing the elapsed time in my prompt.</p>

<p>If the elapsed time is greater than 30 seconds then <code>_maybe_speak</code> uses <code>cut</code> to discard the arguments of captured command, leaving me with the command itself.
It then uses <code>say</code> to produce an audible alert of what command just finished.
I discard the arguments because otherwise the <code>say</code> command can go on for a long time.</p>

<p><code>say</code> is a tool that ships with macOS.
I haven&rsquo;t gotten around to it yet but I&rsquo;ll need to use something else on my Linux machines.</p>

<p>You may have noticed that I run <code>say</code> in the background and in a subshell.
Running it in the background lets me continue interacting with my shell while <code>say</code> finishes executing and running it in a subshell prevents text from appearing in my shell when the background job finishes.</p>

<p>With this setup, I can kick off a slow compile or test run and not feel so bad about dropping into Slack or reading Reddit. It is wonderful and I&rsquo;d recommend it (though, I&rsquo;d more strongly recommend not having commands that take a while to run).</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>I still feel a little guilty as doing so will break any momentum/flow I had going on, but that flow was already broken by the slowness of the command.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/04/26/hanging-a-hangboard-using-a-doorway-pull-up-bar/">How to hang a hangboard using a doorway pull-up bar</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-04-26T20:42:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>8:42 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>If you&rsquo;ve browsed the <a href="/adventure">adventure</a> section of my website you know I&rsquo;m a climber.
Currently, the climbing gyms in Chicago are closed due to COVID-19 concerns.
This has put a damper on my training but I own a hangboard and have been able to keep training my fingers at home.</p>

<p>A hangboard allows you to apply stress to your fingers in a measured and controlled fashion.
It is a vital tool for a climber who is serious about getting stronger.
It is also a great rehab tool for coming back from injuries.</p>

<p>Below is my hangboard.</p>

<p><img src="/images/hangboard.png" alt="Hangboard mounted using hooks and a pull-up bar" /></p>

<p>As you can see from the photo, I&rsquo;ve hung mine using a doorway pull-up bar and a bunch of hooks.
This lets me easily take it down and causes no permanent damage to anything in my apartment.
The towels are there to make sure the door frame isn&rsquo;t crushed by any of the hard pieces.</p>

<p>Originally, I followed <a href="https://www.youtube.com/watch?v=Cu-MrncHpJo">this video</a> to mount it using some pipe and shoving the pipe into the pull-up bar.
This setup made me uncomfortable as the forces on the pull-up bar were far away from the intended location.
This resulted in a lot of flexing and I was concerned about how the pull-up bar was acting on the frame.</p>

<p>I searched online for other ideas and saw a setup that used hooks.
This was appealing to me as it moves your weight under the bar.
A quick trip to Home Depot and a bit of easy construction and now I can keep up my finger strength when stuck at home.
Here are the steps to build one.</p>

<ol>
<li>Buy a 2 inch x 10 inch wood board (or some other 2 inch x N inch board that is big enough for whatever you want to attach to it).</li>
<li>Cut the board so it spans the width of your doorway plus a few extra inches. Home Depot can do this for you.</li>
<li>Mount your hangboard to the board.</li>
<li>Take <a href="https://www.homedepot.com/p/Everbilt-Screw-in-Steel-Bicycle-Hook-with-Vinyl-Coating-25-lbs-21407/206585761">hooks</a>, typically used for hanging bicycles up in a garage, and screw them into the top of your 2-in x 10-in.</li>
<li>Hang the hooks over the pull-up bar. Adjust the hooks so each is pulling on the bar.</li>
<li>Find some padding, I used towels, and put the padding between the door trim and other hard surfaces.</li>
<li>Hang on your hangboard and get stronger.</li>
</ol>


<p>The board and hook method was much easier to construct than the other pull-up bar method and feels much more solid.
The pull-up bar isn&rsquo;t rated for too much weight, so I&rsquo;m not going to do any super heavy, two-handed hangs but it is plenty solid for other hangboard exercises.</p>

<p>If you&rsquo;re a climber and don&rsquo;t want to permanently mount a handboard, I&rsquo;d highly recommend this.
If you don&rsquo;t own a hangboard, I pick up something from <a href="https://www.tensionclimbing.com/hangboards/">Tension Climbing</a>.
Their wooden boards are easy on the finger tips and have all the edge sizes you&rsquo;ll need.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/04/21/using-bash-preexec-for-monitoring-the-runtime-of-your-last-command/">Using Bash-Preexec for monitoring the runtime of your last command</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-04-21T18:22:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2020</span></span> <span class='time'>6:22 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>My article on <a href="/blog/2015/05/03/put-the-last-commands-run-time-in-your-bash-prompt/">putting the runtime of your last command into your bash prompt</a> is one of my most surfaced-by-google articles.
Why is this a great to your prompt?
To quote my previous article:</p>

<blockquote><p>I’m fairly certain the following scenario has happened to every terminal user. You run a command and, while it is running, realize you should have prefixed it with <code>time</code>. You momentarily struggle with the thought of killing the command and rerunning it with <code>time</code>. You decide not to and the command finishes without you knowing how long it took. You debate running it again.</p>

<p>For the last year I’ve lived in a world without this problem. Upon completion, a command’s approximate run time is displayed in my prompt. It is awesome.</p></blockquote>

<p>I&rsquo;ve been living without the above problem since sometime in 2014 and not having that problem is still awesome.</p>

<p>I have made some changes since 2014.</p>

<p>One change was switching to using <a href="https://github.com/rcaloras/bash-preexec">Bash-Preexec</a> instead of directly using <code>trap</code> and <code>$PROMPT_COMMAND</code> for calling functions to start and stop tracking runtime.
Bash-Preexec lets you trigger a function (or multiple) right after a command has been read and right before each prompt.</p>

<p>The usage is pretty straight forward.
In the most basic case, you source <code>bash-preexec.sh</code> and then provide functions named <code>preexec</code>, which is invoked right before a command is executed, and/or <code>precmd</code>, which is invoked just before each prompt.
<code>bash-preexec.sh</code> can be downloaded from <a href="https://github.com/rcaloras/bash-preexec/">its repo</a>.
The changes required to move to Bash-Preexec pretty <a href="https://github.com/jakemcc/dotfiles/commit/46fc3dc9d4d7d0d73152c77b7383645af42b3d5d">pretty minimal</a>.</p>

<p>The other change was introducing the script, <a href="https://github.com/jakemcc/dotfiles/blob/9c8c0315f35b55df6cef7e21261e3dcbbfac86e1/home/.bin/format-duration#L3-L4">format-duration</a> by <a href="https://twitter.com/gfredericks_">Gary Fredericks</a>, to humanely format the time.
This script converts seconds into a more readable string (example: 310 to <code>5m10s</code>)</p>

<p>Here is a screenshot of everything in action (with a reduced prompt, my normal one includes git and other info).</p>

<p><img src="/images/runtime-humane-example.png" width="320" height="150" title="Command line prompt showing runtimes of previous commands" alt="Command line prompt showing runtimes of previous commands"></p>

<p>Below is a simplified snippet from my <code>.bashrc</code> that provides runtimes using both of these additions.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>preexec<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;UNSET&quot;</span> <span class="o">==</span> <span class="s2">&quot;${timer}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nv">timer</span><span class="o">=</span><span class="nv">$SECONDS</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nv">timer</span><span class="o">=</span><span class="k">${</span><span class="nv">timer</span><span class="k">:-</span><span class="nv">$SECONDS</span><span class="k">}</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>precmd<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;UNSET&quot;</span> <span class="o">==</span> <span class="s2">&quot;${timer}&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>     <span class="nv">timer_show</span><span class="o">=</span><span class="s2">&quot;0s&quot;</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nv">the_seconds</span><span class="o">=</span><span class="k">$((</span>SECONDS <span class="o">-</span> timer<span class="k">))</span>
</span><span class='line'>    <span class="c"># use format-duration to make time more human readable</span>
</span><span class='line'>    <span class="nv">timer_show</span><span class="o">=</span><span class="s2">&quot;$(format-duration seconds $the_seconds)&quot;</span>
</span><span class='line'>  <span class="k">fi</span>
</span><span class='line'>  <span class="nv">timer</span><span class="o">=</span><span class="s2">&quot;UNSET&quot;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Add $last_show to the prompt.</span>
</span><span class='line'><span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;[last: ${timer_show}s][\w]$ &#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># a bunch more lines until the end of my .bashrc</span>
</span><span class='line'><span class="c"># where I include .bash-preexec.sh</span>
</span><span class='line'><span class="o">[[</span> -f <span class="s2">&quot;$HOME/.bash-preexec.sh&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">source</span> <span class="s2">&quot;$HOME/.bash-preexec.sh&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>No more wondering about the runtime of commands is great.
Introducing <code>format-duration</code> made reading the time easier while Bash-Preexec made reading the implementation easier.
I highly recommend setting up something similar for your shell.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog//2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/12/30/speeding-up-magit-with-the-native-comp-branch-of-emacs/">Speeding up Magit with the native-comp branch of Emacs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/14/speeding-up-magit/">Speeding up magit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/11/creating-a-custom-kindle-dictionary/">Creating a custom Kindle dictionary</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/10/03/go-create-silly-small-programs/">Go create silly, small programs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/08/31/utilities-i-like-selecta/">Utilities I like: selecta</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/07/03/introducing-photo-fit/">Introducing Photo Fit</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/06/28/using-bazel-to-help-fix-flaky-tests/">Using Bazel to help fix flaky tests</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/05/04/how-to-be-alerted-when-a-long-running-process-finishes/">How to be automatically notified when long running processes finish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/26/hanging-a-hangboard-using-a-doorway-pull-up-bar/">How to hang a hangboard using a doorway pull-up bar</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/21/using-bash-preexec-for-monitoring-the-runtime-of-your-last-command/">Using Bash-Preexec for monitoring the runtime of your last command</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Subscribe</h1>
  <p>Looking forward to reading more of my writing?</p>
  <p>Sign up for my <a target="_blank" href="https://jakemccrary.substack.com/welcome">newsletter</a> to get periodic emails with links to my latest writing and other thoughts.</p>
  <p>Can't wait for the infrequent newsletter? Subscribe to the <a href="http://feeds.feedburner.com/JakeMccrarysMusings">RSS</a> feed.</p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
  


</body>
</html>
