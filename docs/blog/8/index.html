
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="iem7"><![endif]-->
<!--[if lt IE 9]><html class="lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html lang="en"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Jake McCrary</title>
    <meta name="author" content="Jake McCrary">

    
    
    
    

    <meta itemprop="name" content="Jake McCrary" />
    <meta itemprop="description" content=" Recently I rediscovered an Emacs package that allows you to interact
with HTTP endpoints from the comfort of an Emacs buffer.
restclient.el provides &hellip;" />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@jakemcc" />
    <meta name="twitter:title" content="Jake McCrary" />
    <meta name="twitter:description" content=" Recently I rediscovered an Emacs package that allows you to interact
with HTTP endpoints from the comfort of an Emacs buffer.
restclient.el provides &hellip;" />
    <meta name="twitter:creator" content="@jakemcc" />
    <meta name="twitter:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />

    <!-- Open Graph data -->
    <meta property="og:site_name" content="The Blog of Jake McCrary" />
    <meta property="og:url" content="https://jakemccrary.com/blog/8/" />
    <meta property="og:title" content="Jake McCrary" />
    <meta property="og:description" content=" Recently I rediscovered an Emacs package that allows you to interact
with HTTP endpoints from the comfort of an Emacs buffer.
restclient.el provides &hellip;" />
    <meta property="og:image" content="https://jakemccrary.com/images/jake-surprised-eyes-brighter.jpg" />
    
    

    <meta name="description" content=" Recently I rediscovered an Emacs package that allows you to interact
with HTTP endpoints from the comfort of an Emacs buffer.
restclient.el provides &hellip;">

    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://jakemccrary.com/blog/8/">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="alternate" title="Jake McCrary" type="application/atom+xml">
    <link href="https://jakemccrary.com/feed.json" rel="alternate" title="Jake McCrary" type="application/json">

    <!-- iOS scaling bug fix Rewritten version By @mathias, @cheeaun and @jdalton Source url: https://gist.github.com/901295 -->
    <script type="text/javascript">
     (function(doc) {
       var addEvent = 'addEventListener',
           type = 'gesturestart',
           qsa = 'querySelectorAll',
           scales = [1, 1],
           meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];
       function fix() {
         meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
         doc.removeEventListener(type, fix, true);
       }
       if ((meta = meta[meta.length - 1]) && addEvent in doc) {
         fix();
         scales = [0.25, 1.6];
         doc[addEvent](type, fix, true);
       }
     }(document));
    </script>
    
<script>
 var origin = window.location.origin;
 if (!origin) {
   origin = window.location.protocol + '//' + window.location.hostname + (window.location.port ? (':' + window.location.port) : '');
 }
 if (origin.indexOf('localhost') === -1) {
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-19834208-2', 'auto');
   ga('send', 'pageview');
 }
</script>


  </head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake McCrary</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul role=main-navigation>
  <li><a href="/">Articles</a></li>
  <li><a href="/adventures/">Adventures</a></li>
  <li><a href="/about.html">About</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
  <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>

  <form action="https://google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="sitesearch" value="jakemccrary.com">
      <input class="search" type="text" name="q" placeholder="Search"/>
    </fieldset>
  </form>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/04/using-emacs-to-explore-an-http-api/">Using Emacs to Explore an HTTP API</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-04T13:05:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:05 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I rediscovered an Emacs package that allows you to interact
with HTTP endpoints from the comfort of an Emacs buffer.
<a href="https://github.com/pashky/restclient.el">restclient.el</a> provides
<code>restclient-mode</code>. This mode allows you to write and execute HTTP
requests in an Emacs buffer. This package can be found in
<a href="http://melpa.milkbox.net/#/restclient">MELPA</a>.</p>

<p>Below is an example buffer that touches the GitHub API.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">:github</span> <span class="o">=</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">api</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># get users orgs</span>
</span><span class='line'>
</span><span class='line'><span class="no">GET</span> <span class="ss">:github</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">jakemcc</span><span class="o">/</span><span class="n">orgs</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># rendor markdown</span>
</span><span class='line'>
</span><span class='line'><span class="no">POST</span> <span class="ss">:github</span><span class="o">/</span><span class="n">markdown</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;text&quot;</span> <span class="p">:</span> <span class="s2">&quot;## Title&quot;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># rendor markdown raw</span>
</span><span class='line'>
</span><span class='line'><span class="no">POST</span> <span class="ss">:github</span><span class="o">/</span><span class="n">markdown</span><span class="o">/</span><span class="n">raw</span>
</span><span class='line'><span class="no">Content</span><span class="o">-</span><span class="ss">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span>
</span><span class='line'>
</span><span class='line'><span class="no">Title</span>
</span><span class='line'><span class="o">-----</span>
</span></code></pre></td></tr></table></div></figure>


<p>The example above has a few interesting snippets. <code>:github</code> is an
example of a variable. Lines 8-14 show an example of posting json to
an endpoint. You put the data you want to send below the query. The
last POST shows how to set headers for a request.</p>

<p>The location of your cursor decides what query to execute. Comments
start with <code>#</code> and break your document into sections. The query in the
same section as your cursor is the one that is executed. If the cursor
is anywhere on lines 3-6 and I hit <code>C-c C-c</code> then Emacs queries GitHub
for my organizations. Below is what pops up in a buffer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;avatar_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/avatars.githubusercontent.com\/u\/1826953?&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;public_members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/public_members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;events_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/events&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;repos_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf\/repos&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/speakerconf&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1826953</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;login&quot;</span><span class="o">:</span> <span class="s2">&quot;speakerconf&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;avatar_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/avatars.githubusercontent.com\/u\/4711436?&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;public_members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/public_members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;members_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/members{\/member}&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;events_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/events&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;repos_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace\/repos&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;https:\/\/api.github.com\/orgs\/outpace&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">4711436</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;login&quot;</span><span class="o">:</span> <span class="s2">&quot;outpace&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'><span class="c1">// HTTP/1.1 200 OK</span>
</span><span class='line'><span class="c1">// Server: GitHub.com</span>
</span><span class='line'><span class="c1">// Date: Fri, 04 Jul 2014 17:34:26 GMT</span>
</span><span class='line'><span class="c1">// Content-Type: application/json; charset=utf-8</span>
</span><span class='line'><span class="c1">// other headers removed for space consideration on blog</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>C-c C-c</code> triggers <code>restclient-http-send-current</code> which runs a query
and pretty prints the result. I could have used <code>C-c C-r</code> to trigger
<code>restclient-http-send-current-raw</code> which executes a query and shows
the raw result.</p>

<p>It isn&rsquo;t a perfect mode. One issue I&rsquo;ve come across is that queries
targeting <code>localhost</code> fail. The solution is to query <code>127.0.0.1</code>.</p>

<p><code>restclient-mode</code> makes Emacs a useful tool for exploring and
testing HTTP APIs. Since it operates on a simple text
format it allows you to easily share executable documentation with
others. I highly recommend <strong>restclient.el</strong>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/22/comparing-clojure-testing-libraries-output/">Comparing Clojure Testing Libraries: Output</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-22T21:16:00-05:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>9:16 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I recently became interested in how Clojure testing libraries help you
when there is a test failure. This interest resulted in me
<a href="https://github.com/jakemcc/clojure-test-bed">exploring</a> different
Clojure testing libraries. I created the same tests using <strong>clojure.test</strong>
(with and without
<a href="https://github.com/pjstadig/humane-test-output">humane-test-output</a>),
<a href="http://jayfields.com/expectations/">expectations</a>,
<a href="https://github.com/marick/Midje">Midje</a>, and
<a href="http://speclj.com/">Speclj</a> and looked at the output.</p>

<p>I ran all of these examples using Leiningen. <strong>Midje</strong>, <strong>Speclj</strong>, and
<strong>expectations</strong> color their output but I&rsquo;m not going to try to reproduce
that here. The color added by <strong>Midje</strong> and <strong>expectations</strong> is useful. <strong>Speclj</strong>
color hurt its readability. I use a dark colored terminal and <strong>Speclj</strong>
colors the line that tells where the failure occurs
black. This made it hard to read.</p>

<p>I&rsquo;m not going to show what the tests look like for each testing
library past the first comparison. How a test in expressed is
important but not what I want to focus on in this post.</p>

<h2>Comparing Strings</h2>

<p>Going to start off with a basic string comparison. The failing test
compares two strings that only differ by one character.</p>

<h5>clojure.test</h5>

<p>Most (hopefully all) Clojure programmers should be familiar with
<strong>clojure.test</strong>. It is the testing library that is included with Clojure.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.string-test</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.test</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">string-comparisons</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="s">&quot;strings equal&quot;</span> <span class="s">&quot;strings equal&quot;</span><span class="p">))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="s">&quot;space&quot;</span> <span class="s">&quot;spice&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>The output below is what you get when the above test runs. Even in
this simple example it isn&rsquo;t the easiest to read. It doesn&rsquo;t make it
easy to find the expected or actual values.</p>

<figure class='code'><figcaption><span>clojure.test output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (string-comparisons) (string_test.clj:6)</span>
</span><span class='line'><span class="go">expected: (= &quot;space&quot; &quot;spice&quot;)</span>
</span><span class='line'><span class="go">  actual: (not (= &quot;space&quot; &quot;spice&quot;))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below is the same test but with <strong>humane-test-output</strong> enabled. It is easy
to read the output and see the expected and actual value. It even
provides a diff between them although in this situation it isn&rsquo;t that useful.</p>

<figure class='code'><figcaption><span>clojure.test with humane-test-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (string-comparisons) (string_test.clj:6)</span>
</span><span class='line'><span class="go">expected: &quot;space&quot;</span>
</span><span class='line'><span class="go">  actual: &quot;spice&quot;</span>
</span><span class='line'><span class="go">    diff: - &quot;space&quot;</span>
</span><span class='line'><span class="go">          + &quot;spice&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h5>expectations</h5>

<p>Another testing library is Jay Field&rsquo;s
<a href="http://jayfields.com/expectations/">expectations</a>. You can see from
the example that it has a fairly minimal syntax.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.string-expectations</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">expectations</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">expect</span> <span class="s">&quot;strings equal&quot;</span> <span class="s">&quot;strings equal&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="nf">expect</span> <span class="s">&quot;space&quot;</span> <span class="s">&quot;spice&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>expectations output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">failure in (string_expectations.clj:5) : example.string-expectations</span>
</span><span class='line'><span class="go">(expect &quot;space&quot; &quot;spice&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: &quot;space&quot;</span>
</span><span class='line'><span class="go">                was: &quot;spice&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="go">           matches: &quot;sp&quot;</span>
</span><span class='line'><span class="go">           diverges: &quot;ace&quot;</span>
</span><span class='line'><span class="go">                  &amp;: &quot;ice&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The output from <strong>expectations</strong> is very readable. You can easily pick out
the expected and actual values. It also shows you where the
string starts to diverge.</p>

<h5>Speclj</h5>

<p>Before writing this post I had zero experience with Micah Martin&rsquo;s
<a href="http://speclj.com/">Speclj</a>. Below is my translation of the failing
string test and its output.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.string-spec</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">speclj.core</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">describe</span> <span class="s">&quot;String comparisons&quot;</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">it</span> <span class="s">&quot;have nice error message&quot;</span>
</span><span class='line'>      <span class="p">(</span><span class="nf">should=</span> <span class="s">&quot;space&quot;</span> <span class="s">&quot;spice&quot;</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Speclj</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">  9) String comparisons have nice error message</span>
</span><span class='line'><span class="go">     Expected: &quot;space&quot;</span>
</span><span class='line'><span class="go">          got: &quot;spice&quot; (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/string_spec.clj:7</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Speclj</strong>&rsquo;s test output above is an improvement over <strong>clojure.test</strong>. You
can easily find the expected and actual values. It doesn&rsquo;t provide any
help with diagnosing how those values are different.</p>

<h5>Midje</h5>

<p>I have a little bit of experience with Brian Marick&rsquo;s
<a href="https://github.com/marick/Midje">Midje</a>. Unlike the other libraries
it switches up the assertion syntax. In <strong>Midje</strong> the expected value is on
the right side of <code>=&gt;</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.string-test</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">midje.sweet</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">fact</span> <span class="s">&quot;strings are equal&quot;</span>
</span><span class='line'>  <span class="s">&quot;string is equal&quot;</span> <span class="nv">=&gt;</span> <span class="s">&quot;string is equal&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">fact</span> <span class="s">&quot;strings not equal&quot;</span>
</span><span class='line'>   <span class="s">&quot;spice&quot;</span> <span class="nv">=&gt;</span> <span class="s">&quot;space&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Midje</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL &quot;strings not equal&quot; at (string_test.clj:8)</span>
</span><span class='line'><span class="go">    Expected: &quot;space&quot;</span>
</span><span class='line'><span class="go">      Actual: &quot;spice&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Midje</strong>&rsquo;s output is similar to <strong>Speclj</strong>&rsquo;s. You can quickly find the
expected and actual values but it doesn&rsquo;t help you spot the
difference.</p>

<h3>String Comparison Winner</h3>

<p><strong>expectations</strong> wins for best output. You can easily spot the expected
and actual values and it also helps you find the difference between
the strings.</p>

<p>The worst output comes from <strong>clojure.test</strong>. It doesn&rsquo;t make it easy to
spot the difference or even find the expected and actual values.</p>

<h2>Comparing Maps</h2>

<p>For maps I&rsquo;ve setup three assertions. The first has an extra key-value
pair in the actual value. The second has an extra in the expected
value. The final assertion has a different value for the <code>:cheese</code>
key. The <strong>clojure.test</strong> example is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">map-comparisons</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="p">{</span><span class="ss">:sheep</span> <span class="mi">1</span><span class="p">}</span> <span class="p">{</span><span class="ss">:cheese</span> <span class="mi">1</span> <span class="ss">:sheep</span> <span class="mi">1</span><span class="p">}))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="p">{</span><span class="ss">:sheep</span> <span class="mi">1</span> <span class="ss">:cheese</span> <span class="mi">1</span><span class="p">}</span> <span class="p">{</span><span class="ss">:sheep</span> <span class="mi">1</span><span class="p">}))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="p">{</span><span class="ss">:sheep</span> <span class="mi">1</span> <span class="ss">:cheese</span> <span class="mi">1</span><span class="p">}</span> <span class="p">{</span><span class="ss">:sheep</span> <span class="mi">1</span> <span class="ss">:cheese</span> <span class="mi">5</span><span class="p">})))</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>clojure.test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (map-comparisons) (map_test.clj:5)</span>
</span><span class='line'><span class="go">expected: (= {:sheep 1} {:cheese 1, :sheep 1})</span>
</span><span class='line'><span class="go">  actual: (not (= {:sheep 1} {:cheese 1, :sheep 1}))</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (map-comparisons) (map_test.clj:6)</span>
</span><span class='line'><span class="go">expected: (= {:sheep 1, :cheese 1} {:sheep 1})</span>
</span><span class='line'><span class="go">  actual: (not (= {:cheese 1, :sheep 1} {:sheep 1}))</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (map-comparisons) (map_test.clj:7)</span>
</span><span class='line'><span class="go">expected: (= {:sheep 1, :cheese 1} {:sheep 1, :cheese 5})</span>
</span><span class='line'><span class="go">  actual: (not (= {:cheese 1, :sheep 1} {:cheese 5, :sheep 1}))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Unsurprisingly the default <strong>clojure.test</strong> output for maps suffers from
the same problems found in the string comparisons. To find the
actual and expected values you need to manually parse the output.</p>

<figure class='code'><figcaption><span>clojure.test with humane-test-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (map-comparisons) (map_test.clj:5)</span>
</span><span class='line'><span class="go">expected: {:sheep 1}</span>
</span><span class='line'><span class="go">  actual: {:cheese 1, :sheep 1}</span>
</span><span class='line'><span class="go">    diff: + {:cheese 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (map-comparisons) (map_test.clj:6)</span>
</span><span class='line'><span class="go">expected: {:cheese 1, :sheep 1}</span>
</span><span class='line'><span class="go">  actual: {:sheep 1}</span>
</span><span class='line'><span class="go">    diff: - {:cheese 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (map-comparisons) (map_test.clj:7)</span>
</span><span class='line'><span class="go">expected: {:cheese 1, :sheep 1}</span>
</span><span class='line'><span class="go">  actual: {:cheese 5, :sheep 1}</span>
</span><span class='line'><span class="go">    diff: - {:cheese 1}</span>
</span><span class='line'><span class="go">          + {:cheese 5}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Above is the output of using <strong>clojure.test</strong> with <strong>humane-test-output</strong>. It
is a big improvement over the default <strong>clojure.test</strong>. You can quickly
see the expected and actual values. Unlike with the string assertions
the diff view is actually helpful. The diffs do a good job of helping
you identify the error.</p>

<figure class='code'><figcaption><span>expectations</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">failure in (map_expectations.clj:6) : example.map-expectations</span>
</span><span class='line'><span class="go">(expect {:sheep 1} {:sheep 1, :cheese 1})</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: {:sheep 1}</span>
</span><span class='line'><span class="go">                was: {:cheese 1, :sheep 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: null</span>
</span><span class='line'><span class="go">           in actual, not expected: {:cheese 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">failure in (map_expectations.clj:7) : example.map-expectations</span>
</span><span class='line'><span class="go">(expect {:sheep 1, :cheese 1} {:sheep 1})</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: {:cheese 1, :sheep 1}</span>
</span><span class='line'><span class="go">                was: {:sheep 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: {:cheese 1}</span>
</span><span class='line'><span class="go">           in actual, not expected: null</span>
</span><span class='line'>
</span><span class='line'><span class="go">failure in (map_expectations.clj:8) : example.map-expectations</span>
</span><span class='line'><span class="go">(expect {:sheep 1, :cheese 5} {:sheep 1, :cheese 1})</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: {:cheese 5, :sheep 1}</span>
</span><span class='line'><span class="go">                was: {:cheese 1, :sheep 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: {:cheese 5}</span>
</span><span class='line'><span class="go">           in actual, not expected: {:cheese 1}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>expectations</strong> does a pretty good job helping you as well. As before,
you can clearly read the expected and actual values. <strong>expectations</strong> also
provides some hint as to what is different between the maps. I find
the English descriptions a bit easier to read than
<strong>humane-test-output</strong>&rsquo;s diff view. Still seeing lines like line 7 (<code>in
expected, not actual: null</code>) is a bit confusing and the output would
be improved if it was suppressed.</p>

<p>I&rsquo;m just going to lump <strong>Speclj</strong> and <strong>Midje</strong> together. The output for each
is below. They both improve over <strong>clojure.test</strong> by making it easy to see
the expected and actual value. They both don&rsquo;t do anything beyond that.</p>

<figure class='code'><figcaption><span>Speclj</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">  4) map comparisons have nice error messages when extra entries keys present</span>
</span><span class='line'><span class="go">     Expected: {:sheep 1}</span>
</span><span class='line'><span class="go">          got: {:cheese 1, :sheep 1} (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/map_spec.clj:7</span>
</span><span class='line'>
</span><span class='line'><span class="go">  5) map comparisons have nice error messages when missing an entry</span>
</span><span class='line'><span class="go">     Expected: {:cheese 1, :sheep 1}</span>
</span><span class='line'><span class="go">          got: {:sheep 1} (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/map_spec.clj:9</span>
</span><span class='line'>
</span><span class='line'><span class="go">  6) map comparisons have nice error messages when mismatched values</span>
</span><span class='line'><span class="go">     Expected: {:cheese 5, :sheep 1}</span>
</span><span class='line'><span class="go">          got: {:cheese 1, :sheep 1} (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/map_spec.clj:11</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Midje</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL &quot;map is missing an entry&quot; at (map_test.clj:5)</span>
</span><span class='line'><span class="go">    Expected: {:cheese 1, :sheep 1}</span>
</span><span class='line'><span class="go">      Actual: {:sheep 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL &quot;map has an extra entry&quot; at (map_test.clj:8)</span>
</span><span class='line'><span class="go">    Expected: {:sheep 1}</span>
</span><span class='line'><span class="go">      Actual: {:cheese 1, :sheep 1}</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL &quot;map has a different value&quot; at (map_test.clj:11)</span>
</span><span class='line'><span class="go">    Expected: {:cheese 5, :sheep 1}</span>
</span><span class='line'><span class="go">      Actual: {:cheese 1, :sheep 1}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Map Comparison Winner</h3>

<p>Tie between <strong>humane-test-output</strong> and <strong>expectations</strong>. Both do a
good job of helping the reader spot the difference.</p>

<h2>Comparing Sets</h2>

<p>Next up are sets. Only two assertions for this section. One
with the actual value having an extra member and one test where it is
missing a member.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.set-test</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.test</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">set-comparisons</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="o">#</span><span class="p">{</span><span class="ss">:a</span> <span class="ss">:b</span><span class="p">}</span> <span class="o">#</span><span class="p">{</span><span class="ss">:a</span> <span class="ss">:b</span> <span class="ss">:c</span><span class="p">}))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="o">#</span><span class="p">{</span><span class="ss">:a</span> <span class="ss">:b</span> <span class="ss">:c</span><span class="p">}</span> <span class="o">#</span><span class="p">{</span><span class="ss">:a</span> <span class="ss">:b</span><span class="p">})))</span>
</span></code></pre></td></tr></table></div></figure>


<p>First up is the basic <strong>clojure.test</strong> output. It suffers from the same
problem it has suffered this entire time. It doesn&rsquo;t make it easy to
read the expected and actual values.</p>

<figure class='code'><figcaption><span>clojure.test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (set-comparisons) (set_test.clj:5)</span>
</span><span class='line'><span class="go">expected: (= #{:b :a} #{:c :b :a})</span>
</span><span class='line'><span class="go">  actual: (not (= #{:b :a} #{:c :b :a}))</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (set-comparisons) (set_test.clj:6)</span>
</span><span class='line'><span class="go">expected: (= #{:c :b :a} #{:b :a})</span>
</span><span class='line'><span class="go">  actual: (not (= #{:c :b :a} #{:b :a}))</span>
</span></code></pre></td></tr></table></div></figure>


<p>No surprises with <strong>humane-test-output</strong>. It improves the <strong>clojure.test</strong>
output by making it easy to read the expected and actual values. The
diff view also helps figure out what is causing the assertion to fail.</p>

<figure class='code'><figcaption><span>clojure.test with humane-test-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (set-comparisons) (set_test.clj:5)</span>
</span><span class='line'><span class="go">expected: #{:b :a}</span>
</span><span class='line'><span class="go">  actual: #{:c :b :a}</span>
</span><span class='line'><span class="go">    diff: + #{:c}</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (set-comparisons) (set_test.clj:6)</span>
</span><span class='line'><span class="go">expected: #{:c :b :a}</span>
</span><span class='line'><span class="go">  actual: #{:b :a}</span>
</span><span class='line'><span class="go">    diff: - #{:c}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>expectations</strong> once again delivers nice output. It continues to be easy
to find the expected and actual values and helps you spot the
differences with a diff view.</p>

<figure class='code'><figcaption><span>expectations</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">failure in (set_expectations.clj:4) : example.set-expectations</span>
</span><span class='line'><span class="go">(expect #{:b :a} #{:c :b :a})</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: #{:b :a}</span>
</span><span class='line'><span class="go">                was: #{:c :b :a}</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: null</span>
</span><span class='line'><span class="go">           in actual, not expected: #{:c}</span>
</span><span class='line'>
</span><span class='line'><span class="go">failure in (set_expectations.clj:5) : example.set-expectations</span>
</span><span class='line'><span class="go">(expect #{:c :b :a} #{:b :a})</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: #{:c :b :a}</span>
</span><span class='line'><span class="go">                was: #{:b :a}</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: #{:c}</span>
</span><span class='line'><span class="go">           in actual, not expected: null</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Speclj</strong> and <strong>Midje</strong> both have better output than the basic <strong>clojure.test</strong>.</p>

<figure class='code'><figcaption><span>Speclj</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">  7) set comparisons have nice error messages when missing item</span>
</span><span class='line'><span class="go">     Expected: #{:b :a}</span>
</span><span class='line'><span class="go">          got: #{:c :b :a} (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/set_spec.clj:9</span>
</span><span class='line'>
</span><span class='line'><span class="go">  8) set comparisons have nice error messages when more items</span>
</span><span class='line'><span class="go">     Expected: #{:c :b :a}</span>
</span><span class='line'><span class="go">          got: #{:b :a} (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/set_spec.clj:11</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Midje</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL &quot;set is superset of expected&quot; at (set_test.clj:5)</span>
</span><span class='line'><span class="go">    Expected: #{:a :b}</span>
</span><span class='line'><span class="go">      Actual: #{:a :b :c}</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL &quot;set is subset of expected&quot; at (set_test.clj:8)</span>
</span><span class='line'><span class="go">    Expected: #{:a :b :c}</span>
</span><span class='line'><span class="go">      Actual: #{:a :b}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Set Comparison Winner</h3>

<p>Similar to the winner of the map comparisons I&rsquo;m going to split the
victory between <strong>expectations</strong> and <strong>humane-test-output</strong>.</p>

<h2>Comparing Lists</h2>

<p>Next up we compare lists (and lists to vectors). There are three
comparisons; one with an extra element, one with same length but a
mismatched element, and one comparing a vector and list with drastically
different contents.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">example.seq-test</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.test</span> <span class="ss">:refer</span> <span class="ss">:all</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nf">deftest</span> <span class="nv">list-comparisons</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)))</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">is</span> <span class="p">(</span><span class="nb">= </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">9</span> <span class="mi">8</span> <span class="mi">7</span><span class="p">)</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])))</span>
</span></code></pre></td></tr></table></div></figure>


<p>First up <strong>clojure.test</strong>. Same issues as with all the previous
comparisons.</p>

<figure class='code'><figcaption><span>clojure.test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (list-comparisons) (seq_test.clj:5)</span>
</span><span class='line'><span class="go">expected: (= (quote (1 2 3)) (quote (1 2 3 4)))</span>
</span><span class='line'><span class="go">  actual: (not (= (1 2 3) (1 2 3 4)))</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (list-comparisons) (seq_test.clj:6)</span>
</span><span class='line'><span class="go">expected: (= (quote (1 2 4)) (quote (1 2 3)))</span>
</span><span class='line'><span class="go">  actual: (not (= (1 2 4) (1 2 3)))</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (list-comparisons) (seq_test.clj:7)</span>
</span><span class='line'><span class="go">expected: (= (quote (9 8 7)) [1 2 3])</span>
</span><span class='line'><span class="go">  actual: (not (= (9 8 7) [1 2 3]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once again <strong>humane-test-output</strong> improves upon <strong>clojure.test</strong>. Only
interesting difference from previous comparisons is that the diff view
ends up having <code>nil</code> values in it where the elements are the same.</p>

<figure class='code'><figcaption><span>clojure.test with humane-test-output</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL in (list-comparisons) (seq_test.clj:5)</span>
</span><span class='line'><span class="go">expected: (1 2 3)</span>
</span><span class='line'><span class="go">  actual: (1 2 3 4)</span>
</span><span class='line'><span class="go">    diff: + [nil nil nil 4]</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (list-comparisons) (seq_test.clj:6)</span>
</span><span class='line'><span class="go">expected: (1 2 4)</span>
</span><span class='line'><span class="go">  actual: (1 2 3)</span>
</span><span class='line'><span class="go">    diff: - [nil nil 4]</span>
</span><span class='line'><span class="go">          + [nil nil 3]</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL in (list-comparisons) (seq_test.clj:7)</span>
</span><span class='line'><span class="go">expected: (9 8 7)</span>
</span><span class='line'><span class="go">  actual: [1 2 3]</span>
</span><span class='line'><span class="go">    diff: - [9 8 7]</span>
</span><span class='line'><span class="go">          + [1 2 3]</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>expectations</strong> continues to have good output. It tries to help you out
as well. You&rsquo;ll notice that it also has <code>nil</code> values inserted
where the lists are the same.</p>

<figure class='code'><figcaption><span>expectations</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">failure in (list_expectations.clj:4) : example.list-expectations</span>
</span><span class='line'><span class="go">(expect &#39;(1 2 3) &#39;(1 2 3 4))</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: (1 2 3)</span>
</span><span class='line'><span class="go">                was: (1 2 3 4)</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: null</span>
</span><span class='line'><span class="go">           in actual, not expected: [nil nil nil 4]</span>
</span><span class='line'><span class="go">           actual is larger than expected</span>
</span><span class='line'>
</span><span class='line'><span class="go">failure in (list_expectations.clj:5) : example.list-expectations</span>
</span><span class='line'><span class="go">(expect &#39;(1 2 4) &#39;(1 2 3))</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: (1 2 4)</span>
</span><span class='line'><span class="go">                was: (1 2 3)</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: [nil nil 4]</span>
</span><span class='line'><span class="go">           in actual, not expected: [nil nil 3]</span>
</span><span class='line'>
</span><span class='line'><span class="go">failure in (list_expectations.clj:6) : example.list-expectations</span>
</span><span class='line'><span class="go">(expect &#39;(9 8 7) [1 2 3])</span>
</span><span class='line'>
</span><span class='line'><span class="go">           expected: (9 8 7)</span>
</span><span class='line'><span class="go">                was: [1 2 3]</span>
</span><span class='line'>
</span><span class='line'><span class="go">           in expected, not actual: [9 8 7]</span>
</span><span class='line'><span class="go">           in actual, not expected: [1 2 3]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Unsurprisingly, <strong>Speclj</strong> and <strong>Midje</strong> are better than <strong>clojure.test</strong> but
again don&rsquo;t go beyond making easy to find the expected and actual
values.</p>

<figure class='code'><figcaption><span>Speclj</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">  1) List/vector comparisons when there is an extra element</span>
</span><span class='line'><span class="go">     Expected: (1 2 3)</span>
</span><span class='line'><span class="go">          got: (1 2 3 4) (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/string_spec.clj:7</span>
</span><span class='line'>
</span><span class='line'><span class="go">  2) List/vector comparisons when there is a mismatched element</span>
</span><span class='line'><span class="go">     Expected: (1 2 4)</span>
</span><span class='line'><span class="go">          got: (1 2 3) (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/string_spec.clj:9</span>
</span><span class='line'>
</span><span class='line'><span class="go">  3) List/vector comparisons when comparing different types</span>
</span><span class='line'><span class="go">     Expected: (9 8 7)</span>
</span><span class='line'><span class="go">          got: [1 2 3] (using =)</span>
</span><span class='line'><span class="go">     /Users/jake/src/jakemcc/example/spec/example/string_spec.clj:11</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Midje</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">FAIL &quot;lists are different sizes&quot; at (seq_test.clj:5)</span>
</span><span class='line'><span class="go">    Expected: (1 2 3)</span>
</span><span class='line'><span class="go">      Actual: (1 2 3 4)</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL &quot;lists have different entries&quot; at (seq_test.clj:8)</span>
</span><span class='line'><span class="go">    Expected: (1 2 4)</span>
</span><span class='line'><span class="go">      Actual: (1 2 3)</span>
</span><span class='line'>
</span><span class='line'><span class="go">FAIL &quot;compare very different list like values&quot; at (seq_test.clj:14)</span>
</span><span class='line'><span class="go">    Expected: (9 8 7)</span>
</span><span class='line'><span class="go">      Actual: [1 2 3]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>List Comparison Winner</h3>

<p>I find the <strong>clojure.test</strong> with <strong>humane-test-output</strong> to be a bit easier to
read than <strong>expectations</strong>. Both have better output than the basic
<strong>clojure.test</strong>, <strong>Speclj</strong>, and <strong>Midje</strong>.</p>

<h2>Overall Winner</h2>

<p>If I were picking a testing library based entirely on what a failing
test looks like I would use <strong>expectations</strong>. My second pick would be
<strong>clojure.test</strong> with <strong>humane-test-output</strong>.</p>

<p>It is great that Clojure ships with <strong>clojure.test</strong>. It is unfortunate
that it does so little to help you read a failing test. Every library
I tried has better output than <strong>clojure.test</strong>.</p>

<h3>Addendum</h3>

<p><em>Added 2014/06/23</em></p>

<p>Colin Jones
<a href="http://jakemccrary.com/blog/2014/06/22/comparing-clojure-testing-libraries-output/#comment-1449451549">points out</a>
that Speclj provides <code>should==</code>. <code>should==</code> checks that the expected
and actual value have the same contents. He provided a
<a href="https://gist.github.com/trptcolin/7e1ece5179581085730f">gist</a> that
shows the difference.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/31/quicker-feedback-from-failing-tests/">Quicker Feedback From Failing Tests</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-05-31T13:14:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>1:14 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>Over the last couple of years I&rsquo;ve desired quicker feedback from my
Clojure tests. This has resulted in the development of
<a href="https://github.com/jakemcc/lein-autoexpect">lein-autoexpect</a> and more
recently
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a>.
Each tool monitors your project for changes and on change uses
<a href="https://github.com/clojure/tools.namespace">tools.namespace</a> to
reload your code and then reruns either your
<a href="http://jayfields.com/expectations/">expectations</a> or <code>clojure.test</code>
tests. Using tools like these has changed my development process.</p>

<p>Version 0.5.0 of <strong>lein-test-refresh</strong> was released last week. This
release enables even quicker feedback by tracking which tests fail and
after reloading your code it runs those tests first. Only when your
previously failed tests pass does it then rerun all of your tests.</p>

<p><strong>lein-test-refresh</strong> has had quite a few features added since I last
wrote about it. The
<a href="https://github.com/jakemcc/lein-test-refresh/blob/master/README.md#features">readme</a>
will always have the latest list but as of the time of writing this
they include:</p>

<ul>
<li>Reloads code and reruns tests on changes to your project&rsquo;s code.</li>
<li>Runs previously failing tests first.</li>
<li>Supports
<a href="https://github.com/jakemcc/lein-test-refresh/blob/d6b2f2710ae94ae3270d92b0efd85d481717477b/sample.project.clj#L6-L9">custom notification</a>
commands.</li>
<li>Built in <a href="http://growl.info/">Growl</a> support.</li>
<li>Can notify after test success and failure or <a href="https://github.com/jakemcc/lein-test-refresh/blob/d6b2f2710ae94ae3270d92b0efd85d481717477b/sample.project.clj#L12">just after failure</a>.</li>
<li>Supports a
<a href="https://github.com/jakemcc/lein-test-refresh/blob/master/CHANGES.md#040">subset</a>
of Leiningen test selectors.</li>
<li>Reports on your tests running time.</li>
</ul>


<p>I don&rsquo;t have enough experience with the new <strong>lein-test-refresh</strong> to
say how having failing tests will affect my development practices. I
don&rsquo;t expect this to change my development practices but it will
enable quicker feedback. Quick feedback cycles are what it is all
about.</p>

<h3>Acknowledgments</h3>

<p>Most of the &lsquo;rerun failed tests first&rsquo; feature was hashed out and spiked
during a mob programming session organized by
<a href="http://www.zeespencer.com/">Zee Spencer</a>. This happened at a company
conference put on by <a href="http://www.outpace.com/">Outpace</a> in Las Vegas.
Many developers were involved but two that most influenced the final
result were <a href="https://github.com/noprompt">Joel Holdbrooks</a> and
<a href="https://github.com/timothypratley">Timothy Pratley</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/24/book-review-clojure-for-machine-learning/">Book Review: Clojure for Machine Learning</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-05-24T10:09:00-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:09 am</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I was recently given a review copy of
<a href="http://www.packtpub.com/clojure-for-machine-learning/book">Clojure for Machine Learning</a>.
I have an academic familiarity with machine learning techniques and
presented on a few at <a href="http://speakerconf.com/">speakerconf</a>
2012. I haven&rsquo;t explored machine learning in Clojure since preparing
that talk and was excited to read a book on the topic.</p>

<p>The book gives a shallow introduction to many
<a href="http://www.packtpub.com/clojure-for-machine-learning/book#chapter_0">different topics</a>.
It does so through a bit of mathematics and much more code. Depending
on the section, the code examples implement the algorithm being
discussed, show you how to use a specific library, or do both.</p>

<p>An aspect I particularly enjoy about the code examples is that
they always start by showing what dependencies should be added to
your <code>project.clj</code> file. This is done even if the library has been used in
a previous chapter. Because of this every example can stand on its own.</p>

<p>Something that can almost always be improved about Clojure
 examples is that namespaces should be referenced using the
<code>require</code> form with a namespace alias. Even if that require requires a namespace
with a terrible alias, such as <code>(require '[example :as e])</code>, it makes
the example code easier to understand. Being able to read <code>e/a-func</code>
instead of <code>a-func</code> makes it more explicit as to where that function
is located and aides understanding.</p>

<p>I rate all
<a href="https://www.goodreads.com/user/show/3431614-jake-mccrary">my books</a>
by the <a href="http://goodreads.com/">goodreads</a> five star scale<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. This
book earns three stars. Even with my limited machine learning
background I didn&rsquo;t learn anything new but I was introduced to some
Clojure libraries and enjoyed seeing Clojure implementations of
machine learning techniques.</p>

<p>If you enjoy Clojure and the
<a href="http://www.packtpub.com/clojure-for-machine-learning/book#chapter_0">table of contents</a>
excites you then you&rsquo;ll most likely find this book interesting. If you
want to maximize your learning I&rsquo;d recommend taking an
<a href="https://www.coursera.org/courses?search=machine%20learning">online course</a>
in machine learning<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>. It will be a larger time investment but you&rsquo;ll
leave with a deeper understanding.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>1 star = did not like, 2 stars = it was ok, 3 stars = liked it, 4 stars = really liked it, 5 stars = loved it.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>I took the original offering from <a href="https://www.coursera.org/course/ml">Stanford</a> when it was first offered. Post about it <a href="http://jakemccrary.com/blog/2011/12/29/reflections-on-stanfords-online-class-experiment/">here</a>.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/27/emacs-generating-project-shortcuts/">Emacs: Generating project shortcuts</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-27T16:38:00-05:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:38 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m now writing Clojure nearly 100% of my time and as a result am spending more
time in Emacs. I&rsquo;m working in a few different projects and
wanted a quicker way to jump between them. My first attempt at this
ended with me defining many functions that looked like the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">b/test-refresh</span> <span class="p">()</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">find-file</span> <span class="s">&quot;~/src/jakemcc/lein-test-refresh/test-refresh/project.clj&quot;</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>After writing a couple of these I decided the computer could do this
better than I could and decided to write some code to automate it. A
sample of my directory structure is shown below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jakemcc/
</span><span class='line'>├── bookrobot
</span><span class='line'>│   └── project.clj
</span><span class='line'>└── lein-autoexpect
</span><span class='line'>    └── project.clj
</span></code></pre></td></tr></table></div></figure>


<p>Taking advantage of this structure I wrote some Emacs lisp to walk a
directory and define functions that open up any found project.clj
files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="c1">;; -*- lexical-binding: t -*-</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">open-file-fn</span> <span class="p">(</span><span class="nv">file</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="nb">defun</span> <span class="nv">create-project-shortcuts</span> <span class="p">(</span><span class="nv">prefix</span> <span class="nv">base</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nb">elt</span> <span class="p">(</span><span class="nv">directory-files</span> <span class="nv">base</span><span class="p">))</span>
</span><span class='line'>    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">project</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">base</span> <span class="s">&quot;/&quot;</span> <span class="nb">elt</span> <span class="s">&quot;/project.clj&quot;</span><span class="p">)))</span>
</span><span class='line'>      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">file-exists-p</span> <span class="nv">project</span><span class="p">)</span>
</span><span class='line'>        <span class="p">(</span><span class="nv">fset</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nv">concat</span> <span class="nv">prefix</span> <span class="nb">elt</span><span class="p">))</span> <span class="p">(</span><span class="nv">open-file-fn</span> <span class="nv">project</span><span class="p">))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>open-file-fn</code> creates an anonymous interactive function (meaning the function
can be called interactively) that opens <code>file</code>. It takes advantage of
the feature in Emacs 24 that enables lexical scoping by adding <code>;; -*-
lexical-binding: t -*-</code> to the top of your Emacs lisp file. This lets
the anonymous function capture <code>file</code>.</p>

<p><code>create-project-shortcuts</code> takes in a <code>prefix</code> and a <code>base</code> directory.
It searches <code>base</code> for directories that contain a
project.clj file. For each found project.clj file a function is
created (using <code>fset</code>) with the name of the containing directory
prefixed by <code>prefix</code>.</p>

<p>With those two functions defined all that is left is to call
<code>create-project-shortcuts</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="nv">create-project-shortcuts</span> <span class="s">&quot;b/&quot;</span> <span class="s">&quot;~/src/jakemcc&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now <code>b/bookrobot</code> and <code>b/lein-autoexpect</code> are available after hitting
<code>M-x</code>.</p>

<p>I&rsquo;ve used this code to create quick
shortcuts to all of my work and non-work projects. It has been
immensely useful for jumping around projects.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/30/managing-windows-in-osx-using-phoenix/">Managing windows in OS X using Phoenix</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-03-30T18:30:00-05:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:30 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://jakemccrary.com/blog/2013/04/15/manage-your-workspace-with-grids-under-linux-osx-and-windows/">Last year</a>
I wrote about how I managed my windows under OS X, Windows, and Linux.
I&rsquo;m a big fan of having an orderly layout and try to use grid
managers. Since then I&rsquo;ve changed jobs and now my main machine is an
MacBook Pro running OS X Mavericks with two 27 inch cinema displays.
As a result I&rsquo;ve started experimenting with more OS X window managers.
After trying a few out I&rsquo;m going to stick with
<a href="https://github.com/sdegutis/Phoenix">Phoenix</a>.</p>

<h3>Before Phoenix</h3>

<p>Last year I was satisfied using <a href="http://spectacleapp.com/">Spectacle</a>.
It is (or at least was, I haven&rsquo;t used it in a while) easy to install
and had good defaults. I&rsquo;d still recommend it for most people.</p>

<p>At the recommendation from a reader, I switched to
<a href="https://github.com/jigish/slate">Slate</a>. Slate has a ton of features
and I barely scratched the surface in how I used it. I used it as a
replacement for Spectacle and didn&rsquo;t touch any of the advanced
features. Before I had the urge to explore the advanced features I
ended up becoming dissatisfied with Slate. I ran into an issue where
after running for a while (talking at least a week) it would start to
respond slowly. I&rsquo;d try to move a window to another monitor and it
wouldn&rsquo;t move. Eventually I&rsquo;d be in another process and the
command would register sending whatever window I was currently focused
on to another monitor.</p>

<h3>Introducing Phoenix</h3>

<p>I was looking for solutions to Slate&rsquo;s unresponsiveness when I
stumbled on <a href="https://github.com/sdegutis/Phoenix">Phoenix</a>. I was
drawn in by its stated goal; it &ldquo;aims for efficiency and a very small
footprint.&rdquo; The fact that it is still being actively developed was
also a huge selling point. Knowing that any bugs I find have a
potential to be fixed is great.</p>

<p>Phoenix provides a
<a href="https://github.com/sdegutis/Phoenix/wiki/JavaScript-API-documentation">JavaScript API</a>
that allows you to interact with your running applications or launch
applications. It doesn&rsquo;t provide anything out of the box; it is up to
you to make it useful by writing your own (or taking another persons)
configuration.</p>

<p>This is a double-edged sword. This means you get exactly the features
you want. It also means you might spend significant amounts of time
figuring out how to get the features you want.</p>

<p>Luckily there are <a href="https://github.com/sdegutis/Phoenix/wiki">examples</a>
that you can use as a starting point. Browsing through the examples is
a great way of becoming familiar with what is possible and can be
inspiring.</p>

<p>My
<a href="https://github.com/jakemcc/dotfiles/blob/17a73f89a2f3f7b2c9aa07a63d1928b86cc5425d/home/.phoenix.js">configuration</a>
is relatively minimal. I&rsquo;ve written
<a href="https://github.com/jakemcc/dotfiles/blob/17a73f89a2f3f7b2c9aa07a63d1928b86cc5425d/home/.phoenix.js#L42-L87">code</a>
to move windows between monitors (rotating between three added some
complexity to this),
<a href="https://github.com/jakemcc/dotfiles/blob/17a73f89a2f3f7b2c9aa07a63d1928b86cc5425d/home/.phoenix.js#L90-L122">start or focus</a>
certain applications, and
<a href="https://github.com/jakemcc/dotfiles/blob/17a73f89a2f3f7b2c9aa07a63d1928b86cc5425d/home/.phoenix.js#L11-L37">resize</a>
windows. This is enough for me to feel efficient.</p>

<p>I encourage you to use a tool to help manage your windows. Personally
I think Phoenix is pretty great and don&rsquo;t mind tinkering with my
configuration and strongly recommend it. As a bonus it is a young
project where the maintainer is open to suggestions. If you have an
idea for a useful
<a href="https://github.com/sdegutis/Phoenix/issues/18">feature</a> it has a
possibility of being added pretty quickly.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/02/flexible-notification-of-clojure-tests-failing/">Flexible notification of Clojure tests failing</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-02T18:11:00-06:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>6:11 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> has
always supported notifying you of your tests' status through growl.
With the release of version 0.3.4 it now will notify you using
whatever program you want.</p>

<p>To make my Mac whisper my the results of running my tests I can use
the following project.clj</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defproject </span><span class="nv">sample</span> <span class="s">&quot;1.2.3&quot;</span>
</span><span class='line'>  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.5.1&quot;</span><span class="p">]]</span>
</span><span class='line'>  <span class="ss">:profiles</span> <span class="p">{</span><span class="ss">:dev</span> <span class="p">{</span><span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">com.jakemccrary/lein-test-refresh</span> <span class="s">&quot;0.3.4&quot;</span><span class="p">]]}}</span>
</span><span class='line'>  <span class="ss">:test-refresh</span> <span class="p">{</span><span class="ss">:notify-command</span> <span class="p">[</span><span class="s">&quot;say&quot;</span> <span class="s">&quot;-v&quot;</span> <span class="s">&quot;Whisper&quot;</span><span class="p">]})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The specification of the command is found in the <code>:test-refresh
{:notify-command ["say" "-v" "Whisper"]}</code> entry in the above
project.clj. After running your tests
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> will
pass a (usually) short summary message as the final parameter to the
specified command.</p>

<p>Now you can finally have the results of running
your tests whispered to you.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/12/releasing-lein-test-refresh-0-dot-3-0/">Releasing lein-test-refresh 0.3.0</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-12T20:12:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:12 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>At the suggestion of my coworker <a href="http://www.xpteam.com/">Jeff Bay</a>
you can now hit a single keystroke to cause
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> to
rerun your tests. Now you can hit enter in the terminal running <code>lein
test-refresh</code> to cause your tests to be run.</p>

<p>Add the below text to your project.clj to start using
<code>lein-test-refresh</code> today.
<img src="https://clojars.org/com.jakemccrary/lein-test-refresh/latest-version.svg" alt="Clojars generated dependency vector" /></p>

<p>As a reminder if you call you can pass the argument <code>:growl</code> to
lein-test-refresh. If you pass <code>:growl</code> as an argument then you&rsquo;ll be
notified of test success and failures through
<a href="http://growl.info/">growl</a>. On top of the quick feedback cycles that
<a href="https://github.com/jakemcc/lein-test-refresh">lein-test-refresh</a> (and
<a href="https://github.com/jakemcc/lein-autoexpect">lein-autoexpect</a>)
provides the growl notification is my favorite feature. I&rsquo;d highly
recommend giving it a shot.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/01/using-incanter-to-review-my-2013-reading/">Using Incanter to review my 2013 reading</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-01-01T17:31:00-06:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>5:31 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I use <a href="https://goodreads.com">goodreads</a> to keep track of
<a href="https://www.goodreads.com/user/show/3431614-jake-mccrary">my reading</a>
and have since early 2010. I find very useful for capturing what I
want to read and reminding me of how I felt about books I&rsquo;ve read. I
thought it would be fun to take a closer look at what I read in 2013.
I&rsquo;m doing this using <a href="http://clojure.org/">Clojure</a> with
<a href="http://incanter.org/">Incanter</a>. I haven&rsquo;t used Incanter since I
wrote
<a href="http://jakemccrary.com/blog/2010/02/21/plotting-time-series-data-with-incanter/">this</a>
post and thought this would be a good opportunity to visit it again.</p>

<p>First I need to get my data out of goodreads. I&rsquo;ve worked with the
Goodreads API before <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> but am not going to use it for this
exercise. Instead I&rsquo;m using the goodreads export functionality (at
goodreads follow the links: My Books > import/export) to export a csv
file. Having the csv file also lets me cleanup some of the data since
some of the book&rsquo;s page counts were missing <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>.</p>

<p>Now that I have data it is time to start playing with it. Run <code>lein new goodreads-summary</code> and edit the <code>project.clj</code> file to have a dependency on Incanter.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defproject </span><span class="nv">goodreads-summary</span> <span class="s">&quot;0.1.0-SNAPSHOT&quot;</span>
</span><span class='line'>  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.5.1&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">org.clojure/data.csv</span> <span class="s">&quot;0.1.2&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">incanter</span> <span class="s">&quot;1.5.4&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">clj-time</span> <span class="s">&quot;0.6.0&quot;</span><span class="p">]])</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next I&rsquo;m going to take the csv file and transform it into an Incanter
dataset. This is easily done with
<a href="http://liebke.github.io/incanter/io-api.html#incanter.io/read-dataset">incanter.io/read-dataset</a>.
It isn&rsquo;t well documented but by passing <code>:keyword-headers false</code> to
<code>read-dataset</code> the headers from the csv are not converted to keywords.
I&rsquo;m doing this because some of the goodreads headers contain spaces
and dealing with spaces in keywords is a pain. The snippet below has
all of the necessary requires for the remainder of the examples.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">ns </span><span class="nv">goodreads-summary.core</span>
</span><span class='line'>  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.data.csv</span> <span class="ss">:as</span> <span class="nv">csv</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clojure.string</span> <span class="ss">:as</span> <span class="nv">str</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">incanter.core</span> <span class="ss">:as</span> <span class="nv">incanter</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">incanter.io</span> <span class="ss">:as</span> <span class="nv">io</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">incanter.charts</span> <span class="ss">:as</span> <span class="nv">charts</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clj-time.core</span> <span class="ss">:as</span> <span class="nv">tc</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">clj-time.format</span> <span class="ss">:as</span> <span class="nv">tf</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">read-csv</span> <span class="p">[</span><span class="nv">filepath</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">io/read-dataset</span> <span class="nv">filepath</span> <span class="ss">:header</span> <span class="nv">true</span> <span class="ss">:keyword-headers</span> <span class="nv">false</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Calling <code>read-csv</code> with the path to the exported goodreads data
results in dataset. If you want to view the data use
<a href="http://liebke.github.io/incanter/core-api.html#incanter.core/view">incanter.core/view</a>.
Running <code>(incanter/view (read-csv "goodreads_export.csv"))</code> pops up a
grid of with all the data. I don&rsquo;t care about most of the columns so
lets define a function that selects out the few I care about.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">select-columns</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">incanter/sel</span> <span class="nv">dataset</span> <span class="ss">:cols</span> <span class="p">[</span><span class="s">&quot;Number of Pages&quot;</span> <span class="s">&quot;Date Read&quot;</span> <span class="s">&quot;Bookshelves&quot;</span> <span class="s">&quot;Exclusive Shelf&quot;</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Selecting columns is done with
<a href="http://liebke.github.io/incanter/core-api.html#incanter.core/sel">incanter.core/sel</a>.
Like most Incanter functions it has many overloads. One way to use it
is to pass a dataset with a vector of columns you want to select.</p>

<p>Filtering a dataset is done using
<a href="http://liebke.github.io/incanter/core-api.html#incanter.core/$where">incanter.core/$where</a>.
Goodreads has three default shelves <strong>to-read</strong>,
<strong>currently-reading</strong>, and <strong>read</strong>. To select all your read books you
filter of the <strong>Exclusive Shelf</strong> column for <strong>read</strong> books.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">finished</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">incanter/$where</span> <span class="p">{</span><span class="s">&quot;Exclusive Shelf&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">}</span> <span class="nv">dataset</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Filtering for books read in 2013 is a bit more complicated. First I
convert the <strong>Date Read</strong> column from a string to a
<code>org.joda.time.DateTime</code>. This is done with the combination of
<code>transform-date-read-column</code> and <code>parse-date</code>. Some of the my data is missing a <strong>Date Read</strong> value. I&rsquo;m choosing to handle this by treating missing data as the result of <code>(clj-time.core/date-time 0)</code>.</p>

<p>The <code>$where</code> in <code>books-read-in-2013</code> is a bit more complicated than
the filtering in <code>finished</code>. Here I&rsquo;m providing a predicate to
use instead of just doing an equality comparison.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">parse-date</span> <span class="p">[</span><span class="nv">date-str</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">if </span><span class="nv">date-str</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">tf/parse</span> <span class="p">(</span><span class="nf">tf/formatter</span> <span class="s">&quot;yyyy/MM/dd&quot;</span><span class="p">)</span> <span class="nv">date-str</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">tc/date-time</span> <span class="mi">0</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">transform-date-read-column</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">incanter/transform-col</span> <span class="nv">dataset</span> <span class="s">&quot;Date Read&quot;</span> <span class="nv">parse-date</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">date-greater-than-pred</span> <span class="p">[</span><span class="nv">date</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">challenger</span><span class="p">]</span>
</span><span class='line'>    <span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">.compareTo</span> <span class="nv">challenger</span> <span class="nv">date</span><span class="p">)</span> <span class="mi">0</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">books-read-in-2013</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">finished</span> <span class="p">(</span><span class="nf">finished</span> <span class="p">(</span><span class="nf">select-columns</span> <span class="nv">dataset</span><span class="p">))</span>
</span><span class='line'>        <span class="nv">with-dates</span> <span class="p">(</span><span class="nf">incanter/$where</span> <span class="p">{</span><span class="s">&quot;Date Read&quot;</span> <span class="p">{</span><span class="ss">:fn</span> <span class="nv">identity</span><span class="p">}}</span> <span class="nv">finished</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">with-date-objects</span> <span class="p">(</span><span class="nf">transform-date-read-column</span> <span class="nv">with-dates</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">incanter/$where</span> <span class="p">{</span><span class="s">&quot;Date Read&quot;</span> <span class="p">{</span><span class="ss">:fn</span> <span class="p">(</span><span class="nf">date-greater-than-pred</span> <span class="p">(</span><span class="nf">parse-date</span> <span class="s">&quot;2012/12/31&quot;</span><span class="p">))}}</span>
</span><span class='line'>                     <span class="nv">with-date-objects</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have a dataset that that contains only books read in 2013
(well, until I read a book in 2014 and the filter above also grabs
books in 2014). Now to generate some analytic for each month. First
lets add a <strong>Month</strong> column to our data. Originally I wrote the
function below. It uses <code>incanter.core/$map</code> to generate the data,
makes a dataset with the new data, and then adds that to the original
dataset.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">add-month-read-column</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">month-read</span> <span class="p">(</span><span class="nf">incanter/$map</span> <span class="nv">tc/month</span> <span class="s">&quot;Date Read&quot;</span> <span class="nv">dataset</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">month-dataset</span> <span class="p">(</span><span class="nf">incanter/dataset</span> <span class="p">[</span><span class="s">&quot;Month&quot;</span><span class="p">]</span> <span class="nv">month-read</span><span class="p">)</span>
</span><span class='line'>        <span class="nv">with-month-read</span> <span class="p">(</span><span class="nf">incanter/conj-cols</span> <span class="nv">dataset</span> <span class="nv">month-dataset</span><span class="p">)]</span>
</span><span class='line'>    <span class="nv">with-month-read</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>When I wrote the above code it seemed like there should be a better
way. While writing this post I stumbled across
<a href="http://liebke.github.io/incanter/core-api.html#incanter.core/add-derived-column">incanter.core/add-derived-column</a>.
Switching to <code>add-derived-column</code> makes <code>add-month-read-column</code> almost trivial.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">add-month-read-column</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">incanter/add-derived-column</span> <span class="s">&quot;Month&quot;</span> <span class="p">[</span><span class="s">&quot;Date Read&quot;</span><span class="p">]</span> <span class="nv">tc/month</span> <span class="nv">dataset</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have <code>add-month-read-column</code>  we can now start aggregating
some stats. Lets write code for calculating the pages read per month.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">pages-by-month</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">with-month-read</span> <span class="p">(</span><span class="nf">add-month-read-column</span> <span class="nv">dataset</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">(</span><span class="nf">incanter/$rollup</span> <span class="ss">:sum</span> <span class="s">&quot;Number of Pages&quot;</span> <span class="s">&quot;Month&quot;</span> <span class="nv">with-month-read</span><span class="p">)</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">incanter/$order</span> <span class="s">&quot;Month&quot;</span> <span class="ss">:asc</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p>That was pretty easy. Lets write a function to count the number of books read per month.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">book-count-by-month</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">with-month-read</span> <span class="p">(</span><span class="nf">add-month-read-column</span> <span class="nv">dataset</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">(</span><span class="nf">incanter/$rollup</span> <span class="ss">:count</span> <span class="s">&quot;Number of books&quot;</span> <span class="s">&quot;Month&quot;</span> <span class="nv">with-month-read</span><span class="p">)</span>
</span><span class='line'>         <span class="p">(</span><span class="nf">incanter/$order</span> <span class="s">&quot;Month&quot;</span> <span class="ss">:asc</span><span class="p">))))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>pages-by-month</code> and <code>book-count-by-month</code> are very similar. Each uses <a href="http://liebke.github.io/incanter/core-api.html#incanter.core/$rollup">incanter.core/$rollup</a> to calculate per month stats. The first argument to <code>$rollup</code> can be a function that takes a sequence of values or one of the supported magical &ldquo;function identifier keywords&rdquo;.</p>

<p>Next lets combine the data together so we can print out a nice table. While we are at it lets add another column.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">stats-by-month</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">(</span><span class="nf">incanter/$join</span> <span class="p">[</span><span class="s">&quot;Month&quot;</span> <span class="s">&quot;Month&quot;</span><span class="p">]</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">pages-by-month</span> <span class="nv">dataset</span><span class="p">)</span>
</span><span class='line'>                     <span class="p">(</span><span class="nf">book-count-by-month</span> <span class="nv">dataset</span><span class="p">))</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">incanter/rename-cols</span> <span class="p">{</span><span class="s">&quot;Number of Pages&quot;</span> <span class="s">&quot;Page Count&quot;</span>
</span><span class='line'>                              <span class="s">&quot;Number of books&quot;</span> <span class="s">&quot;Book Count&quot;</span><span class="p">})</span>
</span><span class='line'>       <span class="p">(</span><span class="nf">incanter/add-derived-column</span> <span class="s">&quot;Pages/Books&quot;</span>
</span><span class='line'>                                  <span class="p">[</span><span class="s">&quot;Page Count&quot;</span> <span class="s">&quot;Book Count&quot;</span><span class="p">]</span>
</span><span class='line'>                                  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">p</span> <span class="nv">b</span><span class="p">]</span> <span class="p">(</span><span class="nf">Math/round</span> <span class="p">(</span><span class="nb">double </span><span class="p">(</span><span class="nb">/ </span><span class="nv">p</span> <span class="nv">b</span><span class="p">)))))))</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>stats-by-month</code> returns a dataset which when printed looks like the following table. It joins the data, renames columns, and adds a derived column.</p>

<pre><code>| Month | Book Count | Page Count | Pages/Books |
|-------+------------+------------+-------------|
|     1 |          6 |       1279 |         213 |
|     2 |          2 |       1251 |         626 |
|     3 |          8 |       2449 |         306 |
|     4 |          5 |       1667 |         333 |
|     5 |          6 |       2447 |         408 |
|     6 |          5 |       1609 |         322 |
|     7 |          5 |       1445 |         289 |
|     8 |          5 |       2229 |         446 |
|     9 |          2 |        963 |         482 |
|    10 |          5 |       1202 |         240 |
|    11 |          5 |       2248 |         450 |
|    12 |          7 |       1716 |         245 |
</code></pre>

<p>Great. Now we have a little ascii table. Lets get graphical and make some bar charts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">chart-column-by-month</span> <span class="p">[</span><span class="nv">column</span> <span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">select </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">column</span><span class="p">]</span> <span class="p">(</span><span class="nf">incanter/sel</span> <span class="nv">dataset</span> <span class="ss">:cols</span> <span class="nv">column</span><span class="p">))</span>
</span><span class='line'>        <span class="nv">months</span> <span class="p">(</span><span class="nb">select </span><span class="s">&quot;Month&quot;</span><span class="p">)]</span>
</span><span class='line'>    <span class="p">(</span><span class="nf">charts/bar-chart</span> <span class="nv">months</span> <span class="p">(</span><span class="nb">select </span><span class="nv">column</span><span class="p">)</span>
</span><span class='line'>                      <span class="ss">:y-label</span> <span class="nv">column</span> <span class="ss">:x-label</span> <span class="s">&quot;Month&quot;</span><span class="p">)))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">chart-page-count-by-month</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">chart-column-by-month</span> <span class="s">&quot;Page Count&quot;</span> <span class="nv">dataset</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">chart-book-count-by-month</span> <span class="p">[</span><span class="nv">dataset</span><span class="p">]</span>
</span><span class='line'>  <span class="p">(</span><span class="nf">chart-column-by-month</span> <span class="s">&quot;Book Count&quot;</span> <span class="nv">dataset</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">defn </span><span class="nv">view-page-count-chart</span> <span class="p">[]</span>
</span><span class='line'>  <span class="p">(</span><span class="nb">-&gt; </span><span class="p">(</span><span class="nf">read-csv</span> <span class="s">&quot;goodreads_export.csv&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">books-read-in-2013</span>
</span><span class='line'>      <span class="nv">stats-by-month</span>
</span><span class='line'>      <span class="nv">chart-page-count-by-month</span>
</span><span class='line'>      <span class="nv">incanter/view</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the snippet <code>view-page-count-chart</code> produces a pop-up with the
below bar chart. The chart actually surprises me as I fully expected
to have higher page counts during the winter months than the summer
months. This chart and analysis is pretty useless though without
knowing the difficulty of the pages read. For example, last February I
read
<a href="http://www.amazon.com/gp/product/0316920045/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0316920045&amp;linkCode=as2&amp;tag=jakemccrary08-20&amp;linkId=RTXH5NFJLAODUEBP">Infinite Jest</a>.
Knowing that I don&rsquo;t feel like having a low page count in that month
is slacking at all.</p>

<p><img src="/images/page-count-by-month.png" title="Bar chart of total page count by month" alt="Bar chart of total page count by month" /></p>

<h3>2013 Summary</h3>

<p>2013 was a pretty big year of reading. I read more books this past
year than all other years that I have data. I also read some of the
best books I&rsquo;ve ever read. Not only that but I actually created
multiple <sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> custom Kindle dictionaries to help improve my (and
others) reading experience.</p>

<p>Summary table <sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>:</p>

<pre><code>|   :shelf | :books | :pages |
|----------+--------+--------|
| non-tech |     51 |  17798 |
|     tech |     10 |   2707 |
|     read |     61 |  20505 |
</code></pre>

<h3>Plans for 2014</h3>

<p>I&rsquo;m planning on reading a similar amount in this upcoming year but
will probably have a bit more non-fiction books. First step towards doing
that is to start classifying my books as non-fiction or fiction. I&rsquo;m
also planning on rereading at least two books that I&rsquo;ve read in the
last few years. This is unusual for me because I don&rsquo;t often reread
books that quickly.</p>

<p>If you have any book recommendations feel free to leave them in the
comments or contact me through twitter or email.</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>A project on Heroku that takes your to-read list from goodreads and queries the Chicago Public Library to see if books are available. Someday I&rsquo;ll give it some love and make it usable by others.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>I&rsquo;ve also applied to be a goodreads librarian so I can actually fix their data as well.<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>One for <a href="http://jakemccrary.com/blog/2013/07/09/releasing-the-functional-javascript-companion/">Functional JavaScript</a> and another for <a href="http://gum.co/dune-dictionary">Dune</a>. If you want a custom Kindle dictionary made feel free to reach out.<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>tech shelf only includes programming books.<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/14/book-review-clojure-high-performance-programming/">Book Review: Clojure High Performance Programming</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-14T16:39:00-06:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:39 pm</span></time>
      </p>
    
  </header>


  <div class="entry-content"><p>I was recently approached by Packt Publishing asking if I&rsquo;d review
Shantanu Kuma&rsquo;s book
<a href="http://www.packtpub.com/clojure-high-performance-programming/book">Clojure High Performance Programming</a>
. It sounded interesting so I took them up on
their offer for a free copy and read it over two flights.</p>

<p>Unsurprisingly the
<a href="http://www.packtpub.com/clojure-high-performance-programming/book#chapter_1">table of contents</a>
does a good job describing the book. This book doesn&rsquo;t
dive too deep into any one topic but instead gives you a taste of
each.</p>

<p>Overall the book was pretty good. It provides interesting examples of
real world Clojure code that solve specific performance problems. It
talks about host performance, both JVM and hardware, concerns which are
both areas that shouldn&rsquo;t be overlooked. I thought the book was best
when showing examples of well performing code from libraries.</p>

<p>I&rsquo;d recommend this book for developers who aren&rsquo;t past the beginning
stages of writing performant code. It does a good job introducing the
topics you&rsquo;ll want to think about when trying to craft well performing
programs.</p>

<p>It isn&rsquo;t for the developer who has spent years optimizing code for
performance. Those developers are already going to be familiar with
the language and concerns of writing high performance code.</p>

<p>If I could add anything to the book it would be a chapter about
measuring performance in production. If you are writing high
performance programs it has been my experience that you <strong>must</strong>
measure in production. This is easiest to do if you build measuring in
from the very beginning.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog//9">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog//7">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/04/26/hanging-a-hangboard-using-a-doorway-pull-up-bar/">How to hang a hangboard using a doorway pull-up bar</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/21/using-bash-preexec-for-monitoring-the-runtime-of-your-last-command/">Using Bash-Preexec for monitoring the runtime of your last command</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/03/16/a-retrospective-format/">A retrospective format for remote or co-located teams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/03/10/more-working-from-home-tips/">More working from home tips</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/02/25/auto-syncing-a-git-repository/">Auto-syncing a git repository</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/01/11/reading-in-2019/">Reading in 2019</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/10/12/building-an-atreus-keyboard/">Building an Atreus keyboard</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/23/building-a-onewheel-stand/">Building a Onewheel stand</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/08/15/switching-my-ergodox-to-qmk-firmware/">Switching my Ergodox to QMK firmware</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/30/how-i-use-social-media/">How I use social media</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  <a href="/disclosure-policy">Disclosure Policy</a><br/>
  <a href="//www.iubenda.com/privacy-policy/509351" class="iubenda-nostyle iub-legal-only iubenda-embed" title="Privacy Policy">Privacy Policy</a><br/>
<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "//cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
  Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
</p>


</footer>
  


</body>
</html>
