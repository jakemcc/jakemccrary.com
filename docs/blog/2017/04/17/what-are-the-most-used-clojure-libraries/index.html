<!DOCTYPE html>
<head lang="en">
  <meta charset="utf-8">
  <title>What are the most used Clojure libraries? - Jake McCrary</title>
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="stylesheet" href="/style.css"> -->

  <meta itemprop="name" content="What are the most used Clojure libraries? - Jake McCrary" />
  
  <meta itemprop="description" content="Let&#39;s use the power of Google&#39;s BigQuery to discover the most used Clojure libraries." />
  

  <!-- Twitter Card data -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jakemcc" />
  <meta name="twitter:title" content="What are the most used Clojure libraries? - Jake McCrary" />
  
  <meta name="twitter:description" content="Let&#39;s use the power of Google&#39;s BigQuery to discover the most used Clojure libraries." />
  
  <meta name="twitter:creator" content="@jakemcc" />
  <!-- <meta name="twitter:image" content="" /> -->

  <!-- Open Graph data -->
  <meta property="og:site_name" content="Writing by Jake McCrary" />
  <meta property="og:url" content="https://jakemccrary.com//blog/2017/04/17/what-are-the-most-used-clojure-libraries/" />
  <meta property="og:title" content="What are the most used Clojure libraries? - Jake McCrary" />
  
  <meta property="og:description" content="Let&#39;s use the power of Google&#39;s BigQuery to discover the most used Clojure libraries." />
  
  <!-- <meta property="og:image" content="" /> -->
  
  <meta property="og:type" content="article" />
  
  
  <!-- maybe rfc blahblahblah it? -->
  <meta property="article:published_time" content="2017-04-17T23:59:59+00:00" />
  

  <link rel="canonical" href="https://jakemccrary.com//blog/2017/04/17/what-are-the-most-used-clojure-libraries/">

  <style>
   body {
     font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
     max-width: 1200px;
     margin: 0 auto;
     padding: 1rem;
     line-height: 1.5;
   }

   header {
     margin-bottom: 0.5rem;
   }

   header h1 {
     margin: 0;
     font-size: 2.5rem;
   }

   header h1 a {
     color: #333;
     text-decoration: none;
   }

   .main-nav {
     display: flex;
     flex-wrap: wrap;
     align-items: center;
     padding: 0.5rem 0;
     margin-bottom: 2rem;
     gap: 1rem;
   }

   .nav-list {
     display: flex;
     flex-wrap: wrap;
     list-style: none;
     margin: 0;
     padding: 0;
     gap: 1rem;
   }

   .nav-list a {
     text-decoration: none;
     color: #333;
     white-space: nowrap;

   }

   .search-form fieldset {
     border: none;
     margin: 0;
     padding: 0;
   }

   .search {
     padding: 0.5rem;
     border: none;
     background: #f5f5f5;
     border-radius: 4px;
     width: 150px;
   }

   /* Blog post list styling */
   .post-list {
     list-style: none;
     padding: 0;
     margin: 0;
   }

   .post-list li {
     margin-bottom: 1.5rem;
   }

   .post-meta {
     margin-bottom: 0.25rem;
   }

   .post-meta time {
     color: #666;
     margin-right: 0.5rem;
   }

   .post-list h2 {
     display: inline;
     font-size: 1.1rem;
     font-weight: 500;
     margin: 0;
   }

   .post-list h2 a {
     color: #0066cc;
     text-decoration: none;
   }

   .post-list h2 a:hover {
     text-decoration: underline;
   }

   .post-description {
     color: #444;
     margin: 0.25rem 0 0 0;
     line-height: 1.6;
   }

   .right {
     float: right;
   }
   .left {
     float: left;
   }
   .mr1 {
     margin-right: 1em;
   }
   /* Style the footnote references in the text */
   [id^="fnref"] sup {
     font-size: 0.75em;
     line-height: 0;
     position: relative;
     top: -0.5em;
     padding: 0 0.3em;
   }

   [id^="fnref"] a {
     text-decoration: none;
     background-color: #f3f4f6;
     color: #4b5563;
     border-radius: 3px;
     padding: 2px 6px;
     transition: all 0.2s ease;
   }

   [id^="fnref"] a:hover {
     background-color: #e5e7eb;
     color: #1f2937;
   }

   /* Style the footnotes section */
   .footnotes {
     margin-top: 3rem;
     padding-top: 2rem;
     border-top: 2px solid #e5e7eb;
   }

   /* Create custom numbering for footnotes */
   .footnotes li {
     margin-bottom: 1rem;
     color: #4b5563;
   }
   
   /* Style the return links in footnotes */
   .footnotes li a[href^="#fnref"] {
     text-decoration: none;
     color: #6b7280;
     margin-left: 0.5rem;
     font-size: 0.875rem;
     transition: color 0.2s ease;
   }

   .footnotes li a[href^="#fnref"]:hover {
     color: #374151;
   }

   blockquote {
     border-left: 4px solid #d1d5db;
     padding-left: 1em;
     margin-left: 1em;
     color: #4b5563;
     font-style: italic;
     background-color: #f9fafb;
   }

   figure {
     margin: 1rem 0;
     text-align: center;
   }

   figcaption {
     color: #666;
     font-size: 0.9em;
     margin-top: 0.5rem;
     font-style: italic;
   }

   .page-header h1 {
     margin: 0
   }

   .page-header .publication-date {
     color: #666;
     font-size: 0.8em;
     margin: 0;
   }

   body > footer {
     font-size: .8em;
	   color: #888;
     margin-top: 1em;
	   padding-top: 1em;
     padding-bottom: 1em;
   }
   p code, li code {
     display: inline-block;
     white-space: nowrap;
     border: 1px solid #ddd;
     -moz-border-radius: .4em;
     -webkit-border-radius: .4em;
     border-radius: .4em;
     padding: 0 .3em;
     margin: -1px 0;
   }

  </style>
  <link rel="stylesheet" href="/highlight/base16/tomorrow-night.min.css" media="print" onload="this.media='all'">
</head>
<body>
<header>
    <h1><a href="/">Jake McCrary</a></h1>
  </header>
  <nav role="navigation" class="main-nav">
    <ul role="navigation" class="nav-list">
      <li><a href="/">Articles</a></li>
      <li><a href="/adventures/">Adventures</a></li>
      <li><a href="/about.html">About</a></li>
      <li><a href="/blog/archives/">Archives</a></li>
      <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      <li><a href="https://jakemccrary.substack.com/welcome" target="_blank" rel="subscribe-email" title="subscribe via email">Newsletter</a></li>
    </ul>
    <form class="search-form" action="https://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="sitesearch" value="jakemccrary.com">
        <input class="search" type="text" name="q" placeholder="Search">
      </fieldset>
    </form>
  </nav>
  
  <div class="page-header">
    <h1>What are the most used Clojure libraries?</h1>
    
    
    <p class="publication-date">Published on 
      <time datetime="2017-04-17">April 17, 2017</time>
    </p>
    
  </div>
  

  <p>In a <a href='/blog/2017/03/31/what-clojure-testing-library-is-most-used/'>previous post</a>, we used Google's BigQuery and the public <a href='https://cloud.google.com/bigquery/public-data/github'>GitHub dataset</a> to discover the most used Clojure testing library. The answer wasn't surprising. The built-in <code>clojure.test</code> was by far the most used.</p><p>Let's use the dataset to answer a less obvious question, what are the most used libraries in Clojure projects? We'll measure this by counting references to libraries in <code>project.clj</code> and <code>build.boot</code> files.</p><p>Before we can answer that question, we'll need to transform the data. First, we create the Clojure subset of the GitHub dataset. I did this by executing the following queries and saving the results to tables<a href='#fn-1' id='fnref1'><sup>1</sup></a>.</p><pre><code class="language-sql">-- Save the results of this query to the clojure.files table
SELECT
  &#42;
FROM
  &#91;bigquery-public-data:github&#95;repos.files&#93;
WHERE
  RIGHT&#40;path, 4&#41; = '.clj'
  OR RIGHT&#40;path, 5&#41; = '.cljc'
  OR RIGHT&#40;path, 5&#41; = '.cljs'
  OR RIGHT&#40;path, 10&#41; = 'boot.build'

-- Save the results to clojure.contents
SELECT &#42;
FROM &#91;bigquery-public-data:github&#95;repos.contents&#93;
WHERE id IN &#40;SELECT id FROM clojure.files&#41;
</code></pre><p>Next we extract the dependencies from <code>build.boot</code> and <code>project.clj</code> files. Fortunately for us, both of these files specify dependencies in the same format, so we're able to use the same regular expression on both types.</p><p>The query below identifies <code>project.clj</code> and <code>build.boot</code> files, splits each file into lines, and extracts referenced library names and versions using a regular expression. Additional filtering is done get rid of some spurious results.</p><pre><code class="language-sql">SELECT
  REGEXP&#95;EXTRACT&#40;line, r'\&#91;+&#40;\S+&#41;\s+&quot;\S+&quot;&#93;'&#41; AS library,
  REGEXP&#95;EXTRACT&#40;line, r'\&#91;+\S+\s+&quot;&#40;\S+&#41;&quot;&#93;'&#41; AS version, 
  COUNT&#40;&#42;&#41; AS count
FROM &#40;
  SELECT
    SPLIT&#40;content, '\n'&#41; AS line
  FROM
    &#91;clojure.contents&#93;
  WHERE
    id IN &#40;
    SELECT
      id
    FROM
      &#91;clojure.files&#93;
    WHERE
      path LIKE '%project.clj'
      OR path LIKE '%build.boot'&#41;
      HAVING line contains '&#91;'&#41;
GROUP BY
  library, version
HAVING library is not null and not library contains '&quot;'
ORDER BY
  count DESC
</code></pre><p>The first five rows from the result are below. Let's save the entire result to a <code>clojure.libraries</code> table.</p><pre><code>| library             | version | count |
|---------------------+---------+-------|
| org.clojure/clojure | 1.6.0   | 7015  |
| org.clojure/clojure | 1.5.1   | 4251  |
| org.clojure/clojure | 1.7.0   | 4093  |
| org.clojure/clojure | 1.8.0   | 3016  |
| hiccup              | 1.0.5   | 1280  |
</code></pre><p>Now we can start answering all sorts of interesting questions.</p><p>What is the most referenced library put out under the <code>org.clojure</code> group?</p><pre><code>SELECT library, sum&#40;count&#41; count
FROM clojure.libraries
WHERE library CONTAINS 'org.clojure'
GROUP BY library
ORDER BY count desc

| Row | library                        | count |
|-----+--------------------------------+-------|
|   1 | org.clojure/clojure            | 20834 |
|   2 | org.clojure/clojurescript      |  3080 |
|   3 | org.clojure/core.async         |  2612 |
|   4 | org.clojure/tools.logging      |  1579 |
|   5 | org.clojure/data.json          |  1546 |
|   6 | org.clojure/tools.nrepl        |  1244 |
|   7 | org.clojure/java.jdbc          |  1064 |
|   8 | org.clojure/tools.cli          |  1053 |
|   9 | org.clojure/tools.namespace    |   982 |
|  10 | org.clojure/test.check         |   603 |
|  11 | org.clojure/core.match         |   578 |
|  12 | org.clojure/math.numeric-tower |   503 |
|  13 | org.clojure/data.csv           |   381 |
|  14 | org.clojure/math.combinatorics |   372 |
|  15 | org.clojure/tools.reader       |   368 |
|  16 | org.clojure/clojure-contrib    |   335 |
|  17 | org.clojure/data.xml           |   289 |
|  18 | org.clojure/tools.trace        |   236 |
|  19 | org.clojure/java.classpath     |   199 |
|  20 | org.clojure/core.cache         |   179 |
</code></pre><p>Clojure and ClojureScript are at the top, which isn't surprising. I'm surprised to see <code>tools.nrepl</code> in the next five results (rows 3-7). It is the only library out of the top that I haven't used.</p><p>What testing library is used the most? We already answered this in my <a href='/blog/2017/03/31/what-clojure-testing-library-is-most-used/'>last article</a> but let's see if we get the same answer when we're counting how many times a library is pulled into a project.</p><pre><code>SELECT library, sum&#40;count&#41; count
FROM &#91;clojure.libraries&#93; 
WHERE library in &#40;'midje', 'expectations', 'speclj', 'smidjen', 'fudje'&#41;
GROUP BY library
ORDER BY count desc

| Row | library                | count |
|-----+------------------------+-------|
|   1 | midje                  |  1122 |
|   2 | speclj                 |   336 |
|   3 | expectations           |   235 |
|   4 | smidjen                |     1 |
</code></pre><p>Those results are close to the previous results. Of the non-clojure.test libraries, midje still ends up on top.</p><p>What groups (as identified by the Maven groupId) have their libraries referenced the most? Top 12 are below but the <a href='https://docs.google.com/a/jakemccrary.com/spreadsheets/d/1QGRRGSo5t5Pnpwizdv_H8negs8NBxtRour6KxWN6hVY/edit?usp=sharing'>full result</a> is available.</p><pre><code>SELECT REGEXP&#95;EXTRACT&#40;library, r'&#40;\S+&#41;/\S+'&#41; AS group, sum&#40;count&#41; AS count
FROM &#91;clojure.libraries&#93;
GROUP BY group
HAVING group IS NOT null
ORDER BY count DESC

| Row | group                 | count |
|-----+-----------------------+-------|
|   1 | org.clojure           | 39611 |
|   2 | ring                  |  5817 |
|   3 | com.cemerick          |  2053 |
|   4 | com.taoensso          |  1605 |
|   5 | prismatic             |  1398 |
|   6 | org.slf4j             |  1209 |
|   7 | cljsjs                |   868 |
|   8 | javax.servlet         |   786 |
|   9 | com.stuartsierra      |   642 |
|  10 | com.badlogicgames.gdx |   586 |
|  11 | cider                 |   560 |
|  12 | pjstadig              |   536 |
</code></pre><p>And finally, the question that inspired this article, what is the most used library?</p><pre><code>SELECT library, sum&#40;count&#41; count
FROM &#91;clojure.libraries&#93;
WHERE library != 'org.clojure/clojure'
GROUP BY library
ORDER BY count desc

| Row | library                     | count |
|-----+-----------------------------+-------|
|   1 | compojure                   |  3609 |
|   2 | lein-cljsbuild              |  3413 |
|   3 | org.clojure/clojurescript   |  3080 |
|   4 | org.clojure/core.async      |  2612 |
|   5 | lein-ring                   |  1809 |
|   6 | cheshire                    |  1802 |
|   7 | environ                     |  1763 |
|   8 | ring                        |  1678 |
|   9 | clj-http                    |  1648 |
|  10 | clj-time                    |  1613 |
|  11 | hiccup                      |  1591 |
|  12 | lein-figwheel               |  1582 |
|  13 | org.clojure/tools.logging   |  1579 |
|  14 | org.clojure/data.json       |  1546 |
|  15 | http-kit                    |  1423 |
|  16 | lein-environ                |  1325 |
|  17 | ring/ring-defaults          |  1302 |
|  18 | org.clojure/tools.nrepl     |  1244 |
|  19 | midje                       |  1122 |
|  20 | com.cemerick/piggieback     |  1096 |
|  21 | org.clojure/java.jdbc       |  1064 |
|  22 | org.clojure/tools.cli       |  1053 |
|  23 | enlive                      |  1001 |
|  24 | ring/ring-core              |   995 |
|  25 | org.clojure/tools.namespace |   982 |
</code></pre><p><a href='https://github.com/weavejester/compojure'>Compojure</a> takes the top slot. <a href='https://docs.google.com/a/jakemccrary.com/spreadsheets/d/1-zmcOVPKLGrdRT_VkTrRUuRFyuxxmXi9eeH6Xzlt7yg/edit?usp=sharing'>Full results are available</a>.</p><p>Before doing this research I tried to predict what libraries I'd see in the top 10. I thought that clj-time and clj-http would be up there. I'm happy to see my guess was correct.</p><p>It was pretty pleasant using BigQuery to do this analysis. Queries took at most seconds to execute. This quick feedback let me play around in the web interface without feeling like I was waiting for computers to do work. This made the research into Clojure library usage painless and fun. <ol class='footnotes'><li id='fn-1'>I did this in early March 2017.<a href='#fnref1'>&#8617;</a></li></ol></p>
  <script src="/highlight/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script></script>
  <footer>
    <p xmlns:cc="http://creativecommons.org/ns#" >This work by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://jakemccrary.com">Jake McCrary</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""></a></p> 
    <a href="/disclosure-policy">Disclosure Policy</a><br/>
  </footer>
</body>
</html>
