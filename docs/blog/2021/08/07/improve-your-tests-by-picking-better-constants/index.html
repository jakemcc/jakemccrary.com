<!DOCTYPE html>
<head lang="en">
  <meta charset="utf-8">
  <title>Improve your tests by picking better constants - Jake McCrary</title>
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="stylesheet" href="/style.css"> -->

  <meta itemprop="name" content="Improve your tests by picking better constants - Jake McCrary" />
  
  <meta itemprop="description" content="The constants you put in your test code can improve its readability. You should put thought into them." />
  

  <!-- Twitter Card data -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@jakemcc" />
  <meta name="twitter:title" content="Improve your tests by picking better constants - Jake McCrary" />
  
  <meta name="twitter:description" content="The constants you put in your test code can improve its readability. You should put thought into them." />
  
  <meta name="twitter:creator" content="@jakemcc" />
  <!-- <meta name="twitter:image" content="" /> -->

  <!-- Open Graph data -->
  <meta property="og:site_name" content="Writing by Jake McCrary" />
  <meta property="og:url" content="https://jakemccrary.com//blog/2021/08/07/improve-your-tests-by-picking-better-constants/" />
  <meta property="og:title" content="Improve your tests by picking better constants - Jake McCrary" />
  
  <meta property="og:description" content="The constants you put in your test code can improve its readability. You should put thought into them." />
  
  <!-- <meta property="og:image" content="" /> -->
  
  <meta property="og:type" content="article" />
  
  
  <!-- maybe rfc blahblahblah it? -->
  <meta property="article:published_time" content="2021-08-07T23:59:59+00:00" />
  

  <link rel="canonical" href="https://jakemccrary.com//blog/2021/08/07/improve-your-tests-by-picking-better-constants/">

  <style>
   body {
     font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
     max-width: 1200px;
     margin: 0 auto;
     padding: 1rem;
     line-height: 1.5;
   }

   header {
     margin-bottom: 0.5rem;
   }

   header h1 {
     margin: 0;
     font-size: 2.5rem;
   }

   header h1 a {
     color: #333;
     text-decoration: none;
   }

   .main-nav {
     display: flex;
     align-items: center;
     justify-content: space-between;
     padding: 0.5rem 0;
     margin-bottom: 2rem;
   }

   .nav-list {
     display: flex;
     list-style: none;
     margin: 0;
     padding: 0;
     gap: 1.5rem;
   }

   .nav-list a {
     text-decoration: none;
     color: #333;
   }

   .search-form fieldset {
     border: none;
     margin: 0;
     padding: 0;
   }

   .search {
     padding: 0.5rem;
     border: none;
     background: #f5f5f5;
     border-radius: 4px;
   }

   /* Blog post list styling */
   .post-list {
     list-style: none;
     padding: 0;
     margin: 0;
   }

   .post-list li {
     margin-bottom: 1.5rem;
   }

   .post-meta {
     margin-bottom: 0.25rem;
   }

   .post-meta time {
     color: #666;
     margin-right: 0.5rem;
   }

   .post-list h2 {
     display: inline;
     font-size: 1.1rem;
     font-weight: 500;
     margin: 0;
   }

   .post-list h2 a {
     color: #0066cc;
     text-decoration: none;
   }

   .post-list h2 a:hover {
     text-decoration: underline;
   }

   .post-description {
     color: #444;
     margin: 0.25rem 0 0 0;
     line-height: 1.6;
   }

   .right {
     float: right;
   }
   .left {
     float: left;
   }
   .mr1 {
     margin-right: 1em;
   }
   /* Style the footnote references in the text */
   [id^="fnref"] sup {
     font-size: 0.75em;
     line-height: 0;
     position: relative;
     top: -0.5em;
     padding: 0 0.3em;
   }

   [id^="fnref"] a {
     text-decoration: none;
     background-color: #f3f4f6;
     color: #4b5563;
     border-radius: 3px;
     padding: 2px 6px;
     transition: all 0.2s ease;
   }

   [id^="fnref"] a:hover {
     background-color: #e5e7eb;
     color: #1f2937;
   }

   /* Style the footnotes section */
   .footnotes {
     margin-top: 3rem;
     padding-top: 2rem;
     border-top: 2px solid #e5e7eb;
   }

   /* Create custom numbering for footnotes */
   .footnotes li {
     margin-bottom: 1rem;
     color: #4b5563;
   }
   
   /* Style the return links in footnotes */
   .footnotes li a[href^="#fnref"] {
     text-decoration: none;
     color: #6b7280;
     margin-left: 0.5rem;
     font-size: 0.875rem;
     transition: color 0.2s ease;
   }

   .footnotes li a[href^="#fnref"]:hover {
     color: #374151;
   }

   blockquote {
     border-left: 4px solid #d1d5db;
     padding-left: 1em;
     margin-left: 1em;
     color: #4b5563;
     font-style: italic;
     background-color: #f9fafb;
   }

   figure {
     margin: 1rem 0;
     text-align: center;
   }

   figcaption {
     color: #666;
     font-size: 0.9em;
     margin-top: 0.5rem;
     font-style: italic;
   }

   .page-header h1 {
     margin: 0
   }

   .page-header .publication-date {
     color: #666;
     font-size: 0.8em;
     margin: 0;
   }

   body > footer {
     font-size: .8em;
	   color: #888;
     margin-top: 1em;
	   padding-top: 1em;
     padding-bottom: 1em;
   }
   p code, li code {
     display: inline-block;
     white-space: nowrap;
     border: 1px solid #ddd;
     -moz-border-radius: .4em;
     -webkit-border-radius: .4em;
     border-radius: .4em;
     padding: 0 .3em;
     margin: -1px 0;
   }

  </style>
  <link rel="stylesheet" href="/highlight/base16/tomorrow-night.min.css">
</head>
<body>
<header>
    <h1><a href="/">Jake McCrary</a></h1>
  </header>
  <nav role="navigation" class="main-nav">
    <ul role="navigation" class="nav-list">
      <li><a href="/">Articles</a></li>
      <li><a href="/adventures/">Adventures</a></li>
      <li><a href="/about.html">About</a></li>
      <li><a href="/blog/archives/">Archives</a></li>
      <li><a href="http://feeds.feedburner.com/JakeMccrarysMusings" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      <li><a href="https://jakemccrary.substack.com/welcome" target="_blank" rel="subscribe-email" title="subscribe via email">Newsletter</a></li>
    </ul>
    <form class="search-form" action="https://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="sitesearch" value="jakemccrary.com">
        <input class="search" type="text" name="q" placeholder="Search">
      </fieldset>
    </form>
  </nav>
  
  <div class="page-header">
    <h1>Improve your tests by picking better constants</h1>
    
    
    <p class="publication-date">Published on 
      <time datetime="2021-08-07">August 7, 2021</time>
    </p>
    
  </div>
  

  <p>The constants you use in unit tests matter. Like test and variable names, they can improve the readability of your code and make it easier to understand test failures.</p><p>Imagine the following.</p><p>A new developer joins your team and asks a question about how the code resolves config values. You are unsure of the details so you pair up with the new teammate to dig into the code.</p><p>You know the codebase uses a relatively simple key-value pair concept for configuration. It reads keys and values from a known files and, based on some rules, either ignores or overrides values when keys are duplicated across files.</p><p><code>config-value</code> is the function that looks up the value for a particular configuration key, represented as a <code>string</code>. This function takes three arguments: an in-memory representation of the configuration files, the key to lookup, and the mode to operate in. You know the mode is important in influencing how config resolution works but you don't remember the details.</p><p>Luckily for you and your pair, the codebase has plenty of unit tests. The two of you dive in and look at some tests, hoping to understand how config resolution works.</p><pre><code class="language-clojure">&#40;def config {&quot;scratch.conf&quot; {&quot;a&quot; &quot;1&quot;}

             &quot;development.conf&quot; {&quot;a&quot; &quot;2&quot;
                                 &quot;b&quot; &quot;2&quot;}

             &quot;application.conf&quot; {&quot;a&quot; &quot;3&quot;
                                 &quot;b&quot; &quot;3&quot;
                                 &quot;c&quot; &quot;3&quot;}}&#41;

&#40;deftest handles-overrides-in-dev-mode
  &#40;is &#40;= &quot;1&quot; &#40;config-value config &quot;a&quot; :dev&#41;&#41;&#41;
  &#40;is &#40;= &quot;2&quot; &#40;config-value config &quot;b&quot; :dev&#41;&#41;&#41;
  &#40;is &#40;= &quot;3&quot; &#40;config-value config &quot;c&quot; :dev&#41;&#41;&#41;&#41;

&#40;deftest handles-overrides-in-prod-mode
  &#40;is &#40;= &quot;3&quot; &#40;config-value config &quot;a&quot; :prod&#41;&#41;&#41;
  &#40;is &#40;= &quot;3&quot; &#40;config-value config &quot;b&quot; :prod&#41;&#41;&#41;
  &#40;is &#40;= &quot;3&quot; &#40;config-value config &quot;c&quot; :prod&#41;&#41;&#41;&#41;
</code></pre><p>It is great that these tests exist but they could be clearer. They aren't terrible but you have to work a bit understand what is happening.</p><p>When reading <code>&#40;= &quot;2&quot; &#40;config-value config &quot;b&quot; :dev&#41;&#41;</code>, what does <code>&quot;2&quot;</code> represent? What does <code>&quot;b&quot;</code> mean? You have to either keep the value of <code>config</code> in your brain or keep glancing up in the file to recall what it is.</p><p>This isn't great. This adds cognitive overhead that doesn't need to be there.</p><p>There are a few ways these tests could be improved One way is through using better constants. Let's do a quick rewrite.</p><pre><code class="language-clojure">&#40;def config {&quot;scratch.conf&quot; {&quot;in dev+app+scratch&quot; &quot;from scratch&quot;}

             &quot;development.conf&quot; {&quot;in dev+app+scratch&quot; &quot;from development&quot;
                                 &quot;in dev+app&quot; &quot;from development&quot;}

             &quot;application.conf&quot; {&quot;in dev+app+scratch&quot; &quot;from application&quot;
                                 &quot;in dev+app&quot; &quot;from application&quot;
                                 &quot;in app&quot; &quot;from application&quot;}}&#41;

&#40;deftest handles-overrides-in-dev-mode
  &#40;is &#40;= &quot;from scratch&quot; &#40;config-value config &quot;in dev+app+scratch&quot; :dev&#41;&#41;&#41;
  &#40;is &#40;= &quot;from development&quot; &#40;config-value config &quot;in dev+app&quot; :dev&#41;&#41;&#41;
  &#40;is &#40;= &quot;from application&quot; &#40;config-value config &quot;in app&quot; :dev&#41;&#41;&#41;&#41;

&#40;deftest handles-overrides-in-prod-mode
  &#40;is &#40;= &quot;from application&quot; &#40;config-value config &quot;in dev+app+scratch&quot; :prod&#41;&#41;&#41;
  &#40;is &#40;= &quot;from application&quot; &#40;config-value config &quot;in dev+app&quot; :prod&#41;&#41;&#41;
  &#40;is &#40;= &quot;from application&quot; &#40;config-value config &quot;in app&quot; :prod&#41;&#41;&#41;&#41;
</code></pre><p>These are the same tests but with different constants. Those constants make a huge difference. This change has made the tests more legible. You no longer need to remember the value of <code>config</code> or keep glancing up at it to understand the assertions in a test.</p><p>You can read <code>&#40;= &quot;from development&quot; &#40;config-value config &quot;in dev+app&quot; :dev&#41;&#41;</code> and have a pretty solid idea that you are looking up a key found in both <code>development.conf</code> and <code>application.conf</code> and while in <code>:dev</code> mode expect the value from <code>development.conf</code>.</p><p>The new constants provide clues about what the test expects. You can read and understand the assertions without keeping much state in your head.</p><p>This increases the legibility of the tests and is useful when a test fails. Which of the following is clearer?</p><pre><code>FAIL in &#40;handles-overrides-in-dev-mode&#41;
expected: &quot;2&quot;
  actual: &quot;3&quot;
    diff: - &quot;2&quot;
          + &quot;3&quot;
</code></pre><pre><code>FAIL in &#40;handles-overrides-in-dev-mode&#41;
expected: &quot;from development&quot;
  actual: &quot;from application&quot;
    diff: - &quot;from development&quot;
          + &quot;from application&quot;
</code></pre><p>The second one is clearer. You can read it and form a hypothesis about what might be broken.</p><p>Well chosen constants reduce the state a person needs to keep in their head. This makes tests easier to understand. Good constants also make test failures easier to understand. Just like good variable names, good constants increase the readability of our tests.</p><p>It is well worth placing some extra thought into the constants found in your tests.</p>
  <script src="/highlight/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script></script>
  <footer>
    <p xmlns:cc="http://creativecommons.org/ns#" >This work by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://jakemccrary.com">Jake McCrary</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""></a></p> 
    <a href="/disclosure-policy">Disclosure Policy</a><br/>
  </footer>
</body>
</html>
